<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>HK Talk</title>
  
  <subtitle>å…³äºæŠ€æœ¯ï¼Œå…³äºç”Ÿæ´»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.hhking.cn/"/>
  <updated>2020-08-21T11:20:08.931Z</updated>
  <id>https://blog.hhking.cn/</id>
  
  <author>
    <name>hhking</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä» Babel7 ç¼–è¯‘ node_modules æŠ¥é”™è¯´èµ·</title>
    <link href="https://blog.hhking.cn/2020/08/21/babel-with-node-modules/"/>
    <id>https://blog.hhking.cn/2020/08/21/babel-with-node-modules/</id>
    <published>2020-08-21T11:06:48.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ğŸ™„, è¿™ç¯‡å¯ä»¥ç»“åˆ <a href="https://blog.hhking.cn/2019/04/02/babel-v7-update/">Babel 7 å‡çº§å®è·µ</a> ä¸€èµ·çœ‹</p></blockquote><h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><ul><li>Aï¼šæˆ‘è¿™è¾¹æœ‰é—®é¢˜å•Šï¼Œæ€ä¹ˆé¡µé¢ç©ºç™½ï¼Ÿ</li><li>Bï¼šæˆ‘è¿™é‡Œæ˜æ˜æ˜¯å¥½çš„ï¼</li><li>Aï¼šä½ è‡ªå·±æ¥è¯•</li><li>Bï¼šæ€ä¹ˆè¿™ä¹ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜</li></ul><p>è¿™æ˜¯å‘ç”Ÿåœ¨æˆ‘å’ŒåŒäº‹ä¹‹é—´çš„å¯¹è¯ã€‚æˆ‘è·‘è¿‡å»çœ‹äº†ä¸€ä¸‹æ§åˆ¶å°ï¼Œé¡µé¢ç›´æ¥çˆ†ç‚¸ğŸ’¥äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught TypeError: $ is not a function</span><br></pre></td></tr></table></figure><p>å®šä½åˆ°æ˜¯ <code>core-js</code> çš„æŸä¸ªæ–‡ä»¶æç¤ºè¿™ä¸ªé”™ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ</p><p>google äº†ä¸€åœˆï¼Œå†ç»“åˆé¡¹ç›®çš„é…ç½®ï¼Œç»ˆäºå®šä½åˆ°é—®é¢˜ï¼š<code>babel</code> ç¼–è¯‘ <code>node_modules</code>, <code>core-js</code> è‡ªå·± polyfill è‡ªå·±ï¼Œå¯¼è‡´çš„æŠ¥é”™ã€‚</p><h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>å¥½é•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰çœ‹ babel çš„é…ç½®ï¼Œåˆé‡æ–°å­¦ä¹ äº†ä¸€éã€‚</p><p>æˆ‘ä¹‹å‰çš„åšå®¢ <a href="https://blog.hhking.cn/2019/04/02/babel-v7-update/">Babel 7 å‡çº§å®è·µ</a> åœ¨æœ€åé¢çš„<strong>æ€»ç»“</strong>ä¸­æåˆ°ï¼ŒBabel 7 è§£å†³äº†ç¼–è¯‘ <code>node_modules</code> çš„é—®é¢˜, æ‰€ä»¥æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰å­¦åˆ°çš„å†…å®¹ï¼Œé¡¹ç›®çš„ babel çš„é…ç½®å¯èƒ½ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    [</span><br><span class="line">      &quot;@babel/preset-env&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        modules: false,</span><br><span class="line">        useBuiltIns: &apos;usage&apos;,</span><br><span class="line">        corejs: &#123;</span><br><span class="line">          version: 3,</span><br><span class="line">          proposals: true,</span><br><span class="line">        &#125;,</span><br><span class="line">        targets: &#123;</span><br><span class="line">          chrome: 58,</span><br><span class="line">          ie: 11,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬é¡¹ç›®é‡Œè¿˜æœ‰ <code>core-js</code> å’Œ <code>webpack</code>ï¼Œæ‰€ä»¥å¯èƒ½å°±æ‚²å‰§äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught TypeError: $ is not a function</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…·ä½“å¯ä»¥çœ‹è¿™ä¸ª <a href="https://github.com/zloirock/core-js/issues/743#issuecomment-572096103" target="_blank" rel="noopener">issue çš„è§£é‡Š</a> ï¼š</p><p>æˆ‘ä»¬ä½¿ç”¨ polyfill çš„æ—¶å€™ä¼šæ³¨å…¥ <code>require(&quot;core-js/...&quot;)</code>, è¿™æ—¶</p><ol><li>å¯¼å…¥ <code>core-js</code></li><li><code>core-js</code> ä¾èµ– <code>webpack/buildin</code></li><li><code>webpack/buildin</code> è¢«ç¼–è¯‘ï¼Œpolyfill éœ€è¦ä¾èµ– <code>core-js</code></li><li><code>core-js</code> åœ¨ <code>1</code> å·²ç»å¯¼å…¥è¿‡ï¼Œ<code>module.exports</code> åˆå§‹åŒ–æˆäº† <code>{}</code>ï¼ŒåŸæœ¬æ˜¯æœŸæœ›å¯¼å…¥çš„æ˜¯ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±å‡ºç°é”™è¯¯ã€‚</li></ol><p>æ‰€ä»¥åœ¨ç¼–è¯‘ <code>node_modules</code> æ—¶ï¼Œéœ€è¦æ³¨æ„ï¼š</p><ul><li>æ’é™¤æ‰ <code>core-js</code></li><li><code>webpack/buildin</code></li><li>å¦‚æœè¿˜ç”¨åˆ°äº† <code>@babel/plugin-transform-runtime</code>ï¼Œè¿˜éœ€è¦æ’é™¤ <code>@babel/runtime-corejs3</code></li></ul><p>ä¹Ÿå°±æ˜¯ babel éœ€è¦æ·»åŠ ä¸‹é¢é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exclude : [</span><br><span class="line">  /\bcore-js\b/,</span><br><span class="line">  /\bwebpack\/buildin\b/,</span><br><span class="line">  /@babel\/runtime-corejs3/</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>é€šè¿‡ chrome çš„è°ƒè¯•ï¼Œä¹Ÿå¯ä»¥ç¡®å®šä¸Šé¢è¯´çš„ï¼Œæœ€å <code>$</code> å…¶å®æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯å¯¼å…¥äº†ç©ºå¯¹è±¡ï¼Œä¸æ˜¯æœŸæœ›çš„å‡½æ•°ï¼‰</p><p>æˆ‘ä»¬æ–­ç‚¹åœ¨æŠ¥é”™çš„ä½ç½®ï¼š<br><img src="https://i.loli.net/2020/08/21/ZUnMzubiDetrOox.png" alt="1.png"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯å¯¼å…¥ <code>/internals/export</code> æ˜¯ä¸ªç©ºå¯¹è±¡ã€‚æˆ‘ä»¬æ‰¾åˆ° <code>/internals/export</code> ï¼Œåœ¨é¡¶éƒ¨æ–­ç‚¹ååˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°å…ˆæ‰§è¡Œäº†è¿™ä¸ªæ–‡ä»¶<br><img src="https://i.loli.net/2020/08/21/FptPDOJ192vhniz.png" alt="2.png"></p><p>ç”±æ­¤æˆ‘ä»¬å¤§è‡´å¯ä»¥çœ‹å‡ºæ¥è¿‡ç¨‹ï¼š<br>1ã€require <code>/internals/export</code><br>2ã€<code>/internals/export</code> å¾€åæ‰§è¡Œï¼Œåˆ require äº† <code>es.array.index-of</code><br>3ã€<code>es.array.index-of</code> è¿™æ—¶å€™ require <code>/internals/export</code><br>4ã€<code>/internals/export</code> å·²ç»å¯¼å…¥äº†ï¼Œ<code>module.exports</code> åˆå§‹åŒ–æˆäº† <code>{}</code>ï¼Œæ‰€ä»¥ <code>$</code> èµ‹å€¼æˆäº†ç©ºå¯¹è±¡ï¼Œç»§ç»­æ‰§è¡Œå°±æŠ¥é”™äº†</p><p>é—®é¢˜æ¥äº†ï¼Ÿä¸ºä»€ä¹ˆ <code>$</code> ä¼šå˜æˆï¼Œå…¶å®æ˜¯ <code>commonjs</code> å¾ªç¯ <code>import</code> çš„é—®é¢˜ã€‚</p><h2 id="å¾ªç¯å¯¼å…¥"><a href="#å¾ªç¯å¯¼å…¥" class="headerlink" title="å¾ªç¯å¯¼å…¥"></a>å¾ªç¯å¯¼å…¥</h2><p>ä¸Šé¢çš„é—®é¢˜ï¼Œå¯ä»¥è¯´æ˜¯ <code>commonjs</code> çš„ç‰¹æ€§ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">File A:</span><br><span class="line">var b = require(`file B`)</span><br><span class="line"></span><br><span class="line">File B:</span><br><span class="line">var a = require(`file A`)</span><br></pre></td></tr></table></figure><p>å½“ä½¿ç”¨ commonjs require ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œæ¨¡å—çš„ export ä¼šåˆå§‹åŒ–æˆç©ºå¯¹è±¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œè¿™ä¸ªæ¨¡å—é‡Œçš„åç»­ä»£ç æ—¶ï¼Œä¼šå¯¹ export è¿›è¡Œæ‰©å±•æˆ–è€…é‡å†™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶å¯¼å‡ºçš„å†…å®¹ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.namedExport = function() &#123; /* ... */ &#125;; // extends</span><br><span class="line"></span><br><span class="line">module.exports = &#123; namedExport: function() &#123; /* ... */ &#125; &#125;; // overrides</span><br></pre></td></tr></table></figure><p></p><p>ä½†æ˜¯æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œæƒ…å†µæ˜¯è¿™æ ·çš„ï¼š</p><ul><li>require æ¨¡å—Aï¼ŒA çš„å¯¼å‡ºåˆå§‹åŒ–æˆç©ºå¯¹è±¡</li><li>A åˆå» require æ¨¡å— B</li><li>B è¿™æ—¶åˆ require A</li></ul><p>è€Œ A åœ¨ä¸€å¼€å§‹å·²ç» require è¿‡ï¼ŒA é‡Œçš„åç»­ä»£ç ä¸ä¼šå†æ‰§è¡Œï¼Œæ‰€ä»¥è¿”å›äº†ä¸€ä¸ªç©ºå¯¹è±¡ã€‚å¦‚æœ A ç»§ç»­æ‰§è¡Œï¼Œå°±ä¼šå¯¼è‡´æ­»å¾ªç¯äº†ã€‚æ‰€ä»¥ a çš„å€¼ä¹Ÿå°±æ˜¯ä¸ªç©ºå¯¹è±¡äº†ã€‚</p><h2 id="æœ€å¼€å§‹çš„é—®é¢˜"><a href="#æœ€å¼€å§‹çš„é—®é¢˜" class="headerlink" title="æœ€å¼€å§‹çš„é—®é¢˜"></a>æœ€å¼€å§‹çš„é—®é¢˜</h2><p>é€šè¿‡ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œåªè¦æˆ‘ä»¬ç¼–è¯‘ <code>node_modules</code> æ—¶å€™ï¼Œæ’é™¤ä¸€äº›ä¸éœ€è¦çš„æ–‡ä»¶å°±è¡Œäº†ã€‚</p><p>ä½†æ˜¯åœ¨æˆ‘ä»¬çš„é¡¹ç›®ï¼Œå…¶å®æ˜¯å·²ç»é…ç½®äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// babel.config.js</span><br><span class="line">ignore: [/\core-js/, /webpack\/buildin/]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨æˆ‘è‡ªå·±çš„ç”µè„‘ä¸Šæ˜¯æ²¡é—®é¢˜çš„ã€‚é—®é¢˜åœ¨å“ªï¼Ÿ</p><p>æˆ‘ç”¨çš„æ˜¯ <code>mac</code>ï¼ŒåŒäº‹çš„æ˜¯ <code>windows</code>ï¼Œçœ‹æ¥æ˜¯ <code>windows</code> ä¸‹å‡ºç°çš„é—®é¢˜ã€‚</p><p>æŸ¥äº†ä¸€ä¸‹ babel çš„æ–‡æ¡£ï¼Œå‘ç° <code>ignore</code> çš„åŒ¹é…æ¨¡å¼æœ‰ä¸¤ç§ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯ <code>RegExp</code>ï¼š</p><blockquote><p>RegExp - A regular expression to match against the normalized filename. On POSIX the path RegExp will run against a /-separated path, and on Windows it will be on a -separated path.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ mac å’Œ windows çš„åˆ†éš”ç¬¦æ˜¯æ²¡æ³•è‡ªåŠ¨å¤„ç†çš„ï¼Œéœ€è¦åŒºåˆ†ï¼</p><p>è§£å†³åŠæ³•ä¹Ÿç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ <code>string</code> çš„æ¨¡å¼ï¼Œæˆ–è€…ç®€å•ç²—æš´çš„ç›´æ¥æ·»åŠ å¯¹ windows çš„åŒ¹é…ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// babel.config.js</span><br><span class="line">ignore: [/\/core-js/, /webpack\/buildin/, /\\core-js/, /webpack\\buildin/]</span><br></pre></td></tr></table></figure><p></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨ babel ç¼–è¯‘ node_modules æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸‹é¢çš„é…ç½®ï¼š</p><ul><li>çœ‹æƒ…å†µéœ€è¦ exclude <code>core-js</code>ã€<code>webpack/buildin</code>ã€<code>@babel/runtime-corejs3</code></li><li>å¦‚æœæ˜¯åœ¨ <code>babel.config.js</code> é…ç½®åŒ¹é…æ¨¡å¼ï¼Œéœ€è¦æ³¨æ„æ˜¯å¦æœ‰è·¨å¹³å°çš„é—®é¢˜ï¼Œæ¯”å¦‚åˆ†éš”ç¬¦çš„å…¼å®¹</li></ul><p>æœ€åéœ€è¦åæ§½ä¸€ä¸‹ï¼šåŠ äº† <code>node_modules</code> ç¼–è¯‘ï¼Œåˆæ¬¡ç¼–è¯‘æ…¢äº†ä¸€å€ï¼ï¼ï¼å‘Šè¾ï¼ğŸ‘‹</p><p>THE ENDï¼</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://stackoverflow.com/questions/30378226/circular-imports-with-webpack-returning-empty-object" target="_blank" rel="noopener">circular imports with webpack returning empty object</a></li><li><a href="https://stackoverflow.com/questions/57361439/how-to-exclude-core-js-using-usebuiltins-usage" target="_blank" rel="noopener">How to exclude core-js using useBuiltIns: â€œusageâ€</a></li><li><a href="https://babeljs.io/docs/en/options#matchpattern" target="_blank" rel="noopener">Babel MatchPattern</a></li><li><a href="https://github.com/babel/babel/issues/7559" target="_blank" rel="noopener">useBuiltins: â€˜usageâ€™ fails with babel-loader when not excluding node_modules</a></li><li><a href="https://github.com/zloirock/core-js/issues/743" target="_blank" rel="noopener">Uncaught TypeError: isObject is not a function (with useBuiltIns: usage)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;å¥½ä¹…æ²¡æ›´æ–°åšå®¢äº†ğŸ™„, è¿™ç¯‡å¯ä»¥ç»“åˆ &lt;a href=&quot;https://blog.hhking.cn/2019/04/02/babel-v7-update/&quot;&gt;Babel 7 å‡çº§å®è·µ&lt;/a&gt; ä¸€èµ·çœ‹&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Babel" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/Babel/"/>
    
    
      <category term="Babel" scheme="https://blog.hhking.cn/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>Git åˆ†æ”¯å¼€å‘è§„èŒƒ</title>
    <link href="https://blog.hhking.cn/2019/12/28/git-branch-guideline/"/>
    <id>https://blog.hhking.cn/2019/12/28/git-branch-guideline/</id>
    <published>2019-12-28T03:30:39.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨æ•´ç†æ–‡æ¡£å’Œä¸€äº›å›¢é˜Ÿè§„èŒƒï¼Œæ•´ç†äº†ä¸€ä¸‹å›¢é˜Ÿä¸­ä½¿ç”¨ Git çš„ä¸€äº›è§„èŒƒã€‚</p><blockquote><p>è§„èŒƒçš„åˆ¶å®šï¼Œè¦æ ¹æ®ä¸åŒå›¢é˜Ÿå’Œåœºæ™¯</p></blockquote><h2 id="åˆ†æ”¯å‘½å"><a href="#åˆ†æ”¯å‘½å" class="headerlink" title="åˆ†æ”¯å‘½å"></a>åˆ†æ”¯å‘½å</h2><h3 id="master-åˆ†æ”¯"><a href="#master-åˆ†æ”¯" class="headerlink" title="master åˆ†æ”¯"></a>master åˆ†æ”¯</h3><ul><li><code>master</code> æ˜¯ä¸»åˆ†æ”¯ï¼Œç”¨äºéƒ¨ç½²çº¿ä¸Šç”Ÿäº§ç¯å¢ƒ</li><li><code>master</code> åˆ†æ”¯ç”± <code>release</code>ã€<code>hotfix</code> åˆ†æ”¯åˆå¹¶ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹</li></ul><h3 id="release-åˆ†æ”¯"><a href="#release-åˆ†æ”¯" class="headerlink" title="release åˆ†æ”¯"></a>release åˆ†æ”¯</h3><ul><li><code>release</code> æ˜¯é¢„å‘å¸ƒåˆ†æ”¯ï¼Œå¯¹åº”éƒ¨ç½²é¢„å‘å¸ƒç¯å¢ƒ</li><li><code>release</code> åˆ†æ”¯ä¸€èˆ¬ç”± <code>develop</code> åˆ†æ”¯åˆå¹¶</li><li><code>release</code> åˆ†æ”¯å®Œæˆæµ‹è¯•ä¸Šçº¿æ—¶ï¼Œè¦åˆ†åˆ«åˆå¹¶åˆ° <code>master</code> å’Œ <code>develop</code> åˆ†æ”¯</li></ul><h3 id="develop-åˆ†æ”¯"><a href="#develop-åˆ†æ”¯" class="headerlink" title="develop åˆ†æ”¯"></a>develop åˆ†æ”¯</h3><ul><li><code>develop</code> ä¸ºå¼€å‘åˆ†æ”¯ï¼Œå¯¹åº”éƒ¨ç½²æµ‹è¯•ç¯å¢ƒ</li><li><code>develop</code> åˆ†æ”¯éœ€è¦ä¿æŒæœ€æ–°å’Œ bug ä¿®å¤åçš„ä»£ç </li></ul><h3 id="feature-åˆ†æ”¯"><a href="#feature-åˆ†æ”¯" class="headerlink" title="feature åˆ†æ”¯"></a>feature åˆ†æ”¯</h3><ul><li>å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œä» <code>develop</code> åˆ†æ”¯åˆ›å»ºæ–°çš„åŠŸèƒ½åˆ†æ”¯</li><li>åŠŸèƒ½åˆ†æ”¯éƒ½ä»¥ <code>feature/</code> å¼€å¤´ï¼Œå‘½åè§„åˆ™ï¼š<code>feature/**</code>ï¼Œä¾‹å¦‚ï¼š<code>feature/user-center</code></li><li>åŠŸèƒ½å®Œæˆååˆå¹¶åˆ° <code>develop</code> åˆ†æ”¯æµ‹è¯•ï¼Œå¹¶åˆ é™¤å¯¹åº”çš„åŠŸèƒ½åˆ†æ”¯</li></ul><h3 id="hotfix-åˆ†æ”¯"><a href="#hotfix-åˆ†æ”¯" class="headerlink" title="hotfix åˆ†æ”¯"></a>hotfix åˆ†æ”¯</h3><ul><li>ç´§æ€¥ä¿®å¤ bug åˆ†æ”¯ï¼Œä» <code>master</code> åˆ†æ”¯åˆ›å»º</li><li>å‘½åä»¥ <code>hotfix/</code> å¼€å¤´ï¼Œä¾‹å¦‚ï¼š<code>hotfix/user-bug</code></li><li>bug ä¿®å¤å®Œæˆåï¼Œè¦åˆ†åˆ«åˆå¹¶åˆ° <code>master</code> å’Œ <code>develop</code> åˆ†æ”¯</li></ul><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><ul><li>ä¸ºäº†ä¿è¯ <code>develop</code> åˆ†æ”¯æ˜¯æœ€æ–°çš„ï¼Œdevelop åœ¨åˆå¹¶åˆ° release æ—¶ï¼Œå…ˆåˆå¹¶ä¸€ä¸‹ master åˆ†æ”¯ï¼Œå¯ä»¥é¿å…ä¹‹å‰å¿˜è®° release æˆ–è€… hotfix åˆå¹¶åˆ° develop</li><li>è®¾ç½® master ä¸ºä¿æŠ¤åˆ†æ”¯ï¼Œæ§åˆ¶æƒé™</li><li>ä¸Šçº¿è¦åˆå¹¶åˆ° master æ—¶ï¼Œé€šè¿‡åœ¨ gitlab ä¸Šæ Merge Request ç»™å¯¹åº”çš„ç®¡ç†å‘˜æ¥æ“ä½œ</li><li>åˆ†æ”¯å‘½åä»¥ <code>/</code> åˆ’åˆ†å¯ä»¥åœ¨ GUI å·¥å…·ä¸­åˆ†æˆä¸€ä¸ªç›®å½•åˆ†ç±»</li><li>å…·ä½“çš„æ“ä½œæµç¨‹è¦æ ¹æ®å›¢é˜Ÿæ¥è°ƒæ•´</li></ul><h2 id="æäº¤è§„èŒƒ"><a href="#æäº¤è§„èŒƒ" class="headerlink" title="æäº¤è§„èŒƒ"></a>æäº¤è§„èŒƒ</h2><h3 id="æ—¥å¿—è§„èŒƒ"><a href="#æ—¥å¿—è§„èŒƒ" class="headerlink" title="æ—¥å¿—è§„èŒƒ"></a>æ—¥å¿—è§„èŒƒ</h3><p>ç¼–å†™æ¸…æ™°è‰¯å¥½çš„ commit message ï¼Œå¯ä»¥æé«˜å¯è¯»æ€§ï¼Œæ–¹ä¾¿æŸ¥çœ‹æäº¤å†å²è®°å½•</p><p>ä¸šç•Œå¹¿æ³›é‡‡ç”¨çš„ä¸€ç§è§„èŒƒæ˜¯ <a href="https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines" target="_blank" rel="noopener">Angular Git Commit Guidelines</a></p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å›¢é˜Ÿçš„æƒ…å†µæ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ç®€åŒ–ä½¿ç”¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;: &lt;subject&gt;</span><br></pre></td></tr></table></figure><p>typeçš„ç±»åˆ«è¯´æ˜:</p><ul><li>feat: æ·»åŠ æ–°ç‰¹æ€§</li><li>fix: ä¿®å¤bug</li><li>docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£</li><li>style: ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€éƒ½å¥½ç­‰ç­‰ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘</li><li>refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰åŠ æ–°åŠŸèƒ½æˆ–è€…ä¿®å¤bug</li><li>perf: å¢åŠ ä»£ç è¿›è¡Œæ€§èƒ½æµ‹è¯•</li><li>test: å¢åŠ æµ‹è¯•ç”¨ä¾‹</li><li>chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰</li></ul><p>subject ä¸»è¦å†™æ¸…æ¥šè¿™æ¬¡æ›´æ–°æˆ–è€…ä¿®æ”¹çš„å†…å®¹</p><h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><p>å®Œæˆä¸€ä¸ªåŠŸèƒ½ç‚¹æˆ–è€…å®Œæˆä¸€æ¬¡å®Œæ•´çš„ä¿®æ”¹åï¼Œå†æäº¤ commitã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨æ•´ç†æ–‡æ¡£å’Œä¸€äº›å›¢é˜Ÿè§„èŒƒï¼Œæ•´ç†äº†ä¸€ä¸‹å›¢é˜Ÿä¸­ä½¿ç”¨ Git çš„ä¸€äº›è§„èŒƒã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;è§„èŒƒçš„åˆ¶å®šï¼Œè¦æ ¹æ®ä¸åŒå›¢é˜Ÿå’Œåœº
      
    
    </summary>
    
      <category term="Git" scheme="https://blog.hhking.cn/categories/Git/"/>
    
    
      <category term="Git" scheme="https://blog.hhking.cn/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>HTTP å’Œå®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯</title>
    <link href="https://blog.hhking.cn/2019/08/25/http-security-headers/"/>
    <id>https://blog.hhking.cn/2019/08/25/http-security-headers/</id>
    <published>2019-08-25T09:01:33.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>WEB åº”ç”¨è¶Šæ¥è¶Šå¤æ‚ï¼Œå‰ç«¯æ‰€æ‰¿æ‹…çš„ä¹Ÿä¸å†ä»…ä»…æ˜¯åˆ‡å›¾ã€å†™ç•Œé¢çš„ä»»åŠ¡ã€‚ä½œä¸ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆï¼ŒæŒæ¡å¿…è¦çš„ WEB å®‰å…¨ç›¸å…³çš„çŸ¥è¯†ï¼Œä¹Ÿæ˜¯å¿…è¦çš„ã€‚<br>è¿™é‡Œæ”¶é›†æ•´ç†äº† HTTP ä¸­å’Œå®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯å†…å®¹ï¼Œäº†è§£è¿™äº›å¤´ä¿¡æ¯ï¼Œåœ¨æå‡ç½‘ç«™çš„å®‰å…¨æ€§ä¸Šï¼Œæ˜¯æœ‰ä¸å°‘å¸®åŠ©çš„ã€‚</p><h2 id="å®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯"><a href="#å®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯" class="headerlink" title="å®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯"></a>å®‰å…¨ç›¸å…³çš„å¤´ä¿¡æ¯</h2><h3 id="Content-Security-Policy"><a href="#Content-Security-Policy" class="headerlink" title="Content-Security-Policy"></a>Content-Security-Policy</h3><p>å†…å®¹å®‰å…¨ç­–ç•¥ CSP (Content-Security-Policy) çš„ä¸»è¦ç›®çš„æ˜¯å‡å°‘å’ŒæŠ¥å‘Š XSS æ”»å‡»ã€‚</p><p>å®ç°çš„æ–¹å¼æ˜¯é€šè¿‡ç™½åå•æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æä¾›å¯ä¿¡èµ–çš„å¤–éƒ¨èµ„æºæ¥æºçš„ç™½åå•ï¼Œæµè§ˆå™¨æ ¹æ®ç™½åå•æ¥è·å–èµ„æºã€‚</p><p>æ¥çœ‹ä¸‹ MDN ä¸Šæä¾›çš„ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &apos;self&apos;; img-src *; media-src media1.com media2.com; script-src userscripts.example.com; report-uri http://reportcollector.example.com/collector.cgi</span><br></pre></td></tr></table></figure><p><code>default-src &#39;self&#39;;</code>: è¡¨ç¤ºå„ç§å†…å®¹å…è®¸ä»æ–‡æ¡£æ‰€åœ¨çš„æºè·å–(ä¸åŒ…æ‹¬å…¶å­åŸŸå)<br><code>img-src *;</code>: å›¾ç‰‡å¯ä»¥ä»ä»»ä½•åœ°æ–¹åŠ è½½<br><code>media-src media1.com media2.com;</code>: å¤šåª’ä½“æ–‡ä»¶ä»…å…è®¸ä» media1.com å’Œ media2.com åŠ è½½(ä¸åŒ…æ‹¬å…¶å­åŸŸå)<br><code>script-src userscripts.example.com</code>: å¯è¿è¡Œè„šæœ¬ä»…å…è®¸æ¥è‡ªäºuserscripts.example.com<br><code>report-uri</code>: è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œè¡¨ç¤ºå¯ç”¨å‘é€è¿è§„æŠ¥å‘Šï¼Œä¹Ÿå°±æ˜¯ä¼šæŠŠè¿è§„çš„ä¿¡æ¯ (JSON æ ¼å¼) å‘é€åˆ°é…ç½®çš„ URI åœ°å€</p><blockquote><p>å‚è€ƒ:</p><p><a href="https://content-security-policy.com/" target="_blank" rel="noopener">CSP Reference</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener">å†…å®¹å®‰å…¨ç­–ç•¥( CSP )</a></p></blockquote><h3 id="Strict-Transport-Security"><a href="#Strict-Transport-Security" class="headerlink" title="Strict-Transport-Security"></a>Strict-Transport-Security</h3><p>å¦‚æœä½ çš„ç½‘ç«™å¯åŠ¨äº† HTTPSï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œå‘Šè¯‰æµè§ˆå™¨ä½ çš„ç½‘ç«™åªèƒ½é€šè¿‡ HTTPS æ¥è®¿é—®ã€‚</p><p>ä½œç”¨ï¼šä¾‹å¦‚æˆ‘ä»¬åœ¨è®¿é—® HTTP ç½‘ç«™æ—¶ï¼Œç½‘ç«™å†è‡ªåŠ¨è·³è½¬åˆ° HTTPSï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸­é—´äººæ”»å‡»æ½œåœ¨å¨èƒï¼Œå› ä¸ºåœ¨è·³è½¬åˆ° HTTPS ä¹‹å‰ï¼Œç”¨æˆ·ä¿¡æ¯æ˜¯æœªåŠ å¯†çš„ã€‚é…ç½® STS å¯ä»¥è®©æµè§ˆå™¨è‡ªåŠ¨æ›¿æ¢ HTTP ä¸º HTTPS è¯·æ±‚ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=1000; includeSubDomains</span><br></pre></td></tr></table></figure><p><code>max-age</code>: è®¾ç½®åœ¨æµè§ˆå™¨æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åçš„ 1000 ç§’çš„æ—¶é—´å†…å‡¡æ˜¯è®¿é—®è¿™ä¸ªåŸŸåä¸‹çš„è¯·æ±‚éƒ½ä½¿ç”¨HTTPSè¯·æ±‚ã€‚</p><p><code>includeSubDomains</code> è¯¥ç½‘ç«™çš„æ‰€æœ‰å­åŸŸåä¹Ÿå¯ç”¨è¯¥è§„åˆ™ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Security/HTTP_Strict_Transport_Security" target="_blank" rel="noopener">HTTP Strict Transport Security</a></p></blockquote><h3 id="X-Content-Type-Options"><a href="#X-Content-Type-Options" class="headerlink" title="X-Content-Type-Options"></a>X-Content-Type-Options</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å“åº”å¤´çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener"><code>Content-Type</code></a> æ¥è¾¨åˆ«è¯·æ±‚èµ„æºçš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>&quot;</code>text/css<code>&quot;</code> è¡¨ç¤º <code>style</code> ç±»å‹ã€‚ä½†æ˜¯å¦‚æœä¸æŒ‡å®š MIME ç±»å‹æˆ–è€…æŒ‡å®šé”™è¯¯ï¼Œæµè§ˆå™¨ä¼šè¿›è¡Œ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#MIME_sniffing" target="_blank" rel="noopener">MIME ç±»å‹å—…æ¢</a>ï¼ŒçŒœæµ‹èµ„æºçš„ç±»å‹ï¼Œç„¶åè¿›è¡Œè§£æã€‚è€Œè¿™ä¸ªè¡Œä¸ºå¯èƒ½ä¼šè¢«æ¶æ„æ”»å‡»ã€‚</p><p>é…ç½®æ–¹å¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Content-Type-Options: nosniff</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šé€šè¿‡è¿™ä¸ªé…ç½®ï¼Œå¯ä»¥è®©æµè§ˆå™¨æŒ‰æœåŠ¡ç«¯è¿”å›çš„æŒ‡å®šç±»å‹è¿›è¡Œå†…å®¹è§£æã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Content-Type-Options" target="_blank" rel="noopener">X-Content-Type-Options</a></p></blockquote><h3 id="X-Frame-Options"><a href="#X-Frame-Options" class="headerlink" title="X-Frame-Options"></a>X-Frame-Options</h3><p>è¿™ä¸ªå“åº”å¤´æ˜¯ç”¨æ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œè¿™ä¸ªé¡µé¢æ˜¯å¦å¯ä»¥è¢« <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code>, <code>&lt;object&gt;</code> åµŒå…¥ã€‚</p><p>ä½œç”¨ï¼šç½‘ç«™å¯ä»¥é¿å…è¢«åµŒå…¥åˆ°åˆ«äººçš„ç½‘ç«™ä¸­ï¼Œä»è€Œé¿å…ç‚¹å‡»åŠ«æŒ (clickjacking)ã€‚</p><p>é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Frame-Options: deny</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ CSP ä¸­é…ç½® <code>frame-ancestors: none</code> æ¥å®ç°ï¼Œä»¥åå¯èƒ½ä¼šæ…¢æ…¢æ·˜æ±°éæ ‡å‡†çš„ <code>X-Frame-Options</code></p><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="noopener">X-Frame-Options å“åº”å¤´</a></p></blockquote><h3 id="X-XSS-Protection"><a href="#X-XSS-Protection" class="headerlink" title="X-XSS-Protection"></a>X-XSS-Protection</h3><p>é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥è®¾ç½®é˜²å¾¡ XSS æ”»å‡»çš„ã€‚ç›®å‰è¿™ä¸ªä¸€èˆ¬æµè§ˆå™¨éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ã€‚</p><p>é…ç½®ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-XSS-Protection: 1; mode=block</span><br></pre></td></tr></table></figure><p>ä½œç”¨ï¼šè¿™ä¸ªé…ç½®å¯ç”¨ XSS è¿‡æ»¤ï¼Œå¦‚æœæ£€æµ‹åˆ°æœ‰ XSS æ”»å‡»ï¼Œé˜»æ­¢é¡µé¢åŠ è½½ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-XSS-Protection" target="_blank" rel="noopener">X-XSS-Protection</a></p></blockquote><h3 id="Set-Cookie"><a href="#Set-Cookie" class="headerlink" title="Set-Cookie"></a>Set-Cookie</h3><p><code>Set-Cookie</code> ä¸­çš„ <code>Secure</code> å’Œ <code>HttpOnly</code> é…ç½®æ˜¯ç”¨æ¥ä¿è¯ cookie çš„å®‰å…¨çš„ã€‚</p><p><code>Secure</code>: é…ç½®è¿™ä¸ªå®‰å…¨å±æ€§ï¼Œè®© cookie åªåœ¨ HTTPS ä¸­åŠ å¯†ä¼ è¾“ã€‚</p><p><code>HttpOnly</code>: è¿™ä¸ªé…ç½®å¯ä»¥ç¦æ­¢é€šè¿‡ JavaScript æ¥è®¿é—® cookieï¼Œé˜²æ­¢ XSS æ”»å‡»ã€‚</p><blockquote><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Set-Cookie" target="_blank" rel="noopener">Set-Cookie</a></p></blockquote><h3 id="Access-Control-Allow-Origin"><a href="#Access-Control-Allow-Origin" class="headerlink" title="Access-Control-Allow-Origin"></a>Access-Control-Allow-Origin</h3><p>è¿™ä¸ªå“åº”å¤´å‰ç«¯ä¼šæ¯”è¾ƒç†Ÿæ‚‰ï¼Œå› ä¸ºè·¨åŸŸè¯·æ±‚é‡Œ (CORS)ï¼Œå°±å’Œè¿™ä¸ªæœ‰å…³ç³»ã€‚</p><p>é€šè¿‡é…ç½®è¿™ä¸ªå“åº”å¤´ï¼Œå¯ä»¥æŒ‡å®šå“ªäº›åŸŸæœ‰æƒé™è®¿é—®è¯¥èµ„æºã€‚</p><p>é…ç½®æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: &lt;origin&gt;|*</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin" target="_blank" rel="noopener">Access-Control-Allow-Origin</a></p></blockquote><h3 id="Cache-Control-amp-amp-Expires"><a href="#Cache-Control-amp-amp-Expires" class="headerlink" title="Cache-Control &amp;&amp; Expires"></a>Cache-Control &amp;&amp; Expires</h3><p>è¿™ä¸ªå…¶å®æ˜¯å±äºç¼“å­˜é…ç½®ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé’ˆå¯¹ä¸€äº›å…·æœ‰æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯ã€äº¤æ˜“é¡µé¢ï¼Œè¿™äº›ä¸åº”è¯¥é…ç½®ç¼“å­˜ï¼Œä»¥å…å› ä¸ºé¡µé¢ç¼“å­˜è€Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯çš„æ³„éœ²ã€‚</p><blockquote><p>å…·ä½“é…ç½®å¯ä»¥çœ‹ä¹‹å‰çš„æ–‡ç« ï¼š<a href="https://blog.hhking.cn/2018/08/10/browser-cache/">æµè§ˆå™¨çš„ç¼“å­˜æœºåˆ¶</a></p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™äº› HTTP å®‰å…¨é…ç½®ï¼Œæœ‰åŠ©äºæå‡ç½‘ç«™çš„å®‰å…¨æ€§ï¼Œè€Œä»è¿™äº›é…ç½®é‡Œï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å­¦åˆ°ä¸€äº›å®‰å…¨é˜²å¾¡æ–¹é¢çš„æ€è·¯ï¼š</p><ul><li>ä¼ è¾“ä¿¡æ¯åŠ å¯†</li><li>XSS è¿‡æ»¤</li><li>ç™½åå•æœºåˆ¶</li><li>åŒæºç­–ç•¥</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote><p><a href="https://nullsweep.com/http-security-headers-a-complete-guide/" target="_blank" rel="noopener">HTTP Security Headers - A Complete Guide</a><br><a href="https://imququ.com/post/web-security-and-response-header.html" target="_blank" rel="noopener">ä¸€äº›å®‰å…¨ç›¸å…³çš„HTTPå“åº”å¤´</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;WEB åº”ç”¨è¶Šæ¥è¶Šå¤æ‚ï¼Œå‰ç«¯æ‰€æ‰¿æ‹…çš„ä¹Ÿä¸å†ä»…ä»…æ˜¯åˆ‡å›¾ã€å†™ç•Œé¢çš„ä»»åŠ¡ã€‚ä½œä¸ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆï¼ŒæŒæ¡å¿…è¦çš„ WEB å®‰å…¨ç›¸å…³çš„çŸ¥è¯†ï¼Œä¹Ÿæ˜¯å¿…è¦çš„ã€‚&lt;b
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="HTTP" scheme="https://blog.hhking.cn/tags/HTTP/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šä½ è¯»æˆ‘è®°ã€‹å°ç¨‹åº</title>
    <link href="https://blog.hhking.cn/2019/08/12/reading-keeper/"/>
    <id>https://blog.hhking.cn/2019/08/12/reading-keeper/</id>
    <published>2019-08-12T15:12:44.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p>ä¸Šç­é€šå‹¤æ—¶é—´å¾ˆé•¿ï¼Œåœ¨åœ°é“ä¸Šç«Ÿæˆäº†æˆ‘çœ‹ä¹¦æœ€å¤šçš„åœ°æ–¹ã€‚çœ‹è¿‡å¾ˆå¤šä¹¦ã€å°è¯´ï¼Œä¹Ÿå¿˜äº†å¾ˆå¤šã€‚</p><p>å°è¯´ App å’Œ iReader éƒ½å¸¦æœ‰é˜…è¯»è®°å½•çš„æ—¶é•¿ï¼Œä½†æ˜¯æˆ‘ç»å¸¸æ˜¯å„ä¸ªåœ°æ–¹ã€å„ä¸ªå§¿åŠ¿ã€å„ä¸ªç±»å‹éƒ½ä¼šçœ‹ï¼Œæ²¡æ³•ç»Ÿä¸€èµ·æ¥ã€‚äºæ˜¯ä¹ï¼Œå°±æƒ³æœ‰ä¸ªè®°å½•çš„åœ°æ–¹ï¼Œä¹Ÿè¯•è¿‡ä¸å°‘æœ‰æ¬¡åŠŸèƒ½çš„ Appï¼Œå„æœ‰ç‰¹è‰²ï¼Œçœ‹èµ·æ¥ä¹Ÿä¸å¤æ‚ï¼Œä½•ä¸è‡ªå·±åšä¸ªå‘¢ï¼Ÿ</p><h2 id="æèµ·"><a href="#æèµ·" class="headerlink" title="æèµ·"></a>æèµ·</h2><p>æƒ³äº†å¾ˆä¹…ï¼Œå¿™å¿™ç¢Œç¢Œï¼Œç»ˆç©¶æ˜¯æ‡’ï¼Œæ–­æ–­ç»­ç»­è‡³ä»Šï¼Œç»ˆäºåšäº†ä¸ªçº¿ä¸Šç‰ˆçš„å°ç¨‹åº â€”â€” <strong>ä½ è¯»æˆ‘è®°</strong></p><p>ä¹Ÿç®—æ˜¯è‡ªå·±ä½“éªŒäº†ä¸€ä¸‹å°ç¨‹åºå¼€å‘ï¼Œä»å‰ç«¯åˆ°åç«¯ï¼Œåˆ°éƒ¨ç½²ä¸Šçº¿ï¼Œåˆ°æœ€åå‘æ­£å¼ç‰ˆï¼Œç£•ç£•ç¢°ç¢°ï¼Œç«Ÿç„¶è¿‡å»å°†è¿‘ä¸¤ä¸ªæœˆäº†ã€‚</p><p>å°ç¨‹åºä¸»è¦ç”¨çš„æ˜¯ï¼š<a href="https://taro.aotu.io/" target="_blank" rel="noopener">Taro</a>ã€<a href="https://taro-ui.aotu.io/#/" target="_blank" rel="noopener">Taro UI</a>ã€<a href="https://github.com/wux-weapp/wux-weapp" target="_blank" rel="noopener">wux-weapp</a><br>åå°ç”¨çš„æ˜¯ï¼š<a href="https://eggjs.org/zh-cn/intro/" target="_blank" rel="noopener">egg</a>ã€MySQLã€Nginx ä»£ç†</p><p>æ²¡æœ‰å¤æ‚çš„ä¸œè¥¿ï¼Œåªæ˜¯å»æ¥è§¦å’Œå°è¯•äº†ä¸€ä¸‹ç›¸å…³çš„å†…å®¹ï¼Œæœ€é‡è¦çš„æ˜¯ä¸€ä¸ªäº§å“ï¼Œä»æƒ³æ³•åˆ°è½åœ°å®ç°ï¼Œæœ€ç»ˆä¸Šçº¿ã€‚</p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>ç›®å‰ä¸»è¦è‡ªå·±ä½¿ç”¨ï¼Œè™½ç„¶è¿˜ä¸å°‘é—®é¢˜ï¼Œä½†æ˜¯ä¸å½±å“ä½¿ç”¨ã€‚æœ‰ç©ºæ…¢æ…¢å®Œå–„ï¼Œåç»­å†å‡ºä¸ªæ€»ç»“ã€‚</p><p>ç›®å‰å®ç°çš„åŠŸèƒ½ï¼š</p><ul><li style="list-style:none"><input type="checkbox" checked>ä¹¦ç±æœç´¢åŠŸèƒ½</li><li style="list-style:none"><input type="checkbox" checked>ä¹¦æ¶åŠŸèƒ½ï¼Œåˆ†æˆ åœ¨è¯»ã€æƒ³è¯»ã€å·²è¯»å’Œå…¨éƒ¨</li><li style="list-style:none"><input type="checkbox" checked>é˜…è¯»æ—¶é•¿è®°å½•ï¼ŒåŒ…æ‹¬æš‚åœã€å–æ¶ˆã€è®°å½•ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹é˜…è¯»æ—¶é•¿</li><li style="list-style:none"><input type="checkbox" checked>é˜…è¯»æ—¥å†ï¼Œåœ¨æ—¥å†ä¸Šæ˜¾ç¤ºé˜…è¯»è®°å½•</li><li style="list-style:none"><input type="checkbox" checked>é˜…è¯»ç»Ÿè®¡ï¼ŒåŒ…æ‹¬ç´¯è®¡æ—¶é•¿ã€é˜…è¯»å¤©æ•°ã€é˜…è¯»æ•°é‡</li><li style="list-style:none"><input type="checkbox" checked>æ¯æœ¬ä¹¦çš„é˜…è¯»è®°å½•ï¼ŒåŒ…æ‹¬é˜…è¯»å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œè¿˜æœ‰é˜…è¯»è¿›åº¦åˆ†æå’Œé¢„æµ‹</li></ul><p>TODO:</p><ul><li style="list-style:none"><input type="checkbox">é˜…è¯»åˆ†äº«æµ·æŠ¥</li><li style="list-style:none"><input type="checkbox">å¾…ç»­</li></ul><p>ä¸‹é¢æ˜¯æˆ‘æœ€è¿‘ä½¿ç”¨çš„è®°å½•æˆªå›¾<br><img src="/images/reading-keeper-my.PNG" alt=""></p><h2 id="æ‰«ä¸€æ‰«"><a href="#æ‰«ä¸€æ‰«" class="headerlink" title="æ‰«ä¸€æ‰«"></a>æ‰«ä¸€æ‰«</h2><p>æœ€åå¥‰ä¸Šå°ç¨‹åºç </p><p><img src="/images/reading-keeper.png" alt=""></p><p>THE ENDï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¼˜èµ·&quot;&gt;&lt;a href=&quot;#ç¼˜èµ·&quot; class=&quot;headerlink&quot; title=&quot;ç¼˜èµ·&quot;&gt;&lt;/a&gt;ç¼˜èµ·&lt;/h2&gt;&lt;p&gt;ä¸Šç­é€šå‹¤æ—¶é—´å¾ˆé•¿ï¼Œåœ¨åœ°é“ä¸Šç«Ÿæˆäº†æˆ‘çœ‹ä¹¦æœ€å¤šçš„åœ°æ–¹ã€‚çœ‹è¿‡å¾ˆå¤šä¹¦ã€å°è¯´ï¼Œä¹Ÿå¿˜äº†å¾ˆå¤šã€‚&lt;/p&gt;&lt;p&gt;å°è¯´ App å’Œ iReader éƒ½å¸¦æœ‰é˜…è¯»è®°
      
    
    </summary>
    
      <category term="å°ç¨‹åº" scheme="https://blog.hhking.cn/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="Node" scheme="https://blog.hhking.cn/tags/Node/"/>
    
      <category term="å°ç¨‹åº" scheme="https://blog.hhking.cn/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
      <category term="egg" scheme="https://blog.hhking.cn/tags/egg/"/>
    
      <category term="Taro" scheme="https://blog.hhking.cn/tags/Taro/"/>
    
  </entry>
  
  <entry>
    <title>Redux æºç è§£è¯»</title>
    <link href="https://blog.hhking.cn/2019/07/12/redux-interpretation/"/>
    <id>https://blog.hhking.cn/2019/07/12/redux-interpretation/</id>
    <published>2019-07-12T02:42:14.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡è§£è¯»åŸºäº Redux ç‰ˆæœ¬ 4.0.1ã€‚<br>å®Œæ•´çš„æ³¨é‡Šå‘åœ¨è¿™ä¸ªä»“åº“ <a href="https://github.com/hhking/redux-interpretation" target="_blank" rel="noopener">redux-interpretation</a></p></blockquote><p>Redux çš„æºç å¾ˆçŸ­ï¼Œæ ¸å¿ƒå°±æ˜¯å®ç°ä¸‹é¢è¿™äº› apiï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ä¼šé‡åˆ°çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">store: &#123;</span><br><span class="line">  dispatch,</span><br><span class="line">  subscribe,</span><br><span class="line">  getState,</span><br><span class="line">  replaceReducer</span><br><span class="line">&#125;,</span><br><span class="line">bindActionCreators,</span><br><span class="line">combineReducers,</span><br><span class="line">applyMiddleware</span><br></pre></td></tr></table></figure><p>å…ˆæ¥çœ‹çœ‹ Redux çš„æ•°æ®æµå‘å›¾ï¼Œæµç¨‹å›¾ä¹Ÿèƒ½çœ‹å‡ºä¸€ç‚¹è¿™äº› api çš„ä½œç”¨ã€‚<br><img src="/images/redux-flow.png" alt=""></p><h2 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h2><p>createStore æ˜¯ç”Ÿæˆ store çš„å‡½æ•°ï¼Œè¿”å› store å¯¹è±¡ï¼Œ<code>dispatch</code>, <code>subscribe</code>, <code>getState</code>, <code>replaceReducer</code> éƒ½æ˜¯åœ¨è¿™é‡Œå®ç°çš„</p><blockquote><p>è¿˜æœ‰ä¸ª observableï¼Œæ˜¯æä¾›ç»™ è§‚å¯Ÿ/å“åº”å¼ åº“çš„æ¥å£</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createStore.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">    getState,</span><br><span class="line">    replaceReducer,</span><br><span class="line">    [$$observable]: observable</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h2><p><code>dispatch</code> æœ¬è´¨å°±æ˜¯è°ƒç”¨ <code>reducer</code> å¾—åˆ°æ–°çš„ stateï¼Œç„¶åå†å¾ªç¯æ‰§è¡Œç›‘å¬ state å˜åŒ–çš„å›è°ƒå‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createStore.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¼€å§‹æ‰§è¡Œ reducer</span></span><br><span class="line">    isDispatching = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// reducer çš„å‚æ•°æ˜¯å½“å‰çš„ state å’ŒæŒ‡å®šçš„ actionï¼Œè¿”å›å€¼ä½œä¸ºæ–°çš„ state, æ‰€ä»¥è¦ä¿è¯ reducer ä¸€å®šè¦æœ‰ state è¿”å›</span></span><br><span class="line">    currentState = currentReducer(currentState, action)</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// reducer æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">    isDispatching = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è¿™é‡Œè·å–æœ€æ–°çš„å›è°ƒå‡½æ•°æ•°ç»„, ç„¶åå¾ªç¯é€ä¸ªæ‰§è¡Œ.</span></span><br><span class="line"><span class="comment">   * è¿™é‡Œè®© currentListeners = nextListeners, å¦‚æœè¿™æ—¶å€™å‡ºç°æ–°å¢æˆ–è€…å–æ¶ˆè®¢é˜…, ä¹‹å‰çš„ ensureCanMutateNextListeners å°±èµ·ä½œç”¨äº†,</span></span><br><span class="line"><span class="comment">   * æ”¹åŠ¨ä¸ä¼šå½±å“å½“å‰æ‰§è¡Œçš„æ•°ç»„, ä¸‹æ¬¡æ‰§è¡Œ dispatch æ‰ä¼šæ‹¿åˆ°æ”¹è¿‡åçš„æ•°ç»„</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> listeners = (currentListeners = nextListeners)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> listener = listeners[i]</span><br><span class="line">    listener()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> action</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h2><p><code>subscribe</code> å°±æ˜¯æ·»åŠ ç›‘å¬ state å˜åŒ–çš„å›è°ƒå‡½æ•°ï¼Œä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œåœ¨ <code>dispatch</code> åä¼šå¾ªç¯æ‰§è¡Œè¿™ä¸ªæ•°ç»„ã€‚è¿”å›å€¼æ˜¯ä¸€ä¸ªå–æ¶ˆç›‘å¬çš„å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createStore.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">// æ ‡è®°è®¢é˜…çŠ¶æ€ï¼Œå–æ¶ˆè®¢é˜…æ—¶é¿å…é‡å¤å–æ¶ˆè®¢é˜…çš„é€»è¾‘æ‰§è¡Œï¼Œé€ æˆçš„æ€§èƒ½æŸè€—</span></span><br><span class="line">  <span class="keyword">let</span> isSubscribed = <span class="literal">true</span></span><br><span class="line">  <span class="comment">// æ·»åŠ  listener ä¹‹å‰ï¼Œç¡®ä¿ä¸æ”¹åŠ¨ currentListenersï¼Œè€Œæ˜¯ currentListeners çš„å¤åˆ¶å‡ºæ¥çš„ nextListeners</span></span><br><span class="line">  ensureCanMutateNextListeners()</span><br><span class="line">  <span class="comment">// æ·»åŠ å›è°ƒå‡½æ•° listener åˆ° nextListeners</span></span><br><span class="line">  nextListeners.push(listener)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¢é˜…çš„è¿”å›å€¼æ˜¯ä¸ªå‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªè¿”å›å€¼æ¥å–æ¶ˆè®¢é˜…ï¼ˆç±»ä¼¼äº setTimeout çš„è¿”å›å€¼å¯ä»¥ç”¨æ¥å–æ¶ˆå®šæ—¶å™¨ï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isSubscribed) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// reducer æ‰§è¡Œæ—¶ä¸èƒ½å–æ¶ˆè®¢é˜…</span></span><br><span class="line">    <span class="keyword">if</span> (isDispatching) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">'You may not unsubscribe from a store listener while the reducer is executing. '</span> +</span><br><span class="line">          <span class="string">'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.'</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ‡è®°ä¸ºæœªè®¢é˜…</span></span><br><span class="line">    isSubscribed = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¼šå†æ¬¡ç¡®è®¤ nextListeners å’Œ currentListeners æ—¶ï¼Œæµ…å¤åˆ¶ä¸€ä»½æ–°çš„ nextListeners å‡ºæ¥</span></span><br><span class="line">    ensureCanMutateNextListeners()</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°éœ€è¦å–æ¶ˆè®¢é˜…çš„ listenerï¼Œé€šè¿‡ splice ä»æ•°ç»„ä¸­åˆ é™¤ï¼Œå˜åŒ–ä½“ç°åœ¨ nextListeners æ•°ç»„ä¸­</span></span><br><span class="line">    <span class="keyword">const</span> index = nextListeners.indexOf(listener)</span><br><span class="line">    nextListeners.splice(index, <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„åˆ°ä¸€ä¸ªå‡½æ•° <code>ensureCanMutateNextListeners</code>ï¼Œæ˜¯å¹²å˜›ç”¨çš„å‘¢ï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createStore.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ensureCanMutateNextListeners</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</span><br><span class="line">      nextListeners = currentListeners.slice()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è€ƒè™‘ä¸‹é¢è¿™ç§åœºæ™¯ï¼š<br><code>dispatch</code> è¿‡ç¨‹ä¸­ï¼Œç›‘å¬å›è°ƒ listener æ•°ç»„ <code>[ a, b, c ,d ]</code> åœ¨å¾ªç¯æ‰§è¡Œï¼Œä½†æ˜¯åˆšæ‰§è¡Œå®Œ aï¼Œa è¢«å–æ¶ˆç›‘å¬äº†ï¼Œè¿™æ—¶å€™æ•°ç»„å°±ä¼šå˜æˆ <code>[ b, c ,d ]</code>ï¼Œc æ˜¯æ•°ç»„çš„ç¬¬äºŒé¡¹äº†ã€‚åŸæœ¬è¦æ‰§è¡Œç¬¬äºŒé¡¹çš„ b å°±è¢«è·³è¿‡äº†ï¼Œè€Œå»æ‰§è¡Œ c å»äº†ã€‚<br>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºäº†ä¿è¯åœ¨ <code>dispatch</code> è¿‡ç¨‹ä¸­ï¼Œæ–°å¢æˆ–è€…å–æ¶ˆè®¢é˜…ä¸ä¼šå½±å“åˆ°å½“å‰çš„ <code>dispatch</code>ï¼Œé¿å…ç±»ä¼¼è¿™ç§åœºæ™¯ä¸‹ bug çš„äº§ç”Ÿã€‚<br>æµ…å¤åˆ¶ä¸€ä»½ <code>currentListeners</code>ï¼Œä¿è¯å½“å‰çš„ <code>dispatch</code> çš„ä¸å˜ï¼Œæ–°å¢æˆ–è€…å–æ¶ˆçš„ä¼šåœ¨ <code>nextListeners</code> ä¸­ä½“ç°ï¼Œä¹Ÿå°±æ˜¯ä¸‹æ¬¡ dispatch æ—¶ã€‚ (subscribe çš„æ³¨é‡Šé‡Œä¹Ÿæœ‰è¯´æ˜)</p><h2 id="getState"><a href="#getState" class="headerlink" title="getState"></a>getState</h2><p>è¿™ä¸ªç®€å•ç²—æš´ï¼Œå°±æ˜¯è¿”å›å½“å‰çš„ state</p><h2 id="replaceReducer"><a href="#replaceReducer" class="headerlink" title="replaceReducer"></a>replaceReducer</h2><p>è¿™ä¸ªæ–¹æ³•ç›´æ¥æ›¿æ¢å½“å‰çš„ <code>reducer</code>ï¼Œç„¶åæ‰§è¡Œ <code>dispatch({ type: ActionTypes.REPLACE })</code> è¿™ä¸ªå†…ç½®çš„ <code>action</code>ï¼Œæ ¹æ®æ–°çš„ <code>reducer</code> ç”Ÿæˆæ–°çš„ <code>state</code>ã€‚</p><p>è¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>ä»£ç åˆ†å‰²æŒ‰éœ€åŠ è½½</li><li>çƒ­æ›¿æ¢</li></ul><h3 id="bindActionCreators"><a href="#bindActionCreators" class="headerlink" title="bindActionCreators"></a>bindActionCreators</h3><p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯æä¾›ä¸€ä¸ªç®€å†™çš„è°ƒç”¨æ–¹å¼ï¼Œç»™ ActionCreator åŠ ä¸ªè‡ªåŠ¨ <code>dispatch</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bindActionCreators.js éƒ¨åˆ†ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•çš„åšç”¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªç®€å†™çš„è°ƒç”¨æ–¹æ³•ï¼Œæ–¹ä¾¿ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// ç»“æœå°±æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°: `dispatch(actionCreator(xxx))`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dispatch(actionCreator.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="combineReducers"><a href="#combineReducers" class="headerlink" title="combineReducers"></a>combineReducers</h3><p><code>combineReducers</code> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ï¼ŒæŠŠä¸€ä¸ªåŒ…å«å„ä¸ª reducer å‡½æ•°çš„å¯¹è±¡ï¼Œåˆå¹¶æˆä¸€ä¸ª reducer å‡½æ•°ã€‚<br>è¿™éƒ¨åˆ†ä»£ç ä¹Ÿä¸å¤æ‚ï¼Œé™¤å»ä¸€äº›é”™è¯¯æ£€æŸ¥ä¹‹ç±»çš„ï¼Œå°±æ˜¯å¯¹ reducer å°±è¡Œå¤„ç†åˆå¹¶ï¼Œæ‰§è¡Œè¿”å›çš„å‡½æ•°ï¼Œæ‰æ˜¯æ‰§è¡ŒçœŸæ­£çš„æ‰€æœ‰çš„ reducer é€»è¾‘</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//combineReducers</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å– reducers è¿™ä¸ªå¯¹è±¡çš„å»º keys å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">const</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers)</span><br><span class="line">  <span class="keyword">const</span> finalReducers = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = reducerKeys[i]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ key å¯¹åº”çš„ reducer æ˜¯ä¸æ˜¯ `undefined`</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        warning(<span class="string">`No reducer provided for key "<span class="subst">$&#123;key&#125;</span>"`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¡®ä¿ reducer æ˜¯ä¸ªå‡½æ•°ï¼Œç„¶åæ ¹æ® key/value å­˜åœ¨æ–°å¯¹è±¡ finalReducers</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–°å¯¹è±¡ï¼ŒåŒ…å«çš„æ˜¯è¿‡æ»¤ undefined å’Œ éå‡½æ•° åçš„ reducer</span></span><br><span class="line"><span class="comment">     * ä¿å­˜åœ¨å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å†åç»­çš„ä¿®æ”¹ä¸­ï¼Œä¸å½±å“åˆ°åŸæ¥çš„ reducers è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'function'</span>) &#123;</span><br><span class="line">      finalReducers[key] = reducers[key]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> finalReducerKeys = <span class="built_in">Object</span>.keys(finalReducers)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This is used to make sure we don't warn about the same</span></span><br><span class="line">  <span class="comment">// keys multiple times.</span></span><br><span class="line">  <span class="keyword">let</span> unexpectedKeyCache</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    unexpectedKeyCache = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> shapeAssertionError</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    assertReducerShape(finalReducers)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    shapeAssertionError = e</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ªåˆå¹¶åçš„ reducer å‡½æ•°, state é»˜è®¤å€¼ä¸ºç©ºå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (shapeAssertionError) &#123;</span><br><span class="line">      <span class="keyword">throw</span> shapeAssertionError</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class="line">        state,</span><br><span class="line">        finalReducers,</span><br><span class="line">        action,</span><br><span class="line">        unexpectedKeyCache</span><br><span class="line">      )</span><br><span class="line">      <span class="keyword">if</span> (warningMessage) &#123;</span><br><span class="line">        warning(warningMessage)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> hasChanged = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> nextState = &#123;&#125;</span><br><span class="line">    <span class="comment">// å¾ªç¯æ‰§è¡Œ reducerï¼Œè¿™éƒ¨åˆ†å†™çš„å¾ˆæ¸…æ™°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> key = finalReducerKeys[i]</span><br><span class="line">      <span class="keyword">const</span> reducer = finalReducers[key]</span><br><span class="line">      <span class="keyword">const</span> previousStateForKey = state[key]</span><br><span class="line">      <span class="keyword">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class="line">      <span class="comment">// è¿™é‡ŒéªŒè¯æ˜¯å¦ä¼šæ²¡æœ‰ state è¿”å›</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> nextStateForKey === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(errorMessage)</span><br><span class="line">      &#125;</span><br><span class="line">      nextState[key] = nextStateForKey</span><br><span class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// state æœ‰æ”¹å˜è¿”å›ä¸‹ä¸€ä¸ª stateï¼Œå¦åˆ™è¿”å›åŸæ¥çš„ state</span></span><br><span class="line">    <span class="keyword">return</span> hasChanged ? nextState : state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="applyMiddleware"><a href="#applyMiddleware" class="headerlink" title="applyMiddleware"></a>applyMiddleware</h2><p><code>applyMiddleware</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ <code>enhancer</code>ï¼Œæ‰§è¡Œ <code>applyMiddleware</code> å’Œ <code>enhancer</code>ï¼Œéƒ½è¦è¿”å›å’Œ <code>createStore</code> ä¸€æ ·çš„ apiã€‚<br><code>applyMiddleware</code> æ¥æ”¶çš„å‚æ•°æ˜¯ä¸­é—´ä»¶æ•°ç»„ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªä¸­é—´ä»¶æ´‹è‘±æ¨¡å‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// applyMiddleware.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">createStore</span> =&gt;</span> (...args) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> store = createStore(...args)</span><br><span class="line">    <span class="keyword">let</span> dispatch = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">'Dispatching while constructing your middleware is not allowed. '</span> +</span><br><span class="line">          <span class="string">'Other middleware would not be applied to this dispatch.'</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">      getState: store.getState,</span><br><span class="line">      dispatch: <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(...args)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// middlewareAPI ä½œä¸ºå‚æ•°æ‰§è¡Œä¸€éæ‰€æœ‰çš„ä¸­é—´ä»¶</span></span><br><span class="line">    <span class="keyword">const</span> chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class="line">    <span class="comment">// æ ¹æ® compose ç”Ÿäº§çš„å…¶å®æ˜¯ç±»ä¼¼ mid1(mid2(mid3(store.dispatch)))</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥åœ¨æ•°ç»„æœ€åçš„ middleware å…¶å®æ˜¯ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„</span></span><br><span class="line">    dispatch = compose(...chain)(store.dispatch)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      ...store,</span><br><span class="line">      dispatch</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦ç»“åˆå®é™…çš„ä¸­é—´ä»¶æ¥ç†è§£ï¼Œä¸‹é¢æ˜¯ logger ä¸­é—´ä»¶çš„ç¤ºä¾‹ä»£ç :</p><ul><li>å¯ä»¥çœ‹åˆ°ä¸­é—´ä»¶ logger å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°ä¸º dispatch å’Œ getStateï¼Œè¿™ä¸ªå¯¹åº”ä¸Šé¢çš„ middlewareAPI</li><li>middleware(middlewareAPI) æ‰§è¡Œåå¾—åˆ°çš„è¿˜æ˜¯ä¸ªå‡½æ•°ï¼Œå‚æ•°æ˜¯ nextï¼Œçœ‹ä¸Šé¢çš„ compose, è¿™ä¸ª next å…¶å®å°±æ˜¯ store.dispatchï¼Œè¿”å›çš„æ˜¯æ–°çš„ dispatchï¼Œ å‡å¦‚æ˜¯ newDispatch</li><li>æ ¹æ®ä¸Šé¢çš„ composeï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ª newDispatch æ˜¯ä½œä¸ºä¸­é—´ä»¶é“¾çš„ä¸‹ä¸€ä¸ª middleware çš„å‚æ•°å€¼ï¼ˆå°±æ˜¯ nextï¼‰è¿™æ ·ä¸€ç¯æ‰£ä¸€ç¯ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„ dispatch</li><li>åœ¨å®é™…è°ƒç”¨æœ€ç»ˆçš„ dispatch æ—¶ï¼Œä½ ä¼šå‘ç°ï¼Œmiddleware çš„æ‰§è¡Œé¡ºåºåˆå˜æˆæ˜¯ä»å·¦å¾€å³äº†ï¼ˆå› ä¸ºæœ€ç»ˆè¿”å›çš„ dispatch æ˜¯ç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„å‡½æ•°ï¼‰</li><li>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ° next(action)ï¼Œè¿™æ—¶å€™å…¶å®å°±æ˜¯å³è¾¹ä¸€ä¸ª middleware çš„è¿”å›çš„ dispatchï¼Œæ§åˆ¶æƒå°±è½¬åˆ°è¿™ä¸ª middleware äº†ï¼Œ</li><li>è¿™æ ·æ‰§è¡Œåˆ°æœ€åï¼Œæ§åˆ¶æƒè¿”å›ï¼Œå†æ‰§è¡Œ next åé¢çš„ä»£ç </li><li>æœ€ç»ˆå°±æ˜¯å½¢æˆäº†ä¸­é—´ä»¶çš„æ´‹è‘±æ¨¡å‹ï¼Œçœ‹ä¸‹é¢çš„ç¤ºæ„å›¾</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logger ä¸­é—´ä»¶çš„ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="keyword">const</span> logger = <span class="function">(<span class="params">&#123; getState, dispatch &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action)</span><br><span class="line">  <span class="keyword">let</span> result = next(action)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ´‹è‘±æ¨¡å‹ç¤ºæ„å›¾</span></span><br><span class="line">+-------------------------------------------------------------+</span><br><span class="line">|   mid21                                                     |</span><br><span class="line">|         +---------------------------------------------+     |</span><br><span class="line">|         | mid2    +-----------------------------+     |     |</span><br><span class="line">|         |         | mid2   +-------------+      |     |     |</span><br><span class="line">|         |         |        |             |      |     |     |</span><br><span class="line">-&gt; next() -&gt; next() -&gt;next() -&gt; dispatch() -&gt;    -&gt;    -&gt;    -&gt;</span><br><span class="line">|         |         |        |             |      |     |     |</span><br><span class="line">|         |         |        +-------------+      |     |     |</span><br><span class="line">|         |         +-----------------------------+     |     |</span><br><span class="line">|         +---------------------------------------------+     |</span><br><span class="line">+-------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸ªæ¨¡å‹å¯ä»¥çŸ¥é“ä¸­é—´ä»¶çš„å·¥ä½œåŸç†ï¼Œå°±æ˜¯åœ¨å‘é€ dispatch ä¹‹å‰ä»¥åŠå‘é€ä¹‹åï¼Œå¯ä»¥åšä¸€äº›ä½ æƒ³åšçš„äº‹ã€‚</p><p>æ¯”å¦‚è¿™ä¸ª logger ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºä¼šæ˜¯ æ‰“å° dispatching -&gt; ç­‰å¾… next æ‰§è¡Œè¿”å› -&gt; æ‰“å° next state</p><p>è¿™é‡Œå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ logger ä¸­é—´ä»¶è¦æ±‚æ”¾åœ¨æœ€åé¢?</p><p>å†™çš„æ¯”è¾ƒç²—ç³™ï¼Œè¯¦ç»†çš„å¯ä»¥çœ‹è¿™ä¸ªä»“åº“çš„æ³¨é‡Š <a href="https://github.com/hhking/redux-interpretation" target="_blank" rel="noopener">redux-interpretation</a></p><p>THE END!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;æœ¬ç¯‡è§£è¯»åŸºäº Redux ç‰ˆæœ¬ 4.0.1ã€‚&lt;br&gt;å®Œæ•´çš„æ³¨é‡Šå‘åœ¨è¿™ä¸ªä»“åº“ &lt;a href=&quot;https://github.com/hhking/redux-interpretation&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Redux" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/Redux/"/>
    
    
      <category term="Redux" scheme="https://blog.hhking.cn/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title>Babel 7 å‡çº§å®è·µ</title>
    <link href="https://blog.hhking.cn/2019/04/02/babel-v7-update/"/>
    <id>https://blog.hhking.cn/2019/04/02/babel-v7-update/</id>
    <published>2019-04-02T04:14:49.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h2><p>æœ€è¿‘åœ¨çœ‹é¡¹ç›®çš„å‡çº§å’Œä¼˜åŒ–ï¼Œé¡¹ç›®ç”¨çš„æ˜¯ Babel 6ï¼Œè¸©äº†ä¸€ä¸‹å‡çº§åˆ° Babel 7 çš„å‘ã€‚</p><a id="more"></a><h2 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="@babel/preset-env"></a>@babel/preset-env</h2><p><a href="https://babeljs.io/docs/en/babel-preset-env" target="_blank" rel="noopener">@babel/preset-env</a> æ ¹æ®æŒ‡å®šçš„æ‰§è¡Œç¯å¢ƒæä¾›è¯­æ³•è£…æ¢ï¼Œä¹Ÿæä¾›é…ç½® polyfillã€‚</p><blockquote><p><code>Babel 7</code> å·²ç»å¼ƒç”¨å¹´ä»½ <code>preset</code>: <code>babel-preset-es2015, babel-preset-es2016, babel-preset-es2017, babel-preset-latest</code>. ç›´æ¥ä½¿ç”¨ä¸€ä¸ª <code>env</code> æå®šã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒ‡å®šæ‰§è¡Œç¯å¢ƒ Browserslistï¼Œ Browserslist çš„é…ç½®æœ‰å‡ ç§æ–¹å¼ï¼Œå¹¶æŒ‰ä¸‹é¢çš„ä¼˜å…ˆçº§ä½¿ç”¨ï¼š</p><ol><li><code>@babel/preset-env</code> é‡Œçš„ <code>targets</code></li><li><code>package.json</code> é‡Œçš„ <code>browserslist</code> å­—æ®µ</li><li><code>.browserslistrc</code> é…ç½®æ–‡ä»¶</li></ol><blockquote><p><a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">browserslist</a> æ˜¯ç”¨æ¥ç»™ä¸åŒçš„å‰ç«¯å·¥å…·ï¼ˆAutoprefixer, babel-preset-envï¼‰å…±äº« <code>target browsers</code> å’Œ <code>Node.js versions</code> é…ç½®çš„. ä¸€èˆ¬æ¨èå°†é…ç½®å†™åœ¨ <code>package.json</code> é‡Œçš„ <code>browserslist</code> å­—æ®µã€‚</p></blockquote><p>ä¾‹å¦‚æˆ‘ä»¬é…ç½® <code>.babelrc</code> å¦‚ä¸‹ï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"ie"</span>: <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æºæ–‡ä»¶ï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> f = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¼–è¯‘åæ˜¯ï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_classCallCheck</span>(<span class="params">instance, Constructor</span>) </span>&#123; <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> Constructor)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Test = <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _classCallCheck(<span class="keyword">this</span>, Test);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>Babel è½¬æ¢äº†æµè§ˆå™¨ä¸æ”¯æŒçš„ç®­å¤´å‡½æ•°å’Œ <code>Class</code>ï¼Œä½†æ˜¯ <code>Promise</code> å¹¶æ²¡æœ‰å˜åŒ–ã€‚è¿™æ˜¯å› ä¸º Babel åªè½¬æ¢ä¸å…¼å®¹çš„æ–°è¯­æ³•ï¼Œè€Œå¯¹æ–°çš„ APIï¼Œå¦‚ Iteratorã€Generatorã€Setã€Mapsã€Proxyã€Reflectã€Symbolã€Promiseã€Object.assign() ç­‰ï¼Œæ˜¯ä¸ä¼šè½¬æ¢çš„ã€‚è¿™æ—¶å€™å°±éœ€è¦ polyfill äº†ã€‚</p><p>polyfill çš„ä½¿ç”¨åœ¨ Babel 7 æœ‰ä¸€äº›ä¸åŒï¼š</p><ul><li><code>useBuiltIns</code> æä¾› <code>false</code>, <code>entry</code>, <code>usage</code> ä¸‰ç§æ–¹å¼</li><li><code>@babel/runtime</code>, <code>@babel/plugin-transform-runtime</code> æŠŠ <code>helpers</code> å’Œ polyfill åŠŸèƒ½æ‹†åˆ†äº†ã€‚é»˜è®¤åªæä¾› <code>helpers</code>ã€‚</li></ul><h2 id="useBuiltIns"><a href="#useBuiltIns" class="headerlink" title="useBuiltIns"></a>useBuiltIns</h2><h3 id="false"><a href="#false" class="headerlink" title="false"></a>false</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"useBuiltIns"</span>: <span class="literal">false</span>,</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¸å¯¹ <code>polyfill</code> åšæ“ä½œã€‚å¦‚æœå¼•å…¥ <code>@babel/polyfill</code>ï¼Œåˆ™æ— è§†é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æ‰€æœ‰çš„ <code>polyfill</code>ã€‚</p><h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"useBuiltIns"</span>: <span class="string">"entry"</span>,</span><br><span class="line"><span class="string">"corejs"</span>: <span class="number">2</span>,</span><br></pre></td></tr></table></figure><p>æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æµè§ˆå™¨ä¸å…¼å®¹çš„ <code>polyfill</code>ã€‚éœ€è¦åœ¨å…¥å£æ–‡ä»¶æ‰‹åŠ¨æ·»åŠ  <code>import &#39;@babel/polyfill&#39;</code>ï¼Œä¼šè‡ªåŠ¨æ ¹æ® <code>browserslist</code> æ›¿æ¢æˆæµè§ˆå™¨ä¸å…¼å®¹çš„æ‰€æœ‰ <code>polyfill</code>ã€‚</p><p>è¿™é‡Œéœ€è¦æŒ‡å®š <code>core-js</code> çš„ç‰ˆæœ¬, å¦‚æœ <code>&quot;corejs&quot;: 3</code>, åˆ™ <code>import &#39;@babel/polyfill&#39;</code> éœ€è¦æ”¹æˆ<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'core-js/stable'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'regenerator-runtime/runtime'</span>;</span><br></pre></td></tr></table></figure><p></p><p>ç¼–è¯‘ç»“æœï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.array.copy-within"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... æ­¤å¤„çœç•¥ä¸€å¤§å †çš„ polyfill</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/web.immediate"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/web.dom.iterable"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"regenerator-runtime/runtime"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_classCallCheck</span>(<span class="params">instance, Constructor</span>) </span>&#123; <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> Constructor)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Test = <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _classCallCheck(<span class="keyword">this</span>, Test);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"useBuiltIns"</span>: <span class="string">"usage"</span>,</span><br><span class="line"><span class="string">"corejs"</span>: <span class="number">2</span>,</span><br></pre></td></tr></table></figure><p><code>usage</code> ä¼šæ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä½ ä»£ç ä¸­ç”¨åˆ°çš„ API æ¥è¿›è¡Œ <code>polyfill</code>ï¼Œå®ç°äº†æŒ‰éœ€æ·»åŠ ã€‚</p><p>ç¼–è¯‘ç»“æœï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.promise"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.object.to-string"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_classCallCheck</span>(<span class="params">instance, Constructor</span>) </span>&#123; <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> Constructor)) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>); &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Test = <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  _classCallCheck(<span class="keyword">this</span>, Test);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>çœ‹ä¸Šé¢çš„ç¼–è¯‘ç»“æœï¼Œä¼šå‘ç°è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œ<code>_classCallCheck</code> è¾…åŠ©å‡½æ•°æ˜¯ç›´æ¥å†…åµŒçš„ï¼Œå¦‚æœå¤šä¸ªåœ°æ–¹ä½¿ç”¨ <code>Class</code>ï¼Œé‚£æ¯ä¸ªåœ°æ–¹éƒ½ä¼šæ·»åŠ è¿™ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå¤§é‡é‡å¤ã€‚<br>è¿™æ—¶å€™å°±éœ€è¦ <code>@babel/plugin-transform-runtime</code> äº†ã€‚</p><h2 id="babel-plugin-transform-runtime"><a href="#babel-plugin-transform-runtime" class="headerlink" title="@babel/plugin-transform-runtime"></a>@babel/plugin-transform-runtime</h2><p><a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener">@babel/plugin-transform-runtime</a> è¿™ä¸ªæ’ä»¶æ˜¯ç”¨æ¥å¤ç”¨è¾…åŠ©å‡½æ•°çš„ã€‚</p><p>é…ç½® <code>.babelrc</code><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"@babel/preset-env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"useBuiltIns"</span>: <span class="string">"usage"</span>,</span><br><span class="line">        <span class="string">"corejs"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">"targets"</span>: &#123;</span><br><span class="line">          <span class="string">"ie"</span>: <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"@babel/plugin-transform-runtime"</span>]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¼–è¯‘ç»“æœï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _interopRequireDefault = <span class="built_in">require</span>(<span class="string">"@babel/runtime/helpers/interopRequireDefault"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _classCallCheck2 = _interopRequireDefault(<span class="built_in">require</span>(<span class="string">"@babel/runtime/helpers/classCallCheck"</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.promise"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"core-js/modules/es6.object.to-string"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Test = <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  (<span class="number">0</span>, _classCallCheck2.default)(<span class="keyword">this</span>, Test);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>å¯ä»¥å‘ç°ï¼Œhelpers æ˜¯é€šè¿‡ <code>require</code> å¼•å…¥çš„ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨ä»£ç é‡å¤çš„é—®é¢˜äº†ã€‚</p><h2 id="æ‹¾é—"><a href="#æ‹¾é—" class="headerlink" title="æ‹¾é—"></a>æ‹¾é—</h2><p><code>Babel 7</code> åºŸå¼ƒäº† <code>stage-x</code>ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°ä¸€äº›ç‰¹æ€§ï¼Œéœ€è¦è‡ªå·±å®‰è£…å¯¹åº”çš„ pluginï¼Œç„¶åå†é…ç½®ä¸­é…ç½® pluginã€‚</p><p><code>stage-x</code> åŸæœ¬æ˜¯å¯¹åº” ECMAScript ææ¡ˆçš„ä¸åŒé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µæœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œä½†æ˜¯ææ¡ˆä¸€ç›´åœ¨å˜ï¼Œè¿™äº›ç‰¹æ€§å¯èƒ½æ›´è¿›ä¸€æ­¥ï¼Œä¹Ÿå¯èƒ½åºŸå¼ƒã€‚<code>state-x</code> æ˜¯å¦åº”è¯¥ä¿æŒå’Œä¸æ–­æ›´æ–°çš„ææ¡ˆä¸€è‡´ï¼Ÿæ€ä¹ˆå¤„ç†éƒ½æ— æ³•é€‚åº”å˜åŒ–ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ <code>stage-x</code> å¯¹åæœŸçš„ç»´æŠ¤é€ æˆå›°æƒ‘å’Œé£é™©ã€‚</p><p><code>Babel 7</code> è¿˜æœ‰ä¸ªé…ç½®æ–‡ä»¶æŸ¥æ‰¾çš„é—®é¢˜ï¼Œå‡çº§åå¯èƒ½ä¼šå‡ºç° <code>.babelrc</code> é…ç½®æ— æ•ˆçš„æƒ…å†µï¼Œéœ€è¦æ ¹æ®ç›®å½•ç»“æ„å’Œè§„åˆ™è°ƒæ•´ã€‚ç®€å•çš„è¯´ï¼š</p><ul><li>Babel 7 å¢åŠ äº† <code>root</code> ç›®å½•çš„æ¦‚å¿µï¼Œé»˜è®¤æ˜¯ cwd ç›®å½•</li><li>Babel åˆ†æˆé¡¹ç›®çº§é…ç½®æ–‡ä»¶(å¦‚ï¼š<code>.babel.config.js</code>)å’Œæ–‡ä»¶çº§é…ç½®æ–‡ä»¶(å¦‚ï¼š<code>.babelrc</code>)</li><li>é¡¹ç›®çº§ç›®å½•æ˜¯é»˜è®¤æ˜¯åœ¨ <code>root</code> ç›®å½•æŸ¥æ‰¾ï¼Œå¯ä»¥é…ç½® <code>root</code> æˆ–è€… <code>rootMode</code> æ¥æ›´æ”¹æŸ¥æ‰¾æ–¹å¼ï¼›ä¹Ÿå¯ä»¥é…ç½® <code>configFile</code> æ¥æŒ‡å®šæ–‡ä»¶æˆ–è€…å…³é—­é¡¹ç›®çº§é…ç½®</li><li>æ–‡ä»¶çº§é…ç½®æ–‡ä»¶ <code>.babelrc</code> ä¼šæ ¹æ® <code>babelrcRoots</code> é…ç½®ï¼ˆé»˜è®¤å€¼ä¸º <code>root</code>ï¼‰çš„ç›®å½•æŸ¥æ‰¾ï¼Œä¸”åªä½œç”¨äºå½“å‰ç¼–è¯‘ç›®å½•çš„ <code>package.json</code></li></ul><blockquote><p>æ›´è¯¦ç»†çš„å¯ä»¥ç›´æ¥çœ‹æ–‡æ¡£çš„è§£é‡Šè¯´æ˜ <a href="https://babeljs.io/docs/en/config-files#project-wide-configuration" target="_blank" rel="noopener">Config Files</a></p></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Babel 7 çš„é…ç½®æ–¹æ¡ˆï¼š</p><ul><li>@babel/preset-env + targets + useBuiltins: usage</li><li>@babel/plugin-transform-runtime</li><li>å¼•å…¥å¿…è¦çš„ plugin</li></ul><p>è¿™æ ·å°±å®ç°äº†æŒ‰éœ€å¼•å…¥ <code>polyfill</code>ï¼Œçœ‹èµ·æ¥ä¹Ÿæ˜¯ç›¸å½“å®Œç¾ã€‚</p><p>ä½†æ˜¯æƒ³æƒ³è¿˜æ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œæ¯”å¦‚ï¼šBabel ç¼–è¯‘é€šå¸¸ä¼šæ’é™¤ node_modulesï¼Œæ‰€ä»¥ <code>&quot;useBuiltIns&quot;: &quot;usage&quot;</code> å­˜åœ¨é£é™©ï¼Œå¯èƒ½æ— æ³•ä¸ºä¾èµ–åŒ…æ·»åŠ å¿…è¦çš„ <code>polyfill</code>ã€‚äº‘è°¦åœ¨åšå®¢ <a href="https://github.com/sorrycc/blog/issues/80" target="_blank" rel="noopener">Polyfill æ–¹æ¡ˆçš„è¿‡å»ã€ç°åœ¨å’Œæœªæ¥</a> ä¹Ÿæåˆ°ä¸€äº›é—®é¢˜ï¼Œè¿˜æœ‰ä¸€äº›æƒ³æ³•å’Œå±•æœ›ï¼Œæ„Ÿè§‰å†™å¾—æŒºå¥½çš„ã€‚</p><blockquote><p>å…³äº Babel ç¼–è¯‘é€šå¸¸ä¼šæ’é™¤ node_modules çš„åšæ³•ï¼Œé€šç”¨çš„çº¦å®šæ˜¯ node_modules ä¸‹çš„åŒ…åœ¨å‘å¸ƒæ—¶æ‰“åŒ…æˆ es5ã€‚ä½†æ˜¯ä¹Ÿéš¾ä¿è¯å…¨éƒ¨éƒ½éµå®ˆçº¦å®šï¼Œè¿™å°±å­˜åœ¨ä¸€å®šçš„é£é™©ã€‚ä½†æ˜¯å¦‚æœ Babel å¤„ç† node_modulesï¼Œç¼–è¯‘é€Ÿåº¦æ…¢ä¸è¯´ï¼ŒBabel 6 ç¼–è¯‘å·²ç¼–è¯‘è¿‡çš„ä»£ç ä¹Ÿæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œæ®è¯´è¿™ä¸ªé—®é¢˜åœ¨ Babel 7 è§£å†³äº†ï¼Œmaybe! å‘Šè¾ï¼ğŸ‘‹</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ç¼˜èµ·&quot;&gt;&lt;a href=&quot;#ç¼˜èµ·&quot; class=&quot;headerlink&quot; title=&quot;ç¼˜èµ·&quot;&gt;&lt;/a&gt;ç¼˜èµ·&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨çœ‹é¡¹ç›®çš„å‡çº§å’Œä¼˜åŒ–ï¼Œé¡¹ç›®ç”¨çš„æ˜¯ Babel 6ï¼Œè¸©äº†ä¸€ä¸‹å‡çº§åˆ° Babel 7 çš„å‘ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Babel" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/Babel/"/>
    
    
      <category term="Babel" scheme="https://blog.hhking.cn/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>React Hooks é˜…è¯»ç¬”è®° â€”â€” Hooks ç®€ä»‹</title>
    <link href="https://blog.hhking.cn/2019/03/16/hooks-intro-note/"/>
    <id>https://blog.hhking.cn/2019/03/16/hooks-intro-note/</id>
    <published>2019-03-16T07:03:51.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å®˜æ–¹æ–‡æ¡£å…³äº Hooks çš„é˜…è¯»ç¬”è®°</p></blockquote><h2 id="å…³äº-Hooks"><a href="#å…³äº-Hooks" class="headerlink" title="å…³äº Hooks"></a>å…³äº Hooks</h2><ul><li><p>è¿™æ˜¯ä¸ªå¯é€‰çš„åŠŸèƒ½ã€‚å¦‚æœä½ ä¸æƒ³ç”¨ï¼Œä½ å¯ä»¥é€‰æ‹©å¿½ç•¥å®ƒã€‚</p></li><li><p>100% å‘åå…¼å®¹ã€‚Hooks æ²¡æœ‰ç ´åæ€§çš„å˜æ›´ã€‚</p></li><li><p>ç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚Hooks åœ¨ React V16.8.0 å·²ç»å‘å¸ƒã€‚</p></li></ul><a id="more"></a><h2 id="Hooks-è¦è§£å†³çš„é—®é¢˜"><a href="#Hooks-è¦è§£å†³çš„é—®é¢˜" class="headerlink" title="Hooks è¦è§£å†³çš„é—®é¢˜"></a>Hooks è¦è§£å†³çš„é—®é¢˜</h2><h3 id="ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘å¤ç”¨"><a href="#ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘å¤ç”¨" class="headerlink" title="ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘å¤ç”¨"></a>ç»„ä»¶ä¹‹é—´çš„çŠ¶æ€é€»è¾‘å¤ç”¨</h3><p><code>render props</code> å’Œ <code>higer-order components</code> æ¨¡å¼ï¼Œä¹Ÿæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå‡ºç°çš„ã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ç§æ¨¡å¼éœ€è¦é‡æ„ä»£ç æ¥å®ç°ï¼Œå¹¶ä¸”åœ¨ chrome è°ƒè¯•çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç° <code>React DevTools</code> ä¸­ç»„ä»¶ä¼šå¤šäº†å¾ˆå¤šå±‚åµŒå¥—ï¼ˆ<code>wrapper hell</code>ï¼‰ã€‚</p><p>ä½¿ç”¨ Hooksï¼Œå¯ä»¥è®©ä½ ä¸æ”¹å˜ç»„ä»¶å±‚çº§å°±å¯ä»¥å¤ç”¨çŠ¶æ€é€»è¾‘ã€‚è¿™æ ·ä½¿ç”¨èµ·æ¥æ›´åŠ è‡ªç„¶ï¼Œä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚</p><h3 id="å¤æ‚ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šéš¾ç†è§£"><a href="#å¤æ‚ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šéš¾ç†è§£" class="headerlink" title="å¤æ‚ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šéš¾ç†è§£"></a>å¤æ‚ç»„ä»¶å˜å¾—è¶Šæ¥è¶Šéš¾ç†è§£</h3><p>éšç€éœ€æ±‚çš„å¢åŠ ï¼Œç»„ä»¶è¶Šæ¥è¶Šå¤æ‚ï¼Œè€Œä¸”å¾ˆå¤šçš„é€»è¾‘å¤„ç†ï¼ˆä¾‹å¦‚æ•°æ®è·å–ã€äº‹ä»¶ç»‘å®šå’Œè§£ç»‘ï¼‰ä¾èµ–äºç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½†æ˜¯è¿™äº›é€»è¾‘æœ¬èº«äº’ç›¸æ— å…³ï¼Œè¿™ä¹Ÿå°±ä¼šå‡ºç°ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•é‡Œæ··æ‚ç€äº’ä¸ç›¸å…³çš„å¤„ç†é€»è¾‘ï¼Œå¯¼è‡´ç»„ä»¶è¶Šæ¥è¶Šéš¾ä»¥ç†è§£ï¼Œä»è€Œå¯¼è‡´å‡ºé”™çš„æ¦‚ç‡å¢åŠ ã€‚</p><p>Hooks å¯ä»¥å®ç°ç»„ä»¶æ›´å°ç²’åº¦çš„å‡½æ•°æ‹†åˆ†ï¼Œäº’ç›¸æ— å…³çš„é€»è¾‘ä¹Ÿå¯ä»¥åŒºåˆ†å¼€æ¥ï¼Œè€Œä¸ç”¨å†ä¾èµ–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¥è¿›è¡Œæ‹†åˆ†ã€‚</p><h3 id="ä»¤äººå›°æƒ‘çš„-Class"><a href="#ä»¤äººå›°æƒ‘çš„-Class" class="headerlink" title="ä»¤äººå›°æƒ‘çš„ Class"></a>ä»¤äººå›°æƒ‘çš„ Class</h3><p>ä½¿ç”¨ <code>Class</code> ï¼Œæ˜¯ä½¿ç”¨å’Œå­¦ä¹  <code>React</code> çš„ä¸€å¤§éšœç¢ã€‚è¦æ±‚ä½¿ç”¨è€…ç†è§£ <code>class</code> çš„ç”¨æ³•ï¼ˆä¾‹å¦‚è¦ç†è§£ <code>this</code> ï¼Œå¤„ç†äº‹ä»¶ç»‘å®šï¼Œä½¿ç”¨ä¸€äº›ææ¡ˆä¸­çš„è¯­æ³•ï¼‰ï¼Œè€Œä¸”éœ€è¦å­¦ä¼šåˆ†è¾¨ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ <code>function component</code>ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨ <code>class component</code>ã€‚</p><p><code>class component</code> ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ <a href="https://prepack.io/" target="_blank" rel="noopener">Prepack</a> ä¸€äº›ä¼˜åŒ–å¤±æ•ˆã€‚</p><p>è¿˜æœ‰å°±æ˜¯ <code>class</code> å¯¹ä¸€äº›å¼€å‘å·¥å…·çš„å½±å“ï¼Œä¾‹å¦‚ï¼š donâ€™t minify very well(è¿™ä¸ªåº”è¯¥æ˜¯ es6 çš„é€šç—…)ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¼è‡´ hot reloading å‡ºé—®é¢˜ã€‚</p><p>Hooks å¯ä»¥è®©ä½ ä¸ä½¿ç”¨ <code>class</code> ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸Š React çš„ä¸€äº›åŠŸèƒ½ã€‚è€Œ React æœ¬èº«ä¹Ÿæ˜¯æ›´å€¾å‘äº functionsï¼Œä½¿ç”¨ Hooks å¯ä»¥æ›´å¥½çš„æ‹¥æŠ± functionsã€‚</p><blockquote><p><a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener">Introducing Hooks</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;å®˜æ–¹æ–‡æ¡£å…³äº Hooks çš„é˜…è¯»ç¬”è®°&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;å…³äº-Hooks&quot;&gt;&lt;a href=&quot;#å…³äº-Hooks&quot; class=&quot;headerlink&quot; title=&quot;å…³äº Hooks&quot;&gt;&lt;/a&gt;å…³äº Hooks&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;è¿™æ˜¯ä¸ªå¯é€‰çš„åŠŸèƒ½ã€‚å¦‚æœä½ ä¸æƒ³ç”¨ï¼Œä½ å¯ä»¥é€‰æ‹©å¿½ç•¥å®ƒã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;100% å‘åå…¼å®¹ã€‚Hooks æ²¡æœ‰ç ´åæ€§çš„å˜æ›´ã€‚&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;ç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚Hooks åœ¨ React V16.8.0 å·²ç»å‘å¸ƒã€‚&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://blog.hhking.cn/tags/React/"/>
    
      <category term="React Hooks" scheme="https://blog.hhking.cn/tags/React-Hooks/"/>
    
  </entry>
  
  <entry>
    <title>webpack4 å‡çº§è®°</title>
    <link href="https://blog.hhking.cn/2019/03/10/webpack-migrate2v4-from-v3/"/>
    <id>https://blog.hhking.cn/2019/03/10/webpack-migrate2v4-from-v3/</id>
    <published>2019-03-10T13:38:03.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å·ç§° â€œ<strong>é›¶é…ç½®</strong>â€ã€â€œ<strong>æœ€é«˜å¯æå‡98%çš„é€Ÿåº¦</strong>â€ çš„ webpack4 å·²ç»å‡ºæ¥ä¸€æ®µæ—¶é—´äº†ï¼Œè€Œä¸” webpack5 ä¹Ÿå·²ç»åœ¨è·¯ä¸Šäº†ã€‚å†ä¸ä½“éªŒä¸€ä¸‹ webpack4 å°±è€äº†ï¼ç›®å‰é¡¹ç›®ä½¿ç”¨çš„è¿˜æ˜¯ webpack3ï¼Œæ‰“åŒ…é€Ÿåº¦ç¡®å®æ˜¯é”»ç‚¼äººçš„è€å¿ƒï¼Œè¿™æ¬¡è¶ç€æœ‰ç‚¹æ—¶é—´ï¼Œå†³å¿ƒä¼˜åŒ–ä¸€ä¸‹é¡¹ç›®ï¼Œå°è¯•ä» webpack å‡çº§å¼€å§‹ã€‚æœŸé—´æ–­æ–­ç»­ç»­ä¹Ÿé‡åˆ°ä¸å°‘é—®é¢˜ï¼Œåœ¨è¿™é‡Œå¯¹å¤§è‡´çš„è¿‡ç¨‹åšä¸ªè®°å½•ã€‚</p><blockquote><p>çŠ¹è®°å½“å¹´ï¼Œä¹Ÿæ˜¯æˆ‘æŠŠ webpack ä» v1 å‡çº§åˆ° v3 çš„</p></blockquote><a id="more"></a><h2 id="å®‰è£…-webpack-ä»¥åŠç›¸å…³é…ç½®"><a href="#å®‰è£…-webpack-ä»¥åŠç›¸å…³é…ç½®" class="headerlink" title="å®‰è£… webpack ä»¥åŠç›¸å…³é…ç½®"></a>å®‰è£… webpack ä»¥åŠç›¸å…³é…ç½®</h2><ol><li>å…ˆåˆ é™¤ä¹‹å‰çš„ webpackã€webpack-dev-server</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall webpack webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ webpackã€webpack-cli (webpack4 æŠŠè„šæ‰‹æ¶ webpack-cli ä» webpack ä¸­æŠ½ç¦»å‡ºæ¥çš„ï¼Œæ‰€ä»¥å¿…é¡»å®‰è£… webpack-cli)ã€webpack-dev-server</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-dev-server webpack-cli --save-dev</span><br></pre></td></tr></table></figure><ol start="3"><li>webpack4 å·²ä¸æ”¯æŒ <a href="https://github.com/webpack-contrib/extract-text-webpack-plugin" target="_blank" rel="noopener">extract-text-webpack-plugin</a>ï¼Œæ”¹ç”¨ <a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall --save-dev extract-text-webpack-plugin</span><br><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure><ol start="4"><li>å®‰è£…æ–°ç‰ˆçš„ <a href="https://github.com/jantimon/html-webpack-plugin" target="_blank" rel="noopener">html-webpack-plugin</a></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall --save-dev html-webpack-plugin</span><br><span class="line">npm i --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure><ol start="5"><li>è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç›¸å…³çš„åŒ…ï¼Œåœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œæ’æŸ¥å‡ºå¯¹åº”å‡çº§</li></ol><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æŒ‰ webpack4 çš„è¦æ±‚å‡çº§å¹¶é…ç½®å¥½ä¹‹åï¼Œå°±å¼€å§‹å°è¯•åœ¨é¡¹ç›®è·‘å¼€å‘ç¯å¢ƒäº†ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€æ³¢ä¸‰æŠ˜ï¼Œå‡çº§èŠ±è´¹çš„æ—¶é—´ä¸»è¦éƒ½åœ¨è¿™é‡Œäº†ã€‚</p><h3 id="è·¯å¾„é—®é¢˜"><a href="#è·¯å¾„é—®é¢˜" class="headerlink" title="è·¯å¾„é—®é¢˜"></a>è·¯å¾„é—®é¢˜</h3><p>é¦–å…ˆé‡åˆ°çš„æ˜¯å·¨å‘ï¼Œæ˜¯ scss é‡Œçš„è·¯å¾„é—®é¢˜ã€‚</p><p>è·¯å¾„å¤„ç†ä½¿ç”¨ <code>resolve-url-loader</code> æ¥æŠŠè·¯å¾„å¤„ç†æˆç»å¯¹è·¯å¾„ï¼Œè¿™ä¸ª <code>loader</code> å¯ä»¥è§£å†³ sass ä¸­ï¼Œå¼•ç”¨ä¸åŒç›®å½•çš„ scss æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´åŸæ¥çš„ç›¸å¯¹ <code>url</code> é”™è¯¯çš„é—®é¢˜ã€‚</p><p>å‡çº§è¿™ä¸ª <code>loader</code> åï¼Œscss ä¸­å›¾ç‰‡å­—ä½“è·¯å¾„ä¸€ç›´ <code>can&#39;t resolve</code>ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯å‡çº§åé…ç½®ä¸å¯¹ï¼Œåœ¨è¿™é‡Œå¡äº†å¥½ä¹…ï¼Œä¸€ç›´çœ‹é…ç½®ï¼Œæ”¹é…ç½®ï¼ŒæŸ¥ç›¸å…³çš„ <code>loader</code>ï¼Œæ— æœï¼</p><p>æœ€åå†³å®šè¿˜æ˜¯ä»æºç å…¥æ‰‹ï¼Œä½¿ç”¨ <code>vscode</code> çš„è°ƒè¯•åŠŸèƒ½ï¼Œè°ƒè¯•ä¸€ä¸‹è¿™ä¸ª <code>loader</code> çš„å¤„ç†æƒ…å†µã€‚æœç„¶å‘ç°é—®é¢˜ï¼Œ <code>resolve-url-loader</code> v2 å’Œ v3 çš„è·¯å¾„å¤„ç†çš„æ–¹å¼æ”¹äº†ï¼v2 ä¼šå¾ªç¯æŸ¥æ‰¾æ¯ä¸€çº§çš„ç›®å½•ï¼Œè€Œ v3 åªä¼šæ ¹æ®æä¾›çš„è·¯å¾„ç”Ÿæˆå¯¹åº”çš„ç»å¯¹è·¯å¾„æ¥æŸ¥æ‰¾ã€‚</p><p>å‘ç°é”™çš„ä¸æ˜¯å‡çº§åçš„é…ç½®ï¼Œè€Œæ˜¯ä»¥å‰ä»£ç é‡Œå¾ˆå¤šè·¯å¾„æœ¬èº«å°±å†™é”™äº†ï¼Œæ¯”å¦‚</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç„¶è€Œäº‹å®ä¸Šï¼Œå½“å‰ç›®å½•ä¸‹æ ¹æœ¬æ²¡æœ‰ img ç›®å½•ã€‚åº”è¯¥æ˜¯ ../img/test.png</span></span><br><span class="line"><span class="attribute">background-image</span>: url(./img/test.png);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å› ä¸º <code>resolve-url-loader</code> å¾ªç¯æ¯ä¸€çº§æŸ¥æ‰¾çš„åŸå› ï¼Œè¿˜æ˜¯èƒ½æ‰¾åˆ°å¯¹åº”çš„å›¾ç‰‡ã€‚æ‰€ä»¥åŸæ¥è™½ç„¶å†™çš„è‡ªç”±å¥”æ”¾ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚ï¼ˆæœ‰äº›æ˜¯å› ä¸º <code>copy</code> å…¶ä»–åœ°æ–¹çš„ä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰ <code>copy</code> å¯¹åº”çš„èµ„æºæ–‡ä»¶å¯¼è‡´çš„ï¼‰</p><p>å¦‚æ­¤å·¨å‘ï¼Œæ‰€ä»¥åˆé™·å…¥äº†ä¿®æ”¹å¤§æ‰¹é”™è¯¯è·¯å¾„çš„å·¥ä½œä¸­ã€‚ã€‚ã€‚</p><h3 id="æ€§èƒ½é—®é¢˜"><a href="#æ€§èƒ½é—®é¢˜" class="headerlink" title="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜</h3><p>è§£å†³è·¯å¾„é—®é¢˜ä¹‹åï¼ŒåŠ¿å¦‚ç ´ç«¹ï¼Œå¤§éƒ¨åˆ†é—®é¢˜åªè¦æ‰¾åˆ°ç›¸å…³å¤„ç†çš„ <code>loader</code> æˆ–è€… <code>plugin</code> é€šè¿‡è°ƒè¯•ï¼Œéƒ½èƒ½æ‰¾åˆ°åŸå› ã€‚</p><p>webpack4 è·‘èµ·æ¥åï¼Œæ•´ä½“çš„é€Ÿåº¦å·²ç»æ˜¯æå‡ä¸€å¤§æˆªäº†ï¼Œå•ç‹¬æ‰“åŒ…ä¸»æµç¨‹çš„æ—¶é—´ä» <code>155s</code> é™åˆ°äº† <code>70s</code> å·¦å³ï¼Œæå‡è¿‘ <strong>55%</strong>ã€‚</p><p>ä½†æ˜¯æ¥ç€å‘ç°äº†ä¸€ä¸ªç¥å¥‡çš„é—®é¢˜ï¼Œå¼€å‘ç¯å¢ƒå’Œæ‰“åŒ…é€Ÿåº¦ç«Ÿç„¶å·®ä¸å¤šï¼Œç”šè‡³æ›´æ…¢ï¼ï¼ï¼</p><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯ <code>source-map</code> çš„é…ç½®ï¼Œä¸¥é‡æ‹–æ…¢é€Ÿåº¦ã€‚</p><p>ä½†æ˜¯ä¿®æ”¹ä¸åŒçš„ <code>devtool</code>ï¼Œå‘ç°å˜åŒ–å¹¶ä¸å¤§ã€‚é—®é¢˜ä¸åœ¨è¿™ã€‚</p><p>ç„¶åæƒ³åˆ° <code>icon-font</code>ã€‚</p><p>äºæ˜¯çœ‹æ»¡å±å¯†å¯†éº»éº»çš„æ‰“åŒ…ä¿¡æ¯ï¼Œå‘ç°å­—ä½“æ–‡ä»¶ä¸æ–­é‡å¤çš„å¼•å…¥ã€‚å‘ç°æ˜¯ sass å…¬å…± <code>util</code> æ¨¡å—é‡Œå¼•ç”¨äº†å­—ä½“çš„æ¨¡å—ï¼Œç„¶åä¹‹å‰ä¸€æ¬¡ä¿®æ”¹ï¼Œå¢åŠ äº†æ¯ä¸ª <code>scss</code> è‡ªåŠ¨å¼•å…¥ <code>util</code> çš„ <code>loader</code> ã€‚</p><p>æœç„¶ï¼Œæ”¹æ­£è¿™ä¸ªé—®é¢˜ï¼Œåªå¼•å…¥ä¸€æ¬¡å­—ä½“åï¼Œå¼€å‘ç¯å¢ƒé€Ÿåº¦ç›´æ¥å¿«äº†ä¸€å€ã€‚</p><h3 id="sass-å…¬å…±æ¨¡å—çš„é—®é¢˜"><a href="#sass-å…¬å…±æ¨¡å—çš„é—®é¢˜" class="headerlink" title="sass å…¬å…±æ¨¡å—çš„é—®é¢˜"></a>sass å…¬å…±æ¨¡å—çš„é—®é¢˜</h3><p>ä¸Šé¢çš„é—®é¢˜ï¼Œå…¶å®å’Œè¿™ä¸ªé—®é¢˜ç›¸å…³ï¼šå°±æ˜¯ sass å…¬å…±æ¨¡å—çš„é—®é¢˜ã€‚</p><p>å…¶å®åŸå› åœ¨äºï¼Œ<code>sass-loader</code> å¯¹ <code>@import</code> æ˜¯ä¸ä¼šå»é‡çš„ï¼Œé‡å¤ <code>import</code> çš„ <code>scss</code> ä¼šé‡å¤å‡ºç°ã€‚<a href="https://github.com/webpack-contrib/sass-loader" target="_blank" rel="noopener">sass-loader</a>` issue <a href="https://github.com/webpack-contrib/sass-loader/issues/145" target="_blank" rel="noopener">Duplicate Imports </a>ä¸­æœ‰è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><ol><li>è§„èŒƒ sass å…¬å…±æ¨¡å—ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ–‡ä»¶å¼•å…¥çš„å…¬å…±å˜é‡ã€function ä¹‹ç±»çš„ï¼Œä¸è¦å¸¦æœ‰ä¼šç”Ÿæˆ css çš„ä»£ç ã€‚ï¼ˆå¯ä»¥å€ŸåŠ© <a href="https://github.com/shakacode/sass-resources-loader" target="_blank" rel="noopener">sass-resources-loader</a> è‡ªåŠ¨æ¯ä¸ªæ–‡ä»¶å¼•å…¥éœ€è¦çš„å…¬å…±æ¨¡å—ï¼‰ã€‚</li><li>å¯¹äº <code>global.scss</code>, <code>reset.scss</code>, <code>common.scss</code> è¿™ç§ç”Ÿæˆ <code>css</code> çš„å…¬å…±æ¨¡å—ï¼Œåœ¨ <code>js</code> ä¸­ <code>import/require</code>ã€‚</li><li>ä½¿ç”¨ <a href="https://github.com/NMFR/optimize-css-assets-webpack-plugin" target="_blank" rel="noopener">optimize-css-assets-webpack-plugin</a> å¯ä»¥å»æ‰é‡å¤çš„ <code>css</code>ã€‚</li></ol><h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><h3 id="æŸå•ä¸ªé¡¹ç›®å‡çº§å‰åå¯¹æ¯”"><a href="#æŸå•ä¸ªé¡¹ç›®å‡çº§å‰åå¯¹æ¯”" class="headerlink" title="æŸå•ä¸ªé¡¹ç›®å‡çº§å‰åå¯¹æ¯”"></a>æŸå•ä¸ªé¡¹ç›®å‡çº§å‰åå¯¹æ¯”</h3><table><thead><tr><th>time</th><th>development</th><th>production</th></tr></thead><tbody><tr><td>webpack3</td><td>82.676s</td><td>183.235s</td></tr><tr><td>webpack4</td><td>33.6s(æå‡59.3%)</td><td>66.429s(æå‡63.7%)</td></tr></tbody></table><h3 id="å…¨éƒ¨é¡¹ç›®æ‰“åŒ…å‰åå¯¹æ¯”"><a href="#å…¨éƒ¨é¡¹ç›®æ‰“åŒ…å‰åå¯¹æ¯”" class="headerlink" title="å…¨éƒ¨é¡¹ç›®æ‰“åŒ…å‰åå¯¹æ¯”"></a>å…¨éƒ¨é¡¹ç›®æ‰“åŒ…å‰åå¯¹æ¯”</h3><table><thead><tr><th>time</th><th>production</th></tr></thead><tbody><tr><td>webpack3</td><td>1070s</td></tr><tr><td>webpack4</td><td>343s(æå‡67.9%)</td></tr></tbody></table><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>è¿™æ¬¡å‡çº§è™½ç„¶è´¹äº†ä¸å°‘åŠŸå¤«ï¼Œè¸©äº†ä¸å°‘å‘ï¼Œä½†ä¹Ÿæ”¶è·ä¸å°‘ç»éªŒå’Œä¸€äº›æ–°çš„æ€è·¯ã€‚åŒæ—¶ï¼Œä¸€äº›é—®é¢˜ï¼Œä¹Ÿæš´éœ²å‡ºå›¢é˜Ÿé¡¹ç›®ä¸Šçš„ä¸€äº›é—®é¢˜ã€‚</p><p>å‡çº§ webpack4 åï¼Œé€Ÿåº¦å¤§å¹…åº¦æå‡ï¼Œæ•´ä¸ªå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å¯ä»¥è¯´å°†è¿‘ <strong>æå‡ 70% * å›¢é˜Ÿ</strong> å§ã€‚ä½†æ˜¯è¿˜å¯ä»¥ç»§ç»­æ·±å…¥ä¼˜åŒ–ï¼Œè¿˜æœ‰ä¸å°‘çš„æå‡ç©ºé—´ã€‚å¯ä»¥ä½¿ç”¨ <a href="https://github.com/stephencookdev/speed-measure-webpack-plugin" target="_blank" rel="noopener">speed-measure-webpack-plugin</a> æ¥æ£€æµ‹webpackæ‰“åŒ…è¿‡ç¨‹ä¸­å„ä¸ªéƒ¨åˆ†æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œå†æ ¹æ®åˆ†ææ¥åšä¼˜åŒ–ã€‚è¿˜å¯ä»¥è€ƒè™‘ <code>babel</code> å‡çº§åˆ° v7 å’Œå¼€å‘ç¯å¢ƒçš„ <code>node</code> å±‚å‡çº§ä¼˜åŒ–ã€‚</p><p>å‘Šè¾ï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å·ç§° â€œ&lt;strong&gt;é›¶é…ç½®&lt;/strong&gt;â€ã€â€œ&lt;strong&gt;æœ€é«˜å¯æå‡98%çš„é€Ÿåº¦&lt;/strong&gt;â€ çš„ webpack4 å·²ç»å‡ºæ¥ä¸€æ®µæ—¶é—´äº†ï¼Œè€Œä¸” webpack5 ä¹Ÿå·²ç»åœ¨è·¯ä¸Šäº†ã€‚å†ä¸ä½“éªŒä¸€ä¸‹ webpack4 å°±è€äº†ï¼ç›®å‰é¡¹ç›®ä½¿ç”¨çš„è¿˜æ˜¯ webpack3ï¼Œæ‰“åŒ…é€Ÿåº¦ç¡®å®æ˜¯é”»ç‚¼äººçš„è€å¿ƒï¼Œè¿™æ¬¡è¶ç€æœ‰ç‚¹æ—¶é—´ï¼Œå†³å¿ƒä¼˜åŒ–ä¸€ä¸‹é¡¹ç›®ï¼Œå°è¯•ä» webpack å‡çº§å¼€å§‹ã€‚æœŸé—´æ–­æ–­ç»­ç»­ä¹Ÿé‡åˆ°ä¸å°‘é—®é¢˜ï¼Œåœ¨è¿™é‡Œå¯¹å¤§è‡´çš„è¿‡ç¨‹åšä¸ªè®°å½•ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;çŠ¹è®°å½“å¹´ï¼Œä¹Ÿæ˜¯æˆ‘æŠŠ webpack ä» v1 å‡çº§åˆ° v3 çš„&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="webpack" scheme="https://blog.hhking.cn/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘]JavaScript å¦‚ä½•å¤åˆ¶å¯¹è±¡</title>
    <link href="https://blog.hhking.cn/2018/12/11/copying-objects-in-javascript/"/>
    <id>https://blog.hhking.cn/2018/12/11/copying-objects-in-javascript/</id>
    <published>2018-12-11T11:14:13.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡: <a href="https://smalldata.tech/blog/2018/11/01/copying-objects-in-javascript" target="_blank" rel="noopener">COPYING OBJECTS IN JAVASCRIPT</a><br>ä½œè€…: Victor Parmar</p></blockquote><p>è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨ JavaScript ä¸­å¤åˆ¶å¯¹è±¡çš„å„ç§æ–¹æ³•ã€‚å…¶ä¸­åŒ…æ‹¬äº†æµ…å¤åˆ¶å’Œæ·±å¤åˆ¶ã€‚</p><a id="more"></a><p>å¼€å§‹ä¹‹å‰ï¼Œæœ‰å¿…è¦è¯´ä¸€äº›åŸºç¡€æ¦‚å¿µï¼šJavaScript ä¸­çš„å¯¹è±¡ï¼Œæ˜¯å¯¹å†…å­˜ä¸­å­˜å‚¨ä½ç½®çš„å¼•ç”¨ã€‚è¿™äº›å¼•ç”¨æ˜¯å¯å˜çš„ï¼Œå³ï¼šå¼•ç”¨å¯ä»¥è¢«é‡æ–°èµ‹å€¼ã€‚å› æ­¤ï¼Œç®€å•çš„å¤åˆ¶å¼•ç”¨ï¼Œç»“æœåªä¼šæ˜¯ä¸¤ä¸ªå¼•ç”¨åŒæ—¶æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä¸ªä½ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123;</span><br><span class="line">    a : <span class="string">"abc"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(foo.a); <span class="comment">// abc</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bar = foo;</span><br><span class="line"><span class="built_in">console</span>.log(bar.a); <span class="comment">// abc</span></span><br><span class="line"></span><br><span class="line">foo.a = <span class="string">"yo foo"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(foo.a); <span class="comment">// yo foo</span></span><br><span class="line"><span class="built_in">console</span>.log(bar.a); <span class="comment">// yo foo</span></span><br><span class="line"></span><br><span class="line">bar.a = <span class="string">"whatup bar?"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(foo.a); <span class="comment">// whatup bar?</span></span><br><span class="line"><span class="built_in">console</span>.log(bar.a); <span class="comment">// whatup bar?</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œ<code>foo</code> å’Œ <code>bar</code> ä»»æ„ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šåæ˜ åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Šã€‚æ‰€ä»¥ï¼Œæ ¹æ®ä½ çš„ä½¿ç”¨åœºæ™¯ï¼Œåœ¨ JavaScript ä¸­å¤åˆ¶å¯¹è±¡éœ€è¦å°å¿ƒã€‚</p><h2 id="SHALLOW-COPY-æµ…å¤åˆ¶"><a href="#SHALLOW-COPY-æµ…å¤åˆ¶" class="headerlink" title="SHALLOW COPY æµ…å¤åˆ¶"></a>SHALLOW COPY æµ…å¤åˆ¶</h2><p>å¦‚æœä½ çš„å¯¹è±¡çš„å±æ€§éƒ½æ˜¯å€¼ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å±•å¼€è¯­æ³•æˆ–è€… <code>Object.assign(...)</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">"foo"</span>, <span class="attr">bar</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> copy = &#123; ...obj &#125;; <span class="comment">// Object &#123; foo: "foo", bar: "bar" &#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">foo</span>: <span class="string">"foo"</span>, <span class="attr">bar</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> copy = <span class="built_in">Object</span>.assign(&#123;&#125;, obj); <span class="comment">// Object &#123; foo: "foo", bar: "bar" &#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸Šé¢ä¸¤ç§æ–¹æ³•ï¼Œéƒ½å¯ä»¥ç”¨æ¥ä»å¤šä¸ªæºå¯¹è±¡å¤åˆ¶å±æ€§å€¼åˆ°ç›®æ ‡å¯¹è±¡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">foo</span>: <span class="string">"foo"</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">bar</span>: <span class="string">"bar"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> copySpread = &#123; ...obj1, ...obj2 &#125;; <span class="comment">// Object &#123; foo: "foo", bar: "bar" &#125;</span></span><br><span class="line"><span class="keyword">var</span> copyAssign = <span class="built_in">Object</span>.assign(&#123;&#125;, obj1, obj2); <span class="comment">// Object &#123; foo: "foo", bar: "bar" &#125;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“å¯¹è±¡çš„å±æ€§æœ¬èº«æ˜¯å¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå±æ€§åªä¼šå¤åˆ¶å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™å’Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ <code>var bar = foo</code> æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = &#123; <span class="attr">a</span>: <span class="number">0</span> , <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">0</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> copy = &#123; ...foo &#125;;</span><br><span class="line"></span><br><span class="line">copy.a = <span class="number">1</span>;</span><br><span class="line">copy.b.c = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.dir(foo); <span class="comment">// &#123; a: 0, b: &#123; c: 2 &#125; &#125;</span></span><br><span class="line"><span class="built_in">console</span>.dir(copy); <span class="comment">// &#123; a: 1, b: &#123; c: 2 &#125; &#125;</span></span><br></pre></td></tr></table></figure><h2 id="DEEP-COPY-æ·±å¤åˆ¶ï¼ˆå¸¦è­¦å‘Šï¼‰"><a href="#DEEP-COPY-æ·±å¤åˆ¶ï¼ˆå¸¦è­¦å‘Šï¼‰" class="headerlink" title="DEEP COPY æ·±å¤åˆ¶ï¼ˆå¸¦è­¦å‘Šï¼‰"></a>DEEP COPY æ·±å¤åˆ¶ï¼ˆå¸¦è­¦å‘Šï¼‰</h2><p>æ·±å¤åˆ¶å¯¹è±¡ï¼Œä¸€ä¸ªå¯èƒ½å¯è¡Œçš„æ–¹æ³•æ˜¯ï¼ŒæŠŠå¯¹è±¡åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åå†ååºåˆ—åŒ–å›æ¥ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">0</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">0</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> copy = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(obj));</span><br></pre></td></tr></table></figure><p>å¯æƒœçš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•åªé€‚ç”¨äºï¼šæºå¯¹è±¡åŒ…å«çš„æ˜¯å¯åºåˆ—åŒ–çš„ç±»å‹å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰å¾ªç¯å¼•ç”¨ã€‚ä¸€ä¸ªä¸èƒ½åºåˆ—åŒ–çš„ç±»å‹å€¼ä¾‹å­æ˜¯ <code>Date</code> å¯¹è±¡ - å³ä½¿å®ƒæ‰“å°æˆ ISO æ ¼å¼å­—ç¬¦ä¸²ï¼Œ<code>JSON.parse</code> åªä¼šæŠŠå®ƒè§£é‡Šæˆå­—ç¬¦ä¸²è€Œä¸æ˜¯ <code>Date</code> å¯¹è±¡ã€‚</p><h2 id="DEEP-COPY-æ·±å¤åˆ¶ï¼ˆå¸¦å°‘é‡çš„è­¦å‘Šï¼‰"><a href="#DEEP-COPY-æ·±å¤åˆ¶ï¼ˆå¸¦å°‘é‡çš„è­¦å‘Šï¼‰" class="headerlink" title="DEEP COPY æ·±å¤åˆ¶ï¼ˆå¸¦å°‘é‡çš„è­¦å‘Šï¼‰"></a>DEEP COPY æ·±å¤åˆ¶ï¼ˆå¸¦å°‘é‡çš„è­¦å‘Šï¼‰</h2><p>å¯¹æ›´å¤æ‚çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨æ–°çš„ HTML5 å…‹éš†ç®—æ³• <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank" rel="noopener">â€œstructured cloneâ€</a>ã€‚å¯æƒœçš„æ˜¯ï¼Œåœ¨å†™æœ¬æ–‡çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯é™åˆ¶äºé’ˆå¯¹æŸäº›å†…ç½®ç±»å‹ï¼Œä½†æ˜¯å®ƒæ¯” <code>JSON.parse</code> æ”¯æŒæ›´å¤šçš„ç±»å‹ï¼šDate, RegExp, Map, Set, Blob, FileList, ImageData, ç¨€ç–æ•°ç»„å’Œç±»æ•°ç»„ã€‚å®ƒè¿˜ä¿ç•™äº†å…‹éš†æ•°æ®çš„å¼•ç”¨ï¼Œä»è€Œæ”¯æŒå¾ªç¯å’Œé€’å½’ç»“æ„ï¼Œè€Œä¸Šé¢æåˆ°çš„åºåˆ—åŒ–æ–¹æ³•ä¸æ”¯æŒè¿™ç‚¹ã€‚</p><p>ç›®å‰ï¼Œæ²¡æœ‰ç›´æ¥è°ƒç”¨ç»“æ„åŒ–å…‹éš†ç®—æ³•çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸€äº›è¾ƒæ–°çš„æµè§ˆå™¨ç‰¹æ€§æœ‰ä½¿ç”¨è¿™ä¸ªç®—æ³•ã€‚å› æ­¤ï¼Œé€šè¿‡ä¸€äº›å˜é€šçš„æ–¹æ³•å¯ä»¥ç”¨æ¥å®ç°å¯¹è±¡çš„æ·±å¤åˆ¶ã€‚</p><p><code>é€šè¿‡ MessageChannels</code>: è¿™ä¸ªæ€è·¯æ˜¯é€šè¿‡åˆ©ç”¨é€šä¿¡åŠŸèƒ½ä½¿ç”¨çš„åºåˆ—åŒ–ç®—æ³•æ¥å®ç°ã€‚å› ä¸ºè¿™ä¸ªåŠŸèƒ½æ˜¯åŸºäºäº‹ä»¶çš„ï¼Œæ‰€ä»¥ç”Ÿæˆå…‹éš†ä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StructuredCloner</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.pendingClones_ = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">    <span class="keyword">this</span>.nextKey_ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> channel = <span class="keyword">new</span> MessageChannel();</span><br><span class="line">    <span class="keyword">this</span>.inPort_ = channel.port1;</span><br><span class="line">    <span class="keyword">this</span>.outPort_ = channel.port2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.outPort_.onmessage = <span class="function">(<span class="params">&#123;data: &#123;key, value&#125;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> resolve = <span class="keyword">this</span>.pendingClones_.get(key);</span><br><span class="line">      resolve(value);</span><br><span class="line">      <span class="keyword">this</span>.pendingClones_.delete(key);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.outPort_.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cloneAsync(value) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> key = <span class="keyword">this</span>.nextKey_++;</span><br><span class="line">      <span class="keyword">this</span>.pendingClones_.set(key, resolve);</span><br><span class="line">      <span class="keyword">this</span>.inPort_.postMessage(&#123;key, value&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> structuredCloneAsync = <span class="built_in">window</span>.structuredCloneAsync =</span><br><span class="line">    StructuredCloner.prototype.cloneAsync.bind(<span class="keyword">new</span> StructuredCloner);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> main = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> original = &#123; <span class="attr">date</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="attr">number</span>: <span class="built_in">Math</span>.random() &#125;;</span><br><span class="line">  original.self = original;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clone = <span class="keyword">await</span> structuredCloneAsync(original);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// different objects:</span></span><br><span class="line">  <span class="built_in">console</span>.assert(original !== clone);</span><br><span class="line">  <span class="built_in">console</span>.assert(original.date !== clone.date);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cyclical:</span></span><br><span class="line">  <span class="built_in">console</span>.assert(original.self === original);</span><br><span class="line">  <span class="built_in">console</span>.assert(clone.self === clone);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// equivalent values:</span></span><br><span class="line">  <span class="built_in">console</span>.assert(original.number === clone.number);</span><br><span class="line">  <span class="built_in">console</span>.assert(<span class="built_in">Number</span>(original.date) === <span class="built_in">Number</span>(clone.date));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Assertions complete."</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure><p><code>é€šè¿‡ history API</code>: <code>history.pushState()</code> å’Œ <code>history.replaceState()</code> éƒ½ä¼šå¯¹ç¬¬ä¸€ä¸ªå‚æ•°åˆ›å»ºç»“æ„åŒ–å…‹éš†ã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œæ“ä½œæµè§ˆå™¨çš„ history å¹¶ä¸æ˜¯ä¸ªå¾ˆå¿«çš„æ“ä½œï¼Œæ‰€ä»¥é¢‘ç¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¼šå¯¼è‡´æµè§ˆå™¨æ— å“åº”ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> structuredClone = <span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> oldState = history.state;</span><br><span class="line">  history.replaceState(obj, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> clonedObj = history.state;</span><br><span class="line">  history.replaceState(oldState, <span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> clonedObj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>é€šè¿‡ notification API</code>: åˆ›å»ºæ–°çš„é€šçŸ¥æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šåˆ›å»ºå…¶ä¸­å…³è”çš„ data çš„ç»“æ„åŒ–å…‹éš†ã€‚æ³¨æ„ï¼Œè¿™ä¸ªä¹Ÿä¼šå°è¯•å°†é€šçŸ¥å±•ç°ç»™ç”¨æˆ·ï¼Œä½†æ˜¯è¿™ä¸ªé»˜é»˜çš„å¤±è´¥ï¼Œé™¤éåº”ç”¨è¯·æ±‚è¿‡æ˜¾ç¤ºé€šçŸ¥çš„æƒé™ã€‚åœ¨å·²æˆäºˆæƒé™çš„åœºæ™¯ä¸‹ï¼Œé€šçŸ¥é©¬ä¸Šè¢«å…³é—­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> structuredClone = <span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> n = <span class="keyword">new</span> Notification(<span class="string">""</span>, &#123;<span class="attr">data</span>: obj, <span class="attr">silent</span>: <span class="literal">true</span>&#125;);</span><br><span class="line">  n.onshow = n.close.bind(n);</span><br><span class="line">  <span class="keyword">return</span> n.data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="NODE-JS-ä¸­æ·±å¤åˆ¶"><a href="#NODE-JS-ä¸­æ·±å¤åˆ¶" class="headerlink" title="NODE.JS ä¸­æ·±å¤åˆ¶"></a>NODE.JS ä¸­æ·±å¤åˆ¶</h2><p>ä» version 8.0.0 å¼€å§‹ï¼ŒNode.js æä¾› <a href="https://nodejs.org/api/v8.html#v8_serialization_api" target="_blank" rel="noopener">serialization api</a>ï¼Œå®ƒå…¼å®¹ç»“æ„åŒ–å…‹éš†ã€‚æ³¨æ„ï¼Œå†™è¿™ç¯‡æ–‡ç« æ˜¯ï¼Œè¿™ä¸ª API å±äºå®éªŒæ€§çš„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> v8 = <span class="built_in">require</span>(<span class="string">'v8'</span>);</span><br><span class="line"><span class="keyword">const</span> buf = v8.serialize(&#123;<span class="attr">a</span>: <span class="string">'foo'</span>, <span class="attr">b</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()&#125;);</span><br><span class="line"><span class="keyword">const</span> cloned = v8.deserialize(buf);</span><br><span class="line">cloned.b.getMonth();</span><br></pre></td></tr></table></figure><p>å¯¹äº 8.0.0 ä»¥ä¸‹ç‰ˆæœ¬ï¼Œæˆ–è€…æ˜¯éœ€è¦æ›´ç¨³å®šçš„å®ç°ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ lodash çš„ <code>cloneDeep</code> æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯åŸºäºç»“æ„åŒ–å…‹éš†ç®—æ³•çš„ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æ€»ç»“ä¸€ä¸‹ï¼ŒJavaScript ä¸­æœ€å¥½çš„å¤åˆ¶å¯¹è±¡ç®—æ³•ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºç¯å¢ƒå’Œä½ è¦å¤åˆ¶çš„å¯¹è±¡çš„ç±»å‹ã€‚è™½ç„¶ lodash æ˜¯é€šç”¨æ·±å¤åˆ¶æ–¹æ³•ä¸­æœ€å®‰å…¨çš„é€‰æ‹©ï¼Œä½†æ˜¯å¦‚æœä½ è‡ªå·±å®ç°ï¼Œå¯ä»¥å¾—åˆ°æ›´é«˜æ•ˆçš„æ–¹æ¡ˆã€‚ä¸‹é¢æ˜¯ä¸ªç®€å•çš„æ·±å¤åˆ¶ä¾‹å­ï¼Œæ”¯æŒæ—¥æœŸï¼ˆ<code>Date</code>ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> copy;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle the 3 simple types, and null or undefined</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">null</span> == obj || <span class="string">"object"</span> != <span class="keyword">typeof</span> obj) <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle Date</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Date</span>) &#123;</span><br><span class="line">    copy = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    copy.setTime(obj.getTime());</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle Array</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">    copy = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = obj.length; i &lt; len; i++) &#123;</span><br><span class="line">        copy[i] = deepClone(obj[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle Function</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Function</span>) &#123;</span><br><span class="line">    copy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> obj.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Handle Object</span></span><br><span class="line">  <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">      copy = &#123;&#125;;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> obj) &#123;</span><br><span class="line">          <span class="keyword">if</span> (obj.hasOwnProperty(attr)) copy[attr] = deepClone(obj[attr]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> copy;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Unable to copy obj as type isn't supported "</span> + obj.constructor.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ªäººè€Œè¨€ï¼Œæˆ‘å¸Œæœ›å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ç»“æ„åŒ–å…‹éš†ï¼Œè¿™æ ·è¿™ä¸ªé—®é¢˜ï¼ˆå¯¹è±¡å¤åˆ¶ï¼‰å°±å¯ä»¥è§£å†³äº†ï¼šå¼€å¿ƒçš„å…‹éš†:)</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡: &lt;a href=&quot;https://smalldata.tech/blog/2018/11/01/copying-objects-in-javascript&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;COPYING OBJECTS IN JAVASCRIPT&lt;/a&gt;&lt;br&gt;ä½œè€…: Victor Parmar&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨ JavaScript ä¸­å¤åˆ¶å¯¹è±¡çš„å„ç§æ–¹æ³•ã€‚å…¶ä¸­åŒ…æ‹¬äº†æµ…å¤åˆ¶å’Œæ·±å¤åˆ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å¤åˆ¶å¯¹è±¡" scheme="https://blog.hhking.cn/tags/%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1/"/>
    
      <category term="æµ…å¤åˆ¶" scheme="https://blog.hhking.cn/tags/%E6%B5%85%E5%A4%8D%E5%88%B6/"/>
    
      <category term="æ·±å¤åˆ¶" scheme="https://blog.hhking.cn/tags/%E6%B7%B1%E5%A4%8D%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>Awesome Font-end</title>
    <link href="https://blog.hhking.cn/2018/12/03/awesome-front-end/"/>
    <id>https://blog.hhking.cn/2018/12/03/awesome-front-end/</id>
    <published>2018-12-03T13:44:47.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ç«¯çš„å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œæ–°çš„æŠ€æœ¯ã€æ–°çš„å·¥å…·å¦‚é›¨åæ˜¥ç¬‹ï¼Œä¸æ–­çš„å†’å‡ºæ¥ã€‚</p><p>ä½œä¸ºå‰ç«¯ï¼Œèº«å¤„äºå¤§å‰ç«¯çš„ç¹è£æ—¶ä»£ï¼Œéœ€è¦ä¸æ–­çš„å­¦ä¹ ï¼Œä¸æ–­çš„æ›´æ–°è‡ªæˆ‘ã€‚</p><blockquote><p>è¿™æ˜¯æœ€å¥½çš„æ—¶ä»£ï¼Œä¹Ÿæ˜¯æœ€åçš„æ—¶ä»£</p></blockquote><p>é±¼ï¼Œè¿˜æ˜¯æ¸”ï¼Œè¿™æ—¶å°±æ˜¾å¾—éå¸¸çš„é‡è¦ã€‚</p><a id="more"></a><p>æŒæ¡å¥½çš„ä¿¡æ¯æ¥æºï¼Œæ¥æ”¶ä¼˜è´¨çš„å†…å®¹ï¼Œæ‰èƒ½åœ¨æµªæ½®ä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œè®°å½•ä¸€äº›ä¸ªäººè§‰å¾—å€¼å¾—å…³æ³¨å’Œæ”¶è—çš„å‰ç«¯é¢†åŸŸå†…å®¹:</p><ul><li>å‰ç«¯å·¥å…·</li><li>æ•™ç¨‹&amp;&amp;åšå®¢</li><li>å®ç”¨çš„åº“</li><li>å€¼å¾—å…³æ³¨çš„å¤§ç¥</li><li>å€¼å¾—è®¢é˜…çš„èµ„è®¯</li><li>ä¹¦å•</li></ul><p>ä¸»è¦çš„ç›®çš„æ˜¯ä½œä¸ºä¸ªäººå¤‡å¿˜ï¼ğŸ˜€</p><p>GitHub åœ°å€: <a href="https://github.com/hhking/Awesome-Font-end" target="_blank" rel="noopener">Awesome Font-end ğŸ˜€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰ç«¯çš„å‘å±•æ—¥æ–°æœˆå¼‚ï¼Œæ–°çš„æŠ€æœ¯ã€æ–°çš„å·¥å…·å¦‚é›¨åæ˜¥ç¬‹ï¼Œä¸æ–­çš„å†’å‡ºæ¥ã€‚&lt;/p&gt;&lt;p&gt;ä½œä¸ºå‰ç«¯ï¼Œèº«å¤„äºå¤§å‰ç«¯çš„ç¹è£æ—¶ä»£ï¼Œéœ€è¦ä¸æ–­çš„å­¦ä¹ ï¼Œä¸æ–­çš„æ›´æ–°è‡ªæˆ‘ã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;è¿™æ˜¯æœ€å¥½çš„æ—¶ä»£ï¼Œä¹Ÿæ˜¯æœ€åçš„æ—¶ä»£&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;é±¼ï¼Œè¿˜æ˜¯æ¸”ï¼Œè¿™æ—¶å°±æ˜¾å¾—éå¸¸çš„é‡è¦ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Front-end" scheme="https://blog.hhking.cn/tags/Front-end/"/>
    
      <category term="awesome" scheme="https://blog.hhking.cn/tags/awesome/"/>
    
  </entry>
  
  <entry>
    <title>HTML5 å›¾ç‰‡ä¸Šä¼ è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://blog.hhking.cn/2018/11/29/html5-img-upload/"/>
    <id>https://blog.hhking.cn/2018/11/29/html5-img-upload/</id>
    <published>2018-11-29T06:18:59.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰ç«¯åšå›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°å›¾ç‰‡å‹ç¼©ã€å›¾ç‰‡é¢„è§ˆç­‰éœ€æ±‚ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ä¸€ä¸ªä¸ªçš„å‘ã€‚ä¸‹é¢å°±æ¥çœ‹ä¸€çœ‹ HTML5 å®ç°å›¾ç‰‡ä¸Šä¼ çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><a id="more"></a><h2 id="åŸºæœ¬ç»“æ„"><a href="#åŸºæœ¬ç»“æ„" class="headerlink" title="åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h2><p>å›¾ç‰‡ä¸Šä¼ æ˜¯ä½¿ç”¨ input æ ‡ç­¾æ¥é€‰æ‹©å›¾ç‰‡çš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯èƒ½é‡åˆ°ä¸€ä¸ªå‘ï¼š</p><p>å¯èƒ½ä¼šé‡åˆ°å“åº”è¿Ÿé’ï¼Œæ–‡ä»¶é€‰æ‹©æ¡†è¿‡å¥½å‡ ç§’æ‰å¼¹å‡ºã€‚<a href="https://zhuanlan.zhihu.com/p/27946188" target="_blank" rel="noopener">å…·ä½“çš„åŸå› å¯ä»¥æŸ¥çœ‹è¿™é‡Œ</a>ã€‚</p><p>è§£å†³çš„æ–¹æ³•æ˜¯å°† * é€šé…ç¬¦æ”¹æˆæŒ‡å®šçš„ MIME ç±»å‹ã€‚ä¾‹å¦‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">"image/gif,image/jpeg,image/jpg,image/png"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è·å–å›¾ç‰‡æ–‡ä»¶"><a href="#è·å–å›¾ç‰‡æ–‡ä»¶" class="headerlink" title="è·å–å›¾ç‰‡æ–‡ä»¶"></a>è·å–å›¾ç‰‡æ–‡ä»¶</h2><p>é€šè¿‡ç›‘å¬ input çš„ <code>change</code> äº‹ä»¶ï¼Œè·å– <code>FileList</code>ç±»æ•°ç»„å¯¹è±¡ï¼ˆevent.target.filesï¼‰ã€‚<code>FileList</code> å¯¹è±¡çš„æˆå‘˜å°±æ˜¯ <code>File</code>å¯¹è±¡ï¼ŒåŒ…å«çš„å±æ€§å¦‚å›¾ï¼š</p><p><img src="/images/h5-img-upload/h5-img-upload1.jpg" alt=""></p><h2 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h2><p>è¦å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œé¦–å…ˆè¦è·å–å›¾ç‰‡å†…å®¹ã€‚</p><p>è¿™é‡Œéœ€è¦ä½¿ç”¨ <code>FileReader</code>çš„<code>readAsDataURL(Blob|File)</code> æ¥è¯»å–å›¾ç‰‡å†…å®¹ã€‚<code>readAsDataURL</code>æ–¹æ³•è¿”å› data URLï¼Œå°†æ–‡ä»¶è¿›è¡Œ base64 ç¼–ç ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line"><span class="comment">// è¯»å–æˆåŠŸå›è°ƒ</span></span><br><span class="line">fr.onload = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// e.target.result å°±æ˜¯å›¾ç‰‡çš„ base64 åœ°å€ï¼Œå¯ä»¥ç›´æ¥ç”¨äºå›¾ç‰‡çš„ src</span></span><br><span class="line">  img.src = e.target.result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¤±è´¥å›è°ƒ</span></span><br><span class="line">fr.onerror = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// error handle</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»å–å›¾ç‰‡</span></span><br><span class="line">fr.readAsDataURL(file);</span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noopener">FileReader</a></p></blockquote><h2 id="å›¾ç‰‡å‹ç¼©"><a href="#å›¾ç‰‡å‹ç¼©" class="headerlink" title="å›¾ç‰‡å‹ç¼©"></a>å›¾ç‰‡å‹ç¼©</h2><p>å‰ç«¯è¿›è¡Œå›¾ç‰‡å‹ç¼©ï¼Œä¸ä½†èŠ‚çœæµé‡ï¼Œè€Œä¸”åŠ é€Ÿä¸Šä¼ é€Ÿåº¦ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚</p><p>ä¸Šä¸€æ­¥è¯»å–äº†å›¾ç‰‡ï¼Œå°±å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œæ“ä½œäº†ã€‚å‰ç«¯å®ç°å›¾ç‰‡å‹ç¼©ï¼ŒåŸç†å¾ˆç®€å•ï¼š</p><ol><li>ç¼©å°å›¾ç‰‡ï¼Œå¤§å›¾ç‰‡è½¬æˆå°å›¾ç‰‡</li><li>é™ä½å›¾ç‰‡è´¨é‡</li></ol><p>ç¬¬ä¸€ç‚¹æ˜¯é€šè¿‡ <code>canvas</code> çš„ <code>drawImage()</code>æ–¹æ³•æ¥å®ç°ï¼Œç¬¬äºŒç‚¹åœ¨åé¢ä¼šæåˆ°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ctx.drawImage(image, dx, dy, dWidth, dHeight)</span><br></pre></td></tr></table></figure><p>æ˜¯åœ¨ canvas ä¸Šç»˜åˆ¶å›¾åƒï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠåŸå›¾ï¼Œåœ¨ canvas ä¸Šç»˜åˆ¶æˆæ›´å°çš„å›¾ç‰‡ï¼Œå°±å®ç°äº†å‹ç¼©ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p><p>æ‰€ä»¥å…³é”®å°±æ˜¯æ€ä¹ˆæ¥è®¾ç½® <code>dWidth</code> å’Œ<code>dHeight</code>ã€‚</p><p>ä¸€èˆ¬çš„åšæ³•æ˜¯é™åˆ¶å›¾ç‰‡çš„æœ€å¤§é•¿åº¦å’Œå®½åº¦ï¼Œè¶…è¿‡åˆ™ç­‰æ¯”ä¾‹ç¼©æ”¾ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// width height å›¾ç‰‡é•¿å®½</span></span><br><span class="line"><span class="comment">// maxWidth maxHeight é™åˆ¶çš„å›¾ç‰‡æœ€å¤§é•¿å®½</span></span><br><span class="line"><span class="keyword">let</span> scale = width / height;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (scale &gt;= maxWidth / maxHeight) &#123;</span><br><span class="line">  <span class="keyword">if</span> (width &gt; maxWidth) &#123;</span><br><span class="line">    height = maxWidth / scale;</span><br><span class="line">    width = maxWidth;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (height &gt; maxHeight) &#123;</span><br><span class="line">  width = maxHeight * scale;</span><br><span class="line">  height = maxHeight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„ image å°±æ˜¯ä¸Šä¸€æ­¥å¾—åˆ°çš„å›¾ç‰‡å†…å®¹</span></span><br><span class="line">ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•å‚è€ƒï¼š <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="noopener">CanvasRenderingContext2D.drawImage()</a></p></blockquote><h2 id="å›¾ç‰‡è¾“å‡º"><a href="#å›¾ç‰‡è¾“å‡º" class="headerlink" title="å›¾ç‰‡è¾“å‡º"></a>å›¾ç‰‡è¾“å‡º</h2><p>ä¸Šä¸€æ­¥åœ¨ canvas ç»˜ç”»äº†å›¾ç‰‡ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦æŠŠ canvas ç”»å¸ƒè½¬åŒ–æˆ img å›¾åƒã€‚</p><p><code>canvas</code>æä¾›äº†ä¸¤ä¸ªè½¬å›¾ç‰‡çš„æ–¹æ³•ï¼š</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toDataURL" target="_blank" rel="noopener">HTMLCanvasElement.toDataURL()</a>ï¼šå›¾ç‰‡è½¬æ¢æˆbase64æ ¼å¼</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLCanvasElement/toBlob" target="_blank" rel="noopener">HTMLCanvasElement.toBlob()</a>ï¼šå›¾ç‰‡è½¬æ¢æˆBlobæ–‡ä»¶</li></ul><h3 id="toDataURL"><a href="#toDataURL" class="headerlink" title="toDataURL()"></a>toDataURL()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canvas.toDataURL(type, encoderOptions);</span><br></pre></td></tr></table></figure><p>å±äºåŒæ­¥æ–¹æ³•ï¼Œè¿”å› base64 æ ¼å¼çš„å›¾ç‰‡ã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•° <code>type</code>æ˜¯å›¾ç‰‡æ ¼å¼ï¼›</p><p>ç¬¬äºŒä¸ªå‚æ•° <code>encoderOptions</code> å°±æ˜¯ç”¨äºä¹‹å‰æåˆ°çš„ï¼Œæ§åˆ¶å›¾ç‰‡è´¨é‡ï¼Œè¾¾åˆ°å‹ç¼©å›¾ç‰‡çš„æ•ˆæœã€‚</p><blockquote><p>åœ¨æŒ‡å®šå›¾ç‰‡æ ¼å¼ä¸º <code>image/jpeg æˆ–</code> <code>image/webpçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä» 0 åˆ° 1 çš„åŒºé—´å†…é€‰æ‹©å›¾ç‰‡çš„è´¨é‡</code>ã€‚å¦‚æœè¶…å‡ºå–å€¼èŒƒå›´ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼ <code>0.92</code>ã€‚</p></blockquote><h3 id="toBlob"><a href="#toBlob" class="headerlink" title="toBlob()"></a>toBlob()</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> canvas.toBlob(callback, type, encoderOptions);</span><br></pre></td></tr></table></figure><p>å±äºå¼‚æ­¥æ–¹æ³•ï¼Œæ‰€ä»¥æœ‰ä¸ª<code>callback</code> å‚æ•°ã€‚</p><p><code>type</code> å‚æ•°æŒ‡å®šå›¾ç‰‡æ ¼å¼ï¼›</p><p><code>encoderOptions</code>å‚æ•°æŒ‡å®šå›¾ç‰‡è´¨é‡ï¼Œç”¨äºå‹ç¼©å›¾ç‰‡</p><blockquote><p>å€¼åœ¨0ä¸1ä¹‹é—´ï¼Œå½“è¯·æ±‚å›¾ç‰‡æ ¼å¼ä¸º<code>image/jpeg</code>æˆ–è€…<code>image/webp</code>æ—¶ç”¨æ¥æŒ‡å®šå›¾ç‰‡å±•ç¤ºè´¨é‡ã€‚</p></blockquote><blockquote><p>å…³äº Blobï¼š</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener"><code>Blob</code></a>å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" rel="noopener"><code>File</code></a> æ¥å£åŸºäº<code>Blob</code>ï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p><p><a href="https://juejin.im/entry/5937c98eac502e0068cf31ae" target="_blank" rel="noopener">JavaScript ä¸­ Blob å¯¹è±¡</a>: è¿™ç¯‡æ–‡ç« ä»‹ç»äº† Blobï¼Œé‡Œé¢ä¹Ÿæåˆ°äº†å¤§æ–‡ä»¶åˆ†å‰²ä¸Šä¼ çš„å®ç°ã€‚</p></blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹æ¯” Blob æ–‡ä»¶å’Œ base64 ï¼Œæœ‰ä¸‹é¢å‡ ç‚¹ä¼˜ç‚¹ï¼š</p><ul><li>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹åç«¯æ›´å‹å¥½</li><li>base64 å­—ç¬¦ä¸²ä¸€èˆ¬éƒ½éå¸¸é•¿ï¼Œä¼šæœ‰æ€§èƒ½ç­‰é—®é¢˜</li></ul><p>æ‰€ä»¥é€‰æ‹©è½¬åŒ–æˆ Blob æ–‡ä»¶è¿›è¡Œä¸Šä¼ æ›´å¥½ã€‚æŠŠ base64 æˆ–è€… Blob æ–‡ä»¶åŠ å…¥ <code>FormData</code> é‡Œå°±å¯ä»¥å®ç°ä¸Šä¼ äº†ã€‚</p><h2 id="å›¾ç‰‡é¢„è§ˆ"><a href="#å›¾ç‰‡é¢„è§ˆ" class="headerlink" title="å›¾ç‰‡é¢„è§ˆ"></a>å›¾ç‰‡é¢„è§ˆ</h2><p>ä¸€èˆ¬å›¾ç‰‡ä¸Šä¼ è¿˜ä¼šè¦æ±‚å®ç°å›¾ç‰‡ä¸Šä¼ è¿›åº¦ã€å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ã€‚</p><p>å…³äºå›¾ç‰‡é¢„è§ˆçš„å®ç°ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•ï¼Œæ¥è·å–å›¾ç‰‡é“¾æ¥ï¼Œåšä¸ºæœ¬åœ°é¢„è§ˆï¼š</p><ul><li><p>base64 å¯ä»¥ä½œä¸ºå›¾ç‰‡é“¾æ¥ï¼Œ<code>FileReader.readAsDataURL(Blob|File)</code>æ–¹æ³•å¯ä»¥å¾—åˆ° base64</p></li><li><p><code>URL.createObjectURL(Blob|File)</code>è¿”å›çš„ URL å¯ä»¥ä½œä¸ºå›¾ç‰‡çš„é“¾æ¥</p></li></ul><blockquote><p>è¯¦æƒ…å‚è€ƒï¼š</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsDataURL" target="_blank" rel="noopener">FileReader.readAsDataURL()</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/URL/createObjectURL" target="_blank" rel="noopener">URL.createObjectURL()</a></p></blockquote><h2 id="æ‰‹æœºç…§ç‰‡æ—‹è½¬é—®é¢˜"><a href="#æ‰‹æœºç…§ç‰‡æ—‹è½¬é—®é¢˜" class="headerlink" title="æ‰‹æœºç…§ç‰‡æ—‹è½¬é—®é¢˜"></a>æ‰‹æœºç…§ç‰‡æ—‹è½¬é—®é¢˜</h2><p>æŠŠåœ¨ iPhone ä¸Šæ‹å‡ºæ¥çš„ç…§ç‰‡ï¼Œé€šè¿‡ä¸Šé¢çš„æ–¹å¼è¿›è¡Œä¸Šä¼ ï¼Œä½ ä¼šå‘ç°å›¾ç‰‡æ–¹å‘å’Œä½ é¢„æ–™çš„ä¸åŒã€‚</p><h3 id="orientation"><a href="#orientation" class="headerlink" title="orientation"></a>orientation</h3><p>ä½¿ç”¨ iPhone æ‹ç…§ç‰‡ï¼Œä¼šæ ¹æ®ä½ æ‹ç…§æ—¶æ‰‹æœºçš„æ–¹å‘ï¼Œç…§ç‰‡ä¼šæœ‰ä¸åŒçš„æ–¹å‘ã€‚è¿™ä¸ªæ–¹å‘å¯ä»¥é€šè¿‡å›¾ç‰‡çš„ <code>orientation</code>å‚æ•°æ¥ç¡®å®šã€‚</p><table><thead><tr><th>æ—‹è½¬è§’åº¦</th><th>å‚æ•°å€¼</th><th>æ‰‹æœºæ–¹å‘</th></tr></thead><tbody><tr><td>0Â°</td><td>1</td><td>home é”®åœ¨å³æ–¹çš„æ¨ªå±æ‹æ‘„æ–¹å¼</td></tr><tr><td>é€†æ—¶é’ˆ90Â°</td><td>6</td><td>homeé”®åœ¨ä¸‹æ–¹(æ­£å¸¸æ‹¿æ‰‹æœºçš„æ–¹å‘)</td></tr><tr><td>é¡ºæ—¶é’ˆ90Â°</td><td>8</td><td>homeé”®åœ¨ä¸Šæ–¹</td></tr><tr><td>180Â°</td><td>3</td><td>homeé”®åœ¨å·¦ä¾§</td></tr></tbody></table><p>å¯ä»¥é€šè¿‡ <a href="https://github.com/exif-js/exif-js" target="_blank" rel="noopener">exif-js</a> æ¥è·å–å›¾ç‰‡çš„ <code>orientation</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> EXIF <span class="keyword">from</span> <span class="string">'exif-js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// file æ˜¯ä¸Šé¢æåˆ°çš„ File æ–‡ä»¶</span></span><br><span class="line">EXIF.getData(file, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> orientation = EXIF.getTag(<span class="keyword">this</span>, <span class="string">'Orientation'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>è¯¦æƒ…å‚è€ƒï¼š<a href="http://feihu.me/blog/2015/how-to-handle-image-orientation-on-iOS/" target="_blank" rel="noopener">å¦‚ä½•å¤„ç†iOSä¸­ç…§ç‰‡çš„æ–¹å‘</a></p></blockquote><h3 id="æ ¡æ­£æ–¹å‘"><a href="#æ ¡æ­£æ–¹å‘" class="headerlink" title="æ ¡æ­£æ–¹å‘"></a>æ ¡æ­£æ–¹å‘</h3><p>è¦æ ¡æ­£å›¾ç‰‡çš„æ–¹å‘ï¼Œåªéœ€è¦æ ¹æ® <code>orientation</code> å‚æ•°ï¼ŒæŠŠå›¾ç‰‡çš„æ–¹å‘æ—‹è½¬ä¼šæ­£å¸¸å³å¯ã€‚æ—‹è½¬éœ€è¦ç”¨åˆ° canvas çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/rotate" target="_blank" rel="noopener"><code>rotate()</code></a>æ–¹æ³•ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> ctx.rotate(angle);</span><br></pre></td></tr></table></figure><p>å‚æ•° angle æ˜¯é¡ºæ—¶é’ˆæ—‹è½¬çš„å¼§åº¦ï¼Œæ—‹è½¬ä¸­å¿ƒç‚¹æ˜¯ canvas çš„èµ·å§‹ç‚¹ã€‚</p><p>è§’åº¦å€¼æ¢ç®—å¼§åº¦çš„å…¬å¼ï¼š <code>angle = degree * Math.PI / 180</code></p><p>ä»¥ <code>orientation</code>ç­‰äº 6 æ—¶ä¸ºä¾‹ï¼Œä¹Ÿå°±æ˜¯å›¾ç‰‡é€†æ—¶é’ˆæ—‹è½¬äº† 90Â°ï¼Œè¦æŠŠå›¾ç‰‡æ ¡æ­£æ–¹å‘ï¼Œå°±è¦ç”»å¸ƒé¡ºæ—¶é’ˆæ—‹è½¬ 90Â° : <code>rotate((90 * Math.PI) / 180)</code></p><p><img src="/images/h5-img-upload/h5-img-upload2.jpg" alt=""></p><p>ç”»å¸ƒæ—‹è½¬ä¹‹åï¼Œ<code>drawImage()</code>æ ¹æ®ç”»å¸ƒçš„ä½ç½®è¿›è¡Œè°ƒæ•´ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤º:</p><p>æ—‹è½¬ä¹‹å‰ï¼š<code>drawImage(image, 0, 0, x, y)</code></p><p>æ—‹è½¬ä¹‹åï¼ŒåŸæœ‰çš„ç”»å¸ƒä¸å˜ï¼Œåæ ‡è·Ÿç€æ—‹è½¬ï¼Œå›¾ç‰‡è½¬åˆ°å¯è§†èŒƒå›´ä¹‹å¤–ï¼Œæ‰€ä»¥ï¼š</p><ul><li>éœ€è¦æŠŠå›¾ç‰‡ç§»åˆ°å¯è§†èŒƒå›´é‡Œ</li><li>è°ƒæ•´ç”»å¸ƒå¤§å°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// other code...</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line"><span class="comment">// æ—‹è½¬è§’åº¦</span></span><br><span class="line">degree = <span class="number">90</span>;</span><br><span class="line"><span class="comment">// è°ƒæ•´ç”»å¸ƒå¤§å°</span></span><br><span class="line">canvas.width = imgHeight;</span><br><span class="line">canvas.height = imgWidth;</span><br><span class="line"><span class="comment">// ä¿®æ”¹ç»˜ç”»ä½ç½®</span></span><br><span class="line">imgHeight = - imgHeight;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="comment">// other code ...</span></span><br><span class="line"><span class="comment">// canvas æ—‹è½¬</span></span><br><span class="line">ctx.rotate((degree * <span class="built_in">Math</span>.PI)/<span class="number">180</span>);</span><br><span class="line"><span class="comment">// ç»˜åˆ¶å›¾ç‰‡</span></span><br><span class="line">ctx.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, imgWidth, imgHeight);</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ <code>orientation</code> ä¹Ÿæ˜¯ç±»ä¼¼çš„åŸç†ã€‚<a href="https://github.com/hhking/fe-demo/blob/054ec906907988aae919deda5e3369c7a1cb84e9/h5ImgCompress/h5ImgCompress.js#L52" target="_blank" rel="noopener">æŸ¥çœ‹ç¤ºä¾‹ä»£ç </a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å›¾ç‰‡å‹ç¼©ä¸Šä¼ çš„è¿‡ç¨‹ï¼Œæ€»ç»“èµ·æ¥å°±æ˜¯ï¼šå›¾ç‰‡ â†’ å‹ç¼© â†’ å›¾ç‰‡ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ ¸å¿ƒç‚¹æ˜¯ï¼š</p><ul><li><p>FileReader API ä½¿ç”¨</p></li><li><p>Canvas å®ç°å›¾ç‰‡å‹ç¼©ã€ç»˜åˆ¶å’Œæ–¹å‘æ ¡æ­£</p></li></ul><p>è¿™é‡Œä¸»è¦æ€»ç»“äº†ä½¿ç”¨ HTML5 API å®ç°å›¾ç‰‡ä¸Šä¼ çš„è¿‡ç¨‹ï¼Œåœ¨å®é™…çš„ä½¿ç”¨è¿˜è¦æ ¹æ®å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œè€ƒè™‘å…¼å®¹é—®é¢˜ï¼Œé€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>æœ€åï¼ŒæŸ¥çœ‹å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/hhking/fe-demo/tree/054ec906907988aae919deda5e3369c7a1cb84e9/h5ImgCompress" target="_blank" rel="noopener">h5ImgCompress</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰ç«¯åšå›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°å›¾ç‰‡å‹ç¼©ã€å›¾ç‰‡é¢„è§ˆç­‰éœ€æ±‚ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ä¸€ä¸ªä¸ªçš„å‘ã€‚ä¸‹é¢å°±æ¥çœ‹ä¸€çœ‹ HTML5 å®ç°å›¾ç‰‡ä¸Šä¼ çš„æ•´ä¸ªè¿‡ç¨‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="HTML5" scheme="https://blog.hhking.cn/tags/HTML5/"/>
    
      <category term="å›¾ç‰‡ä¸Šä¼ " scheme="https://blog.hhking.cn/tags/%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0/"/>
    
      <category term="å›¾ç‰‡å‹ç¼©" scheme="https://blog.hhking.cn/tags/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/"/>
    
      <category term="å›¾ç‰‡é¢„è§ˆ" scheme="https://blog.hhking.cn/tags/%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88/"/>
    
  </entry>
  
  <entry>
    <title>é˜¿é‡Œäº‘ GitLab æŠ˜è…¾ç¬”è®°</title>
    <link href="https://blog.hhking.cn/2018/11/24/aliyun-gitlab-install/"/>
    <id>https://blog.hhking.cn/2018/11/24/aliyun-gitlab-install/</id>
    <published>2018-11-24T15:09:44.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<p>æƒ³è‡ªå·±æ­å»ºä¸€ä¸ª git æœåŠ¡æ¥ç©ä¸€ç©ï¼Œæ­£å¥½æœ‰ä¸ªé˜¿é‡Œäº‘ï¼Œè™½ç„¶é…ç½®å¾ˆæ¸£ï¼Œä½†æ˜¯ä¹Ÿæƒ³ç€éšä¾¿æä¸€æã€‚</p><p>äºæ˜¯ä»<a href="https://about.gitlab.com/install/" target="_blank" rel="noopener">å®˜æ–¹æ•™ç¨‹</a>å¼€å§‹ï¼Œé‡åˆ°ä¸€äº›å‘ï¼ŒæŸ¥çœ‹ä¸€äº›èµ„æ–™ï¼Œè§£å†³ä¸€äº›é—®é¢˜ï¼Œæœ‰äº†ä¸‹é¢çš„ç¬”è®°ã€‚</p><a id="more"></a><p>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ã€‚æˆ‘çš„é˜¿é‡Œäº‘è£…çš„æ˜¯ <code>CentOS 7</code>,æ‰€ä»¥é€‰æ‹© <code>CentOS 7</code>çš„ç‰ˆæœ¬ã€‚</p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install1.jpg" alt=""></p><blockquote><p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰å±äºä»€ä¹ˆç³»ç»Ÿ</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…å’Œé…ç½®ä¸€äº›å¿…è¦çš„ä¾èµ–"><a href="#å®‰è£…å’Œé…ç½®ä¸€äº›å¿…è¦çš„ä¾èµ–" class="headerlink" title="å®‰è£…å’Œé…ç½®ä¸€äº›å¿…è¦çš„ä¾èµ–"></a>å®‰è£…å’Œé…ç½®ä¸€äº›å¿…è¦çš„ä¾èµ–</h2><h3 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h3><p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨ç³»ç»Ÿé˜²ç«å¢™ä¸­å¼€å¯ HTTP å’Œ SSH çš„è®¿é—®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server</span><br><span class="line">sudo systemctl enable sshd</span><br><span class="line">sudo systemctl start sshd</span><br><span class="line">sudo firewall-cmd --permanent --add-service=http</span><br><span class="line">sudo systemctl reload firewalld</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ</p><p><code>sudo firewall-cmd --permanent --add-service=http</code></p><p>æ—¶å¯èƒ½ä¼šé‡åˆ° <code>FirewallD is not running</code>çš„é”™è¯¯æç¤ºï¼›</p><p>æ„æ€æ˜¯ï¼š<code>é˜²ç«å¢™æœåŠ¡æ²¡æœ‰è¿è¡Œ</code>ã€‚è¿™å¼€å¯é˜²ç«å¢™æœåŠ¡å°±è¡Œäº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start firewalld.service</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°æ‰§è¡Œå‘½ä»¤å°±ä¼šæç¤º <code>success</code></p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install2.jpg" alt=""></p><h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå®‰è£…å¹¶å¼€å¯ <code>Postfix</code> é‚®ä»¶é€šçŸ¥æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install postfix</span><br><span class="line">sudo systemctl enable postfix</span><br><span class="line">sudo systemctl start postfix</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡åˆ°ä¸€ä¸ªæŠ¥é”™</p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install3.jpg" alt=""></p><p>è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ <code>/etc/postfix/main.cf</code>æ–‡ä»¶ä¸­çš„ä¸‹é¢ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inet_interfaces = all</span><br><span class="line">inet_protocols = ipv4 // æˆ–è€… all</span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯æœåŠ¡å°±å¥½äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart postfix</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ -GitLab-è½¯ä»¶åŒ…çš„ä»“åº“ï¼Œå¹¶å®‰è£…"><a href="#æ·»åŠ -GitLab-è½¯ä»¶åŒ…çš„ä»“åº“ï¼Œå¹¶å®‰è£…" class="headerlink" title="æ·»åŠ  GitLab è½¯ä»¶åŒ…çš„ä»“åº“ï¼Œå¹¶å®‰è£…"></a>æ·»åŠ  GitLab è½¯ä»¶åŒ…çš„ä»“åº“ï¼Œå¹¶å®‰è£…</h2><p>å®‰è£… GitLab</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span><br></pre></td></tr></table></figure><p>è®¾ç½® GitLab è®¿é—®åŸŸå</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL="http://gitlab.example.com" yum install -y gitlab-ee</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œ <code>http://gitlab.example.com</code>æ›¿æ¢æˆå¯¹åº”çš„<strong>åŸŸå</strong>æˆ–è€…<strong>IP</strong></p><p>æˆ‘è¿™é‡Œè®¾ç½®æˆ IP åŠ  8888 ç«¯å£ï¼Œè¿™éœ€è¦åœ¨é˜¿é‡Œäº‘ä¸Šé…ç½®å®‰å…¨ç»„è§„åˆ™ï¼Œå‡ºå…¥æ–¹å‘éƒ½è¦é…ç½®å¯¹åº”ç«¯å£ã€‚ä¾‹å¦‚ï¼š</p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install4.jpg" alt=""></p><p>ç„¶åè®¾ç½®é˜²ç«å¢™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> å¼€å¯ 8888 ç«¯å£</span><br><span class="line">firewall-cmd --zone=public --add-port=8888/tcp --permanent</span><br><span class="line"><span class="meta">#</span> é‡å¯é˜²ç«å¢™</span><br><span class="line">systemctl restart firewalld</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œç­‰å¾…å®‰è£…å®Œæ¯•ï¼ˆå®‰è£…è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒä¹…ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo EXTERNAL_URL="http://xx.xx.xx.xx:8888" yum install -y gitlab-ee</span><br></pre></td></tr></table></figure><p>å¦‚æœå®‰è£…å®Œä¹‹åè¦ä¿®æ”¹è®¿é—®çš„åŸŸåæˆ–è€… IPï¼Œåˆ™ä¿®æ”¹ <code>/etc/gitlab/gitlab.rb</code>æ–‡ä»¶ä¸­çš„ <code>external_url</code> å†…å®¹</p><p>ç„¶åé‡æ–°é…ç½®æœåŠ¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯èƒ½ç”¨è®¾ç½®çš„åŸŸåï¼ˆIPï¼‰è®¿é—®äº†ã€‚</p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p>ç¬¬ä¸€æ¬¡æ‰“å¼€ï¼Œä¼šæ‰“å¼€å¯†ç è®¾ç½®é¡µé¢ï¼Œè®©ä½ è®¾ç½®å¯†ç ã€‚</p><p>è®¾ç½®å¯†ç ä¹‹åï¼Œä½¿ç”¨ç”¨æˆ·å root å’Œè®¾ç½®çš„å¯†ç ç™»å½•ã€‚</p><p>æœ€åæ¥ä¸ªç™»å½•æˆåŠŸçš„å›¾ï¼š</p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install5.jpg" alt=""></p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="ä¸€äº›å¸¸ç”¨å‘½ä»¤"><a href="#ä¸€äº›å¸¸ç”¨å‘½ä»¤" class="headerlink" title="ä¸€äº›å¸¸ç”¨å‘½ä»¤"></a>ä¸€äº›å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//å¯åŠ¨</span><br><span class="line">sudo gitlab-ctl start</span><br><span class="line"></span><br><span class="line">//åœæ­¢</span><br><span class="line">sudo gitlab-ctl stop</span><br><span class="line"></span><br><span class="line">//é‡å¯</span><br><span class="line">sudo gitlab-ctl restart</span><br><span class="line"></span><br><span class="line">//æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">sudo gitlab-ctl status</span><br><span class="line"></span><br><span class="line">//ä½¿æ›´æ”¹é…ç½®ç”Ÿæ•ˆ</span><br><span class="line">sudo gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯é˜¿é‡Œäº‘-SWAP"><a href="#å¼€å¯é˜¿é‡Œäº‘-SWAP" class="headerlink" title="å¼€å¯é˜¿é‡Œäº‘ SWAP"></a>å¼€å¯é˜¿é‡Œäº‘ SWAP</h3><p>åˆšå®‰è£…ç»“æŸï¼Œå¼€å¯ GitLab ä¹‹åï¼Œé˜¿é‡Œäº‘å°±å¼€å§‹å¡çˆ†äº†ï¼ŒGitLab ä¹Ÿç›´æ¥æ— æ³•è®¿é—®ï¼Œæˆ–è€…æ˜¯ç›´æ¥ 502ï¼Œç™½å¿™æ´»çš„åŠå¤©ï¼å†…å­˜çˆ†ç‚¸äº†å•Šï¼è¿™æ—¶å€™æƒ³åˆ°é˜¿é‡Œäº‘å¥½åƒæ˜¯æ²¡å¼€å¯ SWAP çš„ã€‚äºæ˜¯å°±æœ‰äº†ä¸‹é¢çš„å†…å®¹ã€‚</p><p>æŸ¥çœ‹ swap åˆ†åŒºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/swaps</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ç©ºçš„ï¼Œä¸‹é¢æ¥å¼€å¯ swap</p><p>è¯¦æƒ…å‚è€ƒï¼š<a href="https://help.aliyun.com/knowledge_detail/42534.html" target="_blank" rel="noopener">äº‘æœåŠ¡å™¨ ECS Linux SWAP é…ç½®æ¦‚è¦è¯´æ˜</a></p><ol><li><p>åˆ›å»ºswapå¤§å°ä¸ºbs(block_size)*count(number_of_block)=4G</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=/mnt/swap bs=1M count=4096</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /mnt/swap</span><br></pre></td></tr></table></figure></li><li><p>ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon /mnt/swap</span><br></pre></td></tr></table></figure></li><li><p>æƒé™è®¾ç½®</p><p>æç¤ºï¼šswapon: /mnt/swapï¼šä¸å®‰å…¨çš„æƒé™ 0644ï¼Œå»ºè®®ä½¿ç”¨ 0600ï¼Œè®¾ç½®æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 0600 /mnt/swap</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å¯ç”¨</p></li><li><p>è®¾ç½®å¼€æœºæ—¶è‡ªå¯ç”¨ SWAP åˆ†åŒº</p><p>éœ€è¦ä¿®æ”¹æ–‡ä»¶ /etc/fstab ä¸­çš„ SWAP è¡Œï¼Œåœ¨æ–‡ä»¶æœ«ä½æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mnt/swap swap swap defaults 0 0</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ swpapiness å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/sys/vm/swappiness</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢å‘½ä»¤çœ‹åˆ° swappiness å€¼ä¸º 0ï¼Œéœ€è¦åœ¨ç‰©ç†å†…å­˜ä½¿ç”¨å®Œæ¯•åæ‰ä¼šä½¿ç”¨ SWAP åˆ†åŒº</p><p><img src="/images/aliyun-gitlab-install/aliyun-gitlab-install6.jpg" alt=""></p><p>æˆ‘ä»¬é…ç½®ä¸ºç©ºé—²å†…å­˜å°‘äº 10% æ—¶æ‰ä½¿ç”¨ SWAP åˆ†åŒº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 10 &gt;/proc/sys/vm/swappiness</span><br></pre></td></tr></table></figure><p>è‹¥éœ€è¦æ°¸ä¹…ä¿®æ”¹æ­¤é…ç½®ï¼Œåœ¨ç³»ç»Ÿé‡å¯ä¹‹åä¹Ÿç”Ÿæ•ˆçš„è¯ï¼Œå¯ä»¥ä¿®æ”¹ /etc/sysctl.conf æ–‡ä»¶ï¼Œå¹¶ä¿®æ”¹ä»¥ä¸‹å†…å®¹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness=10</span><br></pre></td></tr></table></figure></li></ol><p>å¼€å¯ SWAP ä¹‹åï¼ŒGitLab å°±èƒ½è®¿é—®äº†ï¼</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç¯‡ç¬”è®°ï¼Œä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹è¿™æ¬¡å®‰è£… GitLab é‡åˆ°çš„å‘ï¼Œä»¥åŠå¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š</p><p><a href="https://about.gitlab.com/install/" target="_blank" rel="noopener">å®˜æ–¹æ•™ç¨‹</a><br><a href="https://blog.csdn.net/zhaoyanjun6/article/details/79144175" target="_blank" rel="noopener">CentOS åˆä½“éªŒåå››ï¼šé˜¿é‡Œäº‘å®‰è£…Gitlab</a><br><a href="https://help.aliyun.com/knowledge_detail/42534.html" target="_blank" rel="noopener">äº‘æœåŠ¡å™¨ ECS Linux SWAP é…ç½®æ¦‚è¦è¯´æ˜</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æƒ³è‡ªå·±æ­å»ºä¸€ä¸ª git æœåŠ¡æ¥ç©ä¸€ç©ï¼Œæ­£å¥½æœ‰ä¸ªé˜¿é‡Œäº‘ï¼Œè™½ç„¶é…ç½®å¾ˆæ¸£ï¼Œä½†æ˜¯ä¹Ÿæƒ³ç€éšä¾¿æä¸€æã€‚&lt;/p&gt;&lt;p&gt;äºæ˜¯ä»&lt;a href=&quot;https://about.gitlab.com/install/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®˜æ–¹æ•™ç¨‹&lt;/a&gt;å¼€å§‹ï¼Œé‡åˆ°ä¸€äº›å‘ï¼ŒæŸ¥çœ‹ä¸€äº›èµ„æ–™ï¼Œè§£å†³ä¸€äº›é—®é¢˜ï¼Œæœ‰äº†ä¸‹é¢çš„ç¬”è®°ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="GitLab" scheme="https://blog.hhking.cn/categories/GitLab/"/>
    
    
      <category term="é˜¿é‡Œäº‘" scheme="https://blog.hhking.cn/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
      <category term="CentOS 7" scheme="https://blog.hhking.cn/tags/CentOS-7/"/>
    
      <category term="GitLab" scheme="https://blog.hhking.cn/tags/GitLab/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘]JavaScript ç»ˆææŒ‡å—ä¹‹æ‰§è¡Œä¸Šä¸‹æ–‡ã€å˜é‡æå‡ã€ä½œç”¨åŸŸå’Œé—­åŒ…</title>
    <link href="https://blog.hhking.cn/2018/10/24/ultimate-guide-to-execution-contexts-hoisting-scopes-and-closures-in-javascript/"/>
    <id>https://blog.hhking.cn/2018/10/24/ultimate-guide-to-execution-contexts-hoisting-scopes-and-closures-in-javascript/</id>
    <published>2018-10-24T15:18:37.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ï¼š<a href="https://tylermcginnis.com/ultimate-guide-to-execution-contexts-hoisting-scopes-and-closures-in-javascript/" target="_blank" rel="noopener">The Ultimate Guide to Execution Contexts, Hoisting, Scopes, and Closures in JavaScript</a><br>ä½œè€…ï¼š<a href="https://twitter.com/tylermcginnis" target="_blank" rel="noopener">Tyler McGinnis</a></p></blockquote><p><img src="https://i.loli.net/2019/05/26/5cea077212cb313490.png" alt=""></p><p>è§†é¢‘ï¼š<a href="https://www.youtube.com/watch?v=Nt-qa_LlUH0" target="_blank" rel="noopener">The Ultimate Guide to Execution Contexts, Hoisting, Scopes, and Closures in JavaScript</a></p><p>æˆ‘è®¤ä¸ºç†è§£ JavaScript è¯­è¨€çš„æœ€é‡è¦çš„åŸºæœ¬æ¦‚å¿µæ˜¯ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰ï¼Œè¿™ç‚¹å¯èƒ½ä»¤äººæ„Ÿåˆ°æ„å¤–ã€‚æ­£ç¡®çš„å­¦ä¹ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥è®©ä½ æ›´å®¹æ˜“å­¦ä¹ æ›´é«˜çº§çš„å†…å®¹ï¼Œæ¯”å¦‚å˜é‡æå‡ï¼ˆhoistingï¼‰ã€ä½œç”¨åŸŸé“¾ï¼ˆscope chainsï¼‰å’Œé—­åŒ…ï¼ˆclosuresï¼‰ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯â€œæ‰§è¡Œä¸Šä¸‹æ–‡â€å‘¢ï¼Ÿä¸ºäº†æ›´å¥½çš„ç†è§£å®ƒï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•å†™è½¯ä»¶çš„ã€‚</p><a id="more"></a><p>ç¼–å†™è½¯ä»¶çš„ä¸€ç§ç­–ç•¥æ˜¯æŠŠä»£ç æ‹†åˆ†æˆç‹¬ç«‹çš„å—ã€‚è™½ç„¶è¿™äº›â€œå—â€æœ‰ä¸åŒçš„å‘½åï¼ˆå‡½æ•°ã€æ¨¡å—ã€åŒ…ç­‰ç­‰ï¼‰ï¼Œä½†æ˜¯ä»–ä»¬æœ‰åŒæ ·çš„ç›®çš„â€”â€”åˆ†è§£å’Œå¤„ç†åº”ç”¨çš„å¤æ‚æ€§ã€‚ç°åœ¨æˆ‘ä»¬ä¸è¦ä»¥ç¼–å†™ä»£ç çš„æ€ç»´æ¥æ€è€ƒï¼Œè€Œæ˜¯ä»¥ JavaScript å¼•æ“çš„è§’åº¦æ¥æ€è€ƒï¼ŒJavaScript å¼•æ“æ˜¯ç”¨æ¥è§£é‡Šä»£ç çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥ä½¿ç”¨å’Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€æ ·çš„ç­–ç•¥ï¼ŒæŠŠä»£ç æ‹†åˆ†æˆå—ï¼Œæ¥å¤„ç†è§£é‡Šä»£ç çš„å¤æ‚æ€§ã€‚ç­”æ¡ˆæ˜¯å¯ä»¥ï¼Œè¿™äº›â€œå—â€è¢«ç§°ä¸ºæ‰§è¡Œä¸Šä¸‹æ–‡ã€‚<strong>æ­£å¦‚å¯ä»¥ä½¿ç”¨å‡½æ•°ã€æ¨¡å—ã€åŒ…ï¼ˆfunctions/modules/packagesï¼‰æ¥å¤„ç†ç¼–å†™ä»£ç çš„å¤æ‚æ€§ï¼ŒJavaScript å¼•æ“å¯ä»¥é€šè¿‡æ‰§è¡Œä¸Šä¸‹æ–‡æ¥å¤„ç†è§£é‡Šå’Œè¿è¡Œä»£ç çš„å¤æ‚æ€§ã€‚</strong> ç°åœ¨æˆ‘ä»¬çŸ¥é“æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”¨é€”äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦è§£ç­”çš„é—®é¢˜æ˜¯ï¼šå®ƒä»¬æ˜¯å¦‚ä½•åˆ›å»ºçš„å’Œå®ƒä»¬æ˜¯ä»€ä¹ˆç»„æˆçš„ï¼Ÿ</p><p>JavaScript å¼•æ“æ‰§è¡Œä»£ç æ—¶ï¼Œç¬¬ä¸€ä¸ªè¢«åˆ›å»ºçš„æ‰§è¡Œä¸Šä¸‹æ–‡å«åšå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆGlobal Execution Contextï¼‰ã€‚æœ€å¼€å§‹è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡åŒ…å«ä¸¤ä¸ªä¸œè¥¿â€”â€”ä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œ <code>this</code> å˜é‡ã€‚<code>this</code> ä¼šå¼•ç”¨å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨æ‰§è¡Œ JavaScript åˆ™å…¨å±€å¯¹è±¡æ˜¯ <code>window</code>ï¼Œåœ¨ Node ç¯å¢ƒæ‰§è¡Œåˆ™å…¨å±€å¯¹è±¡æ˜¯ <code>global</code>ã€‚</p><p><img src="https://i.loli.net/2019/05/26/5cea07aa5677b67067.png" alt=""></p><p>ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•ä»£ç ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡è¿˜æ˜¯ä¼šåŒ…å«ä¸¤ä¸ªä¸œè¥¿â€”â€” <code>window</code> å’Œ <code>this</code>ã€‚è¿™æ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡çš„æœ€åŸºæœ¬å½¢å¼ã€‚</p><p>æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œçœ‹çœ‹å½“å‘ç¨‹åºæ·»åŠ ä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æˆ‘ä»¬å…ˆæ·»åŠ ä¸€äº›å˜é‡ã€‚</p><p><img src="https://i.loli.net/2019/05/26/5cea07d962a7729018.png" alt=""></p><p><img src="https://i.loli.net/2019/05/26/5cea07ed8270a22948.png" alt=""></p><p>ä½ å¯ä»¥çœ‹å‡ºä¸Šé¢ä¸¤å¼ å›¾çš„ä¸åŒä¹‹å¤„å—ï¼Ÿå…³é”®çš„æ˜¯æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„é˜¶æ®µâ€”â€”åˆ›å»ºï¼ˆ<code>Creation</code>ï¼‰é˜¶æ®µå’Œæ‰§è¡Œï¼ˆ<code>Execution</code>ï¼‰é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å®ƒç‰¹æœ‰çš„èŒè´£ã€‚</p><p>åœ¨å…¨å±€<code>åˆ›å»º</code>é˜¶æ®µï¼ŒJavaScript å¼•æ“å°†ä¼šï¼š</p><ol><li>åˆ›å»ºå…¨å±€å¯¹è±¡</li><li>åˆ›å»º <code>this</code> å¯¹è±¡</li><li>ç»™å˜é‡å’Œå‡½æ•°è®¾ç½®å†…å­˜ç©ºé—´</li><li>å˜é‡å£°æ˜å¹¶é»˜è®¤èµ‹å€¼ä¸º <code>undefined</code>ï¼ŒåŒæ—¶åœ¨å†…å­˜ä¸­æ”¾ç½®æ‰€æœ‰å‡½æ•°å£°æ˜ã€‚</li></ol><p>ç›´åˆ°<code>æ‰§è¡Œ</code>é˜¶æ®µï¼ŒJavaScript å¼•æ“æ‰ä¼šå¼€å§‹ä¸€è¡Œä¸€è¡Œçš„æ‰§è¡Œä»£ç ã€‚</p><p>æˆ‘ä»¬ä»ä¸‹é¢çš„ GIF å›¾å¯ä»¥çœ‹åˆ°ä»<code>åˆ›å»º</code>é˜¶æ®µåˆ°<code>æ‰§è¡Œ</code>é˜¶æ®µè¿™ä¸€æµç¨‹ã€‚</p><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/global-execution-context-gif.gif" alt=""></p><p>åœ¨<code>åˆ›å»º</code>é˜¶æ®µï¼Œåˆ›å»º <code>window</code> å’Œ <code>this</code> ï¼Œå˜é‡å£°æ˜ï¼ˆ<code>name</code> å’Œ <code>handle</code>ï¼‰é»˜è®¤èµ‹å€¼ä¸º <code>undefined</code>ï¼Œæ‰€æœ‰å‡½æ•°å£°æ˜ï¼ˆ<code>getUser</code>ï¼‰å…¨éƒ¨æ”¾å…¥å†…å­˜ä¸­ã€‚ç„¶åä¸€æ—¦è¿›å…¥ <code>æ‰§è¡Œ</code> é˜¶æ®µï¼ŒJavaScript å¼•æ“å¼€å§‹ä¸€è¡Œä¸€è¡Œçš„æ‰§è¡Œä»£ç ï¼Œç„¶åç»™å†…å­˜ä¸­å·²å­˜åœ¨çš„å˜é‡èµ‹ä¸ŠçœŸå®çš„å€¼ã€‚</p><blockquote><p>Gif å¾ˆé…·ï¼Œä½†æ˜¯ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œä»£ç å¹¶äº²è‡ªæŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹æ›´é…·ã€‚æˆ‘ä¸ºä½ åˆ›å»ºäº† <a href="https://tylermcginnis.com/javascript-visualizer/" target="_blank" rel="noopener">JavaScript Visualizer</a>ï¼Œä½ å€¼å¾—æ‹¥æœ‰ã€‚å¦‚æœä½ æƒ³æŸ¥çœ‹ä¸Šé¢çš„ç¡®åˆ‡ä»£ç ï¼Œæ‰“å¼€è¿™ä¸ª<a href="https://tylermcginnis.com/javascript-visualizer/?code=var%20name%20%3D%20%27Tyler%27%0Avar%20handle%20%3D%20%27%40tylermcginnis%27%0A%0Afunction%20getUser%20%28%29%20%7B%0A%20%20return%20%7B%0A%20%20%20%20name%3A%20name%2C%0A%20%20%20%20handle%3A%20handle%0A%20%20%7D%0A%7D" target="_blank" rel="noopener">é“¾æ¥</a>ã€‚</p></blockquote><p>ä¸ºäº†çœŸæ­£å·©å›º <code>åˆ›å»º</code> é˜¶æ®µå’Œ <code>æ‰§è¡Œ</code> é˜¶æ®µçš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬æ‰“å°ä¸€äº› <code>åˆ›å»º</code> é˜¶æ®µä¹‹åå’Œ <code>æ‰§è¡Œ</code> é˜¶æ®µä¹‹å‰çš„å€¼å‡ºæ¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'name: '</span>, name)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'handle: '</span>, handle)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'getUser :'</span>, getUser)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Tyler'</span></span><br><span class="line"><span class="keyword">var</span> handle = <span class="string">'@tylermcginnis'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    handle: handle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ï¼Œä½ æƒ³åœ¨ console ä¸­æ‰“å°å‡ºä»€ä¹ˆï¼Ÿå½“ JavaScript å¼€å§‹ä¸€è¡Œä¸€è¡Œæ‰§è¡Œä»£ç å’Œè°ƒç”¨ <code>console.log</code> æ—¶ï¼Œ<code>åˆ›å»º</code> é˜¶æ®µå·²ç»å®Œæˆäº†ã€‚è¿™æ„å‘³ç€ï¼Œæ­£å¦‚ä¹‹å‰çœ‹åˆ°çš„ï¼Œå˜é‡å£°æ˜å·²ç»èµ‹å€¼ä¸º <code>undefined</code> ï¼Œè€Œå‡½æ•°å£°æ˜åˆ™æ•´ä¸ªæ”¾åœ¨å†…å­˜ä¸­äº†ã€‚æ‰€ä»¥æ­£å¦‚æˆ‘ä»¬æœŸæœ›çš„é‚£æ ·ï¼Œ<code>name</code> å’Œ <code>handle</code> å€¼ä¸º <code>undefined</code>ï¼Œ<code>getUser</code> å¼•ç”¨å†…å­˜ä¸­çš„å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'name: '</span>, name) <span class="comment">// name: undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'handle: '</span>, handle) <span class="comment">// handle: undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'getUser :'</span>, getUser) <span class="comment">// getUser: Æ’ getUser () &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Tyler'</span></span><br><span class="line"><span class="keyword">var</span> handle = <span class="string">'@tylermcginnis'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUser</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    handle: handle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨åˆ›å»ºé˜¶æ®µç»™å˜é‡å£°æ˜é»˜è®¤èµ‹å€¼ä¸º <code>undefined</code> çš„è¿‡ç¨‹ç§°ä¸º<strong><em>å˜é‡æå‡ï¼ˆ<code>Hoisting</code>ï¼‰</em></strong></p></blockquote><p>ä¹‹å‰ä½ å¯èƒ½å°è¯•è¿‡å‘è‡ªå·±è§£é‡Šâ€œå˜é‡æå‡â€ï¼Œä½†æ˜¯ä¸å°½äººæ„ã€‚â€œå˜é‡æå‡â€ä»¤äººè¿·æƒ‘çš„ç‚¹åœ¨äºå®é™…ä¸Šæ²¡æœ‰ä»»ä½•ä¸œè¥¿â€œæå‡â€æˆ–è€…ç§»åŠ¨ã€‚ç°åœ¨ä½ ç†è§£äº†æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå˜é‡å£°æ˜åœ¨ <code>åˆ›å»º</code> é˜¶æ®µé»˜è®¤èµ‹å€¼ä¸º <code>undefined</code>ï¼Œä»è€Œä½ ä¹Ÿç†è§£äº†â€œå˜é‡æå‡â€ï¼Œå› ä¸ºè¿™å°±æ˜¯â€œå˜é‡æå‡â€ã€‚</p><hr><p>ç°åœ¨ï¼Œä½ åº”è¯¥å¯¹å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå®ƒçš„ä¸¤ä¸ªé˜¶æ®µâ€”â€”<code>åˆ›å»º</code> å’Œ <code>æ‰§è¡Œ</code>ç›¸å½“ç†Ÿæ‚‰äº†ã€‚å¥½æ¶ˆæ¯æ˜¯åªå‰©ä¸€ä¸ªå…¶ä»–çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä½ éœ€è¦å­¦ä¹ ï¼Œè€Œä¸”å®ƒå‡ ä¹å’Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å®Œå…¨ç›¸åŒã€‚å®ƒå°±æ˜¯å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå®ƒåœ¨å‡½æ•°<strong>è°ƒç”¨</strong>çš„æ—¶å€™åˆ›å»ºã€‚</p><p>å…³é”®çš„æ˜¯ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡åªæœ‰åœ¨ JavaScript å¼•æ“ç¬¬ä¸€æ¬¡å¼€å§‹è§£é‡Šä»£ç æ—¶ï¼ˆå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰æˆ–è€…å‡½æ•°è°ƒç”¨æ—¶æ‰åˆ›å»ºã€‚</p><p>ç°åœ¨ä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸åŒç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœä½ è¿˜è®°å¾—ï¼Œä¹‹å‰æåˆ°è¿‡åœ¨å…¨å±€ <code>åˆ›å»º</code> é˜¶æ®µï¼ŒJavaScript å¼•æ“å°†ä¼šï¼š</p><ol><li>åˆ›å»ºå…¨å±€å¯¹è±¡</li><li>åˆ›å»º <code>this</code> å¯¹è±¡</li><li>ä¸ºå˜é‡å’Œå‡½æ•°è®¾ç½®å†…å­˜ç©ºé—´</li><li>å˜é‡å£°æ˜é»˜è®¤èµ‹å€¼ä¸º <code>undefined</code>ï¼ŒåŒæ—¶å‡½æ•°å£°æ˜å­˜å…¥å†…å­˜</li></ol><p>è¿™äº›æ­¥éª¤å¯¹äºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ¥è¯´å“ªäº›æ˜¯ä¸å¯¹çš„ï¼Ÿæ­¥éª¤ 1ã€‚æˆ‘ä»¬æœ‰ä¸”åªæœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒåœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡çš„ <code>åˆ›å»º</code> é˜¶æ®µåˆ›å»ºï¼Œè€Œä¸ä¼šåœ¨å‡½æ•°è°ƒç”¨å’Œ JavaScript å¼•æ“åˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶åˆ›å»ºã€‚å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸éœ€è¦åˆ›å»ºå…¨å±€å˜é‡ï¼Œè€Œæ˜¯éœ€è¦è€ƒè™‘å‚æ•°ï¼ˆargumentsï¼‰é—®é¢˜ï¼Œè€Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚è€ƒè™‘åˆ°è¿™äº›ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´ä¹‹å‰çš„åˆ—è¡¨ã€‚å½“<strong>å‡½æ•°</strong>æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶ï¼ŒJavaScript å¼•æ“å°†ä¼šï¼š</p><ol><li><del>åˆ›å»ºå…¨å±€å¯¹è±¡</del></li><li>åˆ›å»ºä¸€ä¸ªå‚æ•°å¯¹è±¡</li><li>åˆ›å»º <code>this</code> å¯¹è±¡</li><li>ä¸ºå˜é‡å’Œå‡½æ•°è®¾ç½®å†…å­˜ç©ºé—´</li><li>å˜é‡å£°æ˜é»˜è®¤èµ‹å€¼ä¸º <code>undefined</code>ï¼ŒåŒæ—¶å‡½æ•°å£°æ˜å­˜å…¥å†…å­˜</li></ol><p>æˆ‘ä»¬å›åˆ°ä¹‹å‰æåˆ°çš„ä»£ç ï¼Œæ¥çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯è¿™æ¬¡é™¤äº†å®šä¹‰ <code>getUser</code>ï¼Œè¿˜è¦çœ‹çœ‹è°ƒç”¨å®ƒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=var%20name%20%3D%20%27Tyler%27%0Avar%20handle%20%3D%20%27%40tylermcginnis%27%0A%0Afunction%20getUser%20%28%29%20%7B%0A%20%20return%20%7B%0A%20%20%20%20name%3A%20name%2C%0A%20%20%20%20handle%3A%20handle%0A%20%20%7D%0A%7D%0A%0AgetUser%28%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/function-execution-context-gif.gif" alt=""></p><p>æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œè°ƒç”¨ <code>getUser</code> æ—¶ä¼šåˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åœ¨ <code>getUser</code> æ‰§è¡Œä¸Šä¸‹æ–‡çš„ <code>åˆ›å»º</code> é˜¶æ®µï¼ŒJavaScript å¼•æ“åˆ›å»º <code>this</code> å¯¹è±¡å’Œ <code>arguments</code> å¯¹è±¡ã€‚å› ä¸º <code>getUser</code> æ²¡æœ‰ä»»ä½•å˜é‡ï¼Œæ‰€ä»¥ JavaScript ä¸éœ€è¦ç»™å˜é‡è®¾ç½®å†…å­˜ç©ºé—´å’Œè¿›è¡Œâ€œæå‡â€ã€‚</p><p>ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°ï¼Œå½“ <code>getUser</code> å‡½æ•°æ‰§è¡Œå®Œï¼Œå®ƒåœ¨å¯è§†åŒ–å›¾é‡Œè¢«ç§»é™¤äº†ã€‚å®é™…ä¸Šï¼ŒJavaScript å¼•æ“åˆ›å»ºäº†â€œæ‰§è¡Œæ ˆâ€ï¼ˆä¹Ÿè¢«æˆä¸ºâ€œè°ƒç”¨æ ˆâ€ï¼‰ã€‚å½“å‡½æ•°è°ƒç”¨æ—¶ï¼Œåˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶æŠŠå®ƒåŠ å…¥æ‰§è¡Œæ ˆã€‚å½“å‡½æ•°æ‰§è¡Œç»“æŸï¼Œå®Œæˆäº† <code>åˆ›å»º</code> å’Œ <code>æ‰§è¡Œ</code> é˜¶æ®µï¼Œå®ƒä¼šä»æ‰§è¡Œæ ˆä¸­å¼¹å‡ºã€‚å› ä¸º JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼ˆæ„å‘³ç€åŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å¾ˆå®¹æ˜“å®ç°å¯è§†åŒ–ã€‚ä½¿ç”¨ â€œJavaScript Visualizerâ€ï¼Œæ‰§è¡Œæ ˆä»¥åµŒå¥—å½¢å¼æ˜¾ç¤ºï¼Œæ¯ä¸ªåµŒå¥—é¡¹å¯¹åº”æ‰§è¡Œæ ˆä¸­çš„æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=function%20a%20%28%29%20%7B%0A%20%20console.log%28%27In%20fn%20a%27%29%0A%20%20%0A%20%20function%20b%20%28%29%20%7B%0A%20%20%20%20console.log%28%27In%20fn%20b%27%29%0A%20%20%20%20%0A%20%20%20%20function%20c%20%28%29%20%7B%0A%20%20%20%20%20%20console.log%28%27In%20fn%20c%27%29%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20c%28%29%0A%20%20%7D%0A%0A%20%20b%28%29%0A%7D%0A%0Aa%28%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/javascript-execution-stack.gif" alt=""></p><hr><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“å‡½æ•°è°ƒç”¨å¦‚ä½•åˆ›å»ºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶åŠ å…¥æ‰§è¡Œæ ˆä¸­ã€‚æˆ‘ä»¬è¿˜ä¸çŸ¥é“çš„æ˜¯æœ‰å±€éƒ¨å˜é‡æ—¶ä¼šæ€ä¹ˆæ ·ã€‚æˆ‘ä»¬ä¿®æ”¹ä»£ç ï¼Œè®©å‡½æ•°æœ‰å±€éƒ¨å˜é‡ã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=var%20name%20%3D%20%27Tyler%27%0Avar%20handle%20%3D%20%27%40tylermcginnis%27%0A%0Afunction%20getURL%20%28handle%29%20%7B%0A%20%20var%20twitterURL%20%3D%20%27https%3A%2F%2Ftwitter.com%2F%27%0A%0A%20%20return%20twitterURL%20%2B%20handle%0A%7D%0A%0AgetURL%28handle%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/local-variables.gif" alt=""></p><p>è¿™é‡Œæœ‰ä¸€äº›é‡è¦çš„ç»†èŠ‚è¦æ³¨æ„ã€‚ç¬¬ä¸€ç‚¹æ˜¯ï¼Œä½ ä¼ å…¥çš„ä»»ä½•å‚æ•°éƒ½ä¼šä½œä¸ºå±€éƒ¨å˜é‡æ·»åŠ åˆ°å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åœ¨ä¾‹å­ä¸­ï¼Œ<code>handle</code> ä½œä¸ºå˜é‡å‡ºç°åœ¨ <code>å…¨å±€</code> æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆåœ¨å˜é‡å®šä¹‰çš„åœ°æ–¹ï¼‰ï¼Œä¹Ÿå‡ºç°åœ¨ <code>getURL</code> æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œå› ä¸ºæŠŠå®ƒå½“åšå‚æ•°ä¼ å…¥äº†ã€‚ç„¶åæ˜¯ï¼Œå‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œå­˜åœ¨äºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ã€‚æ‰€ä»¥å½“æˆ‘ä»¬åˆ›å»º <code>twitterURL</code> æ—¶ï¼Œå®ƒå­˜åœ¨äº <code>getURL</code> æ‰§è¡Œä¸Šä¸‹æ–‡â€”â€”å®ƒå®šä¹‰çš„åœ°æ–¹ï¼Œè€Œä¸åœ¨ <code>å…¨å±€</code> æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ã€‚è¿™ç‚¹çœ‹èµ·æ¥å¾ˆæ˜æ˜¾ï¼Œä½†å®ƒæ˜¯æˆ‘ä»¬ä¸‹ä¸ªä¸»é¢˜â€”â€”ä½œç”¨åŸŸçš„åŸºæœ¬åŸç†ã€‚</p><hr><p>è¿‡å»ï¼Œä½ å¯èƒ½å¬åˆ°è¿‡å¯¹â€œä½œç”¨åŸŸâ€çš„å®šä¹‰ï¼Œå³ä¸ºâ€œå¯è®¿é—®åˆ°å˜é‡çš„åœ°æ–¹â€ã€‚ç°åœ¨ä¸ç®¡è¿™ä¸ªå®šä¹‰æ˜¯å¦æ­£ç¡®ï¼Œä½¿ç”¨ä½ æ–°å­¦åˆ°çš„çŸ¥è¯†â€”â€”æ‰§è¡Œä¸Šä¸‹æ–‡å’Œ JavaScript Visualizer å·¥å…·ï¼Œä½œç”¨åŸŸçš„æ¦‚å¿µä¼šå˜å¾—æ¯”ä¹‹å‰æ›´åŠ æ¸…æ™°ã€‚å®é™…ä¸Šï¼ŒMDN å°† â€œä½œç”¨åŸŸâ€ å®šä¹‰ä¸º â€œå½“å‰æ‰§è¡Œçš„ä¸Šä¸‹æ–‡â€ã€‚å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨ç±»ä¼¼æ‰§è¡Œä¸Šä¸‹æ–‡çš„æ€ç»´æ¥æ€è€ƒâ€œä½œç”¨åŸŸâ€å’Œâ€œå¯è®¿é—®åˆ°å˜é‡çš„åœ°æ–¹â€ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæµ‹è¯•ã€‚ä¸‹é¢ä»£ç ä¸­ï¼Œ<code>bar</code> ä¼šæ‰“å°å‡ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> bar = <span class="string">'Declared in foo'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bar)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨ JavaScript Visualizer æ¥éªŒè¯ã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=function%20foo%20%28%29%20%7B%0A%20%20var%20bar%20%3D%20%27Declared%20in%20foo%27%0A%7D%0A%0Afoo%28%29%0A%0Aconsole.log%28bar%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/scope.gif" alt=""></p><p><code>foo</code> è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œæ ˆä¸­åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åœ¨ <code>åˆ›å»º</code> é˜¶æ®µåˆ›å»º <code>this</code>ã€<code>arguments</code>ï¼Œå¹¶ç»™ <code>bar</code> èµ‹å€¼ä¸º <code>undefined</code>ã€‚ç„¶åå¼€å§‹ <code>æ‰§è¡Œ</code> é˜¶æ®µï¼ŒæŠŠå­—ç¬¦ä¸² <code>Declared in foo</code> èµ‹å€¼ç»™ <code>bar</code>ã€‚åœ¨ <code>æ‰§è¡Œ</code> é˜¶æ®µç»“æŸåï¼Œ<code>foo</code> æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆä¸­å¼¹å‡ºã€‚å½“ <code>foo</code> ä»æ‰§è¡Œæ ˆä¸­ç§»é™¤æ—¶ï¼Œæˆ‘ä»¬å°è¯•åœ¨ console ä¸­æ‰“å° <code>bar</code>ã€‚æ­¤æ—¶é€šè¿‡ JavaScript Visualizerï¼Œå‘ç° <code>bar</code> å¥½åƒæ˜¯ä»æ¥æ²¡æœ‰å‡ºç°è¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ° <code>undefined</code>ã€‚è¿™ä¸ªå‘Šè¯‰æˆ‘ä»¬ï¼Œå‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡æ˜¯å±€éƒ¨ä½œç”¨åŸŸçš„ã€‚è¿™æ„å‘³ç€ï¼ˆå¯¹å¤§å¤šæ•°è€Œå·²ï¼Œåé¢ä¼šçœ‹åˆ°ä¾‹å¤–çš„æƒ…å†µï¼‰ä¸€æ—¦å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ‰§è¡Œæ ˆå¼¹å‡ºï¼Œå˜é‡å°±æ— æ³•è®¿é—®åˆ°äº†ã€‚</p><p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªæµ‹è¯•ã€‚ä¸‹é¢çš„ä»£ç æ‰§è¡Œå®Œä¹‹å console ä¼šæ‰“å°å‡ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'Jordyn'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">'Jake'</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name)</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">'Tyler'</span></span><br><span class="line">first()</span><br><span class="line">second()</span><br><span class="line"><span class="built_in">console</span>.log(name)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹çœ‹ JavaScript Visualizerã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=function%20first%20%28%29%20%7B%0A%20%20var%20name%20%3D%20%27Jordyn%27%0A%0A%20%20console.log%28name%29%0A%7D%0A%0Afunction%20second%20%28%29%20%7B%0A%20%20var%20name%20%3D%20%27Jake%27%0A%0A%20%20console.log%28name%29%0A%7D%0A%0Aconsole.log%28name%29%0Avar%20name%20%3D%20%27Tyler%27%0Afirst%28%29%0Asecond%28%29%0Aconsole.log%28name%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/unique-scopes.gif" alt=""></p><p>æˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯ï¼š<code>undefined</code>ã€<code>Jordyn</code>ã€<code>Jake</code> å’Œ <code>Tyler</code>ã€‚è¿™ä¸ªå‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ¯ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡æœ‰å®ƒè‡ªå·±çš„ç‰¹æœ‰çš„å˜é‡ç¯å¢ƒã€‚å³ä½¿è¿˜æœ‰å…¶ä»–æ‰§è¡Œä¸Šä¸‹æ–‡åŒ…å«å˜é‡ <code>name</code>ï¼ŒJavaScript å¼•æ“ä¼šå…ˆä»å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡æŸ¥æ‰¾å˜é‡ã€‚</p><p>è¿™å°±å¼•å‡ºæ–°çš„é—®é¢˜ï¼Œå¦‚æœå½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨å˜é‡æ€ä¹ˆåŠï¼ŸJavaScript å¼•æ“æ˜¯å¦å°±åœæ­¢æŸ¥æ‰¾è¯¥å˜é‡ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼Œå®ƒä¼šå‘Šè¯‰æˆ‘ä»¬ç­”æ¡ˆã€‚ä¸‹é¢çš„ä»£ç ï¼Œä¼šæ‰“å°ä»€ä¹ˆç»“æœï¼Ÿ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">'Tyler'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logName</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">logName()</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=var%20name%20%3D%20%27Tyler%27%0A%0Afunction%20logName%20%28%29%20%7B%0A%20%20console.log%28name%29%0A%7D%0A%0AlogName%28%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p>å¯èƒ½ç›´è§‰å‘Šè¯‰ä½ ä¼šæ‰“å° <code>undefined</code>ï¼Œå› ä¸º <code>logName</code> æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸä¸‹æ²¡æœ‰ <code>name</code> å˜é‡ã€‚è¿™æ ·æƒ³æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯æ˜¯é”™è¯¯çš„ã€‚å¦‚æœ JavaScript å¼•æ“åœ¨å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰¾ä¸åˆ°å˜é‡ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå®ƒä¼šåœ¨æœ€è¿‘çš„çˆ¶çº§æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾è¯¥å˜é‡ã€‚è¿™ä¸ªæŸ¥æ‰¾é“¾å°†ä¼šä¸€ç›´æŒç»­ï¼Œç›´åˆ°å¼•æ“æŸ¥æ‰¾åˆ°å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿæ²¡æœ‰è¯¥å˜é‡ï¼Œé‚£ä¹ˆå°†ä¼šæŠ›å‡ºå¼•ç”¨é”™è¯¯ï¼ˆReference Errorï¼‰ã€‚</p><blockquote><p>å¦‚æœå˜é‡åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨ï¼ŒJavaScript å¼•æ“ä¼šé€ä¸ªæ£€æŸ¥å„è‡ªçš„çˆ¶çº§æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º <code>ä½œç”¨åŸŸé“¾</code>ã€‚åœ¨ JavaScript Visualizer ä¸­æ˜¾ç¤ºï¼Œæ¯ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ·»åŠ äº†ç¼©è¿›å¹¶åŠ ä¸Šç‰¹åˆ«çš„èƒŒæ™¯é¢œè‰²ã€‚é€šè¿‡å¯è§†åŒ–ï¼Œä½ å¯ä»¥çœ‹åˆ°æ¯ä¸ªå­çº§æ‰§è¡Œä¸Šä¸‹æ–‡å¯ä»¥å¼•ç”¨å®ƒçˆ¶çº§æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ä»»ä½•å˜é‡ï¼Œä½†æ˜¯åä¹‹åˆ™ä¸è¡Œã€‚</p></blockquote><hr><p>å‰é¢æˆ‘ä»¬å­¦ä¹ åˆ°ï¼Œå‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡æ˜¯å±€éƒ¨ä½œç”¨åŸŸçš„ï¼Œå½“å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ‰§è¡Œæ ˆå¼¹å‡ºåï¼Œå˜é‡å°±æ— æ³•è®¿é—®äº†ï¼ˆé’ˆå¯¹å¤§å¤šæ•°æƒ…å†µï¼‰ã€‚è¿™ä¸ªè¯´æ³•é”™è¯¯çš„ä¸€ç§æƒ…å†µæ˜¯ï¼šå½“ä¸€ä¸ªå‡½æ•°å†…åµŒåœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œæ—¶ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿çˆ¶çº§å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å·²ç»ä»æ‰§è¡Œæ ˆä¸­ç§»é™¤ï¼Œå­å‡½æ•°ä¹Ÿå¯ä»¥ä¿æŒèƒ½è®¿é—®å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸã€‚è¿™ä¸ªè¯´èµ·æ¥å°±å¤æ‚äº†ã€‚è¿˜æ˜¯ä½¿ç”¨ JavaScript Visualizerï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚</p><blockquote><p><a href="https://tylermcginnis.com/javascript-visualizer/?code=var%20count%20%3D%200%0A%0Afunction%20makeAdder%28x%29%20%7B%0A%20%20return%20function%20inner%20%28y%29%20%7B%0A%20%20%20%20return%20x%20%2B%20y%3B%0A%20%20%7D%3B%0A%7D%0A%0Avar%20add5%20%3D%20makeAdder%285%29%3B%0Acount%20%2B%3D%20add5%282%29" target="_blank" rel="noopener">æŸ¥çœ‹å¯è§†åŒ–ä»£ç </a></p></blockquote><p><img src="https://tylermcginnis.com/images/posts/advanced-javascript/closure-scope.gif" alt=""></p><p>åœ¨ <code>makeAdder</code> æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨æ‰§è¡Œæ ˆå¼¹å‡ºåï¼ŒJavaScript Visualizer åˆ›å»ºäº† <code>é—­åŒ…ä½œç”¨åŸŸï¼ˆClosure Scopeï¼‰</code>ã€‚åœ¨ <code>é—­åŒ…ä½œç”¨åŸŸï¼ˆClosure Scopeï¼‰</code> é‡Œæ‹¥æœ‰å’Œ <code>makeAdder</code> æ‰§è¡Œä¸Šä¸‹æ–‡é‡Œä¸€æ ·çš„å˜é‡ç¯å¢ƒã€‚äº§ç”Ÿè¿™ä¸ªæƒ…å†µçš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬åœ¨æŠŠå‡½æ•°åµŒå…¥åˆ°å¦ä¸€ä¸ªå‡½æ•°é‡Œã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œï¼Œå‡½æ•° <code>inner</code> å†…åµŒåœ¨å‡½æ•° <code>makeAdder</code> é‡Œï¼Œæ‰€ä»¥ <code>inner</code> åˆ›å»ºäº†åŒ…å« <code>makeAdder</code> å˜é‡ç¯å¢ƒçš„ <code>é—­åŒ…</code>ã€‚å› ä¸ºåˆ›å»ºäº†<code>é—­åŒ…ä½œç”¨åŸŸï¼ˆClosure Scopeï¼‰</code>ï¼Œæ‰€ä»¥å³ä½¿ <code>makeAdder</code> æ‰§è¡Œç¯å¢ƒå·²ç»ä»æ‰§è¡Œæ ˆå¼¹å‡ºäº†ï¼Œ<code>inner</code> è¿˜æ˜¯å¯ä»¥è®¿é—®å˜é‡ <code>x</code>ï¼ˆé€šè¿‡ä½œç”¨åŸŸé“¾ï¼‰ã€‚</p><p>æ­£å¦‚ä½ æ‰€æƒ³ï¼Œå­å‡½æ•°â€œåŒ…å«â€å®ƒçˆ¶çº§å‡½æ•°çš„å˜é‡ç¯å¢ƒï¼ŒæŠŠè¿™ä¸ªæ¦‚å¿µç§°ä¸ºâ€œé—­åŒ…â€ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://tylermcginnis.com/ultimate-guide-to-execution-contexts-hoisting-scopes-and-closures-in-javascript/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;The Ultimate Guide to Execution Contexts, Hoisting, Scopes, and Closures in JavaScript&lt;/a&gt;&lt;br&gt;ä½œè€…ï¼š&lt;a href=&quot;https://twitter.com/tylermcginnis&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Tyler McGinnis&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2019/05/26/5cea077212cb313490.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;è§†é¢‘ï¼š&lt;a href=&quot;https://www.youtube.com/watch?v=Nt-qa_LlUH0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;The Ultimate Guide to Execution Contexts, Hoisting, Scopes, and Closures in JavaScript&lt;/a&gt;&lt;/p&gt;&lt;p&gt;æˆ‘è®¤ä¸ºç†è§£ JavaScript è¯­è¨€çš„æœ€é‡è¦çš„åŸºæœ¬æ¦‚å¿µæ˜¯ç†è§£æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰ï¼Œè¿™ç‚¹å¯èƒ½ä»¤äººæ„Ÿåˆ°æ„å¤–ã€‚æ­£ç¡®çš„å­¦ä¹ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¯ä»¥è®©ä½ æ›´å®¹æ˜“å­¦ä¹ æ›´é«˜çº§çš„å†…å®¹ï¼Œæ¯”å¦‚å˜é‡æå‡ï¼ˆhoistingï¼‰ã€ä½œç”¨åŸŸé“¾ï¼ˆscope chainsï¼‰å’Œé—­åŒ…ï¼ˆclosuresï¼‰ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£åˆ°åº•ä»€ä¹ˆæ˜¯â€œæ‰§è¡Œä¸Šä¸‹æ–‡â€å‘¢ï¼Ÿä¸ºäº†æ›´å¥½çš„ç†è§£å®ƒï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•å†™è½¯ä»¶çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="JavaScript" scheme="https://blog.hhking.cn/tags/JavaScript/"/>
    
      <category term="é—­åŒ…" scheme="https://blog.hhking.cn/tags/%E9%97%AD%E5%8C%85/"/>
    
      <category term="æ‰§è¡Œä¸Šä¸‹æ–‡" scheme="https://blog.hhking.cn/tags/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/"/>
    
      <category term="Execution Contexts" scheme="https://blog.hhking.cn/tags/Execution-Contexts/"/>
    
      <category term="å˜é‡æå‡" scheme="https://blog.hhking.cn/tags/%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87/"/>
    
      <category term="Hoisting" scheme="https://blog.hhking.cn/tags/Hoisting/"/>
    
      <category term="ä½œç”¨åŸŸ" scheme="https://blog.hhking.cn/tags/%E4%BD%9C%E7%94%A8%E5%9F%9F/"/>
    
      <category term="Scopes" scheme="https://blog.hhking.cn/tags/Scopes/"/>
    
      <category term="Closures" scheme="https://blog.hhking.cn/tags/Closures/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘] ç®€å• 5 æ­¥ï¼Œç†è§£ JWT</title>
    <link href="https://blog.hhking.cn/2018/10/01/5-easy-steps-to-understanding-json-web-tokens/"/>
    <id>https://blog.hhking.cn/2018/10/01/5-easy-steps-to-understanding-json-web-tokens/</id>
    <published>2018-10-01T12:03:05.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡: <a href="https://medium.com/vandium-software/5-easy-steps-to-understanding-json-web-tokens-jwt-1164c0adfcec" target="_blank" rel="noopener">5 Easy Steps to Understanding JSON Web Tokens (JWT)</a><br>ä½œè€…: <a href="https://medium.com/@mikeysteckyefantis" target="_blank" rel="noopener">Mikey Stecky-Efantis</a><br>è¯‘è€…: <a href="https://blog.hhking.cn/">hhking</a></p></blockquote><p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fvqfflj9rkj31jk0q1tcx.jpg" alt=""></p><p>è¿™ç¯‡æ–‡ç« ï¼Œå°†ä¼šè§£é‡Š JSON Web Tokens (JWT) çš„åŸºæœ¬åŸç†ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ã€‚JWT æ˜¯ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºå¯ä¿¡ä»»å’Œå®‰å…¨çš„é‡è¦éƒ¨åˆ†ã€‚JWT å…è®¸ä»¥å®‰å…¨çš„æ–¹å¼æ¥è¡¨ç¤ºä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·æ•°æ®ã€‚</p><a id="more"></a><p>ä¸ºäº†è§£é‡Š JWT çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬ä»æŠ½è±¡çš„å®šä¹‰å¼€å§‹ï¼š</p><blockquote><p>JSON Web Token (JWT) æ˜¯ä¸€ä¸ª JSON å¯¹è±¡, åœ¨ <a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="noopener">RFC 7519</a> ä¸­å®šä¹‰ä¸ºä¸€ç§ç”¨æ¥è¡¨ç¤ºåŒæ–¹ä¿¡æ¯é›†çš„å®‰å…¨æ–¹å¼ã€‚Token ç”±å¤´éƒ¨ (header)ã€è´Ÿè½½ (payload)ã€ç­¾å (signature) ç»„æˆã€‚</p></blockquote><p>ç®€å•çš„è¯´ï¼ŒJWT åªæ˜¯å½¢å¦‚ä¸‹é¢æ ¼å¼çš„å­—ç¬¦ä¸²ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header.payload.signature</span><br></pre></td></tr></table></figure><p></p><p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒå¼•å·å­—ç¬¦ä¸²ä¹Ÿæ˜¯åˆæ³•çš„ JSON å¯¹è±¡</em></p><p>ä¸ºäº†è¯´æ˜å¦‚ä½•ä½¿ç”¨å’Œä¸ºä»€ä¹ˆä½¿ç”¨ JWTï¼Œæˆ‘ä»¬å°†ç”¨ä¸€ä¸ªç®€å•çš„ 3 å®ä½“ç¤ºä¾‹ï¼ˆå‚è§ä¸‹å›¾ï¼‰ã€‚ä¾‹å­é‡Œçš„ä¸‰ä¸ªå®ä½“åˆ†åˆ«æ˜¯ç”¨æˆ·ï¼ˆuserï¼‰ã€åº”ç”¨æœåŠ¡å™¨ï¼ˆapplication serverï¼‰ã€è®¤è¯æœåŠ¡å™¨ï¼ˆauthentication serverï¼‰ã€‚è®¤è¯æœåŠ¡å™¨æä¾› JWT ç»™ç”¨æˆ·ï¼Œç„¶åç”¨æˆ·å¯ä»¥å®‰å…¨çš„å’Œåº”ç”¨é€šä¿¡ã€‚</p><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fvqhw0cokfj318g0ukq4q.jpg" alt=""></p><p><center>åº”ç”¨ä½¿ç”¨ JWT æ ¡éªŒç”¨æˆ·çœŸå®æ€§çš„è¿‡ç¨‹</center><br></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ·é¦–å…ˆé€šè¿‡è®¤è¯æœåŠ¡å™¨æä¾›çš„ç™»å½•ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼šç”¨æˆ·åå’Œå¯†ç ï¼ŒFacebook ç™»å½•ï¼ŒGoogle ç™»å½•ï¼Œç­‰ç­‰ï¼‰ç™»å½•è®¤è¯æœåŠ¡å™¨ã€‚ç„¶åè®¤è¯æœåŠ¡å™¨ç”Ÿæˆ JWT å¹¶è¿”å›ç»™ç”¨æˆ·ã€‚å½“ç”¨æˆ·å‘åº”ç”¨æœåŠ¡å™¨å‘èµ· API è¯·æ±‚æ—¶ï¼Œä¼šé™„å¸¦ä¸Š JWTã€‚åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œåº”ç”¨æœåŠ¡å™¨ä¼šé…ç½®æˆå»éªŒè¯ä¼ å…¥çš„ JWT æ˜¯å¦ç”±è®¤è¯æœåŠ¡å™¨ç”Ÿæˆçš„ï¼ˆéªŒè¯è¿‡ç¨‹å°†åœ¨åé¢è¯¦ç»†è§£é‡Šï¼‰ã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·æºå¸¦ JWT å‘èµ· API è¯·æ±‚æ—¶ï¼Œåº”ç”¨å¯ä»¥é€šè¿‡ JWT æ¥æ ¡éªŒ API è¯·æ±‚æ˜¯å¦æ¥è‡ªè®¤è¯çš„ç”¨æˆ·ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ›´åŠ æ·±å…¥çš„ç ”ç©¶ JWT æœ¬èº«åŠå…¶æ„å»ºå’ŒéªŒè¯çš„æ–¹å¼ã€‚</p><h2 id="Step-1-åˆ›å»º-HEADER"><a href="#Step-1-åˆ›å»º-HEADER" class="headerlink" title="Step 1. åˆ›å»º HEADER"></a>Step 1. åˆ›å»º HEADER</h2><p>JWT çš„å¤´éƒ¨ï¼ˆheaderï¼‰æ¨¡å—åŒ…å«äº†å¦‚ä½•è®¡ç®— JWT ç­¾åçš„ä¿¡æ¯ã€‚header æ˜¯ä¸ª JSON å¯¹è±¡ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;typ&quot;: &quot;JWT&quot;,</span><br><span class="line">    &quot;alg&quot;: &quot;HS256&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ª JSON ä¸­ï¼Œâ€typeâ€ å­—æ®µçš„å€¼æŒ‡æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸ª JWTï¼Œâ€algâ€ å­—æ®µçš„å€¼è¯´æ˜ç”¨ä»€ä¹ˆ hash ç®—æ³•æ¥ç”Ÿæˆ JWT ç­¾åæ¨¡å—ã€‚ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ HMAC-SHA256 ç®—æ³• â€”â€” å¸¦æœ‰å¯†é’¥çš„ hash ç®—æ³•ï¼Œæ¥è®¡ç®—ç­¾åï¼ˆåœ¨ step 3 è¯¦ç»†è¯´æ˜ï¼‰ã€‚</p><h2 id="Step-2-åˆ›å»º-PAYLOAD"><a href="#Step-2-åˆ›å»º-PAYLOAD" class="headerlink" title="Step 2. åˆ›å»º PAYLOAD"></a>Step 2. åˆ›å»º PAYLOAD</h2><p>JWT çš„è´Ÿè½½ï¼ˆpayloadï¼‰æ¨¡å—æ˜¯å­˜å‚¨åœ¨å…¶ä¸­çš„æ•°æ®ï¼ˆè¿™ä¸ªæ•°æ®ä¹Ÿè¢«ç§°ä¸º JWT çš„ â€œå£°æ˜â€ï¼‰ã€‚åœ¨ä¾‹å­ä¸­ï¼Œè®¤è¯æœåŠ¡å™¨ç”Ÿæˆ JWTï¼ŒJWT ä¸­ä¿å­˜äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå…·ä½“çš„è¯´æ˜¯ç”¨æˆ· IDã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;userId&quot;: &quot;b08f86af-35da-48f2-8fab-cef3904660bd&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ payload ä¸­åªä¿å­˜äº†ä¸€ä¸ªå£°æ˜ã€‚ä½ æƒ³è¦çš„è¯ï¼Œä¹Ÿå¯ä»¥æ·»åŠ æ›´å¤šçš„å£°æ˜ã€‚JWT çš„ payload æœ‰å‡ ç§ä¸åŒçš„æ ‡å‡†å£°æ˜ï¼Œä¾‹å¦‚ï¼šâ€œissâ€ è¡¨ç¤ºå‘è¡Œäºº, â€œsubâ€ è¡¨ç¤ºä¸»é¢˜, ä»¥åŠ â€œexpâ€ è¡¨ç¤ºè¿‡æœŸæ—¶é—´ã€‚è¿™äº›å­—æ®µåœ¨åˆ›å»º JWT æ—¶éå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”æ˜¯å¯é€‰çš„å­—æ®µã€‚å¯ä»¥åœ¨ <a href="https://en.wikipedia.org/wiki/JSON_Web_Token#Standard_fields" target="_blank" rel="noopener">wikipedia page</a> ä¸ŠæŸ¥çœ‹è¯¦ç»†çš„ JWT æ ‡å‡† å­—æ®µåˆ—è¡¨ã€‚</p><p>è¦è®°ä½ï¼Œæ•°æ®çš„å¤§å°ä¼šå½±å“æ•´ä¸ª JWT çš„å¤§å°ï¼Œæ•´ä¸ªä¸€èˆ¬ä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯å¤ªå¤§çš„ JWT å¯èƒ½ä¼šå¯¹æ€§èƒ½æœ‰è´Ÿé¢å½±å“å¹¶å¯¼è‡´å»¶è¿Ÿã€‚</p><h2 id="Step-3-åˆ›å»º-SIGNATURE"><a href="#Step-3-åˆ›å»º-SIGNATURE" class="headerlink" title="Step 3. åˆ›å»º SIGNATURE"></a>Step 3. åˆ›å»º SIGNATURE</h2><p>ç­¾åï¼ˆsignatureï¼‰æ˜¯æœ‰ä¸‹é¢çš„ä¼ªä»£ç è®¡ç®—å¾—åˆ°çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// signature algorithm</span><br><span class="line">data = base64urlEncode( header ) + â€œ.â€ + base64urlEncode( payload )</span><br><span class="line">hashedData = hash( data, secret )</span><br><span class="line">signature = base64urlEncode( hashedData )</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç®—æ³•åšçš„æ˜¯ï¼šå¯¹æ­¥éª¤ 1 å’Œ 2 ç”Ÿæˆçš„ header å’Œ payload è¿›è¡Œ <a href="http://kjur.github.io/jsjws/tool_b64uenc.html" target="_blank" rel="noopener">base64url encodes</a> ç¼–ç ï¼Œç„¶åæŠŠç¼–ç ç”Ÿæˆçš„å­—ç¬¦ä¸²ä¸­é—´é€šè¿‡å¥å·ï¼ˆ.ï¼‰è¿æ¥èµ·æ¥ã€‚åœ¨ä¼ªä»£ç ä¸­ï¼ŒæŠŠè¿æ¥çš„å­—ç¬¦ä¸²èµ‹å€¼ç»™ <code>data</code>ã€‚é€šè¿‡ JWT header ä¸­å®šä¹‰çš„ hash ç®—æ³•ï¼ŒåŠ ä¸Šå¯†é’¥å¯¹ <code>data</code> å­—ç¬¦ä¸² <a href="https://en.wikipedia.org/wiki/Hash_function" target="_blank" rel="noopener">hash</a> å¤„ç†ã€‚æŠŠ hash åçš„æ•°æ®èµ‹å€¼ç»™ <code>hashedData</code>ã€‚è¿™ä¸ª hash åçš„æ•°æ®é€šè¿‡ base64url ç¼–ç ç”Ÿæˆ JWT ç­¾åï¼ˆsignatureï¼‰ã€‚</p><p>æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œheader å’Œ payload è¢« base64url ç¼–ç æˆï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// header</span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9</span><br><span class="line">// payload</span><br><span class="line">eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ</span><br></pre></td></tr></table></figure><p></p><p>ç„¶åï¼Œå°†ç¼–è¯‘åçš„ header å’Œ payload è¿›è¡Œæ‹¼æ¥ï¼Œä½¿ç”¨æŒ‡å®šçš„ç­¾åç®—æ³•å’Œå¯†é’¥å¯¹å®ƒè®¡ç®—ï¼Œå¾—åˆ°ç­¾åéœ€è¦çš„ hash åçš„æ•°æ®ã€‚åœ¨æˆ‘ä»¬ä¾‹å­ä¸­ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ HS256 ç®—æ³•ï¼Œå¯†é’¥ä¸ºå­—ç¬¦ä¸² <code>secret</code>ï¼Œå¯¹å­—ç¬¦ä¸² <code>data</code> è®¡ç®—å¾—åˆ°å­—ç¬¦ä¸² <code>hashedData</code>ã€‚ç„¶åï¼Œé€šè¿‡ base64url å¯¹å­—ç¬¦ä¸² <code>hashedData</code> ç¼–ç å¾—åˆ°ä¸‹é¢çš„ JWT ç­¾åï¼ˆsignatureï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// signature</span><br><span class="line">-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM</span><br></pre></td></tr></table></figure><h2 id="Step-4-å°†-JWT-ä¸‰ä¸ªæ¨¡å—åˆå¹¶"><a href="#Step-4-å°†-JWT-ä¸‰ä¸ªæ¨¡å—åˆå¹¶" class="headerlink" title="Step 4. å°† JWT ä¸‰ä¸ªæ¨¡å—åˆå¹¶"></a>Step 4. å°† JWT ä¸‰ä¸ªæ¨¡å—åˆå¹¶</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†æ‰€æœ‰çš„ä¸‰ä¸ªæ¨¡å—ï¼Œå¯ä»¥ç”Ÿæˆ JWT äº†ã€‚è®°ä½ JWT çš„ç»“æ„ <code>header.payload.signature</code>ï¼Œæˆ‘ä»¬ç®€å•çš„ä½¿ç”¨å¥ç‚¹ï¼ˆ.ï¼‰ä½œä¸ºåˆ†éš”æ¥åˆå¹¶ä»–ä»¬ã€‚æˆ‘ä»¬ä½¿ç”¨ base64url ç¼–ç åçš„ header å’Œ payloadï¼Œä»¥åŠåœ¨ Step 3 å¾—åˆ°çš„ signatureï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// JWT Token</span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ.-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://jwt.io/" target="_blank" rel="noopener">jwt.io</a> å»åˆ›å»ºä½ çš„ JWTã€‚</p><p>å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œç°åœ¨è®¤è¯æœåŠ¡å™¨å¯ä»¥æŠŠè¿™ä¸ª JWT å‘é€ç»™ç”¨æˆ·ã€‚</p><h3 id="JWT-æ˜¯å¦‚ä½•ä¿æŠ¤æ•°æ®çš„"><a href="#JWT-æ˜¯å¦‚ä½•ä¿æŠ¤æ•°æ®çš„" class="headerlink" title="JWT æ˜¯å¦‚ä½•ä¿æŠ¤æ•°æ®çš„"></a>JWT æ˜¯å¦‚ä½•ä¿æŠ¤æ•°æ®çš„</h3><p>é‡è¦çš„æ˜¯è¦ç†è§£ï¼Œä½¿ç”¨ JWT çš„ç›®çš„ä¸æ˜¯ä»¥ä»»ä½•æ–¹å¼éšè—æˆ–è€…æ¨¡ç³Šæ•°æ®ã€‚ä½¿ç”¨ JWT çš„ç›®çš„æ˜¯ä¸ºäº†è¯æ˜å‘é€çš„æ•°æ®æ˜¯ç”±å¯ä¿¡çš„æºåˆ›å»ºçš„ã€‚</p><p>æ­£å¦‚å‰é¢çš„æ­¥éª¤æ‰€ç¤ºï¼ŒJWT é‡Œçš„æ•°æ®è¢«ç¼–ç ã€ç­¾åï¼Œä½†æ˜¯æ²¡æœ‰åŠ å¯†ã€‚ç¼–ç æ•°æ®çš„ç›®çš„æ˜¯ä¸ºäº†è½¬åŒ–æ•°æ®çš„ç»“æ„ã€‚ç­¾åæ•°æ®æ˜¯å¯ä»¥è®©æ•°æ®æ¥æ”¶è€…æ ¡éªŒæ•°æ®æ¥æºçš„å¯é æ€§ã€‚æ‰€ä»¥ç¼–ç å’Œç­¾åæ•°æ®å¹¶æ²¡æœ‰ä¿æŠ¤æ•°æ®ã€‚è€Œå¦ä¸€æ–¹é¢ï¼ŒåŠ å¯†çš„ä¸»è¦ç›®çš„æ˜¯ä¿æŠ¤æ•°æ®å’Œé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚å…³äºç¼–ç å’ŒåŠ å¯†çš„ä¸åŒä¹‹å¤„çš„è¯¦ç»†è§£é‡Šï¼Œä»¥åŠæ›´å¤šå…³äº hash çš„åŸç†ï¼Œå¯ä»¥çœ‹ <a href="https://danielmiessler.com/study/encoding-encryption-hashing-obfuscation/#encoding" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚</p><blockquote><p>ç”±äº JWT åªæ˜¯ç­¾åå’Œç¼–ç æ•°æ®ï¼Œæ²¡æœ‰åŠ å¯†ï¼Œæ‰€æœ‰ JWT ä¸ä¿è¯æ•æ„Ÿæ•°æ®çš„ä»»ä½•å®‰å…¨æ€§ã€‚</p></blockquote><h2 id="Step-5-æ ¡éªŒ-JWT"><a href="#Step-5-æ ¡éªŒ-JWT" class="headerlink" title="Step 5. æ ¡éªŒ JWT"></a>Step 5. æ ¡éªŒ JWT</h2><p>åœ¨æˆ‘ä»¬çš„ç®€å• 3 å®ä½“å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ JWT æ˜¯ç”± HS256 ç®—æ³•ç­¾å â€”â€” è¿™ä¸ªç®—æ³•çš„å¯†é’¥åªæœ‰è®¤è¯æœåŠ¡å™¨å’Œåº”ç”¨æœåŠ¡å™¨çŸ¥é“ã€‚å½“åº”ç”¨æœåŠ¡å™¨è®¾ç½®ä»–çš„è®¤è¯è¿‡ç¨‹æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨ä»è®¤è¯æœåŠ¡å™¨é‚£æ¥æ”¶å¯†é’¥ã€‚ç”±äºåº”ç”¨çŸ¥é“å¯†é’¥ï¼Œå½“ç”¨æˆ·å‘åº”ç”¨å‘èµ·æºå¸¦ JWT çš„ API è¯·æ±‚æ—¶ï¼Œåº”ç”¨å¯ä»¥æ‰§è¡Œå’Œ Step 3 ä¸€æ ·çš„ç­¾åç®—æ³•ã€‚ç„¶ååº”ç”¨å¯ä»¥æ ¡éªŒå®ƒè‡ªå·± hash æ“ä½œç”Ÿæˆçš„ç­¾åæ˜¯å¦å’Œ JWT ä¸­çš„ç­¾ååŒ¹é…ï¼ˆå³å®ƒåŒ¹é…è®¤è¯æœåŠ¡å™¨åˆ›å»ºçš„ JWT ç­¾åï¼‰ã€‚å¦‚æœç­¾ååŒ¹é…ï¼Œæ„å‘³ç€ JWT æ˜¯åˆæ³•çš„ï¼Œæ ‡æ˜ API è¯·æ±‚æ˜¯æ¥è‡ªå¯é çš„æ¥æºã€‚å¦åˆ™ï¼Œå¦‚æœç­¾åä¸åŒ¹é…ï¼Œæ„å‘³ç€æ¥æ”¶çš„ JWT æ˜¯æ— æ•ˆçš„ï¼Œè¿™ä¹Ÿå¯èƒ½è¯´æ˜åº”ç”¨é­å—æ½œåœ¨çš„æ”»å‡»ã€‚æ‰€ä»¥ï¼Œé€šè¿‡æ ¡éªŒ JWTï¼Œåº”ç”¨åœ¨å’Œç”¨æˆ·ä¹‹é—´å»ºç«‹äº†ä¿¡ä»»ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬äº†è§£äº† JWT æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•åˆ›å»ºå’Œæ ¡éªŒå®ƒï¼Œä»¥åŠå¦‚ä½•ç”¨å®ƒæ¥å»ºç«‹åº”ç”¨å’Œç”¨æˆ·çš„ä¿¡ä»»ã€‚è¿™æ˜¯ç†è§£ JWT çš„åŸºæœ¬åŸç†å’Œå®ƒçš„ä½œç”¨çš„èµ·ç‚¹ã€‚JWT åªæ˜¯ç¡®ä¿åº”ç”¨ä¸­ä¿¡ä»»å’Œå®‰å…¨æ€§çš„éš¾é¢˜ä¹‹ä¸€ã€‚</p><p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œæœ¬æ–‡æ‰€è¿°çš„ JWT è®¤è¯è®¾ç½®ä½¿ç”¨çš„æ˜¯å¯¹ç§°å¯†é’¥ç®—æ³•ï¼ˆHS256ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼æ¥è®¾ç½®ä½ çš„ JWT è®¤è¯ï¼Œåªæ˜¯ä½¿ç”¨éå¯¹ç§°ç®—æ³•ï¼ˆä¾‹å¦‚ RS256ï¼‰â€”â€” è®¤è¯æœåŠ¡å™¨æœ‰ä¸€ä¸ªå¯†é’¥ï¼Œåº”ç”¨æœ‰ä¸€ä¸ªå…¬é’¥ã€‚å…³äºä½¿ç”¨å¯¹ç§°å’Œéå¯¹ç§°ç®—æ³•çš„ä¸åŒä¹‹å¤„çš„è¯¦ç»†åˆ†æï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://stackoverflow.com/questions/39239051/rs256-vs-hs256-whats-the-difference" target="_blank" rel="noopener">è¿™ä¸ª Stack Overflow ä¸Šçš„é—®é¢˜</a>ã€‚</p><p>åŒæ—¶è¦è¯´æ˜çš„æ˜¯ï¼ŒJWT å¿…é¡»é€šè¿‡ HTTPS è¿æ¥ï¼ˆä¸æ˜¯ HTTPï¼‰æ¥å‘é€ã€‚ä½¿ç”¨ HTTPS å¯ä»¥é˜²æ­¢æœªæˆæƒç”¨æˆ·çªƒå–å‘é€çš„ JWTï¼Œä»è€Œæ— æ³•æ‹¦æˆªæœåŠ¡ç«¯å’Œç”¨æˆ·ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>è¿˜æœ‰å°±æ˜¯ï¼Œç»™ä½ çš„ JWT payload è®¾ç½®æœ‰æ•ˆæœŸ â€”â€” ç‰¹åˆ«æ˜¯å¾ˆçŸ­çš„æœ‰æ•ˆæœŸï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼Œä»è€Œå¦‚æœæ—§çš„ JWT è¢«æ³„æ¼ï¼Œå®ƒå¯èƒ½å·²ç»æ— æ•ˆå¹¶æ— æ³•åœ¨ä½¿ç”¨äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡: &lt;a href=&quot;https://medium.com/vandium-software/5-easy-steps-to-understanding-json-web-tokens-jwt-1164c0adfcec&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;5 Easy Steps to Understanding JSON Web Tokens (JWT)&lt;/a&gt;&lt;br&gt;ä½œè€…: &lt;a href=&quot;https://medium.com/@mikeysteckyefantis&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Mikey Stecky-Efantis&lt;/a&gt;&lt;br&gt;è¯‘è€…: &lt;a href=&quot;https://blog.hhking.cn/&quot;&gt;hhking&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/large/006tNc79gy1fvqfflj9rkj31jk0q1tcx.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« ï¼Œå°†ä¼šè§£é‡Š JSON Web Tokens (JWT) çš„åŸºæœ¬åŸç†ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ã€‚JWT æ˜¯ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºå¯ä¿¡ä»»å’Œå®‰å…¨çš„é‡è¦éƒ¨åˆ†ã€‚JWT å…è®¸ä»¥å®‰å…¨çš„æ–¹å¼æ¥è¡¨ç¤ºä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·æ•°æ®ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="JSON Web Tokens" scheme="https://blog.hhking.cn/tags/JSON-Web-Tokens/"/>
    
      <category term="JWT" scheme="https://blog.hhking.cn/tags/JWT/"/>
    
  </entry>
  
  <entry>
    <title>React é«˜é˜¶ç»„ä»¶å…¶å®å¾ˆç®€å•</title>
    <link href="https://blog.hhking.cn/2018/09/28/react-high-order-components/"/>
    <id>https://blog.hhking.cn/2018/09/28/react-high-order-components/</id>
    <published>2018-09-28T11:23:34.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é«˜é˜¶ç»„ä»¶ High-Order Componentsï¼Œä¸å±äº React çš„ APIï¼Œè€Œæ˜¯ React çš„ä¸€ç§è¿ç”¨æŠ€å·§ï¼Œæˆ–è€…è¯´è®¾è®¡æ¨¡å¼ã€‚æ‰€ä»¥ï¼Œä¸ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œä¹Ÿæ˜¯å¯ä»¥å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯æŒæ¡é«˜é˜¶ç»„ä»¶ï¼Œå¯ä»¥æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¤ç”¨æ€§ï¼Œå®ç°èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚å½“ç„¶ï¼Œå­¦ä¼š React çš„é«˜çº§è¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®©ä½ æ›´åŠ æ·±å…¥çš„ç†è§£ Reactã€‚</p><p>é«˜é˜¶ç»„ä»¶ï¼Œå…¶å®æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆå¤æ‚ã€‚</p><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶"><a href="#ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶"></a>ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶</h2><p><strong>é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç»„ä»¶ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚</strong><br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EnhancedComponent = highOrderComponent(WrappedComponent);</span><br></pre></td></tr></table></figure><p></p><p>è¦è®°ä½çš„æ˜¯ï¼Œè™½ç„¶åç§°æ˜¯<strong>é«˜é˜¶ç»„ä»¶</strong>ï¼Œä½†æ˜¯é«˜é˜¶ç»„ä»¶ä¸æ˜¯ç»„ä»¶ï¼Œè€Œæ˜¯<strong>å‡½æ•°</strong>ï¼</p><p>æ—¢ç„¶æ˜¯å‡½æ•°ï¼Œé‚£å°±å¯ä»¥æœ‰å‚æ•°ï¼Œæœ‰è¿”å›å€¼ã€‚ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªç»„ä»¶ <code>WrappedComponent</code> ä½œä¸ºå‚æ•° ï¼Œè¿”å›<strong>åŠ å·¥è¿‡</strong>çš„æ–°ç»„ä»¶ <code>EnhancedComponent</code>ã€‚å…¶å®é«˜é˜¶ç»„ä»¶å°±æ˜¯è®¾è®¡æ¨¡å¼é‡Œçš„è£…é¥°è€…æ¨¡å¼ã€‚</p><p>å¯ä»¥è¯´ï¼Œç»„ä»¶æ˜¯æŠŠ props è½¬åŒ–æˆ UIï¼Œè€Œé«˜é˜¶ç»„ä»¶æ˜¯æŠŠä¸€ä¸ªç»„ä»¶è½¬åŒ–æˆå¦å¤–ä¸€ä¸ªç»„ä»¶ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„é«˜é˜¶ç»„ä»¶ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (WrappedComponent) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">EnhancedComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> &lt;WrappedComponent /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¼ å…¥çš„åŸå§‹ç»„ä»¶ <code>WrappedComponent</code> åšä¸€äº›ä½ æƒ³è¦çš„æ“ä½œï¼ˆæ¯”å¦‚æ“ä½œ propsï¼Œæå– stateï¼Œç»™åŸå§‹ç»„ä»¶åŒ…è£¹å…¶ä»–å…ƒç´ ç­‰ï¼‰ï¼Œä»è€Œ<strong>åŠ å·¥</strong>å‡ºä½ æƒ³è¦çš„ç»„ä»¶ <code>EnhancedComponent</code> ã€‚æŠŠé€šç”¨çš„é€»è¾‘æ”¾åœ¨é«˜é˜¶ç»„ä»¶ä¸­ï¼Œå¯¹ç»„ä»¶å®ç°ä¸€è‡´çš„å¤„ç†ï¼Œä»è€Œå®ç°ä»£ç çš„å¤ç”¨ã€‚</p><h2 id="ä½¿ç”¨é«˜é˜¶ç»„ä»¶"><a href="#ä½¿ç”¨é«˜é˜¶ç»„ä»¶" class="headerlink" title="ä½¿ç”¨é«˜é˜¶ç»„ä»¶"></a>ä½¿ç”¨é«˜é˜¶ç»„ä»¶</h2><p>é«˜é˜¶ç»„ä»¶çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œå°±æ˜¯åœ¨è¡¨å•ä¸­çš„ä½¿ç”¨ã€‚</p><p>React ä¸­ <a href="https://reactjs.org/docs/forms.html" target="_blank" rel="noopener">å—æ§ç»„ä»¶</a>ï¼Œæ˜¯é€šè¿‡ <code>state</code> æ¥æ§åˆ¶ç”¨æˆ·çš„è¾“å…¥è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ç›‘å¬ <code>onChange</code> æ¥æ›´æ–° <code>state</code>ï¼Œä¾‹å¦‚ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Input</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      value: <span class="string">''</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      value: e.target.value,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input type=<span class="string">"text"</span> value=&#123;<span class="keyword">this</span>.state.value&#125; onChange=&#123;<span class="keyword">this</span>.handleChange&#125; /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Input;</span><br></pre></td></tr></table></figure><p></p><p>é€šå¸¸ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¡¨å•å…ƒç´ è¿›è¡ŒéªŒè¯ï¼Œè¿™æ—¶å¯èƒ½éœ€è¦åœ¨ <code>handleChange</code> ä¸­æ·»åŠ éªŒè¯çš„é€»è¾‘ã€‚å¦‚æœæ˜¯ä¸€ä¸ªè¡¨å•å…ƒç´ ï¼Œè¿™æ ·å†™æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å½“è¡¨å•å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œè¿˜æ˜¯è¿™æ ·ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„æ·»åŠ é€»è¾‘çš„è¯ï¼Œæ˜¯ä¸€ç§ä»€ä¹ˆä½“éªŒï¼Ÿå¦‚æœäº§å“å†æ”¹ä¸€ä¸‹éœ€æ±‚ï¼Œé‚£ä½ å°±åªèƒ½å«æ³ªåŠ ç­äº†ï¼</p><p>è¿™æ—¶å€™ï¼Œé«˜é˜¶ç»„ä»¶çš„ä½œç”¨å°±å¯ä»¥ä½“ç°å‡ºæ¥äº†ã€‚åªéœ€è¦æŠŠæ‰€æœ‰è¡¨å•å…ƒç´ é€šç”¨çš„é€»è¾‘æ”¾åœ¨é«˜é˜¶ç»„ä»¶ä¸­ã€‚æŠŠè¾“å…¥æ¡†éœ€è¦çš„ <code>value</code> å’Œ <code>onChange</code> æå–åˆ°é«˜é˜¶ç»„ä»¶ï¼Œå†é€šè¿‡ <code>props</code> ä¼ ç»™åŸå§‹çš„ç»„ä»¶ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (WrappedComponent) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">InputHOC</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="keyword">super</span>(props);</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        value: <span class="string">''</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        value: e.target.value,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> passProps = &#123;</span><br><span class="line">        value: <span class="keyword">this</span>.state.value,</span><br><span class="line">        onChange: <span class="keyword">this</span>.handleChange,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &lt;WrappedComponent &#123;...passProps&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åè¡¨å•å…ƒç´ é‡Œå°±ä¸éœ€è¦å®ç° <code>state</code> å’Œ <code>onChange</code> çš„é€»è¾‘ï¼Œåªéœ€è¦å¤„ç†ä¼ å…¥çš„ <code>props</code>, å¹¶è°ƒç”¨ä¸€ä¸‹<strong>é«˜é˜¶ç»„ä»¶</strong>ï¼Œå¾—åˆ°çš„å°±æ˜¯å¸¦æœ‰æˆ‘ä»¬éœ€è¦çš„å±æ€§å’ŒåŠŸèƒ½çš„<strong>æ–°ç»„ä»¶</strong>ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> InputHOC <span class="keyword">from</span> <span class="string">'./InputHOC'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Input</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;input className=<span class="string">"input"</span> type=<span class="string">"text"</span> &#123;...this.props&#125; /&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> InputHOC(Input);</span><br></pre></td></tr></table></figure><p></p><p>ç„¶åä½ åªè¦æ‹¿æ–°çš„ç»„ä»¶å»ä½¿ç”¨ï¼Œå°±å¯ä»¥äº†ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–çš„è¡¨å•å…ƒç´ ï¼ŒåŒæ ·åªéœ€è¦è°ƒç”¨é«˜é˜¶ç»„ä»¶ï¼Œå°±å¯ä»¥å¾—åˆ°ä½ éœ€è¦çš„ç»„ä»¶ã€‚è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„é«˜é˜¶ç»„ä»¶çš„è¿ç”¨ï¼Œå®ç°ä»£ç çš„å¤ç”¨ã€‚</p><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œåœ¨é«˜é˜¶ç»„ä»¶é‡Œï¼Œä½ å¯ä»¥æ“ä½œ <code>props</code>ã€<code>state</code>ï¼Œç”šè‡³ä¿®æ”¹ <code>render</code> æ–¹æ³•é‡Œçš„æ¸²æŸ“å†…å®¹ã€‚</p><p>é«˜é˜¶ç»„ä»¶çš„æ¨¡å¼å’Œæ•°æ®æµå®é™…å¦‚å›¾ï¼š<br><img src="/images/react-hoc/react-hoc1.jpg" alt=""></p><h2 id="ä¸€äº›æ³¨æ„ç‚¹"><a href="#ä¸€äº›æ³¨æ„ç‚¹" class="headerlink" title="ä¸€äº›æ³¨æ„ç‚¹"></a>ä¸€äº›æ³¨æ„ç‚¹</h2><h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>æ—¢ç„¶é«˜çº§ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (WrappedComponent, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">EnhancedComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something with data</span></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> &lt;WrappedComponent /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="å‘½å"><a href="#å‘½å" class="headerlink" title="å‘½å"></a>å‘½å</h3><p>é«˜é˜¶ç»„ä»¶çš„åˆ›å»ºçš„å®¹å™¨ç»„ä»¶çš„åç§°åœ¨ React Developer Tools ä¸­çœ‹èµ·æ¥å’Œæ™®é€šç»„ä»¶ä¸€æ ·ï¼Œçœ‹ä¸å‡ºæ˜¯ä¸æ˜¯ä½¿ç”¨äº†é«˜é˜¶ç»„ä»¶ã€‚<br><img src="/images/react-hoc/react-hoc2.jpg" alt=""></p><p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œä¸€èˆ¬çº¦å®šç”¨å®¹å™¨ç»„ä»¶ç±»ååŒ…è£¹åŸå§‹ç»„ä»¶æ¥å‘½åå®¹å™¨ç»„ä»¶ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDisplayName = <span class="function">(<span class="params">WrappedComponent</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> WrappedComponent.displayName ||</span><br><span class="line">    WrappedComponent.name ||</span><br><span class="line">    <span class="string">'Component'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (WrappedComponent, validate) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">InputHOC</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> displayName = <span class="string">`InputHOC(<span class="subst">$&#123;getDisplayName(WrappedComponent)&#125;</span>)`</span>;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="keyword">super</span>(props);</span><br><span class="line">      <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        value: <span class="string">''</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(e);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        value: e.target.value,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">const</span> passProps = &#123;</span><br><span class="line">        value: <span class="keyword">this</span>.state.value,</span><br><span class="line">        onChange: <span class="keyword">this</span>.handleChange,</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &lt;WrappedComponent &#123;...passProps&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç»“æœå¦‚ä¸‹ï¼Œè¿™æ ·å°±å¯ä»¥ç›´è§‚çš„çœ‹å‡ºæ˜¯ä½¿ç”¨äº†é«˜é˜¶ç»„ä»¶ï¼š<br><img src="/images/react-hoc/react-hoc3.jpg" alt=""></p><h3 id="å¤šå±‚é«˜é˜¶ç»„ä»¶"><a href="#å¤šå±‚é«˜é˜¶ç»„ä»¶" class="headerlink" title="å¤šå±‚é«˜é˜¶ç»„ä»¶"></a>å¤šå±‚é«˜é˜¶ç»„ä»¶</h3><p>å¯ä»¥å¯¹ä¸€ä¸ªç»„ä»¶ï¼Œåº”ç”¨å¤šä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå½¢æˆå¤šå±‚åµŒå¥—ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input = InputHOC(Input);</span><br><span class="line">Input = InputHHOC(Input);</span><br></pre></td></tr></table></figure><p></p><p><img src="/images/react-hoc/react-hoc4.jpg" alt=""></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é«˜é˜¶ç»„ä»¶æ˜¯å±äº React é«˜çº§è¿ç”¨ï¼Œä½†æ˜¯å…¶å®æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ¦‚å¿µï¼Œä½†æ˜¯å®ƒéå¸¸å®ç”¨ã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œçµæ´»åˆç†çš„ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œçµæ´»æ€§ã€‚</p><p>å¯¹é«˜é˜¶ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ç»„ä»¶</li><li>ç»„ä»¶æ˜¯æŠŠ props è½¬åŒ–æˆ UIï¼Œé«˜é˜¶ç»„ä»¶æ˜¯æŠŠä¸€ä¸ªç»„ä»¶è½¬åŒ–æˆå¦ä¸€ä¸ªç»„ä»¶</li><li>é«˜é˜¶ç»„ä»¶çš„ä½œç”¨æ˜¯å¤ç”¨ä»£ç </li><li>é«˜é˜¶ç»„ä»¶å¯¹åº”è®¾è®¡æ¨¡å¼é‡Œçš„è£…é¥°è€…æ¨¡å¼</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;é«˜é˜¶ç»„ä»¶ High-Order Componentsï¼Œä¸å±äº React çš„ APIï¼Œè€Œæ˜¯ React çš„ä¸€ç§è¿ç”¨æŠ€å·§ï¼Œæˆ–è€…è¯´è®¾è®¡æ¨¡å¼ã€‚æ‰€ä»¥ï¼Œä¸ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œä¹Ÿæ˜¯å¯ä»¥å®ç°åŠŸèƒ½ï¼Œä½†æ˜¯æŒæ¡é«˜é˜¶ç»„ä»¶ï¼Œå¯ä»¥æé«˜ä»£ç çš„çµæ´»æ€§å’Œå¤ç”¨æ€§ï¼Œå®ç°èµ·æ¥æ›´åŠ ä¼˜é›…ã€‚å½“ç„¶ï¼Œå­¦ä¼š React çš„é«˜çº§è¿ç”¨ï¼Œä¹Ÿå¯ä»¥è®©ä½ æ›´åŠ æ·±å…¥çš„ç†è§£ Reactã€‚&lt;/p&gt;&lt;p&gt;é«˜é˜¶ç»„ä»¶ï¼Œå…¶å®æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆå¤æ‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://blog.hhking.cn/tags/React/"/>
    
      <category term="é«˜é˜¶ç»„ä»¶" scheme="https://blog.hhking.cn/tags/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/"/>
    
      <category term="High-Order Components" scheme="https://blog.hhking.cn/tags/High-Order-Components/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘] 5 åˆ†é’Ÿå­¦ä¹ ä¸€äº›ä¼˜é›…çš„ JavaScript æŠ€å·§</title>
    <link href="https://blog.hhking.cn/2018/09/21/9-neat-javascript-tricks/"/>
    <id>https://blog.hhking.cn/2018/09/21/9-neat-javascript-tricks/</id>
    <published>2018-09-21T09:49:44.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ï¼š<a href="https://medium.freecodecamp.org/9-neat-javascript-tricks-e2742f2735c3" target="_blank" rel="noopener">Learn these neat JavaScript tricks in less than 5 minutes</a><br>ä½œè€…ï¼šAlcides Queiroz</p></blockquote><p><img src="https://i.loli.net/2019/05/26/5ce9e86f1eff798032.png" alt=""><br><strong>5 åˆ†é’Ÿå­¦ä¹ ä¸€äº›ä¼˜é›…çš„ JavaScript æŠ€å·§ â€”â€” ä¸“ä¸šçš„çœæ—¶æŠ€å·§</strong></p><a id="more"></a><h2 id="1-æ¸…ç©ºæˆ–æˆªå–æ•°ç»„"><a href="#1-æ¸…ç©ºæˆ–æˆªå–æ•°ç»„" class="headerlink" title="1. æ¸…ç©ºæˆ–æˆªå–æ•°ç»„"></a>1. æ¸…ç©ºæˆ–æˆªå–æ•°ç»„</h2><p>ä¸€ä¸ªç®€å•çš„æ¸…ç©ºæˆ–è€…æˆªå–æ•°ç»„çš„æ–¹æ³•ï¼Œå°±æ˜¯ä¿®æ”¹å®ƒçš„ <code>length</code> å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>];</span><br><span class="line"><span class="comment">// æˆªå–</span></span><br><span class="line">arr.length = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">//=&gt; [11, 22, 33]</span></span><br><span class="line"><span class="comment">// æ¸…ç©º</span></span><br><span class="line">arr.length = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">console</span>.log(arr); <span class="comment">//=&gt; []</span></span><br><span class="line"><span class="built_in">console</span>.log(arr[<span class="number">2</span>]); <span class="comment">//=&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="2-ç”¨å¯¹è±¡è§£æ„æ¥æ¨¡æ‹Ÿå‚æ•°å‘½å"><a href="#2-ç”¨å¯¹è±¡è§£æ„æ¥æ¨¡æ‹Ÿå‚æ•°å‘½å" class="headerlink" title="2.ç”¨å¯¹è±¡è§£æ„æ¥æ¨¡æ‹Ÿå‚æ•°å‘½å"></a>2.ç”¨å¯¹è±¡è§£æ„æ¥æ¨¡æ‹Ÿå‚æ•°å‘½å</h2><p>å½“ä½ è¦ç»™å‡½æ•°ä¼ å…¥å¸¦æœ‰ä¸€ç³»åˆ—é…ç½®çš„å‚æ•°æ—¶ï¼Œä½ å¾ˆå¯èƒ½ä¼šä½¿ç”¨é…ç½®å¯¹è±¡çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">doSomething(&#123; <span class="attr">foo</span>: <span class="string">'Hello'</span>, <span class="attr">bar</span>: <span class="string">'Hey!'</span>, <span class="attr">baz</span>: <span class="number">42</span> &#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> foo = config.foo !== <span class="literal">undefined</span> ? config.foo : <span class="string">'Hi'</span>;</span><br><span class="line">  <span class="keyword">const</span> bar = config.bar !== <span class="literal">undefined</span> ? config.bar : <span class="string">'Yo!'</span>;</span><br><span class="line">  <span class="keyword">const</span> baz = config.baz !== <span class="literal">undefined</span> ? config.baz : <span class="number">13</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ JavaScript ä¸­æ¨¡æ‹Ÿå‘½åå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªé™ˆæ—§ä½†æ˜¯å¾ˆæœ‰æ•ˆçš„æ–¹å¼ã€‚è¿™æ ·å‡½æ•°è°ƒç”¨çœ‹èµ·æ¥èˆ’æœå¤šäº†ã€‚å¦ä¸€æ–¹é¢ï¼Œé…ç½®å¯¹è±¡çš„æ§åˆ¶é€»è¾‘ä¹Ÿä¸éœ€è¦è¿™ä¹ˆå†—é•¿ï¼Œä½¿ç”¨ ES2015 çš„å¯¹è±¡è§£æ„ï¼Œå¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">&#123; foo = <span class="string">'Hi'</span>, bar = <span class="string">'Yo!'</span>, baz = <span class="number">13</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³è®©é…ç½®å¯¹è±¡æ˜¯å¯é€‰çš„ï¼Œä¹Ÿå¾ˆç®€å•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params">&#123; foo = <span class="string">'Hi'</span>, bar = <span class="string">'Yo!'</span>, baz = <span class="number">13</span> &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å¯¹æ•°ç»„ä½¿ç”¨å¯¹è±¡è§£æ„"><a href="#3-å¯¹æ•°ç»„ä½¿ç”¨å¯¹è±¡è§£æ„" class="headerlink" title="3.å¯¹æ•°ç»„ä½¿ç”¨å¯¹è±¡è§£æ„"></a>3.å¯¹æ•°ç»„ä½¿ç”¨å¯¹è±¡è§£æ„</h2><p>ä½¿ç”¨å¯¹è±¡è§£æ„æŠŠæ•°ç»„é¡¹èµ‹å€¼ç»™ç‰¹å®šçš„å˜é‡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> csvFileLine = <span class="string">'1997,John Doe,US,john@doe.com,New York'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="number">2</span>: country, <span class="number">4</span>: state &#125; = csvFileLine.split(<span class="string">','</span>);</span><br></pre></td></tr></table></figure><blockquote><p>è¯‘æ³¨ï¼šè¿™é‡ŒæŠŠæ•°ç»„ä¸‹æ ‡ä¸º 2 çš„å€¼ï¼ˆ<code>US</code>ï¼‰èµ‹ç»™å˜é‡ <code>country</code>; ä¸‹æ ‡ä¸º 4 çš„å€¼ï¼ˆ<code>New York</code>ï¼‰èµ‹ç»™å˜é‡ <code>state</code>ã€‚</p></blockquote><h2 id="4-switch-ä¸­ä½¿ç”¨èŒƒå›´"><a href="#4-switch-ä¸­ä½¿ç”¨èŒƒå›´" class="headerlink" title="4. switch ä¸­ä½¿ç”¨èŒƒå›´"></a>4. switch ä¸­ä½¿ç”¨èŒƒå›´</h2><blockquote><p>æ³¨æ„ï¼šç»è¿‡ä¸€ç•ªæ€è€ƒï¼Œæˆ‘å†³å®šæŠŠè¿™ä¸ªæŠ€å·§å’Œæ–‡ä¸­å…¶ä»–çš„åŒºåˆ«å¼€æ¥ã€‚è¿™ä¸ªå¹¶ä¸æ˜¯ä¸€ä¸ªèŠ‚çº¦æ—¶é—´çš„æŠ€å·§ï¼Œåœ¨çœŸæ­£ä»£ç ä¸­ä¹Ÿä¸é€‚åˆä½¿ç”¨ã€‚è®°ä½ï¼šè¿™ç§åœºæ™¯ä¸‹ä½¿ç”¨ <code>if</code> é€šå¸¸ä¼šæ›´å¥½ã€‚<br>å’Œæ–‡ä¸­å…¶ä»–çš„æŠ€å·§ä¸åŒï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†å¥½å¥‡è€Œä¸æ˜¯å®ç”¨ã€‚<br>æ€»ä¹‹ï¼Œç”±äºå†å²åŸå› æˆ‘ä¼šä¿ç•™è¿™ä¸ªæŠ€å·§åœ¨è¿™ç¯‡æ–‡ç« ä¸­ã€‚</p></blockquote><p>è¿™é‡Œæœ‰ä¸ªç®€å•çš„åœ¨ switch è¯­å¥ä¸­ä½¿ç”¨èŒƒå›´çš„æŠ€å·§ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWaterState</span>(<span class="params">tempInCelsius</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> (tempInCelsius &lt;= <span class="number">0</span>): </span><br><span class="line">      state = <span class="string">'Solid'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> (tempInCelsius &gt; <span class="number">0</span> &amp;&amp; tempInCelsius &lt; <span class="number">100</span>): </span><br><span class="line">      state = <span class="string">'Liquid'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      state = <span class="string">'Gas'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-ä½¿ç”¨-async-await-æ—¶ï¼Œawait-å¤šä¸ª-async-å‡½æ•°"><a href="#5-ä½¿ç”¨-async-await-æ—¶ï¼Œawait-å¤šä¸ª-async-å‡½æ•°" class="headerlink" title="5. ä½¿ç”¨ async/await æ—¶ï¼Œawait å¤šä¸ª async å‡½æ•°"></a>5. ä½¿ç”¨ <code>async/await</code> æ—¶ï¼Œ<code>await</code> å¤šä¸ª <code>async</code> å‡½æ•°</h2><p>å¯ä»¥ä½¿ç”¨ <code>Promise.all</code> æ¥ <code>await</code> å¤šä¸ª async å‡½æ•°æ‰§è¡Œå®Œæˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">Promise</span>.all([anAsyncCall(), thisIsAlsoAsync(), oneMore()])</span><br></pre></td></tr></table></figure><h2 id="6-åˆ›å»ºçº¯å¯¹è±¡"><a href="#6-åˆ›å»ºçº¯å¯¹è±¡" class="headerlink" title="6. åˆ›å»ºçº¯å¯¹è±¡"></a>6. åˆ›å»ºçº¯å¯¹è±¡</h2><p>ä½ å¯ä»¥åˆ›å»º 100% çš„çº¯å¯¹è±¡ï¼ˆpure objectï¼‰, ä¸ç»§æ‰¿ <code>Object</code> çš„ä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼ˆä¾‹å¦‚ï¼š<code>constructor</code>ã€<code>toString()</code> ç­‰ç­‰ï¼‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pureObject = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line"><span class="built_in">console</span>.log(pureObject); <span class="comment">//=&gt; &#123;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(pureObject.constructor); <span class="comment">//=&gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(pureObject.toString); <span class="comment">//=&gt; undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(pureObject.hasOwnProperty); <span class="comment">//=&gt; undefined</span></span><br></pre></td></tr></table></figure><h2 id="7-æ ¼å¼åŒ–-JSON-ä»£ç "><a href="#7-æ ¼å¼åŒ–-JSON-ä»£ç " class="headerlink" title="7. æ ¼å¼åŒ– JSON ä»£ç "></a>7. æ ¼å¼åŒ– JSON ä»£ç </h2><p><code>JSON.stringify</code> èƒ½åšçš„ä¸åªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²åŒ–å¯¹è±¡ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨å®ƒæ¥æ ¼å¼åŒ– JSON çš„è¾“å‡ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; </span><br><span class="line">  foo: &#123; <span class="attr">bar</span>: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>], <span class="attr">baz</span>: &#123; <span class="attr">bing</span>: <span class="literal">true</span>, <span class="attr">boom</span>: <span class="string">'Hello'</span> &#125; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// The third parameter is the number of spaces used to </span></span><br><span class="line"><span class="comment">// beautify the JSON output.</span></span><br><span class="line"><span class="built_in">JSON</span>.stringify(obj, <span class="literal">null</span>, <span class="number">4</span>); </span><br><span class="line"><span class="comment">// =&gt;"&#123;</span></span><br><span class="line"><span class="comment">// =&gt;    "foo": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;        "bar": [</span></span><br><span class="line"><span class="comment">// =&gt;            11,</span></span><br><span class="line"><span class="comment">// =&gt;            22,</span></span><br><span class="line"><span class="comment">// =&gt;            33,</span></span><br><span class="line"><span class="comment">// =&gt;            44</span></span><br><span class="line"><span class="comment">// =&gt;        ],</span></span><br><span class="line"><span class="comment">// =&gt;        "baz": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;            "bing": true,</span></span><br><span class="line"><span class="comment">// =&gt;            "boom": "Hello"</span></span><br><span class="line"><span class="comment">// =&gt;        &#125;</span></span><br><span class="line"><span class="comment">// =&gt;    &#125;</span></span><br><span class="line"><span class="comment">// =&gt;&#125;"</span></span><br></pre></td></tr></table></figure><h2 id="8-æ•°ç»„å»é‡"><a href="#8-æ•°ç»„å»é‡" class="headerlink" title="8. æ•°ç»„å»é‡"></a>8. æ•°ç»„å»é‡</h2><p>åªä½¿ç”¨ ES2015 çš„ <code>Set</code> å’Œå±•å¼€è¿ç®—ç¬¦ï¼Œå°±å¯ä»¥è½»æ¾å®ç°æ•°ç»„å»é‡ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> removeDuplicateItems = <span class="function"><span class="params">arr</span> =&gt;</span> [...new <span class="built_in">Set</span>(arr)];</span><br><span class="line">removeDuplicateItems([<span class="number">42</span>, <span class="string">'foo'</span>, <span class="number">42</span>, <span class="string">'foo'</span>, <span class="literal">true</span>, <span class="literal">true</span>]);</span><br><span class="line"><span class="comment">//=&gt; [42, "foo", true]</span></span><br></pre></td></tr></table></figure><h2 id="9-æ‰å¹³åŒ–å¤šç»´æ•°ç»„"><a href="#9-æ‰å¹³åŒ–å¤šç»´æ•°ç»„" class="headerlink" title="9.æ‰å¹³åŒ–å¤šç»´æ•°ç»„"></a>9.æ‰å¹³åŒ–å¤šç»´æ•°ç»„</h2><p>ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦å¯ä»¥è½»æ¾çš„æ‰å¹³åŒ–æ•°ç»„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>], [<span class="number">44</span>, <span class="number">55</span>], <span class="number">66</span>];</span><br><span class="line"><span class="keyword">const</span> flatArr = [].concat(...arr); <span class="comment">//=&gt; [11, 22, 33, 44, 55, 66]</span></span><br></pre></td></tr></table></figure><p>å¯æƒœçš„æ˜¯ï¼Œä¸Šé¢çš„è¿™ä¸ªæŠ€å·§åªå¯¹äºŒç»´æ•°ç»„æœ‰æ•ˆã€‚ä½†æ˜¯é€šè¿‡é€’å½’ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿å®ƒä¹Ÿé€‚ç”¨äºäºŒç»´ä»¥ä¸Šçš„æ•°ç»„ï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flattenArray</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> flattened = [].concat(...arr);</span><br><span class="line">  <span class="keyword">return</span> flattened.some(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">Array</span>.isArray(item)) ? </span><br><span class="line">    flattenArray(flattened) : flattened;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>], [<span class="number">44</span>, [<span class="number">55</span>, <span class="number">66</span>, [<span class="number">77</span>, [<span class="number">88</span>]], <span class="number">99</span>]]];</span><br><span class="line"><span class="keyword">const</span> flatArr = flattenArray(arr); </span><br><span class="line"><span class="comment">//=&gt; [11, 22, 33, 44, 55, 66, 77, 88, 99]</span></span><br></pre></td></tr></table></figure><p></p><p>å°±è¿™äº›å•¦ï¼å¸Œæœ›è¿™äº›ä¼˜é›…çš„å°æŠ€å·§å¯ä»¥å¸®ä½ å†™å‡ºæ›´å¥½æ›´æ¼‚äº®çš„ JavaScriptã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://medium.freecodecamp.org/9-neat-javascript-tricks-e2742f2735c3&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Learn these neat JavaScript tricks in less than 5 minutes&lt;/a&gt;&lt;br&gt;ä½œè€…ï¼šAlcides Queiroz&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2019/05/26/5ce9e86f1eff798032.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;strong&gt;5 åˆ†é’Ÿå­¦ä¹ ä¸€äº›ä¼˜é›…çš„ JavaScript æŠ€å·§ â€”â€” ä¸“ä¸šçš„çœæ—¶æŠ€å·§&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="JavaScript" scheme="https://blog.hhking.cn/tags/JavaScript/"/>
    
      <category term="ç»éªŒåˆ†äº«" scheme="https://blog.hhking.cn/tags/%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>é‡æ–°è®¤è¯† React ç”Ÿå‘½å‘¨æœŸ</title>
    <link href="https://blog.hhking.cn/2018/09/18/react-lifecycle-change/"/>
    <id>https://blog.hhking.cn/2018/09/18/react-lifecycle-change/</id>
    <published>2018-09-18T11:48:51.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>React ä» v16 å¼€å§‹ï¼Œåƒæ˜¯è·¨å…¥äº†æ–°çš„æ—¶ä»£ï¼Œæ€§èƒ½å’Œæ–°çš„ API éƒ½ä»¤äººç©ç›®ã€‚é‡æ–°è®¤è¯† Reactï¼Œä»é‡æ–°è®¤è¯†ç”Ÿå‘½å‘¨æœŸå¼€å§‹ã€‚</p><p>ä¸ºäº†æ›´å¥½çš„æ”¯æŒå¼‚æ­¥æ¸²æŸ“ï¼ˆAsync Renderingï¼‰ï¼Œè§£å†³ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ»¥ç”¨å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼ŒReact ä» V16.3 å¼€å§‹ï¼Œå¯¹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ¸è¿›å¼è°ƒæ•´ï¼ŒåŒæ—¶åœ¨å®˜æ–¹æ–‡æ¡£ä¹Ÿæä¾›äº†ä½¿ç”¨çš„æœ€ä½³å®è·µã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å°†ç®€è¦å¯¹æ¯” React æ–°æ—§ç”Ÿå‘½å‘¨æœŸï¼Œé‡æ–°è®¤è¯†ä¸€ä¸‹ React ç”Ÿå‘½å‘¨æœŸã€‚</p><a id="more"></a><h1 id="æ–°çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ–°çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ–°çš„ç”Ÿå‘½å‘¨æœŸ"></a>æ–°çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>å…ˆçœ‹çœ‹ä¸¤å¼ ç»å…¸çš„ç”Ÿå‘½å‘¨æœŸçš„ç¤ºæ„å›¾<br><img src="/images/react-life-cycle/react-life-cycle-old.png" alt="æ—§çš„ç”Ÿå‘½å‘¨æœŸ"></p><p><center>æ—§çš„ç”Ÿå‘½å‘¨æœŸ</center><br><br></p><p><img src="/images/react-life-cycle/react-life-cycle-new.jpg" alt="æ–°çš„ç”Ÿå‘½å‘¨æœŸ"></p><p><center>æ–°çš„ç”Ÿå‘½å‘¨æœŸ</center><br><br></p><p>React 16.3 æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</p><ol><li>getDerivedStateFromProps()</li><li>getSnapshotBeforeUpdate()</li></ol><p>é€æ¸åºŸå¼ƒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š</p><ol><li>componentWillMount()</li><li>componentWillReceiveProps()</li><li>componentWillUpdate()</li></ol><blockquote><p>è™½ç„¶åºŸå¼ƒäº†è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½†æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œå°†ä¼šåšæ¸è¿›å¼è°ƒæ•´ã€‚ï¼ˆè¯¦æƒ…è§<a href="https://github.com/facebook/react/pull/12028" target="_blank" rel="noopener">#12028</a>ï¼‰<br>V16.3 å¹¶æœªåˆ é™¤è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶è¿˜ä¸ºå®ƒä»¬æ–°å¢ä»¥ UNSAFE_ å‰ç¼€ä¸ºåˆ«åçš„ä¸‰ä¸ªå‡½æ•° <code>UNSAFE_componentWillMount()</code>ã€<code>UNSAFE_componentWillReceiveProps()</code>ã€<code>UNSAFE_componentWillUpdate()</code>ã€‚<br>åœ¨ 16.4 ç‰ˆæœ¬ç»™å‡ºè­¦å‘Šå°†ä¼šå¼ƒç”¨ <code>componentWillMount()</code>ã€<code>componentWillReceiveProps()</code>ã€<code>componentWillUpdate()</code> ä¸‰ä¸ªå‡½æ•°<br>ç„¶ååœ¨ 17 ç‰ˆæœ¬å°†ä¼šåˆ é™¤ <code>componentWillMount()</code>ã€<code>componentWillReceiveProps()</code>ã€<code>componentWillUpdate()</code> è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œä¼šä¿ç•™ä½¿ç”¨ <code>UNSAFE_componentWillMount()</code>ã€<code>UNSAFE_componentWillReceiveProps()</code>ã€<code>UNSAFE_componentWillUpdate()</code></p></blockquote><p>ä¸€èˆ¬å°†ç”Ÿå‘½å‘¨æœŸåˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li>åˆ›å»ºé˜¶æ®µï¼ˆMountingï¼‰</li><li>æ›´æ–°é˜¶æ®µï¼ˆUpdatingï¼‰</li><li>å¸è½½é˜¶æ®µï¼ˆUnmountingï¼‰</li></ol><p>ä» React v16 å¼€å§‹ï¼Œè¿˜å¯¹ç”Ÿå‘½å‘¨æœŸåŠ å…¥äº†é”™è¯¯å¤„ç†ï¼ˆError Handlingï¼‰ã€‚</p><p>ä¸‹é¢åˆ†æä¸€ä¸‹ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µã€‚</p><h2 id="åˆ›å»ºé˜¶æ®µ-Mounting"><a href="#åˆ›å»ºé˜¶æ®µ-Mounting" class="headerlink" title="åˆ›å»ºé˜¶æ®µ Mounting"></a>åˆ›å»ºé˜¶æ®µ Mounting</h2><p>ç»„ä»¶å®ä¾‹åˆ›å»ºå¹¶æ’å…¥ DOM æ—¶ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li>constructor()</li><li>static getDerivedStateFromProps()</li><li><del>componentWillMount()/UNSAFE_componentWillMount()</del>ï¼ˆbeing deprecatedï¼‰</li><li>render()</li><li>componentDidMount()</li></ul><blockquote><p>æœ‰å®šä¹‰ <code>getDerivedStateFromProps</code> æ—¶ï¼Œä¼šå¿½ç•¥ <code>componentWillMount()/UNSAFE_componentWillMount()</code><br>ï¼ˆ<a href="https://github.com/facebook/react/blob/master/packages/react-dom/src/server/ReactPartialRenderer.js" target="_blank" rel="noopener">è¯¦æƒ…æŸ¥çœ‹æºç </a>ï¼‰</p></blockquote><h3 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor()"></a>constructor()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props)</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°é€šå¸¸ç”¨äºï¼š</p><ul><li>ä½¿ç”¨ <code>this.state</code> æ¥åˆå§‹åŒ– <code>state</code></li><li>ç»™äº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®š <code>this</code></li></ul><blockquote><p>æ³¨æ„ï¼šES6 å­ç±»çš„æ„é€ å‡½æ•°å¿…é¡»æ‰§è¡Œä¸€æ¬¡ super()ã€‚React å¦‚æœæ„é€ å‡½æ•°ä¸­è¦ä½¿ç”¨ this.propsï¼Œå¿…é¡»å…ˆæ‰§è¡Œ super(props)ã€‚</p></blockquote><h3 id="static-getDerivedStateFromProps"><a href="#static-getDerivedStateFromProps" class="headerlink" title="static getDerivedStateFromProps()"></a>static getDerivedStateFromProps()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> getDerivedStateFromProps(nextProps, prevState)</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºæ—¶ã€æ¥æ”¶æ–°çš„ props æ—¶ã€setState æ—¶ã€forceUpdate æ—¶ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p><blockquote><p>æ³¨æ„ï¼šv16.3 setState æ—¶ã€forceUpdate æ—¶ä¸ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œv16.4 ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><p>è¿™æ˜¯ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/static" target="_blank" rel="noopener">é™æ€æ–¹æ³•</a>ï¼Œå‚æ•° <code>nextProps</code> æ˜¯æ–°æ¥æ”¶çš„ <code>props</code>ï¼Œ<code>prevState</code> æ˜¯å½“å‰çš„ <code>state</code>ã€‚è¿”å›å€¼ï¼ˆå¯¹è±¡ï¼‰å°†ç”¨äºæ›´æ–° <code>state</code>ï¼Œå¦‚æœä¸éœ€è¦æ›´æ–°åˆ™éœ€è¦è¿”å› <code>null</code>ã€‚</p><p>ä¸‹é¢æ˜¯å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¾‹å­<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Initialize state in constructor,</span></span><br><span class="line">  <span class="comment">// Or with a property initializer.</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    isScrollingDown: <span class="literal">false</span>,</span><br><span class="line">    lastRow: <span class="literal">null</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromProps(props, state) &#123;</span><br><span class="line">    <span class="keyword">if</span> (props.currentRow !== state.lastRow) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        isScrollingDown: props.currentRow &gt; state.lastRow,</span><br><span class="line">        lastRow: props.currentRow,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return null to indicate no change to state.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ªæ–¹æ³•çš„å¸¸ç”¨ä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾äº†ï¼šçˆ¶ç»„ä»¶ä¼ å…¥æ–°çš„ <code>props</code> æ—¶ï¼Œç”¨æ¥å’Œå½“å‰çš„ <code>state</code> å¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–° <code>state</code>ã€‚ä»¥å‰ä¸€èˆ¬ä½¿ç”¨ <code>componentWillReceiveProps</code> åšè¿™ä¸ªæ“ä½œã€‚</p><p>è¿™ä¸ªæ–¹æ³•åœ¨å»ºè®®å°½é‡å°‘ç”¨ï¼Œåªåœ¨å¿…è¦çš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ol><li>æ— æ¡ä»¶çš„æ ¹æ® <code>props</code> æ›´æ–° <code>state</code></li><li>å½“ <code>props</code> å’Œ <code>state</code> çš„ä¸åŒ¹é…æƒ…å†µæ›´æ–° <code>state</code></li></ol><p>è¯¦æƒ…å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£çš„æœ€ä½³å®è·µ <a href="http://react.css88.com/blog/2018/06/07/you-probably-dont-need-derived-state.html#what-about-memoization" target="_blank" rel="noopener">You Probably Donâ€™t Need Derived State</a></p><h3 id="componentWillMount-UNSAFE-componentWillMount-ï¼ˆå¼ƒç”¨ï¼‰"><a href="#componentWillMount-UNSAFE-componentWillMount-ï¼ˆå¼ƒç”¨ï¼‰" class="headerlink" title="componentWillMount()/UNSAFE_componentWillMount()ï¼ˆå¼ƒç”¨ï¼‰"></a>componentWillMount()/UNSAFE_componentWillMount()ï¼ˆå¼ƒç”¨ï¼‰</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNSAFE_componentWillMount()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å·²ç»ä¸æ¨èä½¿ç”¨ã€‚å› ä¸ºåœ¨æœªæ¥å¼‚æ­¥æ¸²æŸ“æœºåˆ¶ä¸‹ï¼Œè¯¥æ–¹æ³•å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ã€‚å®ƒæ‰€è¡Œä½¿çš„åŠŸèƒ½ä¹Ÿå¯ä»¥ç”± <code>componentDidMount()</code> å’Œ <code>constructor()</code> ä»£æ›¿ï¼š</p><ul><li>ä¹‹å‰æœ‰äº›äººä¼šæŠŠå¼‚æ­¥è¯·æ±‚æ”¾åœ¨è¿™ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå…¶å®å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ¨èæŠŠå¼‚æ­¥æ•°æ®è¯·æ±‚æ”¾åœ¨ <code>componentDidMount()</code> ä¸­ã€‚</li><li>åœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ <code>componentWillMount()</code> è·å–å¿…è¦çš„åŒæ­¥æ•°æ®ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ <code>constructor()</code> ä»£æ›¿å®ƒã€‚</li></ul><p><strong>å¯ä»¥ä½¿ç”¨ setStateï¼Œä¸ä¼šè§¦å‘ re-render</strong></p><h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render()</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªç±»ç»„ä»¶ä¸­ï¼Œ<code>render()</code> å”¯ä¸€å¿…é¡»çš„æ–¹æ³•ã€‚</p><p><code>render()</code> æ­£å¦‚å…¶åï¼Œä½œä¸ºæ¸²æŸ“ç”¨ï¼Œå¯ä»¥è¿”å›ä¸‹é¢å‡ ç§ç±»å‹ï¼š</p><ul><li>React å…ƒç´ ï¼ˆReact elementsï¼‰</li><li>æ•°ç»„ï¼ˆArraysï¼‰</li><li>ç‰‡æ®µï¼ˆfragmentsï¼‰</li><li>æ’æ§½ï¼ˆPortalsï¼‰</li><li>å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼ˆString and numbersï¼‰</li><li>å¸ƒå°”å€¼æˆ– nullï¼ˆBooleans or nullï¼‰</li></ul><blockquote><p>æ³¨æ„ï¼š<br>Arrays å’Œ String æ˜¯ v16.0.0 æ–°å¢ã€‚<br>fragments æ˜¯ v16.2.0 æ–°å¢ã€‚<br>Portals æ˜¯ V16.0.0 æ–°å¢ã€‚</p></blockquote><p>é‡Œé¢ä¸åº”è¯¥åŒ…å«å‰¯ä½œç”¨ï¼Œåº”è¯¥ä½œä¸ºçº¯å‡½æ•°ã€‚</p><p><strong>ä¸èƒ½ä½¿ç”¨ setStateã€‚</strong></p><h3 id="componentDidMount"><a href="#componentDidMount" class="headerlink" title="componentDidMount()"></a>componentDidMount()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()</span><br></pre></td></tr></table></figure><p>ç»„ä»¶å®Œæˆè£…è½½ï¼ˆå·²ç»æ’å…¥ DOM æ ‘ï¼‰æ—¶ï¼Œè§¦å‘è¯¥æ–¹æ³•ã€‚è¿™ä¸ªé˜¶æ®µå·²ç»è·å–åˆ°çœŸå®çš„ DOMã€‚</p><p>ä¸€èˆ¬ç”¨äºä¸‹é¢çš„åœºæ™¯ï¼š</p><ul><li>å¼‚æ­¥è¯·æ±‚ ajax</li><li>æ·»åŠ äº‹ä»¶ç»‘å®šï¼ˆæ³¨æ„åœ¨ <code>componentWillUnmount</code> ä¸­å–æ¶ˆï¼Œä»¥å…é€ æˆå†…å­˜æ³„æ¼ï¼‰</li></ul><p><strong>å¯ä»¥ä½¿ç”¨ setStateï¼Œè§¦å‘re-renderï¼Œå½±å“æ€§èƒ½ã€‚</strong></p><h2 id="æ›´æ–°é˜¶æ®µ-Updating"><a href="#æ›´æ–°é˜¶æ®µ-Updating" class="headerlink" title="æ›´æ–°é˜¶æ®µ Updating"></a>æ›´æ–°é˜¶æ®µ Updating</h2><ul><li><del>componentWillReceiveProps()/UNSAFE_componentWillReceiveProps()</del>ï¼ˆbeing deprecatedï¼‰</li><li>static getDerivedStateFromProps()</li><li>shouldComponentUpdate()</li><li><del>componentWillUpdate()/UNSAFE_componentWillUpdate()</del>ï¼ˆbeing deprecatedï¼‰</li><li>render()</li><li>getSnapshotBeforeUpdate()</li><li>componentDidUpdate()</li></ul><blockquote><p>æœ‰ <code>getDerivedStateFromProps</code> æˆ–è€… <code>getSnapshotBeforeUpdate</code> æ—¶ï¼Œ<code>componentWillReceiveProps()/UNSAFE_componentWillReceiveProps()</code> å’Œ <code>componentWillUpdate()/UNSAFE_componentWillUpdate()</code> ä¸ä¼šæ‰§è¡Œ ï¼ˆ<a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberClassComponent.js" target="_blank" rel="noopener">è¯¦æƒ…æŸ¥çœ‹æºç </a>ï¼‰</p></blockquote><h3 id="componentWillReceiveProps-UNSAFE-componentWillReceiveProps-ï¼ˆå¼ƒç”¨ï¼‰"><a href="#componentWillReceiveProps-UNSAFE-componentWillReceiveProps-ï¼ˆå¼ƒç”¨ï¼‰" class="headerlink" title="componentWillReceiveProps()/UNSAFE_componentWillReceiveProps()ï¼ˆå¼ƒç”¨ï¼‰"></a>componentWillReceiveProps()/UNSAFE_componentWillReceiveProps()ï¼ˆå¼ƒç”¨ï¼‰</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNSAFE_componentWillReceiveProps(nextProps)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•åœ¨æ¥æ”¶æ–°çš„ props æ—¶è°ƒç”¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœçˆ¶ç»„ä»¶å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿ props æ²¡æœ‰æ›´æ”¹ï¼Œä¹Ÿä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><p>ä¸€èˆ¬ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆ¤æ–­ props çš„å‰åå˜åŒ–æ¥æ›´æ–° <code>state</code>ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    isScrollingDown: <span class="literal">false</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.currentRow !== nextProps.currentRow) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        isScrollingDown:</span><br><span class="line">          nextProps.currentRow &gt; <span class="keyword">this</span>.props.currentRow,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å°†è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ <code>getDerivedStateFromProps</code> ä»£æ›¿ã€‚</p><p><strong>å¯ä»¥ä½¿ç”¨ setState</strong></p><h3 id="static-getDerivedStateFromProps-1"><a href="#static-getDerivedStateFromProps-1" class="headerlink" title="static getDerivedStateFromProps()"></a>static getDerivedStateFromProps()</h3><p>åŒ Mounting æ—¶æ‰€è¿°ä¸€è‡´ã€‚</p><h3 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate()"></a>shouldComponentUpdate()</h3><p>åœ¨æ¥æ”¶æ–°çš„ <code>props</code> æˆ–æ–°çš„ <code>state</code> æ—¶ï¼Œåœ¨æ¸²æŸ“å‰ä¼šè§¦å‘è¯¥æ–¹æ³•ã€‚</p><p>è¯¥æ–¹æ³•é€šè¿‡è¿”å› <code>true</code> æˆ–è€… <code>false</code> æ¥ç¡®å®šæ˜¯å¦éœ€è¦è§¦å‘æ–°çš„æ¸²æŸ“ã€‚è¿”å› <code>false</code>ï¼Œ åˆ™ä¸ä¼šè§¦å‘åç»­çš„ <code>UNSAFE_componentWillUpdate()</code>ã€<code>render()</code> å’Œ <code>componentDidUpdate()</code>ï¼ˆä½†æ˜¯ <code>state</code> å˜åŒ–è¿˜æ˜¯å¯èƒ½å¼•èµ·å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼‰ã€‚</p><p>æ‰€ä»¥é€šå¸¸é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯¹ <code>props</code> å’Œ <code>state</code> åšæ¯”è¾ƒï¼Œä»è€Œé¿å…ä¸€äº›ä¸å¿…è¦çš„æ¸²æŸ“ã€‚</p><blockquote><p>PureComponent çš„åŸç†å°±æ˜¯å¯¹ <code>props</code> å’Œ <code>state</code> è¿›è¡Œæµ…å¯¹æ¯”ï¼ˆshallow comparisonï¼‰ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è§¦å‘æ¸²æŸ“ã€‚</p></blockquote><h3 id="componentWillUpdate-UNSAFE-componentWillUpdate-ï¼ˆå¼ƒç”¨ï¼‰"><a href="#componentWillUpdate-UNSAFE-componentWillUpdate-ï¼ˆå¼ƒç”¨ï¼‰" class="headerlink" title="componentWillUpdate()/UNSAFE_componentWillUpdate() ï¼ˆå¼ƒç”¨ï¼‰"></a>componentWillUpdate()/UNSAFE_componentWillUpdate() ï¼ˆå¼ƒç”¨ï¼‰</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UNSAFE_componentWillUpdate(nextProps, nextState)</span><br></pre></td></tr></table></figure><p>å½“æ¥æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼Œåœ¨æ¸²æŸ“å‰æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p><p>åœ¨ä»¥åå¼‚æ­¥æ¸²æŸ“æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æŸäº›ç»„ä»¶æš‚ç¼“æ›´æ–°ï¼Œå¯¼è‡´ <code>componentWillUpdate</code> å’Œ <code>componentDidUpdate</code> ä¹‹é—´çš„æ—¶é—´å˜é•¿ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿä¸€äº›å˜åŒ–ï¼Œæ¯”å¦‚ç”¨æˆ·è¡Œä¸ºå¯¼è‡´ DOM å‘ç”Ÿäº†æ–°çš„å˜åŒ–ï¼Œè¿™æ—¶åœ¨ <code>componentWillUpdate</code> è·å–çš„ä¿¡æ¯å¯èƒ½å°±ä¸å¯é äº†ã€‚</p><p><strong>ä¸èƒ½ä½¿ç”¨ setState</strong></p><h3 id="render-1"><a href="#render-1" class="headerlink" title="render()"></a>render()</h3><p>åŒ Mounting æ—¶æ‰€è¿°ä¸€è‡´ã€‚</p><h3 id="getSnapshotBeforeUpdate"><a href="#getSnapshotBeforeUpdate" class="headerlink" title="getSnapshotBeforeUpdate()"></a>getSnapshotBeforeUpdate()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getSnapShotBeforeUpdate(prevProps, prevState)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•åœ¨ <code>render()</code> ä¹‹åï¼Œ<code>componentDidUpdate()</code> ä¹‹å‰è°ƒç”¨ã€‚</p><p>ä¸¤ä¸ªå‚æ•° <code>prevProps</code> è¡¨ç¤ºæ›´æ–°å‰çš„ <code>props</code>ï¼Œ<code>prevState</code> è¡¨ç¤ºæ›´æ–°å‰çš„ <code>state</code>ã€‚</p><p>è¿”å›å€¼ç§°ä¸ºä¸€ä¸ªå¿«ç…§ï¼ˆsnapshotï¼‰ï¼Œå¦‚æœä¸éœ€è¦ snapshotï¼Œåˆ™å¿…é¡»æ˜¾ç¤ºçš„è¿”å› <code>null</code> â€”â€” å› ä¸ºè¿”å›å€¼å°†ä½œä¸º <code>componentDidUpdate()</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä½¿ç”¨ã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°å¿…é¡»è¦é…åˆ <code>componentDidUpdate()</code> ä¸€èµ·ä½¿ç”¨ã€‚</p><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åœ¨çœŸå® DOM æ›´æ–°ï¼ˆ<code>componentDidUpdate</code>ï¼‰å‰ï¼Œè·å–ä¸€äº›éœ€è¦çš„ä¿¡æ¯ï¼ˆç±»ä¼¼å¿«ç…§åŠŸèƒ½ï¼‰ï¼Œç„¶åä½œä¸ºå‚æ•°ä¼ ç»™ <code>componentDidUpdate</code>ã€‚ä¾‹å¦‚ï¼šåœ¨ <code>getSnapShotBeforeUpdate</code> ä¸­è·å–æ»šåŠ¨ä½ç½®ï¼Œç„¶åä½œä¸ºå‚æ•°ä¼ ç»™ <code>componentDidUpdate</code>ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨æ¸²æŸ“çœŸå®çš„ DOM æ—¶å°±æ»šåŠ¨åˆ°éœ€è¦çš„ä½ç½®ã€‚</p><p>ä¸‹é¢æ˜¯å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¾‹å­ï¼š<br></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScrollingList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.listRef = React.createRef();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  getSnapshotBeforeUpdate(prevProps, prevState) &#123;</span><br><span class="line">    <span class="comment">// Are we adding new items to the list?</span></span><br><span class="line">    <span class="comment">// Capture the scroll position so we can adjust scroll later.</span></span><br><span class="line">    <span class="keyword">if</span> (prevProps.list.length &lt; <span class="keyword">this</span>.props.list.length) &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">this</span>.listRef.current;</span><br><span class="line">      <span class="keyword">return</span> list.scrollHeight - list.scrollTop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(prevProps, prevState, snapshot) &#123;</span><br><span class="line">    <span class="comment">// If we have a snapshot value, we've just added new items.</span></span><br><span class="line">    <span class="comment">// Adjust scroll so these new items don't push the old ones out of view.</span></span><br><span class="line">    <span class="comment">// (snapshot here is the value returned from getSnapshotBeforeUpdate)</span></span><br><span class="line">    <span class="keyword">if</span> (snapshot !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> list = <span class="keyword">this</span>.listRef.current;</span><br><span class="line">      list.scrollTop = list.scrollHeight - snapshot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div ref=&#123;<span class="keyword">this</span>.listRef&#125;&gt;&#123;<span class="comment">/* ...contents... */</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><h3 id="componentDidUpdate"><a href="#componentDidUpdate" class="headerlink" title="componentDidUpdate()"></a>componentDidUpdate()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps, prevState, snapshot)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æ›´æ–°å®Œæˆä¹‹åè°ƒç”¨ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° <code>snapshot</code> å°±æ˜¯ <code>getSnapshotBeforeUpdate</code> çš„è¿”å›å€¼ã€‚</p><p>æ­£å¦‚å‰é¢æ‰€è¯´ï¼Œæœ‰ <code>getSnapshotBeforeUpdate</code> æ—¶ï¼Œå¿…é¡»è¦æœ‰ <code>componentDidUpdate</code>ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ³•çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯å°±æ˜¯ä¸Šé¢çœ‹åˆ°çš„ä¾‹å­ï¼Œé…åˆ <code>getSnapshotBeforeUpdate</code> ä½¿ç”¨ã€‚</p><p><strong>å¯ä»¥ä½¿ç”¨ setStateï¼Œä¼šè§¦å‘ re-renderï¼Œæ‰€ä»¥è¦æ³¨æ„åˆ¤æ–­ï¼Œé¿å…å¯¼è‡´æ­»å¾ªç¯ã€‚</strong></p><h2 id="å¸è½½é˜¶æ®µ-Unmounting"><a href="#å¸è½½é˜¶æ®µ-Unmounting" class="headerlink" title="å¸è½½é˜¶æ®µ Unmounting"></a>å¸è½½é˜¶æ®µ Unmounting</h2><ul><li>componentWillUnmount()</li></ul><h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">componentWillUnmount()</span><br></pre></td></tr></table></figure><p>åœ¨ç»„ä»¶å¸è½½æˆ–è€…é”€æ¯å‰è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚ï¼š</p><ul><li>å–æ¶ˆå®šæ—¶å™¨</li><li>å–æ¶ˆäº‹ä»¶ç»‘å®š</li><li>å–æ¶ˆç½‘ç»œè¯·æ±‚</li></ul><p><strong>ä¸èƒ½ä½¿ç”¨ setState</strong></p><h2 id="é”™è¯¯å¤„ç†-Error-Handling"><a href="#é”™è¯¯å¤„ç†-Error-Handling" class="headerlink" title="é”™è¯¯å¤„ç† Error Handling"></a>é”™è¯¯å¤„ç† Error Handling</h2><ul><li>componentDidCatch()</li></ul><h3 id="componentDidCatch"><a href="#componentDidCatch" class="headerlink" title="componentDidCatch()"></a>componentDidCatch()</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">componentDidCatch(err, info)</span><br></pre></td></tr></table></figure><p>ä»»ä½•å­ç»„ä»¶åœ¨æ¸²æŸ“æœŸé—´ï¼Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æˆ–è€…æ„é€ å‡½æ•° constructor å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ã€‚</p><p>é”™è¯¯è¾¹ç•Œä¸ä¼šæ•è·ä¸‹é¢çš„é”™è¯¯ï¼š</p><ul><li>äº‹ä»¶å¤„ç† (Event handlers) ï¼ˆå› ä¸ºäº‹ä»¶å¤„ç†ä¸å‘ç”Ÿåœ¨ React æ¸²æŸ“æ—¶ï¼ŒæŠ¥é”™ä¸å½±å“æ¸²æŸ“ï¼‰</li><li>å¼‚æ­¥ä»£ç  (Asynchronous code) (e.g. setTimeout or requestAnimationFrame callbacks)</li><li>æœåŠ¡ç«¯æ¸²æŸ“ (Server side rendering)</li><li>é”™è¯¯è¾¹ç•Œæœ¬èº«(è€Œä¸æ˜¯å­ç»„ä»¶)æŠ›å‡ºçš„é”™è¯¯</li></ul><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>React ç”Ÿå‘½å‘¨æœŸå¯ä»¥æŸ¥çœ‹ <a href="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" target="_blank" rel="noopener">ç”Ÿå‘½å‘¨æœŸå›¾</a></p><p>è™½ç„¶ React æœ‰åšå‘ä¸‹å…¼å®¹ï¼Œä½†æ˜¯æ¨èå°½é‡é¿å…ä½¿ç”¨åºŸå¼ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œæ˜¯æ‹¥æŠ±æœªæ¥ï¼Œç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸæ›¿æ¢å®ƒä»¬ã€‚</p><p>å¦‚æœä½ ä¸æƒ³å‡çº§ Reactï¼Œä½†æ˜¯æƒ³ç”¨æ–°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½¿ç”¨ <a href="https://github.com/reactjs/react-lifecycles-compat" target="_blank" rel="noopener">react-lifecycles-compat</a> polyfillï¼Œå¯ä»¥ä¸ºä½ç‰ˆæœ¬çš„ Reactï¼ˆ0.14.9+ï¼‰æä¾›æ–°çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚</p><blockquote><p>å‚è€ƒï¼š<br><a href="https://reactjs.org/docs/react-component.html" target="_blank" rel="noopener">React.Component</a><br><a href="http://react.css88.com/blog/2018/03/27/update-on-async-rendering.html" target="_blank" rel="noopener">Update on Async Rendering</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;React ä» v16 å¼€å§‹ï¼Œåƒæ˜¯è·¨å…¥äº†æ–°çš„æ—¶ä»£ï¼Œæ€§èƒ½å’Œæ–°çš„ API éƒ½ä»¤äººç©ç›®ã€‚é‡æ–°è®¤è¯† Reactï¼Œä»é‡æ–°è®¤è¯†ç”Ÿå‘½å‘¨æœŸå¼€å§‹ã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†æ›´å¥½çš„æ”¯æŒå¼‚æ­¥æ¸²æŸ“ï¼ˆAsync Renderingï¼‰ï¼Œè§£å†³ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ»¥ç”¨å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼ŒReact ä» V16.3 å¼€å§‹ï¼Œå¯¹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ¸è¿›å¼è°ƒæ•´ï¼ŒåŒæ—¶åœ¨å®˜æ–¹æ–‡æ¡£ä¹Ÿæä¾›äº†ä½¿ç”¨çš„æœ€ä½³å®è·µã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å°†ç®€è¦å¯¹æ¯” React æ–°æ—§ç”Ÿå‘½å‘¨æœŸï¼Œé‡æ–°è®¤è¯†ä¸€ä¸‹ React ç”Ÿå‘½å‘¨æœŸã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://blog.hhking.cn/categories/%E5%89%8D%E7%AB%AF/React/"/>
    
    
      <category term="React" scheme="https://blog.hhking.cn/tags/React/"/>
    
      <category term="ç”Ÿå‘½å‘¨æœŸ" scheme="https://blog.hhking.cn/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘] ä½¿ç”¨ React ä¸€å¹´åï¼Œæˆ‘å­¦åˆ°çš„æœ€é‡è¦ç»éªŒ</title>
    <link href="https://blog.hhking.cn/2018/09/12/mindset-lessons-from-a-year-with-react/"/>
    <id>https://blog.hhking.cn/2018/09/12/mindset-lessons-from-a-year-with-react/</id>
    <published>2018-09-12T12:27:23.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡ï¼š<a href="https://medium.freecodecamp.org/mindset-lessons-from-a-year-with-react-1de862421981" target="_blank" rel="noopener">The most important lessons Iâ€™ve learned after a year of working with<br>React</a><br>ä½œè€…ï¼šTomas Eglinskas</p></blockquote><p><img src="https://cdn-images-1.medium.com/max/2000/1*TheYckj9udF4qLjoJW8sjg.png" alt="images"></p><center>No, I didnâ€™t wrote that, but I know it got your attention ğŸ”ª</center><p><br></p><p>å¼€å§‹å­¦ä¹ ä¸€é¡¹æ–°çš„æŠ€æœ¯æ—¶å€™ä»¤äººå¾ˆè‹¦æ¼ã€‚ä½ ç»å¸¸å‘ç°è‡ªå·±å¤„äºæ•™ç¨‹å’Œæ–‡ç« çš„æµ·æ´‹é‡Œï¼Œè¿˜ä¼´éšç€æ— æ•°çš„ä¸ªäººè§‚ç‚¹ã€‚å¹¶ä¸”æ¯ä¸ªäººéƒ½å£°ç§°ä»–ä»¬æ‰¾åˆ°äº†â€œæ­£ç¡®è€Œå®Œç¾çš„æ–¹å¼â€ã€‚</p><a id="more"></a><p>è¿™è®©æˆ‘ä»¬éœ€è¦å»è¾¨åˆ«ï¼šæˆ‘ä»¬é€‰æ‹©çš„æ•™ç¨‹æ˜¯å¦ä¼šæµªè´¹æ—¶é—´ã€‚</p><p>åœ¨æ½œå…¥è¿™ç‰‡æµ·æ´‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦ç†è§£è¯¥æŠ€æœ¯çš„åŸºæœ¬æ¦‚å¿µã€‚ç„¶åæˆ‘ä»¬éœ€è¦å»ºç«‹åŸºäºæŠ€æœ¯çš„æ€ç»´æ¨¡å¼ã€‚å¦‚æœæˆ‘ä»¬å¼€å§‹å­¦ä¹  Reactï¼Œæˆ‘ä»¬é¦–å…ˆè¦ä»¥ React çš„æ–¹å¼å»æ€è€ƒã€‚åé¢æˆ‘ä»¬æ‰å¯ä»¥å¼€å§‹å°†å„ç§æ€ç»´æ¨¡å¼èä¸ºä¸€ä½“ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å°†ä»ä¸ªäººä½¿ç”¨ React çš„ç»å†æ¥ä»‹ç»ä»ä¸­å­¦åˆ°çš„ä¸€äº›å…³äºè¿™ç§æ€ç»´çš„ç»éªŒã€‚æˆ‘ä»¬å°†å›é¡¾å·¥ä½œæ—¶é—´å’Œåšä¸ªäººé¡¹ç›®çš„å¤œæ™šï¼Œç”šè‡³æˆ‘åœ¨æœ¬åœ° JavaScript æ´»åŠ¨ä¸­çš„æ¼”è®²ã€‚</p><p>æˆ‘ä»¬å¼€å§‹å§ï¼</p><h2 id="React-åœ¨ä¸æ–­å‘å±•ï¼Œä½ éœ€è¦ä¸æ—¶ä¿±è¿›"><a href="#React-åœ¨ä¸æ–­å‘å±•ï¼Œä½ éœ€è¦ä¸æ—¶ä¿±è¿›" class="headerlink" title="React åœ¨ä¸æ–­å‘å±•ï¼Œä½ éœ€è¦ä¸æ—¶ä¿±è¿›"></a>React åœ¨ä¸æ–­å‘å±•ï¼Œä½ éœ€è¦ä¸æ—¶ä¿±è¿›</h2><p>å¦‚æœä½ è®°å¾— 16.3.0 ç‰ˆæœ¬çš„é¦–æ¬¡å…¬å‘Šï¼Œä½ ä¼šæƒ³èµ·å½“æ—¶å¤§å®¶æ˜¯å¤šä¹ˆçš„æ¿€åŠ¨ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ä¸€äº›å˜åŒ–å’Œæå‡ï¼š</p><ul><li>Official Context API</li><li>createRef API</li><li>forwardRef API</li><li>StrictMode</li><li>Component Lifecycle Changes</li></ul><p>React çš„æ ¸å¿ƒå›¢é˜Ÿå’Œæ‰€æœ‰çš„è´¡çŒ®è€…æ­£åœ¨åšç€ä¼Ÿå¤§çš„å·¥ä½œ â€”â€” åŠªåŠ›æ”¹è¿›æˆ‘ä»¬æ‰€å–œçˆ±çš„æŠ€æœ¯ã€‚åœ¨ 16.4.0 ç‰ˆæœ¬æˆ‘ä»¬çœ‹åˆ°äº† <a href="https://reactjs.org/blog/2018/05/23/react-v-16-4.html" target="_blank" rel="noopener">Pointer Events</a>ã€‚</p><p>æ¯«æ— ç–‘é—®æ›´å¤šçš„å˜åŒ–å°†ä¼šæ¥ä¸´ï¼Œè¿™åªæ˜¯æ—¶é—´é—®é¢˜ï¼šå¼‚æ­¥æ¸²æŸ“ (Async Rendering)ã€ç¼“å­˜ (Caching) ã€version 17.0.0 ä»¥åŠå…¶ä»–æœªçŸ¥çš„ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³æˆä¸ºä½¼ä½¼è€…ï¼Œä½ å¿…é¡»ç´§è·Ÿç€ç¤¾åŒºé‡Œå˜åŒ–çš„è„šæ­¥ã€‚</p><p><strong><code>äº†è§£äº‹ç‰©çš„å·¥ä½œåŸç†ï¼Œä»¥åŠè¢«å¼€å‘å‡ºæ¥çš„åŸå› ã€‚äº†è§£æ­£åœ¨è§£å†³çš„é—®é¢˜ï¼Œä»¥åŠå¼€å‘æ˜¯å¦‚ä½•å˜å¾—è¶Šæ¥è¶Šç®€å•ã€‚è¿™ä¼šè®©ä½ å—ç›ŠåŒªæµ…ã€‚</code></strong></p><h2 id="ä¸è¦å®³æ€•æŠŠä½ çš„ä»£ç æ‹†åˆ†æˆæ›´å°çš„å—"><a href="#ä¸è¦å®³æ€•æŠŠä½ çš„ä»£ç æ‹†åˆ†æˆæ›´å°çš„å—" class="headerlink" title="ä¸è¦å®³æ€•æŠŠä½ çš„ä»£ç æ‹†åˆ†æˆæ›´å°çš„å—"></a>ä¸è¦å®³æ€•æŠŠä½ çš„ä»£ç æ‹†åˆ†æˆæ›´å°çš„å—</h2><p>React æ˜¯åŸºäºç»„ä»¶çš„ã€‚æ‰€ä»¥ä½ åº”è¯¥åˆ©ç”¨è¿™ä¸ªæ¦‚å¿µï¼Œè€Œä¸æ˜¯å®³æ€•æŠŠå¤§çš„æ¨¡å—æ‹†åˆ†æ›´å°çš„æ¨¡å—ã€‚</p><p>æœ‰æ—¶å€™ï¼Œä¸€ä¸ªç®€å•çš„ç»„ä»¶å¯èƒ½åªæœ‰ 4-5 è¡Œä»£ç ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚</p><p>è¿™æ ·åšï¼Œå¯ä»¥è®©æ–°äººåŠ å…¥æ—¶ï¼Œä¸éœ€è¦èŠ±å‡ å¤©çš„æ—¶é—´å»ç†è§£è¿™äº›ä»£ç æ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// isn't this easy to understand?</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  [</span><br><span class="line">   &lt;ChangeButton</span><br><span class="line">    onClick=&#123;<span class="keyword">this</span>.changeUserApprovalStatus&#125;</span><br><span class="line">    text=<span class="string">"Letâ€™s switch it!"</span></span><br><span class="line">   /&gt;,</span><br><span class="line">   &lt;UserInformation status=&#123;status&#125;/&gt; </span><br><span class="line">  ]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä½ ä¸å¿…è®©ç»„ä»¶éƒ½åŒ…å«å¤æ‚çš„é€»è¾‘ã€‚å®ƒä»¬å¯ä»¥åªå½“è§†è§‰ç»„ä»¶ã€‚å¦‚æœè¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ–¹ä¾¿æµ‹è¯•ï¼Œå¹¶å‡å°‘ä»£ç çš„â€œåå‘³é“â€ï¼Œé‚£ä¹ˆå¯¹å›¢é˜Ÿçš„æ¯ä¸ªäººæ¥è¯´éƒ½æ˜¯ä¸ªä¼Ÿå¤§çš„èƒœåˆ©ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ErrorMessage <span class="keyword">from</span> <span class="string">'./ErrorMessage'</span>;</span><br><span class="line"><span class="keyword">const</span> NotFound = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;ErrorMessage</span><br><span class="line">    title=<span class="string">"Oops! Page not found."</span></span><br><span class="line">    message=<span class="string">"The page you are looking for does not exist!"</span></span><br><span class="line">    className=<span class="string">"test_404-page"</span></span><br><span class="line">  /&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå±æ€§éƒ½æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰ä¸ªçº¯ç»„ä»¶æ§åˆ¶ç½‘ç«™çš„é”™è¯¯ä¿¡æ¯ <code>Not Found</code>ï¼Œä»…æ­¤è€Œå·²ã€‚</p><p>å¹¶ä¸”ï¼Œå¦‚æœä½ ä¸å–œæ¬¢ CSS çš„ class é€‰æ‹©å™¨ä½œä¸º class ååˆ°å¤„éƒ½æ˜¯ï¼Œæˆ‘ä¼šæ¨èä½¿ç”¨ styled componentsã€‚è¿™æ ·å¯ä»¥æé«˜å¯è¯»æ€§ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">Number</span> = styled.h1<span class="string">`</span></span><br><span class="line"><span class="string">  font-size: 36px;</span></span><br><span class="line"><span class="string">  line-height: 40px;</span></span><br><span class="line"><span class="string">  margin-right: 5px;</span></span><br><span class="line"><span class="string">  padding: 0px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="comment">//..</span></span><br><span class="line">&lt;Container&gt;</span><br><span class="line">  &lt;<span class="built_in">Number</span>&gt;&#123;skipRatePre&#125;&lt;<span class="regexp">/Number&gt;</span></span><br><span class="line"><span class="regexp">  &lt;InfoName&gt;Skip Rate&lt;/</span>InfoName&gt;</span><br><span class="line">&lt;<span class="regexp">/Container&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æ‹…å¿ƒåˆ›å»ºå¤ªå¤šç»„ä»¶æ˜¯å› ä¸ºå¤ªå¤šæ–‡ä»¶ä¼šæ±¡æŸ“ç›®å½•ï¼Œé‚£ä¹ˆé‡æ–°è€ƒè™‘å¦‚ä½•æ¶æ„ä½ çš„ä»£ç ã€‚æˆ‘ä¸€ç›´åœ¨ä½¿ç”¨åˆ†å½¢ç»“æ„ (<a href="https://hackernoon.com/fractal-a-react-app-structure-for-infinite-scale-4dab943092af" target="_blank" rel="noopener">fractal structrue</a>)ï¼Œå®ƒéå¸¸æ£’ã€‚</p><h2 id="ä¸è¦å±€é™äºåŸºç¡€-â€”â€”-è½¬å‘é«˜çº§"><a href="#ä¸è¦å±€é™äºåŸºç¡€-â€”â€”-è½¬å‘é«˜çº§" class="headerlink" title="ä¸è¦å±€é™äºåŸºç¡€ â€”â€” è½¬å‘é«˜çº§"></a>ä¸è¦å±€é™äºåŸºç¡€ â€”â€” è½¬å‘é«˜çº§</h2><p>æœ‰æ—¶ä½ å¯èƒ½ä¼šè®¤ä¸ºä½ å¯¹æŸäº›ä¸œè¥¿ç†è§£ä¸å¤Ÿï¼Œä¸èƒ½è½¬å‘é«˜çº§åº”ç”¨ã€‚ä½†æ˜¯é€šå¸¸ä½ ä¸å¿…è¿‡å¤šæ‹…å¿ƒ â€”â€” æ¥å—æŒ‘æˆ˜å¹¶è¯æ˜è‡ªå·±çš„æ‹…å¿ƒæ˜¯é”™çš„ã€‚</p><p>é€šè¿‡æŒæ¡é«˜çº§å†…å®¹å¹¶æ¨åŠ¨ä½ è‡ªå·±ï¼Œä½ å¯ä»¥ç†è§£æ›´å¤šåŸºç¡€çŸ¥è¯†ä»¥åŠå¦‚ä½•å°†ä»–ä»¬è¿ç”¨åœ¨æ›´å¤§çš„é¡¹ç›®ä¸Šã€‚</p><p>è¿™é‡Œæœ‰è®¸å¤šæ¨¡å¼å¯ä»¥å°è¯•ï¼š</p><ul><li>å¤åˆç»„ä»¶ï¼ˆCompound Componentsï¼‰</li><li>é«˜é˜¶ç»„ä»¶ ï¼ˆHigh Order Componentsï¼‰</li><li>Render Props</li><li>Smart/Dumb ç»„ä»¶ ï¼ˆSmart/Dumb Componentsï¼‰</li><li>ç­‰ç­‰ (å°è¯•å»åˆ†æ)</li></ul><p>å»ç ”ç©¶ä»–ä»¬ï¼Œä½ ä¼šçŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ã€åœ¨å“ªé‡Œä½¿ç”¨å®ƒä»¬ã€‚ç”¨èµ· React ä½ ä¼šæ„Ÿè§‰æ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// looks like magic?</span></span><br><span class="line"><span class="comment">// it's not that hard when you just try</span></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> children = React.Children.map(<span class="keyword">this</span>.props.children,</span><br><span class="line">   (child, index) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> React.cloneElement(child, &#123;</span><br><span class="line">        onSelect: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.props.onTabSelect(index)</span><br><span class="line">    &#125;);    </span><br><span class="line"> &#125;);  </span><br><span class="line"> <span class="keyword">return</span> children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä¸è¦å®³æ€•åœ¨å·¥ä½œä¸­ä½¿ç”¨æ–°ä¸œè¥¿ â€”â€” å½“ç„¶ï¼Œåœ¨ä¸€å®šèŒƒå›´å†…ã€‚</p><p>æœ‰äººå¯èƒ½ä¼šè´¨ç–‘ï¼Œè¿™å¾ˆæ­£å¸¸ã€‚ä½ çš„ä»»åŠ¡å°±æ˜¯ç”¨å¼ºæœ‰åŠ›çš„è¯æ®æ¥æå«ä½ çš„å·¥ä½œå’Œå†³å®šã€‚</p><p>ä½ çš„ç›®æ ‡åº”è¯¥æ˜¯è§£å†³ç°æœ‰çš„é—®é¢˜ï¼Œè®©åç»­å¼€å‘æ›´ç®€å•ï¼Œæˆ–è€…æ¸…ç†ä¸€äº›é¢æ¡å¼ä»£ç ã€‚å³ä½¿ä½ çš„å»ºè®®è¢«æ‹’ç»ï¼Œä½ çš„æ”¶è·ä¹Ÿä¼šæ¯”ä¿æŒæ²‰é»˜å¾—åˆ°çš„æ›´å¤šã€‚</p><h2 id="ä¸è¦è¿‡åº¦å¤æ‚"><a href="#ä¸è¦è¿‡åº¦å¤æ‚" class="headerlink" title="ä¸è¦è¿‡åº¦å¤æ‚"></a>ä¸è¦è¿‡åº¦å¤æ‚</h2><p>è¿™ä¸ªå¬èµ·æ¥åƒæ˜¯ä¸ªç›¸åçš„è§‚ç‚¹ï¼Œä½†æ˜¯æœ‰æ‰€ä¸åŒã€‚åœ¨ç”Ÿæ´»ä¸­ï¼Œå„ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¿æŒå¹³è¡¡ã€‚æˆ‘ä»¬ä¸åº”è¯¥è¿‡åº¦è®¾è®¡æ¥ç‚«è€€ï¼Œè€Œæ˜¯è¦åŠ¡å®ï¼Œç¼–å†™æ˜“äºç†è§£å¹¶å®ç°å…¶åŠŸèƒ½çš„ä»£ç ã€‚</p><p>å¦‚æœä½ ä¸éœ€è¦ Reduxï¼Œä½†æ˜¯ä½ æƒ³ä½¿ç”¨å®ƒï¼Œå› ä¸ºå¾ˆå¤šäººéƒ½åœ¨ä¸çŸ¥é“å®ƒçœŸæ­£ç”¨é€”çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒã€‚ä½ ä¸è¦è¿™æ ·åšã€‚è¦æœ‰è‡ªå·±çš„ä¸»å¼ ï¼Œå¦‚æœæœ‰äººæ¨å€’ä½ ï¼Œä¸è¦å®³æ€•ç«™èµ·æ¥ã€‚</p><p>æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³ï¼Œé€šè¿‡ä½¿ç”¨æœ€æ–°çš„æŠ€æœ¯å¹¶ç¼–å†™å¤æ‚çš„ä»£ç ï¼Œä½ å¯ä»¥å‘ä¸–ç•Œå®£ç§°ï¼šâ€œæˆ‘ä¸æ˜¯åˆçº§ï¼Œæˆ‘æ˜¯ä¸­çº§/é«˜çº§å¼€å‘è€…ã€‚çœ‹çœ‹æˆ‘èƒ½åšä»€ä¹ˆï¼â€</p><p>è€å®è¯´ï¼Œè¿™ä¾¿æ˜¯æˆ‘å¼€å‘è€…ç”Ÿæ¶¯åˆæœŸçš„å¿ƒæ€ã€‚ä½†æ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä½ ä¼šæ˜ç™½ï¼Œä¸ä¸ºç‚«è€€ã€â€œèƒ½å®ç°â€çš„ä»£ç æ›´å®¹æ˜“æ¥å—ã€‚</p><ol><li>ä½ çš„åŒäº‹å¯ä»¥æ¥æ‰‹ä½ çš„é¡¹ç›®ï¼Œä½ ä¸æ˜¯å”¯ä¸€è´Ÿè´£å¼€å‘ã€ä¿®å¤ã€æµ‹è¯•å·¥ä½œçš„äººã€‚</li><li>å›¢é˜Ÿå¯ä»¥ä¸éœ€è¦é€šè¿‡é•¿æ—¶é—´çš„ä¼šè®®å°±çŸ¥é“å…¶ä»–äººåšçš„äº‹æƒ…ã€‚å‡ åˆ†é’Ÿè®¨è®ºå°±è¶³å¤Ÿäº†ã€‚</li><li>å½“ä½ åŒäº‹å¤–å‡ºåº¦å‡ä¸¤å‘¨æ—¶ï¼Œä½ å¯ä»¥æ¥æ‰‹ä»–ä»¬çš„å·¥ä½œã€‚è€Œä¸”ä½ ä¸éœ€è¦å·¥ä½œ 8 å°æ—¶ï¼Œå› ä¸ºä½  1 å°æ—¶å°±å¯ä»¥æå®šã€‚</li></ol><p>äººä»¬å°Šé‡è®©åˆ«äººç”Ÿæ´»æ›´è½»æ¾çš„äººã€‚å› æ­¤å¦‚æœä½ çš„ç›®æ ‡æ˜¯è·å¾—åˆ«äººçš„å°Šæ•¬ã€æå‡æ’åã€æå‡è‡ªå·±ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä¸ºå›¢é˜Ÿè€Œä¸æ˜¯ä¸ºä½ è‡ªå·±ç¼–å†™ä»£ç ã€‚</p><p>ä½ ä¼šæˆä¸ºå¤§å®¶æœ€å–œæ¬¢çš„å›¢é˜Ÿæˆå‘˜ã€‚</p><h2 id="é‡æ„ï¼Œé‡æ„ï¼Œå†é‡æ„-â€”â€”-è¿™æ˜¯æ­£å¸¸çš„ã€‚"><a href="#é‡æ„ï¼Œé‡æ„ï¼Œå†é‡æ„-â€”â€”-è¿™æ˜¯æ­£å¸¸çš„ã€‚" class="headerlink" title="é‡æ„ï¼Œé‡æ„ï¼Œå†é‡æ„ â€”â€” è¿™æ˜¯æ­£å¸¸çš„ã€‚"></a>é‡æ„ï¼Œé‡æ„ï¼Œå†é‡æ„ â€”â€” è¿™æ˜¯æ­£å¸¸çš„ã€‚</h2><p>ä½ å¯èƒ½ä¼šå‡ åæ¬¡çš„æ”¹å˜æƒ³æ³•ï¼Œè™½ç„¶é¡¹ç›®ç»ç†æ”¹å˜å¾—æ›´é¢‘ç¹ã€‚æœ‰äººä¼šè¯„è®ºä½ çš„å·¥ä½œï¼Œä½ ä¹Ÿä¼šè¯„è®ºä»–ã€‚æ‰€ä»¥ç»“æœæ˜¯ï¼Œä½ å°†ä¼šå¾ˆå¤šæ¬¡çš„ä¿®æ”¹ä½ çš„ä»£ç ã€‚</p><p>ä½†æ˜¯åˆ«æ‹…å¿ƒï¼Œè¿™æ˜¯ä¸ªæ­£å¸¸çš„å­¦ä¹ è¿‡ç¨‹ã€‚ä¸çŠ¯é”™ã€ä»£ç ä¸æŠ¥é”™ï¼Œæˆ‘ä»¬å°±æ— æ³•æå‡è‡ªå·±ã€‚</p><p>è·Œå€’çš„æ¬¡æ•°è¶Šå¤šï¼Œé‡æ–°ç«™èµ·æ¥å°±å˜å¾—è¶Šå®¹æ˜“ã€‚</p><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªæé†’ï¼šä½ è¦ä¿è¯å»æµ‹è¯•ä½ ç°åœ¨çš„è½¯ä»¶ã€‚å†’çƒŸæµ‹è¯•ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€å¿«ç…§æµ‹è¯• â€”â€” åˆ«ä¸å¥½æ„æ€å»æµ‹è¯•ã€‚</p><p>æ¯ä¸ªäººéƒ½çœ‹åˆ°æˆ–è€…å°†ä¼šçœ‹åˆ°æµ‹è¯•å¯ä»¥èŠ‚çº¦å®è´µæ—¶é—´çš„åœºæ™¯ã€‚</p><p>å¦‚æœä½ å’Œå¾ˆå¤šäººä¸€æ ·ï¼Œéƒ½è®¤ä¸ºåšè¿™äº›æ˜¯æµªè´¹æ—¶é—´ï¼Œè¯•ç€ä»¥ä¸åŒçš„è§’åº¦æƒ³ä¸€æƒ³ã€‚</p><ol><li>ä½ ä¸éœ€è¦å’Œä½ åŒäº‹ä¸€èµ·å‘ä»–è§£é‡Šæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</li><li>ä½ ä¸éœ€è¦å’Œä½ åŒäº‹ä¸€èµ·å‘ä»–è§£é‡Šä¸ºä½•ä¼šå‡ºç°é”™è¯¯ã€‚</li><li>ä½ ä¸éœ€è¦å¸®ä½ åŒäº‹ä¿® bugã€‚</li><li>ä½ ä¸éœ€è¦ä¿® 3 å‘¨åæ‰å‘ç°çš„ bugã€‚</li><li>ä½ å°†æœ‰æ—¶é—´åšä½ æƒ³åšçš„äº‹æƒ…ã€‚</li></ol><p>è¿™äº›éƒ½æ˜¯æœ‰å¾ˆå¤šç›Šå¤„çš„ã€‚</p><h2 id="å¦‚æœä½ å–œæ¬¢å®ƒï¼Œä½ ä¼šä¸æ–­æˆé•¿"><a href="#å¦‚æœä½ å–œæ¬¢å®ƒï¼Œä½ ä¼šä¸æ–­æˆé•¿" class="headerlink" title="å¦‚æœä½ å–œæ¬¢å®ƒï¼Œä½ ä¼šä¸æ–­æˆé•¿"></a>å¦‚æœä½ å–œæ¬¢å®ƒï¼Œä½ ä¼šä¸æ–­æˆé•¿</h2><p>åœ¨è¿‡å»çš„ä¸€å¹´é‡Œï¼Œæˆ‘çš„ç›®æ ‡æ˜¯æ›´å¥½çš„ä½¿ç”¨ Reactã€‚æˆ‘æƒ³åšä¸€ä¸ªå…³äºå®ƒçš„æ¼”è®²ã€‚æˆ‘æƒ³å…¶ä»–äººå’Œæˆ‘ä¸€æ ·äº«å—å®ƒã€‚</p><p>æˆ‘å¯ä»¥ä¸åœæ­‡çš„æ•´æ™šååœ¨é‚£ç¼–ç¨‹ï¼Œè§‚çœ‹å„ç§æ¼”è®²å¹¶äº«å—æ¯ä¸€åˆ†é’Ÿã€‚</p><p>äº‹å®æ˜¯ï¼Œå½“ä½ æƒ³è¦ä»€ä¹ˆï¼Œä½ ä¼šå‘ç°ï¼Œä¸çŸ¥æ€ä¹ˆçš„å°±ä¼šæœ‰äººå¼€å§‹å¸®åŠ©ä½ ã€‚åœ¨ä¸Šä¸ªæœˆï¼Œæˆ‘ä¸º 200 äººåšäº†é¦–æ¬¡å…³äº React çš„æ¼”è®²ã€‚</p><p>åœ¨è¿™è¿‡å»çš„ä¸€å¹´é‡Œï¼Œæˆ‘å˜å¾—æ›´åŠ å¼ºå¤§ï¼ŒReact ç”¨å¾—æ›´åŠ å¾—å¿ƒåº”æ‰‹ â€”â€” å„ç§æ¨¡å¼ï¼ŒèŒƒå¼å’Œå†…éƒ¨åŸç†ã€‚æˆ‘å¯ä»¥è¿›è¡Œé«˜çº§å†…å®¹çš„è®¨è®ºå¹¶å‘åˆ«äººè®²æˆæˆ‘ä¹‹å‰å®³æ€•æ¥è§¦çš„è¯é¢˜ã€‚</p><p>ä»Šå¤©æˆ‘ä¾æ—§æ„Ÿåˆ°å…´å¥‹å’Œäº«å—ï¼Œä¸€å¦‚ä¸€å¹´å‰çš„æ„Ÿå—ã€‚</p><p>å› æ­¤ï¼Œæˆ‘å»ºè®®æ¯ä¸ªäººéƒ½é—®é—®è‡ªå·±ï¼šâ€œä½ æ˜¯å¦å–œæ¬¢ä½ åœ¨åšçš„äº‹æƒ…ï¼Ÿâ€</p><p>å¦‚æœä¸å–œæ¬¢ï¼Œé‚£å°±ç»§ç»­å¯»æ‰¾ä½ å¯ä»¥è°ˆè®ºå‡ ä¸ªå°æ—¶ã€æ¯æ™šå­¦ä¹ å¹¶ä¸”ä½¿ä½ å¼€å¿ƒçš„é‚£ä¸ªç‰¹åˆ«çš„äº‹æƒ…ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å¿…é¡»æ‰¾åˆ°æœ€æ¥è¿‘æˆ‘ä»¬å†…å¿ƒçš„ä¸œè¥¿ã€‚æˆåŠŸä¸èƒ½å¼ºè¿«ï¼Œè€Œæ˜¯ä¸»åŠ¨è·å–ã€‚</p><p>å¦‚æœæˆ‘å¯ä»¥å›åˆ°ä¸€å¹´å‰ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œè¿™ä¸ªå¤§çš„æ—…ç¨‹ä¹‹å‰ï¼Œè¿™äº›å°±æ˜¯æˆ‘æƒ³å¯¹è‡ªå·±è¯´çš„ã€‚</p><p>Thank you for reading!</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://medium.freecodecamp.org/mindset-lessons-from-a-year-with-react-1de862421981&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;The most important lessons Iâ€™ve learned after a year of working with&lt;br&gt;React&lt;/a&gt;&lt;br&gt;ä½œè€…ï¼šTomas Eglinskas&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/2000/1*TheYckj9udF4qLjoJW8sjg.png&quot; alt=&quot;images&quot;&gt;&lt;/p&gt;&lt;center&gt;No, I didnâ€™t wrote that, but I know it got your attention ğŸ”ª&lt;/center&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¼€å§‹å­¦ä¹ ä¸€é¡¹æ–°çš„æŠ€æœ¯æ—¶å€™ä»¤äººå¾ˆè‹¦æ¼ã€‚ä½ ç»å¸¸å‘ç°è‡ªå·±å¤„äºæ•™ç¨‹å’Œæ–‡ç« çš„æµ·æ´‹é‡Œï¼Œè¿˜ä¼´éšç€æ— æ•°çš„ä¸ªäººè§‚ç‚¹ã€‚å¹¶ä¸”æ¯ä¸ªäººéƒ½å£°ç§°ä»–ä»¬æ‰¾åˆ°äº†â€œæ­£ç¡®è€Œå®Œç¾çš„æ–¹å¼â€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="React" scheme="https://blog.hhking.cn/tags/React/"/>
    
      <category term="JavaScript" scheme="https://blog.hhking.cn/tags/JavaScript/"/>
    
      <category term="ç»éªŒåˆ†äº«" scheme="https://blog.hhking.cn/tags/%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘] æˆ‘ä»æ²¡ç†è§£è¿‡ JavaScript é—­åŒ…</title>
    <link href="https://blog.hhking.cn/2018/09/08/i-never-understood-javascript-closures/"/>
    <id>https://blog.hhking.cn/2018/09/08/i-never-understood-javascript-closures/</id>
    <published>2018-09-08T13:59:11.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡: <a href="https://medium.com/dailyjs/i-never-understood-javascript-closures-9663703368e8" target="_blank" rel="noopener">I never understood JavaScript closures</a><br>ä½œè€…: <a href="https://medium.com/@odemeulder?source=post_header_lockup" target="_blank" rel="noopener">Olivier De Meulder</a><br>æ—¶é—´: Sep 7, 2017<br>è¯‘æ³¨ï¼šä½œè€…ä» JavaScript çš„åŸç†å‡ºå‘ï¼Œè¯¦ç»†è§£è¯»æ‰§è¡Œè¿‡ç¨‹ï¼Œé€šè¿‡â€œèƒŒåŒ…â€çš„å½¢è±¡æ¯”å–»ï¼Œæ¥è§£é‡Šé—­åŒ…ã€‚</p></blockquote><p><img src="https://cdn-images-1.medium.com/max/1600/1*1vMy563vz6LA_67VrzeT9g.png" alt="images"></p><p><strong>æˆ‘ä»æ²¡ç†è§£è¿‡ JavaScript é—­åŒ…</strong><br><strong>ç›´åˆ°æœ‰äººè¿™æ ·è·Ÿæˆ‘è§£é‡Šâ€¦â€¦</strong></p><p>æ­£å¦‚æ ‡é¢˜æ‰€è¯´ï¼ŒJavaScript é—­åŒ…å¯¹æˆ‘æ¥è¯´ä¸€ç›´æ˜¯ä¸ªè¿·ã€‚æˆ‘ <a href="https://medium.freecodecamp.org/lets-learn-javascript-closures-66feb44f6a44" target="_blank" rel="noopener">çœ‹è¿‡</a> <a href="https://medium.freecodecamp.org/whats-a-javascript-closure-in-plain-english-please-6a1fc1d2ff1c" target="_blank" rel="noopener">å¾ˆå¤š</a> <a href="https://en.wikipedia.org/wiki/Closure_%28computer_programming%29" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œåœ¨å·¥ä½œä¸­ç”¨è¿‡é—­åŒ…ï¼Œç”šè‡³æœ‰æ—¶å€™æˆ‘éƒ½æ²¡æœ‰æ„è¯†åˆ°æˆ‘åœ¨ä½¿ç”¨é—­åŒ…ã€‚</p><p>æœ€è¿‘å‚åŠ ä¸€ä¸ªäº¤æµä¼šï¼Œæœ‰äººç”¨æŸç§æ–¹å¼å‘æˆ‘è§£é‡Šäº†é—­åŒ…ï¼Œç‚¹é†’äº†æˆ‘ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä¹Ÿå°†ç”¨è¿™ç§æ–¹å¼æ¥è§£é‡Šé—­åŒ…ã€‚è¿™é‡Œè¦ç§°èµä¸€ä¸‹ <a href="https://www.codesmith.io/" target="_blank" rel="noopener">CodeSmith </a>çš„ä¼˜ç§€äººæ‰å’Œä»–ä»¬çš„ã€ŠJavaScript The Hard Partsã€‹ç³»åˆ—ã€‚</p><a id="more"></a><h2 id="å¼€å§‹ä¹‹å‰"><a href="#å¼€å§‹ä¹‹å‰" class="headerlink" title="å¼€å§‹ä¹‹å‰"></a>å¼€å§‹ä¹‹å‰</h2><p>åœ¨ç†è§£é—­åŒ…ä¹‹å‰ï¼Œä¸€äº›é‡è¦çš„æ¦‚å¿µéœ€è¦ç†è§£ã€‚å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ <strong><em>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆexecution contextï¼‰</em></strong>ã€‚</p><p><a href="http://davidshariff.com/blog/what-is-the-execution-context-in-javascript/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a> å¯¹æ‰§è¡Œä¸Šä¸‹æ–‡æœ‰å¾ˆå¥½çš„ä»‹ç»ã€‚å¼•ç”¨ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼š</p><blockquote><p>JavaScript ä»£ç åœ¨æ‰§è¡Œæ—¶ï¼Œå®ƒçš„æ‰§è¡Œç¯å¢ƒéå¸¸é‡è¦ï¼Œå®ƒä¼šè¢«å¤„ç†æˆä¸‹é¢çš„æŸä¸€ç§æƒ…å†µï¼š</p><p><strong>å…¨å±€ä»£ç (Global code)</strong> â€”â€” ä»£ç å¼€å§‹æ‰§è¡Œæ—¶çš„é»˜è®¤ç¯å¢ƒã€‚</p><p><strong>å‡½æ•°ä»£ç (Function code)</strong> â€”â€” å½“æ‰§è¡Œåˆ°å‡½æ•°ä½“æ—¶ã€‚</p><p>(â€¦)</p><p>(â€¦), æˆ‘ä»¬æŠŠæœ¯è¯­ <code>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆexecution contextï¼‰</code> ç§°ä¸ºå½“å‰æ‰§è¡Œä»£ç æ‰€å¤„çš„ <em>ç¯å¢ƒæˆ–è€…ä½œç”¨åŸŸ</em>ã€‚</p></blockquote><p>æ¢å¥è¯è¯´ï¼Œå½“æˆ‘ä»¬å¼€å§‹æ‰§è¡Œç¨‹åºæ—¶ï¼Œé¦–å…ˆå¤„äºå…¨å±€ä¸Šä¸‹æ–‡ä¸­ã€‚åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å˜é‡ï¼Œç§°ä¸ºå…¨å±€å˜é‡ã€‚å½“ç¨‹åºè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå‘ç”Ÿä¸‹é¢è¿™å‡ æ­¥ï¼š</p><ol><li>JavaScript åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ â€”â€” å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li><li>è¿™ä¸ªå±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡æœ‰å±äºå®ƒçš„å˜é‡é›†ï¼Œè¿™äº›å˜é‡æ˜¯è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å±€éƒ¨å˜é‡ã€‚</li><li>è¿™ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ‰§è¡Œæ ˆä¸­ã€‚å°†æ‰§è¡Œæ ˆå½“æˆæ˜¯ç”¨æ¥è·Ÿè¸ªç¨‹åºæ‰§è¡Œä½ç½®çš„ä¸€ç§æœºåˆ¶ã€‚</li></ol><p>å‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå®Œï¼Ÿå½“é‡åˆ° <code>return</code> è¯­å¥æˆ–è€…ç»“æŸæ‹¬å· <code>}</code> æ—¶ã€‚å‡½æ•°ç»“æŸæ—¶ï¼Œå‘ç”Ÿä¸‹é¢æƒ…å†µï¼š</p><ol><li>å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä»æ‰§è¡Œæ ˆå¼¹å‡ºã€‚</li><li>å‡½æ•°æŠŠè¿”å›å€¼è¿”å›åˆ°è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚è°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯æŒ‡è°ƒç”¨è¯¥å‡½æ•°çš„çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå®ƒå¯ä»¥æ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿå¯ä»¥æ˜¯å¦å¤–ä¸€ä¸ªå±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿™é‡Œçš„è¿”å›å€¼æ€ä¹ˆå¤„ç†å–å†³äºè°ƒç”¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿”å›å€¼å¯æ˜¯ <code>object</code>, <code>array</code>, <code>function</code>, <code>boolean</code> ç­‰ä»»ä½•ç±»å‹ã€‚å¦‚æœå‡½æ•°æ²¡æœ‰ <code>return</code> è¯­å¥ï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯ <code>undefined</code>ã€‚</li><li>å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚è¿™ç‚¹å¾ˆé‡è¦ â€”â€” è¢«é”€æ¯ã€‚æ‰€æœ‰åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„å˜é‡éƒ½è¢«æ¸…é™¤ã€‚è¿™äº›å˜é‡ä¸å†å¯ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç§°å®ƒä»¬ä¸ºå±€éƒ¨å˜é‡ã€‚</li></ol><h2 id="ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­"><a href="#ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­" class="headerlink" title="ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­"></a>ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­</h2><p>åœ¨å¼€å§‹å­¦ä¹ é—­åŒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸‹é¢è¿™æ®µä»£ç ã€‚å®ƒçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæ‰€æœ‰çš„è¯»è€…åº”è¯¥éƒ½èƒ½æ¸…æ¥šçš„çŸ¥é“å®ƒçš„ä½œç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>: <span class="keyword">let</span> a = <span class="number">3</span></span><br><span class="line"><span class="number">2</span>: <span class="function"><span class="keyword">function</span> <span class="title">addTwo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"><span class="number">3</span>:   <span class="keyword">let</span> ret = x + <span class="number">2</span></span><br><span class="line"><span class="number">4</span>:   <span class="keyword">return</span> ret</span><br><span class="line"><span class="number">5</span>: &#125;</span><br><span class="line"><span class="number">6</span>: <span class="keyword">let</span> b = addTwo(a)</span><br><span class="line"><span class="number">7</span>: <span class="built_in">console</span>.log(b)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ç†è§£ JavaScript å¼•æ“çš„çœŸæ­£å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><ol><li>åœ¨ä»£ç ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜äº†ä¸€ä¸ªæ–°çš„å˜é‡ <code>a</code>ï¼Œå¹¶èµ‹å€¼ä¸º <code>3</code>ã€‚</li><li>æ¥ä¸‹æ¥æ¯”è¾ƒæ£˜æ‰‹äº†ã€‚ç¬¬ 2 åˆ°ç¬¬ 5 è¡Œå±äºä¸€ä¸ªæ•´ä½“ã€‚è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œå‘½åä¸º <code>addTwo</code>ã€‚ç„¶åæˆ‘ä»¬æ€ä¹ˆå¯¹å®ƒèµ‹å€¼çš„ï¼Ÿé€šè¿‡å‡½æ•°å®šä¹‰ã€‚æ‰€æœ‰åœ¨ä¸¤ä¸ªæ‹¬å· <code>{}</code> ä¹‹é—´çš„å†…å®¹éƒ½è¢«èµ‹ç»™ <code>addTwo</code>ã€‚å‡½æ•°é‡Œçš„ä»£ç ä¸è®¡ç®—ã€ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¿å­˜åœ¨å˜é‡ï¼Œç•™ç€åé¢ä½¿ç”¨ã€‚</li><li>ç°åœ¨æˆ‘ä»¬åˆ°äº†ç¬¬ 6 è¡Œã€‚çœ‹ä¼¼å¾ˆç®€å•ï¼Œå…¶å®è¿™é‡Œæœ‰å¾ˆå¤šéœ€è¦è§£è¯»ã€‚é¦–å…ˆæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜äº†ä¸€ä¸ªå˜é‡ï¼Œæ ‡è®°ä¸º <code>b</code>ã€‚å½“å˜é‡åˆšå£°æ˜æ—¶ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ <code>undefined</code>ã€‚</li><li>æ¥ç€ï¼Œè¿˜æ˜¯åœ¨ç¬¬ 6 è¡Œï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸ªèµ‹å€¼è¿ç®—ç¬¦ã€‚æˆ‘ä»¬å‡†å¤‡ç»™å˜é‡ <code>b</code> èµ‹æ–°å€¼ã€‚æ¥ç€çœ‹åˆ°ä¸€ä¸ªå°†è¦è¢«è°ƒç”¨çš„å‡½æ•°ã€‚å½“ä½ çœ‹åˆ°å˜é‡åé¢è·Ÿç€åœ†æ‹¬å· <code>(...)</code> ï¼Œé‚£å°±æ˜¯å‡½æ•°è°ƒç”¨çš„æ ‡è¯†ã€‚æå‰è¯´ä¸‹åé¢çš„æƒ…å†µï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰è¿”å›å€¼ï¼ˆä¸€ä¸ªå€¼ã€ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ˜¯ <code>undefined</code>ï¼‰ã€‚å‡½æ•°çš„è¿”å›å€¼å°†è¢«èµ‹å€¼ç»™å˜é‡ <code>b</code>ã€‚</li><li>ä½†æ˜¯ï¼ˆåœ¨èµ‹å€¼å‰ï¼‰æˆ‘ä»¬é¦–å…ˆè¦è°ƒç”¨å‡½æ•° <code>addTwo</code>ã€‚JavaScript å°†åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å†…å­˜ä¸­æŸ¥æ‰¾å˜é‡ <code>addTwo</code>ã€‚æ‰¾åˆ°äº†ï¼å®ƒåœ¨ç¬¬ 2 æ­¥ï¼ˆç¬¬ 2-5 è¡Œï¼‰ä¸­å®šä¹‰ï¼Œä½ ç§ï¼Œå˜é‡ <code>addTwo</code> åŒ…å«å‡½æ•°å®šä¹‰ã€‚æ³¨æ„ï¼Œå˜é‡ <code>a</code> å½“åšå‚æ•°ä¼ ç»™äº†å‡½æ•°ã€‚JavaScript åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å†…å­˜ä¸­å¯»æ‰¾å˜é‡ <code>a</code>ï¼Œæ‰¾åˆ°å¹¶å‘ç°å®ƒçš„å€¼æ˜¯ <code>3</code>ï¼Œç„¶åæŠŠæ•°å€¼ <code>3</code> åšä¸ºå‚æ•°ä¼ ç»™å‡½æ•°ã€‚å‡½æ•°æ‰§è¡Œå‡†å¤‡å°±ç»ªã€‚</li><li>ç°åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡å°†ä¼šåˆ‡æ¢ã€‚ä¸€ä¸ªæ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»ºï¼Œæˆ‘ä»¬æŠŠå®ƒå‘½åä¸º â€œaddTwo æ‰§è¡Œä¸Šä¸‹æ–‡â€ã€‚è¯¥æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥è°ƒç”¨æ ˆã€‚åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­é¦–å…ˆåšäº›ä»€ä¹ˆäº‹å‘¢ï¼Ÿ</li><li>ä½ å¯èƒ½ä¼šæƒ³è¯´ï¼šâ€œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜ä¸€ä¸ªæ–°çš„å˜é‡ <code>ret</code> â€ã€‚ç„¶åç­”æ¡ˆä¸æ˜¯è¿™æ ·ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼šæˆ‘ä»¬é¦–å…ˆéœ€è¦æŸ¥çœ‹å‡½æ•°çš„å‚æ•°ï¼šåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜æ–°çš„å˜é‡ <code>x</code>ï¼Œå› ä¸ºå€¼ <code>3</code> ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•°ï¼Œæ‰€ä»¥å˜é‡ <code>x</code> èµ‹å€¼ä¸ºæ•°å€¼ <code>3</code>ã€‚</li><li>ä¸‹ä¸€æ­¥ï¼šå±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜æ–°å˜é‡ <code>ret</code>ã€‚å®ƒçš„å€¼é»˜è®¤ä¸º <code>undefined</code>ã€‚ï¼ˆç¬¬3è¡Œï¼‰</li><li>è¿˜æ˜¯ç¬¬ 3 è¡Œï¼Œå‡†å¤‡æ‰§è¡ŒåŠ æ³•ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦è·å– <code>x</code> çš„å€¼ã€‚JavaScript å°†å¯»æ‰¾å˜é‡ <code>x</code>ã€‚é¦–å…ˆåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾ã€‚æ‰¾åˆ°å˜é‡ <code>x</code> çš„å€¼ä¸º <code>3</code>ã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°æ˜¯æ•°å€¼ <code>2</code>ï¼ŒåŠ æ³•çš„ç»“æœï¼ˆ<code>5</code>ï¼‰èµ‹å€¼ç»™å˜é‡ <code>ret</code>ã€‚</li><li>ç¬¬ 4 è¡Œã€‚æˆ‘ä»¬è¿”å›å˜é‡ <code>ret</code> çš„å€¼ã€‚åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­åˆè¿›è¡ŒæŸ¥æ‰¾ <code>ret</code>ã€‚<code>ret</code> çš„å€¼ä¸º <code>5</code>ã€‚æ‰€ä»¥è¯¥å‡½æ•°è¿”å›æ•°å€¼ <code>5</code>ï¼Œå‡½æ•°ç»“æŸã€‚</li><li>ç¬¬ 4-5 è¡Œã€‚å‡½æ•°ç»“æŸã€‚å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚å˜é‡ <code>x</code> å’Œ <code>ret</code> è¢«æ¸…é™¤ï¼Œä¸å†å­˜åœ¨ã€‚è°ƒç”¨æ ˆå¼¹å‡ºè¯¥ä¸Šä¸‹æ–‡ï¼Œè¿”å›å€¼è¿”å›ç»™è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå‡½æ•° <code>addTwo</code> æ˜¯åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨çš„ã€‚</li><li>ç°åœ¨å›åˆ°æˆ‘ä»¬åœ¨ç¬¬ 4 æ­¥é—ç•™çš„å†…å®¹ã€‚è¿”å›å€¼ï¼ˆæ•°å€¼ <code>5</code>ï¼‰å¤åˆ¶ç»™å˜é‡ <code>b</code>ã€‚åœ¨è¿™ä¸ªå°ç¨‹åºä¸­ï¼Œæˆ‘ä»¬è¿˜åœ¨ç¬¬ 6 è¡Œã€‚</li><li>ä¸‹é¢æˆ‘ä¸å†è¯¦ç»†è¯´æ˜äº†ã€‚åœ¨ç¬¬ 7 è¡Œï¼Œå˜é‡ <code>b</code> çš„å€¼åœ¨ <code>console</code> ä¸­æ‰“å°å‡ºæ¥ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­é‡Œå°†æ‰“å°å‡ºæ•°å€¼ <code>5</code>ã€‚</li></ol><p>å¯¹ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œè¿™çœŸæ˜¯ä¸ªå†—é•¿çš„è§£é‡Šï¼è€Œä¸”æˆ‘ä»¬ç”šè‡³è¿˜æ²¡æ¶‰åŠåˆ°é—­åŒ…ã€‚æˆ‘ä¿è¯ä¸€å®šä¼šè®²è§£é—­åŒ…çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€æ±‚ç»•ä¸€ä¸¤æ¬¡ã€‚</p><h2 id="è¯æ³•ä½œç”¨åŸŸ-Lexical-scope"><a href="#è¯æ³•ä½œç”¨åŸŸ-Lexical-scope" class="headerlink" title="è¯æ³•ä½œç”¨åŸŸ (Lexical scope)"></a>è¯æ³•ä½œç”¨åŸŸ (Lexical scope)</h2><p>æˆ‘ä»¬éœ€è¦ç†è§£è¯æ³•ä½œç”¨åŸŸçš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>: <span class="keyword">let</span> val1 = <span class="number">2</span></span><br><span class="line"><span class="number">2</span>: <span class="function"><span class="keyword">function</span> <span class="title">multiplyThis</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line"><span class="number">3</span>:   <span class="keyword">let</span> ret = n * val1</span><br><span class="line"><span class="number">4</span>:   <span class="keyword">return</span> ret</span><br><span class="line"><span class="number">5</span>: &#125;</span><br><span class="line"><span class="number">6</span>: <span class="keyword">let</span> multiplied = multiplyThis(<span class="number">6</span>)</span><br><span class="line"><span class="number">7</span>: <span class="built_in">console</span>.log(<span class="string">'example of scope:'</span>, multiplied)</span><br></pre></td></tr></table></figure><p>ä¾‹å­ä¸­ï¼Œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å„æœ‰ä¸€äº›å˜é‡ã€‚JavaScript çš„ä¸€ä¸ªéš¾ç‚¹æ˜¯å¦‚ä½•å¯»æ‰¾å˜é‡ã€‚å¦‚æœåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡æ‰¾åˆ°æŸä¸ªå˜é‡ï¼Œé‚£ä¹ˆåˆ°å®ƒçš„è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­å»æ‰¾ã€‚å¦‚æœåœ¨å®ƒçš„è°ƒç”¨ä¸Šä¸‹æ–‡ä¹Ÿæ²¡æ‰¾åˆ°ï¼Œé‡å¤ä¸Šé¢çš„æŸ¥æ‰¾æ­¥éª¤ï¼Œç›´åˆ°åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰¾ï¼ˆå¦‚æœä¹Ÿæ²¡æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±æ˜¯ <code>undefined</code> ï¼‰ã€‚æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œå®ƒä¼šéªŒè¯è¿™ç‚¹ã€‚å¦‚æœä½ ç†è§£ä½œç”¨åŸŸçš„åŸç†ï¼Œä½ å¯ä»¥è·³è¿‡è¿™éƒ¨åˆ†ã€‚</p><ol><li>åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜ä¸€ä¸ªæ–°å˜é‡ <code>val1</code> ï¼Œå¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>2</code>ã€‚</li><li>ç¬¬ 2-5 è¡Œå£°æ˜æ–°å˜é‡ <code>multiplyThis</code> å¹¶èµ‹å€¼ä¸ºå‡½æ•°å®šä¹‰ã€‚</li><li>ç¬¬ 6 è¡Œï¼Œåœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜æ–°å˜é‡ <code>multiplied</code>ã€‚</li><li>åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å†…å­˜ä¸­è·å–å˜é‡ <code>multiplyThis</code> å¹¶ä½œä¸ºå‡½æ•°æ‰§è¡Œã€‚ä¼ å…¥å‚æ•°æ•°å€¼ <code>6</code>ã€‚</li><li>æ–°å‡½æ•°è°ƒç”¨ = æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šåˆ›å»ºæ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li><li>åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œå£°æ˜å˜é‡ <code>n</code> å¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>6</code>ã€‚</li><li>ç¬¬ 3 è¡Œï¼Œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜å˜é‡ <code>ret</code>ã€‚</li><li>è¿˜æ˜¯ç¬¬ 3 è¡Œï¼Œä¸¤ä¸ªæ“ä½œæ•°â€”â€”å˜é‡ <code>n</code> å’Œ <code>val1</code> çš„å€¼æ‰§è¡Œä¹˜æ³•è¿ç®—ã€‚å…ˆåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡æŸ¥æ‰¾å˜é‡ <code>n</code>ï¼Œå®ƒæ˜¯æˆ‘ä»¬åœ¨ç¬¬ 6 æ­¥ä¸­å£°æ˜çš„ï¼Œå€¼ä¸ºæ•°å€¼ <code>6</code>ã€‚æ¥ç€åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡æŸ¥æ‰¾å˜é‡ <code>val1</code>ï¼Œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡æ²¡æœ‰æ‰¾åˆ°åä¸º <code>val1</code> çš„å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ£€æŸ¥è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™é‡Œè°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å®ƒï¼Œå®ƒåœ¨ç¬¬ 1 æ­¥ä¸­è¢«å®šä¹‰ï¼Œå€¼ä¸ºæ•°å€¼ <code>2</code>ã€‚</li><li>ä¾æ—§æ˜¯ç¬¬ 3 è¡Œã€‚ä¸¤ä¸ªæ“ä½œæ•°ç›¸ä¹˜ç„¶åèµ‹å€¼ç»™å˜é‡ <code>ret</code>ã€‚6 * 2 = 12ã€‚<code>ret</code> ç°åœ¨å€¼ä¸º <code>12</code>ã€‚</li><li>è¿”å›å˜é‡ <code>ret</code>ã€‚å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä»¥åŠç›¸åº”çš„å˜é‡ <code>ret</code> å’Œ <code>n</code> ä¸€èµ·è¢«é”€æ¯ã€‚å˜é‡ <code>val1</code> ä½œä¸ºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†æ²¡æœ‰è¢«é”€æ¯ã€‚</li><li>å›åˆ°ç¬¬ 6 è¡Œã€‚åœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå˜é‡ <code>multiplied</code> è¢«èµ‹å€¼ä¸ºæ•°å€¼ <code>12</code>ã€‚</li><li>æœ€ååœ¨ç¬¬ 7 è¡Œï¼Œæˆ‘ä»¬åœ¨ console ä¸­æ˜¾ç¤ºå˜é‡ <code>multiplied</code> çš„å€¼ã€‚</li></ol><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®°ä½ï¼Œå‡½æ•°å¯ä»¥è®¿é—®åˆ°å®ƒè°ƒç”¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å˜é‡ã€‚è¿™ç§ç°è±¡æ­£å¼å­¦åæ˜¯ <strong>è¯æ³•ä½œç”¨åŸŸ</strong>ã€‚</p><blockquote><p>ï¼ˆè¯‘è€…æ³¨ï¼šè§‰å¾—è¿™é‡Œå¯¹è¯æ³•ä½œç”¨åŸŸçš„è§£é‡Šé™äºæ­¤ä¾‹ï¼Œå¹¶ä¸å®Œå…¨å‡†ç¡®ã€‚è¯æ³•ä½œç”¨åŸŸï¼Œå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å†³å®šçš„ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ—¶ï¼‰ã€‚</p></blockquote><h2 id="è¿”å›å€¼æ˜¯å‡½æ•°çš„å‡½æ•°"><a href="#è¿”å›å€¼æ˜¯å‡½æ•°çš„å‡½æ•°" class="headerlink" title="è¿”å›å€¼æ˜¯å‡½æ•°çš„å‡½æ•°"></a>è¿”å›å€¼æ˜¯å‡½æ•°çš„å‡½æ•°</h2><p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­é‡Œå‡½æ•° <code>addTwo</code> è¿”å›çš„æ˜¯ä¸ªæ•°å€¼ã€‚è®°å¾—ä¹‹å‰æè¿‡å‡½æ•°å¯ä»¥è¿”å›ä»»ä½•ç±»å‹ã€‚æˆ‘ä»¬æ¥çœ‹ä¸ªå‡½æ•°è¿”å›å‡½æ•°çš„ä¾‹å­ï¼Œè¿™ä¸ªæ˜¯ç†è§£é—­åŒ…çš„å…³é”®ç‚¹ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬è¦åˆ†æçš„ä¾‹å­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>: <span class="keyword">let</span> val = <span class="number">7</span></span><br><span class="line"> <span class="number">2</span>: <span class="function"><span class="keyword">function</span> <span class="title">createAdder</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="number">3</span>:   <span class="function"><span class="keyword">function</span> <span class="title">addNumbers</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"> <span class="number">4</span>:     <span class="keyword">let</span> ret = a + b</span><br><span class="line"> <span class="number">5</span>:     <span class="keyword">return</span> ret</span><br><span class="line"> <span class="number">6</span>:   &#125;</span><br><span class="line"> <span class="number">7</span>:   <span class="keyword">return</span> addNumbers</span><br><span class="line"> <span class="number">8</span>: &#125;</span><br><span class="line"> <span class="number">9</span>: <span class="keyword">let</span> adder = createAdder()</span><br><span class="line"><span class="number">10</span>: <span class="keyword">let</span> sum = adder(val, <span class="number">8</span>)</span><br><span class="line"><span class="number">11</span>: <span class="built_in">console</span>.log(<span class="string">'example of function returning a function: '</span>, sum)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åˆ†è§£ï¼š</p><ol><li>ç¬¬ 1 è¡Œï¼Œæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜å˜é‡ <code>val</code> å¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>7</code>ã€‚</li><li>ç¬¬ 2-8 è¡Œï¼Œæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜å˜é‡ <code>createAdder</code> å¹¶èµ‹å€¼ä¸ºå‡½æ•°å®šä¹‰ã€‚ç¬¬ 3-7 è¡Œè¡¨ç¤ºå‡½æ•°å®šä¹‰ã€‚å’Œå‰é¢æ‰€è¯´ï¼Œè¿™æ—¶å€™ä¸ä¼šè¿›å…¥å‡½æ•°ï¼Œæˆ‘ä»¬åªæ˜¯æŠŠå‡½æ•°å®šä¹‰ä¿å­˜åœ¨å˜é‡ (createAdder)ã€‚</li><li>ç¬¬ 9 è¡Œï¼Œæˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜åä¸º <code>adder</code> çš„æ–°å˜é‡ï¼Œæš‚æ—¶èµ‹å€¼ä¸º <code>undefined</code>ã€‚</li><li>è¿˜æ˜¯ç¬¬ 9 è¡Œï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰æ‹¬å· <code>()</code>ï¼ŒçŸ¥é“éœ€è¦æ‰§è¡Œæˆ–è€…è°ƒç”¨å‡½æ•°ã€‚æˆ‘ä»¬ä»å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡çš„å†…å­˜ä¸­æŸ¥æ‰¾å˜é‡ <code>createAdder</code>ï¼Œå®ƒåœ¨ç¬¬ 2 æ­¥åˆ›å»ºã€‚okï¼Œç°åœ¨è°ƒç”¨å®ƒã€‚</li><li>è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬ç°åœ¨å¤„äºç¬¬ 2 è¡Œã€‚æ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»ºã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­åˆ›å»ºå±€éƒ¨å˜é‡ã€‚JavaScript å¼•æ“æŠŠæ–°çš„ä¸Šä¸‹æ–‡å‹å…¥è°ƒç”¨æ ˆã€‚è¯¥å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥å‡½æ•°ä½“ã€‚</li><li>è¿˜æ˜¯åœ¨ 3-6 è¡Œã€‚æˆ‘ä»¬å£°æ˜äº†ä¸ªæ–°å‡½æ•°ã€‚æˆ‘ä»¬åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­åˆ›å»ºäº†æ–°çš„å˜é‡ <code>addNumbers</code>ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼Œ<code>addNumbers</code> åªåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å‡ºç°ã€‚æˆ‘ä»¬ä½¿ç”¨å±€éƒ¨å˜é‡ <code>addNumbers</code> ä¿å­˜äº†å‡½æ•°å®šä¹‰ã€‚</li><li>ç°åœ¨åˆ°äº†ç¬¬ 7 è¡Œã€‚æˆ‘ä»¬è¿”å›å˜é‡ <code>addNumbers</code> çš„å€¼ã€‚JavaScript å¼•æ“æ‰¾åˆ° <code>addNumbers</code> è¿™ä¸ªå˜é‡ï¼Œå®ƒæ˜¯ä¸ªå‡½æ•°å®šä¹‰ã€‚è¿™æ²¡é—®é¢˜ï¼Œå‡½æ•°å¯ä»¥è¿”å›ä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬å‡½æ•°å®šä¹‰ã€‚æ‰€ä»¥æˆ‘ä»¬è¿”å›äº† <code>addNumbers</code> è¿™ä¸ªå‡½æ•°å®šä¹‰ã€‚æ‹¬å·ä¸­çš„æ‰€æœ‰å†…å®¹â€”â€”ç¬¬ 4-5 è¡Œç»„æˆäº†å‡½æ•°å®šä¹‰ã€‚æˆ‘ä»¬ä¹Ÿä»è°ƒç”¨æ ˆä¸­ç§»é™¤äº†è¯¥å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li><li>å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨è¿”å›æ—¶é”€æ¯äº†ã€‚<code>addNumbers</code> å˜é‡ä¸å­˜åœ¨äº†ï¼Œä½†æ˜¯å‡½æ•°å®šä¹‰è¿˜åœ¨ï¼Œå®ƒè¢«å‡½æ•°è¿”å›å¹¶èµ‹å€¼ç»™äº†å˜é‡ <code>adder</code> â€”â€” æˆ‘ä»¬åœ¨ç¬¬ 3 æ­¥åˆ›å»ºçš„å˜é‡ã€‚</li><li>ç°åœ¨åˆ°äº†ç¬¬ 10 è¡Œã€‚æˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å®šä¹‰äº†æ–°å˜é‡ <code>sum</code>ï¼Œæš‚æ—¶èµ‹å€¼æ˜¯ <code>undefined</code>ã€‚</li><li>æ¥ä¸‹æ¥éœ€è¦éœ€è¦æ‰§è¡Œå‡½æ•°ã€‚å‡½æ•°å®šä¹‰åœ¨å˜é‡ <code>adder</code> ä¸­ã€‚æˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾å¹¶ç¡®ä¿æ‰¾åˆ°äº†å®ƒã€‚è¿™ä¸ªå‡½æ•°å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ã€‚</li><li>æˆ‘ä»¬è·å–è¿™ä¸¤ä¸ªå‚æ•°ï¼Œä»¥ä¾¿èƒ½è°ƒç”¨å‡½æ•°å¹¶ä¼ å…¥æ­£ç¡®çš„å‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å˜é‡ <code>val</code>ï¼Œåœ¨ç¬¬ 1 æ­¥ä¸­å®šä¹‰ï¼Œè¡¨ç¤ºæ•°å€¼ <code>7</code> , ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°å€¼ <code>8</code>ã€‚</li><li>ç°åœ¨æˆ‘ä»¬å¼€å§‹æ‰§è¡Œå‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨å®šä¹‰åœ¨ 3-5 è¡Œã€‚æ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»ºï¼ŒåŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªæ–°å˜é‡ï¼š<code>a</code> å’Œ <code>b</code>ï¼Œä»–ä»¬åˆ†åˆ«èµ‹å€¼ä¸º <code>7</code> å’Œ <code>8</code>ï¼Œè¿™æ˜¯ä¸Šä¸€æ­¥æåˆ°çš„ä¼ ç»™å‡½æ•°çš„å‚æ•°ã€‚</li><li>ç¬¬ 4 è¡Œï¼Œå£°æ˜å˜é‡ <code>ret</code>ã€‚å®ƒæ˜¯åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„ã€‚</li><li>ç¬¬ 4 è¡Œï¼Œè¿›è¡ŒåŠ æ³•è¿ç®—ï¼šæˆ‘ä»¬è®©å˜é‡ <code>a</code> å’Œå˜é‡ <code>b</code> çš„å€¼ç›¸åŠ ã€‚ç›¸åŠ çš„ç»“æœï¼ˆ15ï¼‰èµ‹å€¼ç»™å˜é‡ <code>ret</code>ã€‚</li><li>å‡½æ•°è¿”å›å˜é‡ <code>ret</code> ã€‚å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡é”€æ¯ï¼Œä»è°ƒç”¨æ ˆä¸­ç§»é™¤ï¼Œå˜é‡ <code>a</code>ã€<code>b</code> å’Œ <code>ret</code> éƒ½ä¸å­˜åœ¨äº†ã€‚</li><li>è¿”å›å€¼èµ‹å€¼ç»™åœ¨ç¬¬ 9 æ­¥å®šä¹‰çš„å˜é‡ <code>sum</code>ã€‚</li><li>åœ¨ console ä¸­æ‰“å° <code>sum</code> çš„å€¼ã€‚</li></ol><p>æ­£å¦‚æ‰€é¢„æœŸçš„ï¼Œconsole æ‰“å°å‡º 15ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬çœŸçš„ç»å†äº†å¾ˆå¤šå›°éš¾ã€‚æˆ‘æƒ³åœ¨è¿™é‡Œè¯´æ˜å‡ ç‚¹ã€‚é¦–å…ˆï¼Œå‡½æ•°å®šä¹‰å¯ä»¥ä¿å­˜åœ¨å˜é‡ä¸­ï¼Œå‡½æ•°å®šä¹‰åœ¨æ‰§è¡Œå‰å¯¹ç¨‹åºæ˜¯ä¸å¯è§çš„ï¼›ç¬¬äºŒç‚¹ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªå±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä¸´æ—¶çš„ï¼‰ï¼Œå±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡åœ¨å‡½æ•°ç»“æŸåæ¶ˆå¤±ï¼Œå‡½æ•°åœ¨é‡åˆ° <code>return</code> è¯­å¥æˆ–è€…å³æ‹¬å· <code>}</code> æ—¶ç»“æŸã€‚</p><h2 id="æœ€åï¼Œé—­åŒ…"><a href="#æœ€åï¼Œé—­åŒ…" class="headerlink" title="æœ€åï¼Œé—­åŒ…"></a>æœ€åï¼Œé—­åŒ…</h2><p>çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>: <span class="function"><span class="keyword">function</span> <span class="title">createCounter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="number">2</span>:   <span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line"> <span class="number">3</span>:   <span class="keyword">const</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="number">4</span>:     counter = counter + <span class="number">1</span></span><br><span class="line"> <span class="number">5</span>:     <span class="keyword">return</span> counter</span><br><span class="line"> <span class="number">6</span>:   &#125;</span><br><span class="line"> <span class="number">7</span>:   <span class="keyword">return</span> myFunction</span><br><span class="line"> <span class="number">8</span>: &#125;</span><br><span class="line"> <span class="number">9</span>: <span class="keyword">const</span> increment = createCounter()</span><br><span class="line"><span class="number">10</span>: <span class="keyword">const</span> c1 = increment()</span><br><span class="line"><span class="number">11</span>: <span class="keyword">const</span> c2 = increment()</span><br><span class="line"><span class="number">12</span>: <span class="keyword">const</span> c3 = increment()</span><br><span class="line"><span class="number">13</span>: <span class="built_in">console</span>.log(<span class="string">'example increment'</span>, c1, c2, c3)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¹‹å‰çš„ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åº”è¯¥æŒæ¡äº†å…¶ä¸­çš„çªé—¨ï¼Œè®©æˆ‘ä»¬æŒ‰æˆ‘ä»¬æœŸæœ›çš„æ‰§è¡Œæ–¹å¼æ¥å¿«é€Ÿè¿‡ä¸€éæ‰§è¡Œè¿‡ç¨‹ã€‚</p><ol><li>1-8 è¡Œã€‚æˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºäº†å˜é‡ <code>createCounter</code> å¹¶èµ‹å€¼ä¸ºå‡½æ•°å®šä¹‰ã€‚</li><li>ç¬¬ 9 è¡Œã€‚åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜å˜é‡ <code>increment</code>ã€‚</li><li>è¿˜æ˜¯ç¬¬ 9 è¡Œã€‚æˆ‘ä»¬éœ€è¦è°ƒç”¨å‡½æ•° <code>createCounter</code> å¹¶æŠŠå®ƒçš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡ <code>increment</code>ã€‚</li><li>1-8 è¡Œï¼Œå‡½æ•°è°ƒç”¨ï¼Œåˆ›å»ºæ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚</li><li>ç¬¬ 2 è¡Œï¼Œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜å˜é‡ <code>counter</code>ï¼Œå¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>0</code>ã€‚</li><li>3-6 è¡Œï¼Œå£°æ˜åä¸º <code>myFunction</code> çš„å˜é‡ã€‚è¯¥å˜é‡æ˜¯åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜çš„ã€‚å˜é‡çš„å†…å®¹æ˜¯å¦ä¸€ä¸ªå‡½æ•°å®šä¹‰ â€”â€” åœ¨ 4-5 è¡Œå®šä¹‰ã€‚</li><li>ç¬¬ 7 è¡Œï¼Œè¿”å›å˜é‡ <code>myFunction</code> çš„å€¼ã€‚å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ é™¤äº†ï¼Œ<code>myFunction</code> å’Œ <code>counter</code> ä¹Ÿä¸å­˜åœ¨äº†ã€‚ç¨‹åºæ§åˆ¶æƒå›åˆ°è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚</li><li>ç¬¬ 9 è¡Œã€‚åœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œä¹Ÿæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>createCounter</code> çš„è¿”å›å€¼èµ‹ç»™ <code>increment</code>ã€‚ç°åœ¨å˜é‡ <code>increment</code> åŒ…å«ä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚è¯¥å‡½æ•°å®šä¹‰æ˜¯ <code>createCounter</code> è¿”å›çš„ã€‚å®ƒä¸å†æ˜¯æ ‡è®°ä¸º <code>myFunction</code>ï¼Œä½†æ˜¯æ˜¯åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒè¢«å‘½åä¸º <code>increment</code>ã€‚</li><li>ç¬¬ 10 è¡Œï¼Œå£°æ˜å˜é‡ <code>c1</code>ã€‚</li><li>ç»§ç»­ç¬¬ 10 è¡Œï¼Œå¯»æ‰¾å˜é‡ <code>increment</code>ï¼Œå®ƒæ˜¯ä¸ªå‡½æ•°ï¼Œè°ƒç”¨å‡½æ•°ã€‚å®ƒåŒ…å«ä¹‹å‰è¿”å›çš„å‡½æ•°å®šä¹‰ â€”â€” åœ¨ 4-5 è¡Œå®šä¹‰çš„ã€‚</li><li>åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œæ²¡æœ‰å‚æ•°ï¼Œå¼€å§‹æ‰§è¡Œå‡½æ•°ã€‚</li><li>ç¬¬ 4 è¡Œï¼Œ<code>counter = counter + 1</code>ã€‚åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å¯»æ‰¾ <code>counter</code> çš„å€¼ã€‚æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸Šä¸‹æ–‡è€Œæ²¡æœ‰å£°æ˜ä»»ä½•å±€éƒ¨å˜é‡ã€‚æˆ‘ä»¬çœ‹çœ‹å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œä¹Ÿæ²¡æœ‰å˜é‡ <code>counter</code>ã€‚JavaScript ä¼šæŠŠè¿™ä¸ªè½¬åŒ–æˆ <code>counter = undefined + 1</code>ï¼Œå£°æ˜æ–°çš„å±€éƒ¨å˜é‡ <code>counter</code> å¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>1</code>ï¼Œå› ä¸º <code>undefined</code> ä¼šè½¬åŒ–æˆ <code>0</code>ã€‚</li><li>ç¬¬ 5 è¡Œï¼Œæˆ‘ä»¬è¿”å› <code>counter</code> çš„å€¼ï¼Œæˆ–è€…è¯´æ•°å€¼ <code>1</code>ã€‚é”€æ¯å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå˜é‡ <code>counter</code>ã€‚</li><li>å›åˆ°ç¬¬ 10 è¡Œï¼Œè¿”å›å€¼ï¼ˆ<code>1</code>ï¼‰èµ‹ç»™ <code>c1</code>ã€‚</li><li>ç¬¬ 11 è¡Œï¼Œé‡å¤ç¬¬ 10-14 çš„æ­¥éª¤ï¼Œæœ€å <code>c2</code> ä¹Ÿèµ‹å€¼ä¸º <code>1</code>ã€‚</li><li>ç¬¬ 12 è¡Œï¼Œé‡å¤ç¬¬ 10-14 çš„æ­¥éª¤ï¼Œæœ€å <code>c3</code> ä¹Ÿèµ‹å€¼ä¸º <code>1</code>ã€‚</li><li>ç¬¬ 13 è¡Œï¼Œæˆ‘ä»¬æ‰“å°å‡ºå˜é‡ <code>c1</code>ã€<code>c2</code> å’Œ <code>c3</code> çš„å€¼ã€‚</li></ol><p>è‡ªå·±å°è¯•ä¸€ä¸‹è¿™ä¸ªï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä½ ä¼šå‘ç°ï¼Œæ‰“å°å‡ºæ¥çš„å¹¶ä¸æ˜¯ä¸Šé¢è§£é‡Šçš„é¢„æœŸç»“æœ <code>1</code>ã€ <code>1</code> å’Œ <code>1</code>ï¼Œè€Œæ˜¯æ‰“å°å‡º <code>1</code>ã€ <code>2</code> å’Œ <code>3</code>ã€‚æ‰€ä»¥å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œ<code>increment</code> å‡½æ•°è®°ä½äº† <code>counter</code> çš„å€¼ã€‚è¿™æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p><p>æ˜¯ä¸æ˜¯å› ä¸º <code>counter</code> æ˜¯å±äºå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿè¯•è¯• <code>console.log(counter)</code>ï¼Œä½ ä¼šå¾—åˆ° <code>undefined</code>ã€‚æ‰€ä»¥å®ƒå¹¶ä¸æ˜¯ã€‚</p><p>æˆ–è®¸ï¼Œæ˜¯å› ä¸ºå½“ä½ è°ƒç”¨ <code>increment</code> æ—¶ï¼Œå®ƒä»¥æŸç§æ–¹å¼è¿”å›åˆ›å»ºå®ƒçš„å‡½æ•°ï¼ˆcreateCounterï¼‰çš„åœ°æ–¹ï¼Ÿè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿå˜é‡ <code>increment</code> åŒ…å«å‡½æ•°å®šä¹‰ï¼Œè€Œä¸æ˜¯å®ƒä»å“ªé‡Œåˆ›å»ºã€‚æ‰€ä»¥å¹¶ä¸æ˜¯è¿™ä¸ªåŸå› ã€‚</p><p>æ‰€ä»¥è¿™é‡Œè‚¯å®šå­˜åœ¨å¦ä¸€ç§æœºåˆ¶ã€‚å®ƒå°±æ˜¯<strong>é—­åŒ…</strong>ã€‚æˆ‘ä»¬ç»ˆäºè®²åˆ°å®ƒäº†ï¼Œä¸€ç›´ç¼ºå¤±çš„éƒ¨åˆ†ã€‚</p><p>ä¸‹é¢æ˜¯å®ƒçš„å·¥ä½œåŸç†ã€‚åªè¦ä½ å£°æ˜ä¸€ä¸ªæ–°çš„å‡½æ•°å¹¶èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œä½ å°±ä¿å­˜äº†è¿™ä¸ªå‡½æ•°å®šä¹‰ï¼Œ<strong><em>ä¹Ÿå°±å½¢æˆäº†é—­åŒ…</em></strong>ã€‚é—­åŒ…åŒ…å«å‡½æ•°åˆ›å»ºæ—¶çš„ä½œç”¨åŸŸé‡Œçš„æ‰€æœ‰å˜é‡ã€‚è¿™ç±»ä¼¼äºä¸€ä¸ªèƒŒåŒ…ã€‚å‡½æ•°å®šä¹‰å¸¦ç€ä¸€ä¸ªèƒŒåŒ…ï¼ŒåŒ…é‡Œä¿å­˜äº†æ‰€æœ‰åœ¨å‡½æ•°å®šä¹‰åˆ›å»ºæ—¶ä½œç”¨åŸŸé‡Œçš„å˜é‡ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸Šé¢çš„è§£é‡Šå…¨é”™äº†ã€‚æˆ‘ä»¬é‡æ–°æ¥ä¸€éï¼Œè¿™æ¬¡æ˜¯æ­£ç¡®çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span>: <span class="function"><span class="keyword">function</span> <span class="title">createCounter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="number">2</span>:   <span class="keyword">let</span> counter = <span class="number">0</span></span><br><span class="line"> <span class="number">3</span>:   <span class="keyword">const</span> myFunction = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="number">4</span>:     counter = counter + <span class="number">1</span></span><br><span class="line"> <span class="number">5</span>:     <span class="keyword">return</span> counter</span><br><span class="line"> <span class="number">6</span>:   &#125;</span><br><span class="line"> <span class="number">7</span>:   <span class="keyword">return</span> myFunction</span><br><span class="line"> <span class="number">8</span>: &#125;</span><br><span class="line"> <span class="number">9</span>: <span class="keyword">const</span> increment = createCounter()</span><br><span class="line"><span class="number">10</span>: <span class="keyword">const</span> c1 = increment()</span><br><span class="line"><span class="number">11</span>: <span class="keyword">const</span> c2 = increment()</span><br><span class="line"><span class="number">12</span>: <span class="keyword">const</span> c3 = increment()</span><br><span class="line"><span class="number">13</span>: <span class="built_in">console</span>.log(<span class="string">'example increment'</span>, c1, c2, c3)</span><br></pre></td></tr></table></figure><ol><li>1-8 è¡Œã€‚æˆ‘ä»¬åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºäº†å˜é‡ <code>createCounter</code> å¹¶èµ‹å€¼ä¸ºå‡½æ•°å®šä¹‰ã€‚åŒä¸Šã€‚</li><li>ç¬¬ 9 è¡Œã€‚åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜å˜é‡ <code>increment</code>ã€‚åŒä¸Šã€‚</li><li>è¿˜æ˜¯ç¬¬ 9 è¡Œã€‚æˆ‘ä»¬éœ€è¦è°ƒç”¨å‡½æ•° <code>createCounter</code> å¹¶æŠŠå®ƒçš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡ <code>increment</code>ã€‚åŒä¸Šã€‚</li><li>1-8 è¡Œï¼Œå‡½æ•°è°ƒç”¨ï¼Œåˆ›å»ºæ–°çš„å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚åŒä¸Šã€‚</li><li>ç¬¬ 2 è¡Œï¼Œåœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å£°æ˜å˜é‡ <code>counter</code>ï¼Œå¹¶èµ‹å€¼ä¸ºæ•°å€¼ <code>0</code>ã€‚åŒä¸Šã€‚</li><li>3-6 è¡Œï¼Œå£°æ˜åä¸º <code>myFunction</code> çš„å˜é‡ã€‚è¯¥å˜é‡æ˜¯åœ¨å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å£°æ˜çš„ã€‚å˜é‡çš„å†…å®¹æ˜¯å¦ä¸€ä¸ªå‡½æ•°å®šä¹‰ â€”â€” åœ¨ 4-5 è¡Œå®šä¹‰ã€‚ç°åœ¨æˆ‘ä»¬åŒæ—¶ <em>åˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…</em> å¹¶æŠŠå®ƒä½œä¸ºå‡½æ•°å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚é—­åŒ…åŒ…å«äº†å½“å‰ä½œç”¨åŸŸé‡Œçš„å˜é‡ï¼Œåœ¨è¿™é‡Œæ˜¯å˜é‡ <code>counter</code> (å€¼ä¸º <code>0</code>)ã€‚</li><li>ç¬¬ 7 è¡Œï¼Œè¿”å›å˜é‡ <code>myFunction</code> çš„å€¼ã€‚å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ é™¤äº†ï¼Œ<code>myFunction</code> å’Œ <code>counter</code> ä¹Ÿä¸å­˜åœ¨äº†ã€‚ç¨‹åºæ§åˆ¶æƒå›åˆ°è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥æˆ‘ä»¬è¿”å›äº†å‡½æ•°å®šä¹‰å’Œå®ƒçš„ <em>é—­åŒ…</em> â€”â€” è¿™ä¸ªèƒŒåŒ…åŒ…å«äº†å‡½æ•°åˆ›å»ºæ—¶ä½œç”¨åŸŸé‡Œçš„å˜é‡ã€‚</li><li>ç¬¬ 9 è¡Œã€‚åœ¨è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œä¹Ÿæ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>createCounter</code> çš„è¿”å›å€¼èµ‹ç»™ <code>increment</code>ã€‚ç°åœ¨å˜é‡ <code>increment</code> åŒ…å«ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼ˆå’Œé—­åŒ…ï¼‰ã€‚è¯¥å‡½æ•°å®šä¹‰æ˜¯ <code>createCounter</code> è¿”å›çš„ã€‚å®ƒä¸å†æ˜¯æ ‡è®°ä¸º <code>myFunction</code>ï¼Œä½†æ˜¯æ˜¯åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œå®ƒè¢«å‘½åä¸º <code>increment</code>ã€‚</li><li>ç¬¬ 10 è¡Œï¼Œå£°æ˜å˜é‡ <code>c1</code>ã€‚</li><li>ç»§ç»­ç¬¬ 10 è¡Œï¼Œå¯»æ‰¾å˜é‡ <code>increment</code>ï¼Œå®ƒæ˜¯ä¸ªå‡½æ•°ï¼Œè°ƒç”¨å‡½æ•°ã€‚å®ƒåŒ…å«ä¹‹å‰è¿”å›çš„å‡½æ•°å®šä¹‰ â€”â€” åœ¨ 4-5 è¡Œå®šä¹‰çš„ã€‚ï¼ˆåŒæ—¶å®ƒä¹Ÿæœ‰ä¸ªåŒ…å«å˜é‡çš„èƒŒåŒ…ï¼‰</li><li>åˆ›å»ºæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œè¿™é‡Œæ²¡æœ‰å‚æ•°ï¼Œå¼€å§‹æ‰§è¡Œå‡½æ•°ã€‚</li><li>ç¬¬ 4 è¡Œï¼Œ<code>counter = counter + 1</code>ã€‚æˆ‘ä»¬éœ€è¦å¯»æ‰¾å˜é‡ <code>counter</code>ã€‚æˆ‘ä»¬åœ¨å±€éƒ¨æˆ–è€…å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡å¯»æ‰¾å‰ï¼Œå…ˆæŸ¥çœ‹æˆ‘ä»¬çš„èƒŒåŒ…ã€‚æˆ‘ä»¬æ£€æŸ¥é—­åŒ…ã€‚ä½ ç§ï¼é—­åŒ…é‡ŒåŒ…å«å˜é‡ <code>counter</code>ï¼Œå€¼ä¸º <code>0</code>ã€‚é€šè¿‡ç¬¬ 4 è¡Œçš„è¡¨è¾¾å¼ï¼Œå®ƒçš„å€¼è®¾ä¸º <code>1</code>ã€‚å®ƒç»§ç»­ä¿å­˜åœ¨èƒŒåŒ…é‡Œã€‚ç°åœ¨é—­åŒ…åŒ…å«å€¼ä¸º <code>1</code> çš„å˜é‡ <code>counter</code>ã€‚</li><li>ç¬¬ 5 è¡Œï¼Œæˆ‘ä»¬è¿”å› <code>counter</code> çš„å€¼ï¼Œæˆ–è€…è¯´æ•°å€¼ <code>1</code>ã€‚é”€æ¯å±€éƒ¨æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå˜é‡ <code>counter</code>ã€‚</li><li>å›åˆ°ç¬¬ 10 è¡Œï¼Œè¿”å›å€¼ï¼ˆ<code>1</code>ï¼‰èµ‹ç»™ <code>c1</code>ã€‚</li><li>ç¬¬ 11 è¡Œï¼Œé‡å¤ç¬¬ 10-14 çš„æ­¥éª¤ã€‚è¿™æ¬¡ï¼Œå½“æˆ‘ä»¬æŸ¥çœ‹é—­åŒ…æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°å˜é‡ <code>counter</code> çš„å€¼ä¸º <code>1</code>ã€‚å®ƒæ˜¯åœ¨ç¬¬ 12 æ­¥ï¼ˆç¨‹åºç¬¬ 4 è¡Œï¼‰è®¾ç½®çš„ã€‚é€šè¿‡ <code>increment</code> å‡½æ•°ï¼Œå®ƒçš„å€¼å¢åŠ å¹¶ä¿å­˜ä¸º <code>2</code>ã€‚ æœ€å <code>c2</code> ä¹Ÿèµ‹å€¼ä¸º <code>2</code>ã€‚</li><li>ç¬¬ 12 è¡Œï¼Œé‡å¤ç¬¬ 10-14 çš„æ­¥éª¤ï¼Œæœ€å <code>c3</code> ä¹Ÿèµ‹å€¼ä¸º <code>3</code>ã€‚</li><li>ç¬¬ 13 è¡Œï¼Œæˆ‘ä»¬æ‰“å°å‡ºå˜é‡ <code>c1</code>ã€<code>c2</code> å’Œ <code>c3</code> çš„å€¼ã€‚</li></ol><p>ç°åœ¨æˆ‘ä»¬ç†è§£å®ƒçš„åŸç†äº†ã€‚éœ€è¦è®°ä½çš„å…³é”®ç‚¹æ˜¯ï¼Œä½†å‡½æ•°å£°æ˜æ—¶ï¼Œå®ƒåŒ…å«å‡½æ•°å®šä¹‰å’Œä¸€ä¸ªé—­åŒ…ã€‚<strong>é—­åŒ…æ˜¯å‡½æ•°åˆ›å»ºæ—¶ä½œç”¨åŸŸå†…æ‰€æœ‰å˜é‡çš„é›†åˆã€‚</strong></p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ˜¯ä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½æœ‰é—­åŒ…ï¼Œå³ä½¿æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹åˆ›å»ºçš„å‡½æ•°ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å…¨å±€ä½œç”¨åŸŸä¸‹åˆ›å»ºçš„å‡½æ•°ä¹Ÿç”Ÿæˆé—­åŒ…ã€‚ä½†æ˜¯æ—¢ç„¶å‡½æ•°æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹åˆ›å»ºçš„ï¼Œä»–ä»¬å¯ä»¥è®¿é—®å…¨å±€ä½œç”¨åŸŸä¸‹çš„æ‰€æœ‰å˜é‡ã€‚æ‰€ä»¥è¿™å’Œé—­åŒ…çš„æ¦‚å¿µä¸ç›¸å…³ã€‚</p><p>å½“å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œé—­åŒ…çš„æ¦‚å¿µå°±å˜å¾—æ›´åŠ ç›¸å…³äº†ã€‚è¿”å›çš„å‡½æ•°å¯ä»¥è®¿é—®ä¸åœ¨å…¨å±€ä½œç”¨åŸŸé‡Œçš„å˜é‡ï¼Œä½†å®ƒä»¬åªå­˜åœ¨äºé—­åŒ…é‡Œã€‚</p><h2 id="å¹¶ä¸ç®€å•çš„é—­åŒ…"><a href="#å¹¶ä¸ç®€å•çš„é—­åŒ…" class="headerlink" title="å¹¶ä¸ç®€å•çš„é—­åŒ…"></a>å¹¶ä¸ç®€å•çš„é—­åŒ…</h2><p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½éƒ½æ²¡æœ‰æ³¨æ„åˆ°é—­åŒ…çš„ç”Ÿæˆã€‚ä½ å¯èƒ½åœ¨åå‡½æ•°åº”ç”¨çœ‹åˆ°è¿‡ä¾‹å­ï¼Œåƒä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = <span class="number">4</span></span><br><span class="line"><span class="keyword">const</span> addX = <span class="function"><span class="params">x</span> =&gt;</span> n =&gt; n + x</span><br><span class="line"><span class="keyword">const</span> addThree = addX(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">let</span> d = addThree(c)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'example partial application'</span>, d)</span><br></pre></td></tr></table></figure><p>å¦‚æœç®­å¤´å‡½æ•°è®©ä½ éš¾ä»¥ç†è§£ï¼Œä¸‹é¢æ˜¯ç­‰ä»·çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> c = <span class="number">4</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addX</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> n + x</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> addThree = addX(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">let</span> d = addThree(c)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'example partial application'</span>, d)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªé€šç”¨çš„ç›¸åŠ å‡½æ•° <code>addX</code>ï¼šä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ˆ<code>x</code>ï¼‰ç„¶åè¿”å›å¦ä¸€ä¸ªå‡½æ•°ã€‚</p><p>è¿”å›çš„å‡½æ•°ä¹Ÿå¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å’Œå˜é‡ <code>x</code> ç›¸åŠ ã€‚</p><p>å˜é‡ <code>x</code> æ˜¯é—­åŒ…çš„ä¸€éƒ¨åˆ†ã€‚å½“å˜é‡ <code>addThree</code> åœ¨å±€éƒ¨ä¸Šä¸‹æ–‡ä¸­å£°æ˜æ—¶ï¼Œè¢«èµ‹å€¼ä¸ºå‡½æ•°å®šä¹‰å’Œé—­åŒ…ã€‚è¯¥é—­åŒ…åŒ…å«å˜é‡ <code>x</code>ã€‚</p><p>æ‰€ä»¥ç°åœ¨è°ƒç”¨æ‰§è¡Œ <code>addThree</code> æ˜¯ï¼Œå®ƒå¯ä»¥ä»é—­åŒ…ä¸­è·å–å˜é‡ <code>x</code>ï¼Œè€Œå˜é‡ <code>n</code> æ˜¯é€šè¿‡å‚æ•°ä¼ å…¥ï¼Œæ‰€ä»¥å‡½æ•°å¯ä»¥è¿”å›ç›¸åŠ çš„å’Œã€‚</p><p>è¿™ä¸ªä¾‹å­ console ä¼šæ‰“å°å‡ºæ•°å€¼ <code>7</code>ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>æˆ‘ç‰¢ç‰¢è®°ä½é—­åŒ…çš„æ–¹æ³•æ˜¯é€šè¿‡ <strong>èƒŒåŒ…çš„æ¯”å–»</strong> ã€‚å½“ä¸€ä¸ªå‡½æ•°è¢«åˆ›å»ºã€ä¼ é€’æˆ–è€…ä»å¦ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›æ—¶ï¼Œå®ƒå°±èƒŒç€ä¸€ä¸ªèƒŒåŒ…ã€‚èƒŒåŒ…é‡Œæ˜¯å‡½æ•°å£°æ˜æ—¶çš„ä½œç”¨åŸŸé‡Œçš„æ‰€æœ‰å˜é‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡: &lt;a href=&quot;https://medium.com/dailyjs/i-never-understood-javascript-closures-9663703368e8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;I never understood JavaScript closures&lt;/a&gt;&lt;br&gt;ä½œè€…: &lt;a href=&quot;https://medium.com/@odemeulder?source=post_header_lockup&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Olivier De Meulder&lt;/a&gt;&lt;br&gt;æ—¶é—´: Sep 7, 2017&lt;br&gt;è¯‘æ³¨ï¼šä½œè€…ä» JavaScript çš„åŸç†å‡ºå‘ï¼Œè¯¦ç»†è§£è¯»æ‰§è¡Œè¿‡ç¨‹ï¼Œé€šè¿‡â€œèƒŒåŒ…â€çš„å½¢è±¡æ¯”å–»ï¼Œæ¥è§£é‡Šé—­åŒ…ã€‚&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/1600/1*1vMy563vz6LA_67VrzeT9g.png&quot; alt=&quot;images&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;æˆ‘ä»æ²¡ç†è§£è¿‡ JavaScript é—­åŒ…&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;ç›´åˆ°æœ‰äººè¿™æ ·è·Ÿæˆ‘è§£é‡Šâ€¦â€¦&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;æ­£å¦‚æ ‡é¢˜æ‰€è¯´ï¼ŒJavaScript é—­åŒ…å¯¹æˆ‘æ¥è¯´ä¸€ç›´æ˜¯ä¸ªè¿·ã€‚æˆ‘ &lt;a href=&quot;https://medium.freecodecamp.org/lets-learn-javascript-closures-66feb44f6a44&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çœ‹è¿‡&lt;/a&gt; &lt;a href=&quot;https://medium.freecodecamp.org/whats-a-javascript-closure-in-plain-english-please-6a1fc1d2ff1c&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¾ˆå¤š&lt;/a&gt; &lt;a href=&quot;https://en.wikipedia.org/wiki/Closure_%28computer_programming%29&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ–‡ç« &lt;/a&gt;ï¼Œåœ¨å·¥ä½œä¸­ç”¨è¿‡é—­åŒ…ï¼Œç”šè‡³æœ‰æ—¶å€™æˆ‘éƒ½æ²¡æœ‰æ„è¯†åˆ°æˆ‘åœ¨ä½¿ç”¨é—­åŒ…ã€‚&lt;/p&gt;&lt;p&gt;æœ€è¿‘å‚åŠ ä¸€ä¸ªäº¤æµä¼šï¼Œæœ‰äººç”¨æŸç§æ–¹å¼å‘æˆ‘è§£é‡Šäº†é—­åŒ…ï¼Œç‚¹é†’äº†æˆ‘ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä¹Ÿå°†ç”¨è¿™ç§æ–¹å¼æ¥è§£é‡Šé—­åŒ…ã€‚è¿™é‡Œè¦ç§°èµä¸€ä¸‹ &lt;a href=&quot;https://www.codesmith.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CodeSmith &lt;/a&gt;çš„ä¼˜ç§€äººæ‰å’Œä»–ä»¬çš„ã€ŠJavaScript The Hard Partsã€‹ç³»åˆ—ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="JavaScript" scheme="https://blog.hhking.cn/tags/JavaScript/"/>
    
      <category term="é—­åŒ…" scheme="https://blog.hhking.cn/tags/%E9%97%AD%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>[è¯‘] axios å†…éƒ¨è®¾è®¡åˆ†æ</title>
    <link href="https://blog.hhking.cn/2018/09/04/http-request-library-with-axios/"/>
    <id>https://blog.hhking.cn/2018/09/04/http-request-library-with-axios/</id>
    <published>2018-09-04T12:06:10.000Z</published>
    <updated>2020-08-21T11:20:08.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡: <a href="https://www.tutorialdocs.com/article/axios-learn.html" target="_blank" rel="noopener">How to Implement an HTTP Request Library with Axios</a><br>ä½œè€…ï¼šAlex</p></blockquote><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦ç”¨åˆ°å¼‚æ­¥è¯·æ±‚çš„åœºæ™¯ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ HTTP è¯·æ±‚åº“ï¼Œå¯ä»¥æå¤§çš„å‡å°‘å¼€å‘æ—¶é—´ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>axios æ˜¯è¿‘å‡ å¹´éå¸¸çƒ­é—¨ HTTP è¯·æ±‚åº“ã€‚ç›®å‰åœ¨ <a href="https://github.com/axios/axios" target="_blank" rel="noopener">Github</a> å·²ç»æœ‰è¶…è¿‡ 40k çš„ starsï¼Œä¹Ÿå¾—åˆ°å¾ˆå¤šæƒå¨äººå£«çš„æ¨èã€‚</p><p>å› æ­¤ï¼Œæœ‰å¿…è¦å»äº†è§£ä¸€ä¸‹ axios æ˜¯å¦‚ä½•è®¾è®¡çš„ã€æ˜¯å¦‚ä½•å®ç° HTTP è¯·æ±‚åº“çš„ã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶ axios çš„ç‰ˆæœ¬æ˜¯ 0.18.0ï¼Œæˆ‘ä»¬ä»¥æ­¤ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæ¥è§£è¯»åˆ†ææºç ç»†èŠ‚ã€‚axios çš„æºç æ˜¯åœ¨ lib ç›®å½•ä¸‹ï¼Œä»¥ä¸‹æ¶‰åŠåˆ°çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹ <code>lib</code> ç›®å½•ã€‚</p><p>æ­¤ç¯‡ä¸»è¦è®¨è®ºä¸€ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å¦‚ä½•ä½¿ç”¨ axios</li><li>axios æ ¸å¿ƒæ¨¡å—ï¼ˆè¯·æ±‚ requests, æ‹¦æˆªå™¨ interceptors, æ’¤é”€ withdrawalsï¼‰çš„è®¾è®¡å’Œå®ç°æ–¹å¼</li><li>axios çš„è®¾è®¡ä¼˜ç‚¹</li></ul><a id="more"></a><h2 id="å¦‚ä½•ä½¿ç”¨-axios"><a href="#å¦‚ä½•ä½¿ç”¨-axios" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ axios"></a>å¦‚ä½•ä½¿ç”¨ axios</h2><p>åœ¨ç†è§£ axios çš„è®¾è®¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ axiosã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ä¸‹é¢çš„ axios APIã€‚</p><h3 id="å‘é€è¯·æ±‚"><a href="#å‘é€è¯·æ±‚" class="headerlink" title="å‘é€è¯·æ±‚"></a>å‘é€è¯·æ±‚</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">  method:<span class="string">'get'</span>,</span><br><span class="line">  url:<span class="string">'http://bit.ly/2mTM3nY'</span>,</span><br><span class="line">  responseType:<span class="string">'stream'</span></span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  response.data.pipe(fs.createWriteStream(<span class="string">'ada_lovelace.jpg'</span>))</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å®˜æ–¹æä¾›çš„ API ä¾‹å­ã€‚ä»ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œaxios çš„ä½¿ç”¨æ–¹å¼å’Œ jQuery çš„ ajax éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½è¿”å› Promise ï¼ˆæ­¤ä¾‹ä¸­ axios ä¹Ÿå¯ä»¥ä½¿ç”¨æˆåŠŸå›è°ƒçš„æ–¹å¼ï¼Œä½†æ˜¯æ¨èä½¿ç”¨ Promise æˆ–è€… awaitï¼‰æ¥è¿›è¡Œåç»­æ“ä½œã€‚</p><p>è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸éœ€è¦è¿‡å¤šè§£é‡Šï¼Œæˆ‘ä»¬æ¥çœ‹æ€ä¹ˆæ·»åŠ  <strong>è¿‡æ»¤å‡½æ•°(filter function)</strong>ã€‚</p><h3 id="æ·»åŠ æ‹¦æˆªå‡½æ•°"><a href="#æ·»åŠ æ‹¦æˆªå‡½æ•°" class="headerlink" title="æ·»åŠ æ‹¦æˆªå‡½æ•°"></a>æ·»åŠ æ‹¦æˆªå‡½æ•°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªè¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// æ³¨æ„è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ³• â€”â€” ä¸€ä¸ªæˆåŠŸæ—¶çš„å’Œä¸€ä¸ªå¤±è´¥æ—¶çš„ï¼Œåé¢ä¼šå¯¹è¿™äº›åšè§£é‡Š</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚å‰çš„ä¸€äº›å¤„ç†</span></span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†è¯·æ±‚å¤±è´¥çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªå“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å“åº”çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å“åº”å¤±è´¥æ—¶çš„å¤„ç†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç å¯çŸ¥ï¼šåœ¨è¯·æ±‚å‰ï¼Œå¯ä»¥å¯¹è¯·æ±‚ <code>config</code> çš„å‚æ•°åšå¤„ç†ï¼›è¯·æ±‚åå“åº”æ—¶ï¼Œä¹Ÿå¯ä»¥å¯¹è¿”å›çš„æ•°æ®åšäº›ç‰¹æ®Šå¤„ç†ã€‚åŒæ—¶ï¼Œåœ¨è¯·æ±‚æˆ–è€…å“åº”å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åšç›¸åº”çš„ç‰¹æ®Šé”™è¯¯å¤„ç†ã€‚</p><h3 id="å–æ¶ˆ-HTTP-è¯·æ±‚"><a href="#å–æ¶ˆ-HTTP-è¯·æ±‚" class="headerlink" title="å–æ¶ˆ HTTP è¯·æ±‚"></a>å–æ¶ˆ HTTP è¯·æ±‚</h3><p>åœ¨å¼€å‘æœç´¢ç›¸å…³çš„æ¨¡å—æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦é¢‘ç¹å‘èµ·æ•°æ®æœç´¢çš„è¯·æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å‘èµ·ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬è¦å–æ¶ˆä¸Šä¸€æ¬¡çš„è¯·æ±‚ã€‚åŒæ—¶ä¹Ÿå»ºè®®å–æ¶ˆå’Œè¯·æ±‚ç›¸å…³è”çš„å‡½æ•°è°ƒç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CancelToken = axios.CancelToken;</span><br><span class="line"><span class="keyword">const</span> source = CancelToken.source();</span><br><span class="line"></span><br><span class="line">axios.get(<span class="string">'/user/12345'</span>, &#123;</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">thrown</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (axios.isCancel(thrown)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Request canceled'</span>, thrown.message);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// handle error</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">axios.post(<span class="string">'/user/12345'</span>, &#123;</span><br><span class="line">  name: <span class="string">'new name'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  cancelToken: source.token</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// cancel the request (the message parameter is optional)</span></span><br><span class="line">source.cancel(<span class="string">'Operation canceled by the user.'</span>);</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä¾‹å­å¯çŸ¥ï¼Œaxios ä½¿ç”¨åŸºäº CancelToken çš„æ’¤é”€æ–¹å¼çš„ææ¡ˆã€‚ä½†æ˜¯è¯¥ææ¡ˆå·²ç»è¢«æ’¤é”€äº†ï¼Œ<a href="https://github.com/tc39/proposal-cancelable-promises" target="_blank" rel="noopener">æŸ¥çœ‹è¯¦æƒ…</a>ã€‚æ’¤é”€çš„å®ç°ç»†èŠ‚åœ¨åé¢çš„æºç åˆ†æéƒ¨åˆ†ä¼šè§£é‡Šã€‚</p><h2 id="axios-æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå®ç°æ–¹å¼"><a href="#axios-æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå®ç°æ–¹å¼" class="headerlink" title="axios æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå®ç°æ–¹å¼"></a>axios æ ¸å¿ƒæ¨¡å—çš„è®¾è®¡å’Œå®ç°æ–¹å¼</h2><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œç›¸ä¿¡å¤§å®¶å¯¹ axios çš„ä½¿ç”¨æœ‰äº†ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ ¹æ® axios çš„æ¨¡å—æ¥åˆ†æå…¶è®¾è®¡å’Œå®ç°ã€‚ä¸‹å›¾å±•ç¤ºäº†è¯¥åšæ–‡æ¶‰åŠåˆ°çš„ axios ç›¸å…³ç›®å½•ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå»ºè®® clone ç›¸å…³çš„ä»£ç æ¥çœ‹ï¼Œè¿™æ ·å¯ä»¥å¯¹ç›¸åº”çš„æ¨¡å—æœ‰æ›´æ·±çš„ç†è§£ã€‚</p><p><img src="https://www.tutorialdocs.com/upload/2018/08/axios-module.png" alt="images"></p><h3 id="HTTP-è¯·æ±‚æ¨¡å—ï¼ˆHTTP-request-moduleï¼‰"><a href="#HTTP-è¯·æ±‚æ¨¡å—ï¼ˆHTTP-request-moduleï¼‰" class="headerlink" title="HTTP è¯·æ±‚æ¨¡å—ï¼ˆHTTP request moduleï¼‰"></a>HTTP è¯·æ±‚æ¨¡å—ï¼ˆHTTP request moduleï¼‰</h3><p>å’Œè¯·æ±‚æ¨¡å—ç›¸å…³çš„ä»£ç åœ¨ <code>core/dispatchReqeust.js</code> æ–‡ä»¶ä¸­ã€‚è¿™é‡Œæˆ‘é€‰å–äº†éƒ¨åˆ†å…³é”®æºç æ¥åšç®€å•çš„ä»‹ç»ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/dispatchReqeust.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">dispatchRequest</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other source code</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é»˜è®¤çš„é€‚é…å™¨æ¨¡å—æ˜¯æ ¹æ®å½“å‰ç¯å¢ƒæ¥é€‰æ‹©ä½¿ç”¨ Node æˆ–è€… XHR æ¥å‘èµ·è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">var</span> adapter = config.adapter || defaults.adapter; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> adapter(config).then(<span class="function"><span class="keyword">function</span> <span class="title">onAdapterResolution</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// other source code</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span> <span class="title">onAdapterRejection</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isCancel(reason)) &#123;</span><br><span class="line">            throwIfCancellationRequested(config);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// other source code</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(reason);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å¯çŸ¥ï¼Œ<code>dispatchRequest</code> æ–¹æ³•æ˜¯ç”¨æ¥è·å–å‘é€è¯·æ±‚æ¨¡å—ï¼Œå‘é€è¯·æ±‚æ¨¡å—æ˜¯é€šè¿‡ <code>config.adapter</code> å¾—åˆ°ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥ç¬¦åˆè§„èŒƒçš„é€‚é…å™¨å‡½æ•°ï¼ˆadapter functionï¼‰æ¥ä»£æ›¿åŸå§‹çš„æ¨¡å—ï¼ˆæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šè¿™ä¹ˆåšï¼Œä½†æ˜¯è¿™æ˜¯ä¸€ä¸ªä½è€¦åˆæ‰©å±•ç‚¹ï¼‰ã€‚</p><p>åœ¨ <code>default.js</code> æ–‡ä»¶é‡Œï¼Œå¯ä»¥çœ‹åˆ° <code>adapter</code> ç”Ÿæˆçš„é€»è¾‘ï¼šé€šè¿‡ä¸€äº›ç‰¹æ®Šçš„å±æ€§å’Œå½“å‰æ‰§è¡Œç¯å¢ƒçš„æ„é€ å‡½æ•°æ¥åˆ¤æ–­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// default.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDefaultAdapter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> adapter;</span><br><span class="line">    <span class="comment">// Only Node.js has the classes of which variable type is process.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> process !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">Object</span>.prototype.toString.call(process) === <span class="string">'[object process]'</span>) &#123;</span><br><span class="line">        <span class="comment">// Node.js request module.</span></span><br><span class="line">        adapter = <span class="built_in">require</span>(<span class="string">'./adapters/http'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> XMLHttpRequest !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">        <span class="comment">// The browser request module.</span></span><br><span class="line">        adapter = <span class="built_in">require</span>(<span class="string">'./adapters/xhr'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>axios é‡Œçš„ XHR æ¨¡å—æ˜¯å¯¹ <code>XMLHTTPRequest</code> å¯¹è±¡çš„å°è£…ï¼Œç›¸å¯¹æ¯”è¾ƒç®€å•ã€‚æ‰€ä»¥è¿™é‡Œä¸ä¼šè¿‡å¤šçš„è¯´æ˜ï¼Œæœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±å»é˜…è¯»ï¼Œä»£ç åœ¨ <code>adapters/xhr.js</code> æ–‡ä»¶ã€‚</p><h3 id="æ‹¦æˆªå™¨æ¨¡å—ï¼ˆInterceptor-moduleï¼‰"><a href="#æ‹¦æˆªå™¨æ¨¡å—ï¼ˆInterceptor-moduleï¼‰" class="headerlink" title="æ‹¦æˆªå™¨æ¨¡å—ï¼ˆInterceptor moduleï¼‰"></a>æ‹¦æˆªå™¨æ¨¡å—ï¼ˆInterceptor moduleï¼‰</h3><p>ç°åœ¨æ¥çœ‹çœ‹ axios æ˜¯å¦‚ä½•å®ç°è¯·æ±‚å’Œå“åº”çš„æ‹¦æˆªå™¨æ–¹æ³•ã€‚å…ˆæ¥çœ‹çœ‹ axios çš„ç»Ÿä¸€æ¥å£ â€”â€” <code>request</code> å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/Axios.js</span></span><br><span class="line">Axios.prototype.request = <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other code</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> chain = [dispatchRequest, <span class="literal">undefined</span>];</span><br><span class="line">    <span class="keyword">var</span> promise = <span class="built_in">Promise</span>.resolve(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.interceptors.request.forEach(<span class="function"><span class="keyword">function</span> <span class="title">unshiftRequestInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">        chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.interceptors.response.forEach(<span class="function"><span class="keyword">function</span> <span class="title">pushResponseInterceptors</span>(<span class="params">interceptor</span>) </span>&#123;</span><br><span class="line">        chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (chain.length) &#123;</span><br><span class="line">        promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°æ˜¯ axios å‘é€è¯·æ±‚çš„æ¥å£ã€‚å› ä¸ºè¿™ä¸ªåŠŸèƒ½å®ç°ç›¸å¯¹è¾ƒé•¿ï¼Œæ‰€ä»¥æˆ‘ç®€è¦ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„è®¾è®¡æ€è·¯ï¼š</p><ol><li>chain æ˜¯æ‰§è¡Œé˜Ÿåˆ—ã€‚é˜Ÿåˆ—çš„åˆå§‹å€¼æ˜¯ä¸€ä¸ªå¸¦ config å‚æ•°çš„ Promiseã€‚</li><li>chain æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œæ’å…¥äº†ä¸¤ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥å‘é€è¯·æ±‚çš„åˆå§‹åŒ–å‡½æ•° <code>dispatchRequest</code>ï¼Œä¸€ä¸ªæ˜¯<br>å’Œ <code>dispatchRequest</code> é…å¯¹çš„å‡½æ•° <code>undefined</code>ã€‚ä¸ºä»€ä¹ˆè¦åŠ  <code>undefined</code> å‘¢ï¼Ÿå› ä¸ºåœ¨ Promise é‡Œéœ€è¦ä¸€ä¸ªæˆåŠŸå›è°ƒå’Œä¸€ä¸ªå¤±è´¥å›è°ƒï¼Œä»ä»£ç æ®µ <code>promise = promise.then(chain.shift(), chain.shift());</code> ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ã€‚æ‰€ä»¥ï¼Œ<code>dispatchRequest</code> å’Œ <code>undefined</code> å¯ä»¥å½“æˆæ˜¯æˆå¯¹çš„å‡½æ•°ã€‚</li><li><code>chain</code> æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œå‘é€è¯·æ±‚çš„ <code>dispatchRequest</code> å‡½æ•°ä½äºâ€œä¸­é—´ä½ç½®â€ã€‚åœ¨å®ƒçš„å‰é¢æ˜¯è¯·æ±‚æ‹¦æˆªå™¨ï¼Œé€šè¿‡ <code>unshift</code> æ–¹æ³•æ’å…¥ï¼›åœ¨ <code>dispatchRequest</code> åé¢çš„æ˜¯å“åº”æ‹¦æˆªå™¨ï¼Œé€šè¿‡ <code>push</code> æ–¹æ³•æ’å…¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™äº›æ–¹æ³•éƒ½æ˜¯æˆå¯¹æ·»åŠ çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸€æ¬¡ä¼šæ·»åŠ ä¸¤ä¸ªæ–¹æ³•ã€‚</li></ol><p>é€šè¿‡ä¸Šè¿° <code>request</code> çš„ä»£ç ï¼Œæˆ‘ä»¬å¤§è‡´çŸ¥é“æ€ä¹ˆä½¿ç”¨æ‹¦æˆªå™¨äº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆå–æ¶ˆ HTTP è¯·æ±‚ã€‚</p><h3 id="å–æ¶ˆè¯·æ±‚æ¨¡å—ï¼ˆCancel-request-moduleï¼‰"><a href="#å–æ¶ˆè¯·æ±‚æ¨¡å—ï¼ˆCancel-request-moduleï¼‰" class="headerlink" title="å–æ¶ˆè¯·æ±‚æ¨¡å—ï¼ˆCancel-request moduleï¼‰"></a>å–æ¶ˆè¯·æ±‚æ¨¡å—ï¼ˆCancel-request moduleï¼‰</h3><p>å’Œå–æ¶ˆç›¸å…³çš„æ¨¡å—åœ¨ <code>Cancel/</code> ç›®å½•ã€‚ç°åœ¨æ¥çœ‹ä¸€ä¸‹ç›¸å…³çš„æ ¸å¿ƒä»£ç ã€‚</p><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å…ƒç±» <code>Cancel</code>ã€‚è¿™ä¸ªç±»æ˜¯ç”¨æ¥æ ‡è®°å–æ¶ˆçŠ¶æ€ã€‚ä»£ç ç»†èŠ‚å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cancel/Cancel.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Cancel'</span> + (<span class="keyword">this</span>.message ? <span class="string">': '</span> + <span class="keyword">this</span>.message : <span class="string">''</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.__CANCEL__ = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ <code>CancelToken</code> ç±»ä¸­ï¼Œé€šè¿‡ä¼ é€’ Promise æ–¹æ³•æ¥å®ç° HTTP è¯·æ±‚çš„å–æ¶ˆï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cancel/CancelToken.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CancelToken</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">'function'</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'executor must be a function.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> resolvePromise;</span><br><span class="line">    <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">promiseExecutor</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        resolvePromise = resolve;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> token = <span class="keyword">this</span>;</span><br><span class="line">    executor(<span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">            <span class="comment">// Cancellation has already been requested</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        token.reason = <span class="keyword">new</span> Cancel(message);</span><br><span class="line">        resolvePromise(token.reason);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CancelToken.source = <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cancel;</span><br><span class="line">    <span class="keyword">var</span> token = <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">        cancel = c;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        token: token,</span><br><span class="line">        cancel: cancel</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç›¸å…³çš„å–æ¶ˆè¯·æ±‚çš„ä»£ç åœ¨ <code>adapter/xhr.js</code> æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// adapter/xhr.js</span></span><br><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">    <span class="comment">// Wait for the cancellation.</span></span><br><span class="line">    config.cancelToken.promise.then(<span class="function"><span class="keyword">function</span> <span class="title">onCanceled</span>(<span class="params">cancel</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        request.abort();</span><br><span class="line">        reject(cancel);</span><br><span class="line">        <span class="comment">// Reset the request.</span></span><br><span class="line">        request = <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°å–æ¶ˆ HTTP è¯·æ±‚çš„ä»£ç ï¼Œæˆ‘ä»¬ç®€è¦çš„è§£é‡Šä¸€ä¸‹ç›¸å…³å®ç°é€»è¾‘ï¼š</p><ol><li>åœ¨éœ€è¦å–æ¶ˆçš„è¯·æ±‚ä¸­ï¼Œè°ƒç”¨ <code>source</code> æ–¹æ³•æ¥åˆå§‹åŒ–ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å› <code>CancelToken</code> ç±»çš„å®ä¾‹ A å’Œ <code>cancle</code> æ–¹æ³•ã€‚</li><li>å½“ <code>source</code> æ–¹æ³•è¿”å›å®ä¾‹ A æ—¶ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªå¤„äº <code>pending</code> çŠ¶æ€çš„ promiseã€‚ç„¶åæŠŠå®ä¾‹ A ä¼ é€’ç»™ axiosï¼Œpromise å°±å¯ä»¥å½“åšå–æ¶ˆè¯·æ±‚çš„è§¦å‘å™¨ã€‚</li><li>å½“è°ƒç”¨ <code>source</code> æ–¹æ³•è¿”å›çš„ <code>cancel</code> æ–¹æ³•æ—¶ï¼Œå®ä¾‹ A ä¸­çš„ promise ä» pending è½¬åŒ–æˆ fulfilled çŠ¶æ€ï¼Œç„¶åé©¬ä¸Šè§¦å‘å›è°ƒå‡½æ•°ã€‚ä»è€Œ axios çš„å–æ¶ˆé€»è¾‘ â€”â€” <code>request.abort()</code> è¢«è§¦å‘ã€‚</li></ol><h2 id="axios-çš„è®¾è®¡ä¼˜ç‚¹"><a href="#axios-çš„è®¾è®¡ä¼˜ç‚¹" class="headerlink" title="axios çš„è®¾è®¡ä¼˜ç‚¹"></a>axios çš„è®¾è®¡ä¼˜ç‚¹</h2><h3 id="å‘é€è¯·æ±‚å‡½æ•°çš„å¤„ç†é€»è¾‘"><a href="#å‘é€è¯·æ±‚å‡½æ•°çš„å¤„ç†é€»è¾‘" class="headerlink" title="å‘é€è¯·æ±‚å‡½æ•°çš„å¤„ç†é€»è¾‘"></a>å‘é€è¯·æ±‚å‡½æ•°çš„å¤„ç†é€»è¾‘</h3><p>æ­£å¦‚å‰é¢ç« èŠ‚æåˆ°çš„ï¼Œaxios å¹¶æ²¡æœ‰æŠŠå‘é€è¯·æ±‚çš„ <code>dispatchRequest</code> å‡½æ•°å½“æˆç‰¹æ®Šå‡½æ•°å¯¹å¾…ã€‚å®é™…ä¸Šï¼Œ<code>dispatchRequest</code> å‡½æ•°æ”¾åœ¨é˜Ÿåˆ—çš„ä¸­é—´ï¼Œä»è€Œä¿è¯é˜Ÿåˆ—å¤„ç†çš„ä¸€è‡´æ€§å¹¶æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p><h3 id="é€‚é…å™¨çš„å¤„ç†é€»è¾‘"><a href="#é€‚é…å™¨çš„å¤„ç†é€»è¾‘" class="headerlink" title="é€‚é…å™¨çš„å¤„ç†é€»è¾‘"></a>é€‚é…å™¨çš„å¤„ç†é€»è¾‘</h3><p>åœ¨é€‚é…å™¨çš„çš„å¤„ç†é€»è¾‘ä¸­ï¼Œ<code>http</code> å’Œ <code>xhr</code> æ¨¡å—ï¼ˆ<code>http</code> ç”¨äº Node.js å‘é€è¯·æ±‚ï¼Œ<code>xhr</code> ç”¨äºæµè§ˆå™¨å‘é€è¯·æ±‚ï¼‰å¹¶ä¸ç›´æ¥æ”¾åœ¨ <code>dispatchRequest</code> æ¨¡å—ä¸­ï¼Œè€Œæ˜¯é€šè¿‡é»˜è®¤é…ç½®ä» <code>default.js</code> å¼•å…¥ã€‚ä»è€Œä¸ä»…å¯ä»¥ä¿è¯ä¸¤ä¸ªæ¨¡å—çš„ä½è€¦åˆï¼Œè€Œä¸”ä¸ºå°†æ¥çš„ç”¨æˆ·é¢„ç•™äº†å®šåˆ¶åŒ–è¯·æ±‚çš„ç©ºé—´ã€‚</p><h3 id="å–æ¶ˆ-HTTP-è¯·æ±‚çš„å¤„ç†é€»è¾‘"><a href="#å–æ¶ˆ-HTTP-è¯·æ±‚çš„å¤„ç†é€»è¾‘" class="headerlink" title="å–æ¶ˆ HTTP è¯·æ±‚çš„å¤„ç†é€»è¾‘"></a>å–æ¶ˆ HTTP è¯·æ±‚çš„å¤„ç†é€»è¾‘</h3><p>åœ¨å–æ¶ˆ HTTP è¯·æ±‚çš„é€»è¾‘ä¸­ï¼Œaxios è®¾è®¡ä½¿ç”¨ Promise ä½œä¸ºè§¦å‘å™¨ï¼ŒæŠŠ <code>resolve</code> æ–¹æ³•ä½œä¸º <code>callback</code> çš„å‚æ•°ä¼ é€’åˆ°å¤–é¢ã€‚è¿™æ ·ä¸ä»…ç¡®ä¿å†…éƒ¨é€»è¾‘çš„ä¸€è‡´æ€§ï¼Œè¿˜å¯ä»¥ç¡®ä¿åœ¨éœ€è¦å–æ¶ˆè¯·æ±‚æ—¶ï¼Œä¸å¿…ç›´æ¥ä¿®æ”¹ç›¸å…³ç±»çš„æ ·æœ¬æ•°æ®ï¼Œä»è€Œå¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…ä¾µå…¥å…¶ä»–çš„æ¨¡å—ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† axios çš„ä½¿ç”¨ï¼Œè®¾è®¡æ€è·¯å’Œå®ç°æ–¹æ³•ã€‚é˜…è¯»åï¼Œä½ å¯ä»¥çŸ¥é“ axios çš„è®¾è®¡ï¼ŒåŒæ—¶å­¦ä¹ æ¨¡å—çš„å°è£…å’Œäº¤äº’ã€‚</p><p>æœ¬æ–‡åªä»‹ç»äº† axios çš„æ ¸å¿ƒæ¨¡å—ã€‚å¦‚æœä½ å¯¹å…¶ä»–æºç æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å» <a href="https://github.com/axios/axios" target="_blank" rel="noopener">Github</a> ä¸ŠæŸ¥çœ‹ã€‚</p><p><em>åœ¨ <a href="http://www.ruanyifeng.com/blog/2018/08/weekly-issue-20.html" target="_blank" rel="noopener">é˜®ä¸€å³°æ¯å‘¨åˆ†äº«ç¬¬ 20 æœŸ</a> çœ‹åˆ°è¿™ç¯‡æ–‡ç« ã€‚æ–‡ç« æ²¡æœ‰å¾ˆå¤æ‚çš„ä¸œè¥¿ï¼Œä¹Ÿä¸æ˜¯å¾ˆç»†è‡´çš„ä½¿ç”¨è¯´æ˜æˆ–è€…æºç è§£è¯»ï¼Œä½œè€…ä¸»è¦æ˜¯å¯¹ axios å†…éƒ¨è®¾è®¡è¿›è¡Œåˆ†æï¼Œä»æ•´ä½“ä¸Šäº†è§£å…¶ä¸­çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³ã€‚ç¿»è¯‘å¯èƒ½æœ‰ä¸å‡†ç¡®æˆ–è€…é”™è¯¯åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</em></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;&lt;p&gt;åŸæ–‡: &lt;a href=&quot;https://www.tutorialdocs.com/article/axios-learn.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;How to Implement an HTTP Request Library with Axios&lt;/a&gt;&lt;br&gt;ä½œè€…ï¼šAlex&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h2&gt;&lt;p&gt;åœ¨å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°éœ€è¦ç”¨åˆ°å¼‚æ­¥è¯·æ±‚çš„åœºæ™¯ã€‚æ‰€ä»¥ï¼Œä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ HTTP è¯·æ±‚åº“ï¼Œå¯ä»¥æå¤§çš„å‡å°‘å¼€å‘æ—¶é—´ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚&lt;/p&gt;&lt;p&gt;axios æ˜¯è¿‘å‡ å¹´éå¸¸çƒ­é—¨ HTTP è¯·æ±‚åº“ã€‚ç›®å‰åœ¨ &lt;a href=&quot;https://github.com/axios/axios&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Github&lt;/a&gt; å·²ç»æœ‰è¶…è¿‡ 40k çš„ starsï¼Œä¹Ÿå¾—åˆ°å¾ˆå¤šæƒå¨äººå£«çš„æ¨èã€‚&lt;/p&gt;&lt;p&gt;å› æ­¤ï¼Œæœ‰å¿…è¦å»äº†è§£ä¸€ä¸‹ axios æ˜¯å¦‚ä½•è®¾è®¡çš„ã€æ˜¯å¦‚ä½•å®ç° HTTP è¯·æ±‚åº“çš„ã€‚å†™è¿™ç¯‡æ–‡ç« æ—¶ axios çš„ç‰ˆæœ¬æ˜¯ 0.18.0ï¼Œæˆ‘ä»¬ä»¥æ­¤ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæ¥è§£è¯»åˆ†ææºç ç»†èŠ‚ã€‚axios çš„æºç æ˜¯åœ¨ lib ç›®å½•ä¸‹ï¼Œä»¥ä¸‹æ¶‰åŠåˆ°çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹ &lt;code&gt;lib&lt;/code&gt; ç›®å½•ã€‚&lt;/p&gt;&lt;p&gt;æ­¤ç¯‡ä¸»è¦è®¨è®ºä¸€ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¦‚ä½•ä½¿ç”¨ axios&lt;/li&gt;&lt;li&gt;axios æ ¸å¿ƒæ¨¡å—ï¼ˆè¯·æ±‚ requests, æ‹¦æˆªå™¨ interceptors, æ’¤é”€ withdrawalsï¼‰çš„è®¾è®¡å’Œå®ç°æ–¹å¼&lt;/li&gt;&lt;li&gt;axios çš„è®¾è®¡ä¼˜ç‚¹&lt;/li&gt;&lt;/ul&gt;
    
    </summary>
    
      <category term="ç¿»è¯‘" scheme="https://blog.hhking.cn/categories/%E7%BF%BB%E8%AF%91/"/>
    
    
      <category term="å‰ç«¯" scheme="https://blog.hhking.cn/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="Ajax" scheme="https://blog.hhking.cn/tags/Ajax/"/>
    
      <category term="æºç åˆ†æ" scheme="https://blog.hhking.cn/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
</feed>
